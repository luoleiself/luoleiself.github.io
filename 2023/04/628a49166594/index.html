<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon-32x32.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"luoleiself.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="可读流ReadableStream创建并从给定的 Handler 返回一个可读流对象 RS 构造方法创建并从给定的处理程序返回一个可读的流对象 可读流配置项underlyingSource 可选的定义可读流的行为方式的配置项  start(controller) 由开发人员定义, 当流对象被创建时立刻调用, 执行其他任何必须的设置流功能, 如果过程是异步的则返回一个 Promise control">
<meta property="og:type" content="article">
<meta property="og:title" content="Stream">
<meta property="og:url" content="https://luoleiself.github.io/2023/04/628a49166594/index.html">
<meta property="og:site_name" content="luoleiself&#39;s blog">
<meta property="og:description" content="可读流ReadableStream创建并从给定的 Handler 返回一个可读流对象 RS 构造方法创建并从给定的处理程序返回一个可读的流对象 可读流配置项underlyingSource 可选的定义可读流的行为方式的配置项  start(controller) 由开发人员定义, 当流对象被创建时立刻调用, 执行其他任何必须的设置流功能, 如果过程是异步的则返回一个 Promise control">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-04-12T07:52:05.000Z">
<meta property="article:modified_time" content="2024-07-26T14:00:47.967Z">
<meta property="article:author" content="luoleiself">
<meta property="article:tag" content="API">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://luoleiself.github.io/2023/04/628a49166594/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Stream | luoleiself's blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5fa63b434a4b3e74b6258584372c74c0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="luoleiself's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">luoleiself's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/luoleiself" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://luoleiself.github.io/2023/04/628a49166594/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="luoleiself">
      <meta itemprop="description" content="努力的往前飞, 再累也无所谓, 黑夜过后的光芒有多美...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="luoleiself's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Stream
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-04-12 15:52:05" itemprop="dateCreated datePublished" datetime="2023-04-12T15:52:05+08:00">2023-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-07-26 22:00:47" itemprop="dateModified" datetime="2024-07-26T22:00:47+08:00">2024-07-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/WebAPI/" itemprop="url" rel="index"><span itemprop="name">WebAPI</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>13 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="可读流"><a href="#可读流" class="headerlink" title="可读流"></a>可读流</h2><h3 id="ReadableStream"><a href="#ReadableStream" class="headerlink" title="ReadableStream"></a>ReadableStream</h3><p>创建并从给定的 Handler 返回一个可读流对象</p>
<h4 id="RS-构造方法"><a href="#RS-构造方法" class="headerlink" title="RS 构造方法"></a>RS 构造方法</h4><p>创建并从给定的处理程序返回一个可读的流对象</p>
<h5 id="可读流配置项"><a href="#可读流配置项" class="headerlink" title="可读流配置项"></a>可读流配置项</h5><p><code>underlyingSource</code> 可选的定义可读流的行为方式的配置项</p>
<ul>
<li>start(controller) 由开发人员定义, 当流对象被创建时立刻调用, 执行其他任何必须的设置流功能, 如果过程是异步的则返回一个 Promise<ul>
<li>controller 根据 <code>type=&#39;bytes&#39;</code> 属性传递的 <code>ReadableStreamDefaultController</code> 或 <code>ReadableByteStreamController</code> 控制器实例</li>
</ul>
</li>
<li>pull(controller) 由开发人员定义, 当流的内部队列不满时, 会重复调用这个方法, 直到队列补满</li>
<li>cancel(reason) 由开发人员定义, 当该流被取消时调用</li>
<li>type 控制正在处理的可读类型的流, 默认 <code>ReadableStreamDefaultController</code>, <code>type=&#39;bytes&#39;</code> 表示 <code>ReadableByteStreamController</code></li>
<li>autoAllocateChunkSize 开启流自动分配缓冲区, 使用正整数设置</li>
</ul>
<span id="more"></span>

<h5 id="可读流队列策略配置项"><a href="#可读流队列策略配置项" class="headerlink" title="可读流队列策略配置项"></a>可读流队列策略配置项</h5><p><code>queuingStrategy</code> 可选的为流定义排队策略的配置项</p>
<ul>
<li>highWaterMark 非负整数, 定义应用在背压之前可以包含在内部队列中的块的总数</li>
<li>size(chunk) 表示每个分块使用的大小(以字节为单位)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queuingStrategy = <span class="keyword">new</span> <span class="title class_">CountQueuingStrategy</span>(&#123; <span class="attr">highWaterMark</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> rs = <span class="keyword">new</span> <span class="title class_">ReadableStream</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 当创建实例时执行, 用于设置流功能, 可以返回一个 Promise</span></span><br><span class="line">    <span class="title function_">start</span>(<span class="params">controller</span>) &#123;</span><br><span class="line">      interval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> string = <span class="title function_">randomChars</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add the string to the stream</span></span><br><span class="line">        controller.<span class="title function_">enqueue</span>(string);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// show it on the screen</span></span><br><span class="line">        <span class="keyword">let</span> listItem = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">        listItem.<span class="property">textContent</span> = string;</span><br><span class="line">        list1.<span class="title function_">appendChild</span>(listItem);</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">      button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="built_in">clearInterval</span>(interval);</span><br><span class="line">        <span class="title function_">fetchStream</span>();</span><br><span class="line">        controller.<span class="title function_">close</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// // 当流的内部队列不满时, 会重复调用这个方法, 直到队列补满, 如果返回一个 promise, 此方法将不会再被调用</span></span><br><span class="line">    <span class="comment">// pull(controller) &#123;</span></span><br><span class="line">    <span class="comment">//   // We don&#x27;t really need a pull in this example</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="comment">// // 应用程序调用此方法将该流取消, 可以返回一个 Promise</span></span><br><span class="line">    <span class="comment">// cancel() &#123;</span></span><br><span class="line">    <span class="comment">//   // This is called if the reader cancels,</span></span><br><span class="line">    <span class="comment">//   // so we should stop generating strings</span></span><br><span class="line">    <span class="comment">//   clearInterval(interval);</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="comment">// type: &#x27;&#x27;, // 表示该流的类型</span></span><br><span class="line">    <span class="comment">// autoAllocateChunkSize: &#x27;&#x27;, // 开启流自动分配缓冲区</span></span><br><span class="line">  &#125;,</span><br><span class="line">  queuingStrategy</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="RS-实例属性"><a href="#RS-实例属性" class="headerlink" title="RS 实例属性"></a>RS 实例属性</h4><ul>
<li>locked 只读属性, 返回该可读流是否被锁定到一个 reader</li>
</ul>
<h4 id="RS-实例方法"><a href="#RS-实例方法" class="headerlink" title="RS 实例方法"></a>RS 实例方法</h4><h5 id="RS-cancel-reason"><a href="#RS-cancel-reason" class="headerlink" title="RS.cancel(reason)"></a>RS.cancel(reason)</h5><p>取消读取流, 可以传入 reason 参数表示取消原因, 该参数将回传给调用方</p>
<h5 id="RS-getReader-mode"><a href="#RS-getReader-mode" class="headerlink" title="RS.getReader(mode)"></a>RS.getReader(mode)</h5><p>将流锁定到该实例, 一旦流被锁定, 其他 reader 不能读取直到释放</p>
<ul>
<li>默认返回一个 <code>ReadableStreamDefaultReader</code> 实例</li>
<li><code>&#123; mode: &#39;byob&#39; &#125;</code> 返回一个 <code>ReadableStreamBYOBReader</code> 实例</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取 ReadableStreamDefaultReader 实例</span></span><br><span class="line"><span class="keyword">const</span> reader = rs.<span class="title function_">getReader</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 ReadableStreamBYOBReader 实例</span></span><br><span class="line"><span class="keyword">const</span> reader = rs.<span class="title function_">getReader</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;byob&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<h5 id="RS-pipeThrough-transformStream-options"><a href="#RS-pipeThrough-transformStream-options" class="headerlink" title="RS.pipeThrough(transformStream, options)"></a>RS.pipeThrough(transformStream, options)</h5><p>提供当前流管道输出到一个 transform 流或 writable/readable 流对的链式方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;png-logo.png&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span> response.<span class="property">body</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">body</span>) =&gt;</span> body.<span class="title function_">pipeThrough</span>(<span class="keyword">new</span> <span class="title class_">PNGTransformStream</span>()))</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">rs</span>) =&gt;</span> rs.<span class="title function_">pipeTo</span>(<span class="keyword">new</span> <span class="title class_">FinalDestinationStream</span>()));</span><br></pre></td></tr></table></figure>

<h5 id="RS-pipeTo-destination-options"><a href="#RS-pipeTo-destination-options" class="headerlink" title="RS.pipeTo(destination, options)"></a>RS.pipeTo(destination, options)</h5><p>将当前 <code>ReadableStream</code> 管道输出到给定的 <code>WritableStream</code>, 并返回一个 Promise</p>
<h5 id="RS-tee"><a href="#RS-tee" class="headerlink" title="RS.tee()"></a>RS.tee()</h5><p>返回包含两个 <code>ReadableStream</code> 实例分支的数组, 每个元素接收了相同的传输数据</p>
<h3 id="默认读取流"><a href="#默认读取流" class="headerlink" title="默认读取流"></a>默认读取流</h3><blockquote>
<p>通常不需要手动创建, 可以使用 <code>ReadableStream.getReader()</code> 方法获取</p>
</blockquote>
<p><code>ReadableStreamDefaultReader</code> 表示一个用于读取来自网络提供的流数据(例如 fetch 请求)的<strong>默认读取器</strong></p>
<p><code>ReadableStreamDefaultReader</code> 可以用于读取底层为任意类型源的 <code>ReadableStream</code>(与 ReadableStreamBYOBReader 不同, 后者仅可以与底层为字节源的可读流一起使用)</p>
<h4 id="RSDR-构造方法"><a href="#RSDR-构造方法" class="headerlink" title="RSDR 构造方法"></a>RSDR 构造方法</h4><p>构造方法创建并返回一个 <code>ReadableStreamDefaultReader</code> 实例, 通常不需要手动创建</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数 stream 为将被读取的 ReadableStream;</span></span><br><span class="line"><span class="keyword">const</span> rsdr = <span class="keyword">new</span> <span class="title class_">ReadableStreamDefaultReader</span>(stream);</span><br></pre></td></tr></table></figure>

<h4 id="RSDR-实例属性"><a href="#RSDR-实例属性" class="headerlink" title="RSDR 实例属性"></a>RSDR 实例属性</h4><ul>
<li>closed 只读属性, 返回一个 Promise, 在流关闭时兑现</li>
</ul>
<h4 id="RSDR-实例方法"><a href="#RSDR-实例方法" class="headerlink" title="RSDR 实例方法"></a>RSDR 实例方法</h4><h5 id="RSDR-cancel-reason"><a href="#RSDR-cancel-reason" class="headerlink" title="RSDR.cancel(reason)"></a>RSDR.cancel(reason)</h5><p>返回一个 Promise, 当流被取消时兑现, 调用此方法取消流可传入 reason 参数表示取消原因</p>
<h5 id="RSDR-read"><a href="#RSDR-read" class="headerlink" title="RSDR.read()"></a>RSDR.read()</h5><p>返回一个 Promise, 提供对流内部队列中下一个分块的访问权限 {value: theChunk, done: false} 表示可用, {value: undefined, done: true} 表示流已关闭</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rsdr = rs.<span class="title function_">getReader</span>();</span><br><span class="line">rsdr.<span class="title function_">read</span>().<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">&#123; done, value &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (done) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;rsdr complete...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 取消流</span></span><br><span class="line">    rsdr.<span class="title function_">cancel</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放读取流的锁</span></span><br><span class="line">rsdr.<span class="title function_">releaseLock</span>();</span><br></pre></td></tr></table></figure>

<h5 id="RSDR-releaseLock"><a href="#RSDR-releaseLock" class="headerlink" title="RSDR.releaseLock()"></a>RSDR.releaseLock()</h5><p>释放读取这个流的锁</p>
<h3 id="字节读取流"><a href="#字节读取流" class="headerlink" title="字节读取流"></a>字节读取流</h3><blockquote>
<p>通常不需要手动创建，使用 <code>ReadableStream.getReader(&#123; mode: &#39;byob&#39; &#125;)</code> 方法获取</p>
</blockquote>
<p><code>ReadableStreamBYOBReader</code> 表示一个支持从底层字节源进行零拷贝读取的读取器, 用于从底层源进行高效复制, 其中数据以匿名字节序列的形式传递</p>
<h4 id="RSBYOBR-构造方法"><a href="#RSBYOBR-构造方法" class="headerlink" title="RSBYOBR 构造方法"></a>RSBYOBR 构造方法</h4><p>构造方法创建并返回一个 <code>ReadableStreamBYOBReader</code> 实例, 通常不需要手动创建</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数 stream 为将被读取的 ReadableStream</span></span><br><span class="line"><span class="keyword">const</span> rsbyobr = <span class="keyword">new</span> <span class="title class_">ReadableStreamBYOBReader</span>(stream);</span><br></pre></td></tr></table></figure>

<h4 id="RSBYOBR-实例属性"><a href="#RSBYOBR-实例属性" class="headerlink" title="RSBYOBR 实例属性"></a>RSBYOBR 实例属性</h4><ul>
<li>closed 只读属性, 返回一个 Promise, 在流关闭时兑现</li>
</ul>
<h4 id="RSBYOBR-实例方法"><a href="#RSBYOBR-实例方法" class="headerlink" title="RSBYOBR 实例方法"></a>RSBYOBR 实例方法</h4><h5 id="RSBYOBR-cancel-reason"><a href="#RSBYOBR-cancel-reason" class="headerlink" title="RSBYOBR.cancel(reason)"></a>RSBYOBR.cancel(reason)</h5><p>返回一个 Promise, 当流被取消时兑现, 调用此方法取消流可传入 reason 参数表示取消原因</p>
<h5 id="RSBYOBR-read-view"><a href="#RSBYOBR-read-view" class="headerlink" title="RSBYOBR.read(view)"></a>RSBYOBR.read(view)</h5><p>传递一个必须写入数据的视图, 并返回一个 Promise 解析为流中的下一个块的视图或者表示流已关闭或出错的指示的视图</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rsbyobr = rs.<span class="title function_">getReader</span>(&#123; <span class="attr">mode</span>: <span class="string">&#x27;byob&#x27;</span> &#125;);</span><br><span class="line"><span class="keyword">let</span> buffer = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(<span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">4000</span>));</span><br><span class="line">rsbyobr.<span class="title function_">read</span>(buffer).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">&#123; done, value &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (done) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;rsbyobr complete...&#x27;</span>);</span><br><span class="line">    <span class="comment">// 取消流</span></span><br><span class="line">    rsbyobr.<span class="title function_">cancel</span>();</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 释放读取流的锁</span></span><br><span class="line">rsbyobr.<span class="title function_">releaseLock</span>();</span><br></pre></td></tr></table></figure>

<h5 id="RSBYOBR-releaseLock"><a href="#RSBYOBR-releaseLock" class="headerlink" title="RSBYOBR.releaseLock()"></a>RSBYOBR.releaseLock()</h5><p>释放读取这个流的锁</p>
<h3 id="默认读取流控制器"><a href="#默认读取流控制器" class="headerlink" title="默认读取流控制器"></a>默认读取流控制器</h3><blockquote>
<p><strong>无构造函数</strong>, <code>ReadableStreamDefaultController</code> 实例会在构造 <code>ReadableStream</code> 时被自动创建</p>
</blockquote>
<p><code>ReadableStreamDefaultController</code> 接口是一个控制器, 允许控制 <code>ReadableStream</code> 的状态和内部队列, 默认控制器用于不是字节流的流</p>
<h4 id="RSDC-实例属性"><a href="#RSDC-实例属性" class="headerlink" title="RSDC 实例属性"></a>RSDC 实例属性</h4><ul>
<li>desiredSize 只读属性, 返回填充满流的内部队列所需要的大小</li>
</ul>
<h4 id="RSDC-实例方法"><a href="#RSDC-实例方法" class="headerlink" title="RSDC 实例方法"></a>RSDC 实例方法</h4><h5 id="RSDC-close"><a href="#RSDC-close" class="headerlink" title="RSDC.close()"></a>RSDC.close()</h5><p>关闭关联的流</p>
<h5 id="RSDC-enqueue-chunk"><a href="#RSDC-enqueue-chunk" class="headerlink" title="RSDC.enqueue(chunk)"></a>RSDC.enqueue(chunk)</h5><p>将给定的块加入关联的流</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按下按钮时, 关闭流并运行另一个函数从流中读取数据</span></span><br><span class="line"><span class="keyword">let</span> interval;</span><br><span class="line"><span class="keyword">const</span> rs = <span class="keyword">new</span> <span class="title class_">ReadableStream</span>(&#123;</span><br><span class="line">  <span class="title function_">start</span>(<span class="params">controller</span>) &#123;</span><br><span class="line">    interval = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> string = <span class="title function_">randomChars</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add the string to the stream</span></span><br><span class="line">      controller.<span class="title function_">enqueue</span>(string);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// show it on the screen</span></span><br><span class="line">      <span class="keyword">let</span> listItem = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">      listItem.<span class="property">textContent</span> = string;</span><br><span class="line">      list1.<span class="title function_">appendChild</span>(listItem);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    button.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">clearInterval</span>(interval);</span><br><span class="line">      <span class="title function_">fetchStream</span>();</span><br><span class="line">      controller.<span class="title function_">close</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">pull</span>(<span class="params">controller</span>) &#123;&#125;,</span><br><span class="line">  <span class="title function_">cancel</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(interval);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="RSDC-error-message"><a href="#RSDC-error-message" class="headerlink" title="RSDC.error(message)"></a>RSDC.error(message)</h5><p>导致未来任何与关联流的交互都会出错</p>
<h3 id="字节读取流控制器"><a href="#字节读取流控制器" class="headerlink" title="字节读取流控制器"></a>字节读取流控制器</h3><blockquote>
<p><strong>无构造函数</strong>, 当构造 <code>ReadableStream</code> 时, <code>type=&quot;bytes&quot;</code> 将自动创建 <code>ReadableByteStreamController</code> 实例</p>
</blockquote>
<p><code>ReadableByteStreamController</code> 接口是一个控制器, 允许控制具有底层字节源的状态和内部队列, 并在流的内部队列为空时实现从底层源到消费者的高效零拷贝数据传输</p>
<h4 id="RBSC-实例属性"><a href="#RBSC-实例属性" class="headerlink" title="RBSC 实例属性"></a>RBSC 实例属性</h4><ul>
<li>byobRequest 返回当前的 <code>BYOB</code> 拉取请求, 如果没有未处理的请求则返回 null</li>
<li>desiredSize 返回填充流内部队列所需的大小</li>
</ul>
<h4 id="RBSC-实例方法"><a href="#RBSC-实例方法" class="headerlink" title="RBSC 实例方法"></a>RBSC 实例方法</h4><h5 id="RBSC-close"><a href="#RBSC-close" class="headerlink" title="RBSC.close()"></a>RBSC.close()</h5><p>关闭关联的流</p>
<h5 id="RBSC-enqueue-chunk"><a href="#RBSC-enqueue-chunk" class="headerlink" title="RBSC.enqueue(chunk)"></a>RBSC.enqueue(chunk)</h5><p>将给定的块加入关联的流</p>
<h5 id="RBSC-error-message"><a href="#RBSC-error-message" class="headerlink" title="RBSC.error(message)"></a>RBSC.error(message)</h5><p>导致未来任何与关联流的交互都会出错</p>
<h2 id="可写流"><a href="#可写流" class="headerlink" title="可写流"></a>可写流</h2><h3 id="WritableStream"><a href="#WritableStream" class="headerlink" title="WritableStream"></a>WritableStream</h3><p>将流数据写入目的地(称为 sink) 提供了一个标准的抽象</p>
<h4 id="WS-构造方法"><a href="#WS-构造方法" class="headerlink" title="WS 构造方法"></a>WS 构造方法</h4><p>创建一个新的 <code>WritableStream</code> 实例</p>
<h5 id="可写流配置项"><a href="#可写流配置项" class="headerlink" title="可写流配置项"></a>可写流配置项</h5><p><code>underlyingSource</code> 可选的定义可读流的行为方式的配置项</p>
<ul>
<li>start(controller) 由开发人员定义, 当流对象被创建时立刻调用, 执行其他任何必须的设置流功能, 如果过程是异步的则返回一个 Promise<ul>
<li>controller 传递的 <code>WritableStreamDefaultController</code> 控制器实例</li>
</ul>
</li>
<li>write(chunk, controller) 由开发人员定义, 当新数据块准备好写入底层接收器时将被调用<ul>
<li>chunk 指定的数据块</li>
</ul>
</li>
<li>close(controller) 由开发人员定义, 如果应用发出信号表明它已完成块写入流, 则将调用此方法</li>
<li>abort(reason) 由开发人员定义, 如果应用发出信号表示它希望突然关闭流并将其置于错误状态, 则将调用此方法</li>
</ul>
<h5 id="可写流队列策略配置项"><a href="#可写流队列策略配置项" class="headerlink" title="可写流队列策略配置项"></a>可写流队列策略配置项</h5><p><code>queuingStrategy</code> 可选的为流定义排队策略的配置项</p>
<ul>
<li>highWaterMark 非负整数, 定义应用在背压之前可以包含在内部队列中的块的总数</li>
<li>size(chunk) 表示每个分块使用的大小(以字节为单位)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queuingStrategy = <span class="keyword">new</span> <span class="title class_">CountQueuingStrategy</span>(&#123; <span class="attr">highWaterMark</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="title class_">WritableStream</span>(&#123;</span><br><span class="line">  <span class="title function_">start</span>(<span class="params">controller</span>) &#123;&#125;,</span><br><span class="line">  <span class="title function_">write</span>(<span class="params">chunk, controller</span>) &#123;&#125;,</span><br><span class="line">  <span class="title function_">close</span>(<span class="params">controller</span>) &#123;&#125;,</span><br><span class="line">  <span class="title function_">abort</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;error &#x27;</span>, reason);</span><br><span class="line">  &#125;,</span><br><span class="line">  queuingStrategy,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="WS-实例属性"><a href="#WS-实例属性" class="headerlink" title="WS 实例属性"></a>WS 实例属性</h4><ul>
<li>locked 只读属性, 返回可写流是否已锁定一个 writer</li>
</ul>
<h4 id="WS-实例方法"><a href="#WS-实例方法" class="headerlink" title="WS 实例方法"></a>WS 实例方法</h4><h5 id="WS-close"><a href="#WS-close" class="headerlink" title="WS.close()"></a>WS.close()</h5><p>关闭关联的流</p>
<h5 id="WS-abort-reason"><a href="#WS-abort-reason" class="headerlink" title="WS.abort(reason)"></a>WS.abort(reason)</h5><p>中止流, 表示不再向流中写入数据(立刻返回一个错误状态) 并丢球所有已入队的数据</p>
<h5 id="WS-getWriter"><a href="#WS-getWriter" class="headerlink" title="WS.getWriter()"></a>WS.getWriter()</h5><p>返回一个新的 <code>WritableStreamDefaultWriter</code> 实例并且将流锁定到该实例, 一旦流被锁定, 其他 writer 不能写入直到释放</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> decoder = <span class="keyword">new</span> <span class="title class_">TextDecoder</span>(<span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> queuingStrategy = <span class="keyword">new</span> <span class="title class_">CountQueuingStrategy</span>(&#123; <span class="attr">highWaterMark</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="keyword">let</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> writer = <span class="keyword">new</span> <span class="title class_">WritableStream</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// 当创建实例时执行, 用于设置流功能, 可以返回一个 Promise</span></span><br><span class="line">    <span class="title function_">start</span>(<span class="params">controller</span>) &#123;&#125;,</span><br><span class="line">    <span class="comment">// 当一个新的 chunk 准备好写入 sink 时调用此方法, 可以返回一个 Promise 来表示写入操作的成功或者失败</span></span><br><span class="line">    <span class="title function_">write</span>(<span class="params">chunk, controller</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> buffer = <span class="keyword">new</span> <span class="title class_">ArrayBuffer</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">var</span> view = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(buffer);</span><br><span class="line">        view[<span class="number">0</span>] = chunk;</span><br><span class="line">        <span class="keyword">var</span> decoded = decoder.<span class="title function_">decode</span>(view, &#123; <span class="attr">stream</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">        <span class="keyword">var</span> listItem = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">        listItem.<span class="property">textContent</span> = <span class="string">&#x27;Chunk decoded: &#x27;</span> + decoded;</span><br><span class="line">        list.<span class="title function_">appendChild</span>(listItem);</span><br><span class="line">        result += decoded;</span><br><span class="line">        <span class="title function_">resolve</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 当应用程序完成所有 chunk 的写入时执行此方法, 可以返回一个 Promise 表示操作成功或失败</span></span><br><span class="line">    <span class="title function_">close</span>(<span class="params">controller</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> listItem = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;li&#x27;</span>);</span><br><span class="line">      listItem.<span class="property">textContent</span> = <span class="string">&#x27;[MESSAGE RECEIVED] &#x27;</span> + result;</span><br><span class="line">      list.<span class="title function_">appendChild</span>(listItem);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 立即关闭流并且丢弃所有入队数据时执行此方法, 可以返回一个 Promise 表示操作成功或失败</span></span><br><span class="line">    <span class="title function_">abort</span>(<span class="params">reason</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Sink error:&#x27;</span>, err);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  queuingStrategy</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="默认写入流"><a href="#默认写入流" class="headerlink" title="默认写入流"></a>默认写入流</h3><blockquote>
<p>通常不需要手动创建, 可以使用 <code>WritableStream.getWriter()</code> 方法获取</p>
</blockquote>
<p><code>WritableStreamDefaultWriter</code> 一旦创建就会锁定 Writer, 以确保没有其他流可以写入底层接收器</p>
<h4 id="WSDW-构造方法"><a href="#WSDW-构造方法" class="headerlink" title="WSDW 构造方法"></a>WSDW 构造方法</h4><p>构造方法创建并返回一个 <code>WritableStreamDefaultWriter</code> 实例, 通常不需要手动创建</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数 stream 为将被写入的 WritableStream</span></span><br><span class="line"><span class="keyword">const</span> wsdw = <span class="keyword">new</span> <span class="title class_">WritableStreamDefaultWriter</span>(stream);</span><br></pre></td></tr></table></figure>

<h4 id="WSDW-实例属性"><a href="#WSDW-实例属性" class="headerlink" title="WSDW 实例属性"></a>WSDW 实例属性</h4><ul>
<li>closed 只读属性, 返回一个 Promise, 在流关闭时兑现</li>
<li>desiredSize 只读属性, 返回填充满流的内部队列所需要的大小</li>
<li>ready 只读属性, 返回一个 Promise, 当流填充内部队列的所需大小从非正数变为正数时兑现</li>
</ul>
<h4 id="WSDW-实例方法"><a href="#WSDW-实例方法" class="headerlink" title="WSDW 实例方法"></a>WSDW 实例方法</h4><h5 id="WSDW-abort-reason"><a href="#WSDW-abort-reason" class="headerlink" title="WSDW.abort(reason)"></a>WSDW.abort(reason)</h5><p>中止流, 返回一个 Promise, 表示生产者不能再向流写入数据(会立刻返回一个错误状态), 并丢弃所有已入队了数据</p>
<h5 id="WSDW-close"><a href="#WSDW-close" class="headerlink" title="WSDW.close()"></a>WSDW.close()</h5><p>关闭关联的可写流, 返回一个 Promise, 如果所有剩余的分块在关闭之前成功写入, 则使用 undefined 兑现, 如果遇到问题则拒绝并返回相关错误</p>
<h5 id="WSDW-releaseLock"><a href="#WSDW-releaseLock" class="headerlink" title="WSDW.releaseLock()"></a>WSDW.releaseLock()</h5><p>释放可写流的锁</p>
<h5 id="WSDW-write-chunk"><a href="#WSDW-write-chunk" class="headerlink" title="WSDW.write(chunk)"></a>WSDW.write(chunk)</h5><p>将传递的数据写入 WritableStream 和它的底层 sink, 返回一个 Promise, 成功写入后使用 undefined 兑现, 如果遇到问题则拒绝并返回相关错误</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wsdw = ws.<span class="title function_">getWriter</span>();</span><br><span class="line"><span class="keyword">const</span> encoder = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br><span class="line"><span class="keyword">const</span> encoded = encoder.<span class="title function_">encode</span>(<span class="string">&#x27;hello world&#x27;</span>, &#123; <span class="attr">stream</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">encoded.<span class="title function_">forEach</span>(<span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">  wsdw.<span class="property">ready</span></span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> wsdw.<span class="title function_">write</span>(chunk))</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;chunk written is to sink.&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;chunk error &#x27;</span>, err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// Call ready again to ensure that all chunks are written</span></span><br><span class="line"><span class="comment">// before closing the writer.</span></span><br><span class="line">wsdw.<span class="property">ready</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    wsdw.<span class="title function_">close</span>();</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;All chunks written&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Stream error &#x27;</span>, err);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="默认写入流控制器"><a href="#默认写入流控制器" class="headerlink" title="默认写入流控制器"></a>默认写入流控制器</h3><blockquote>
<p><strong>无构造函数</strong>, <code>WritableStreamDefaultController</code> 实例会在构造 <code>WritableStream</code> 时被自动创建</p>
</blockquote>
<p><code>WritableStreamDefaultController</code> 接口是一个控制器, 允许控制 <code>WritableStream</code> 状态的控制器, 当构造 <code>WritableStream</code> 时, 会为底层的 sink 提供一个相应的<code>WritableStreamDefaultController</code>实例进行操作</p>
<h4 id="WSDC-实例属性"><a href="#WSDC-实例属性" class="headerlink" title="WSDC 实例属性"></a>WSDC 实例属性</h4><ul>
<li>signal 返回与 <code>AbortSignal</code> 关联的控制器</li>
</ul>
<h4 id="WSDC-实例方法"><a href="#WSDC-实例方法" class="headerlink" title="WSDC 实例方法"></a>WSDC 实例方法</h4><h5 id="WSDC-error-message-导致未来任何与关联流的交互都会出错"><a href="#WSDC-error-message-导致未来任何与关联流的交互都会出错" class="headerlink" title="WSDC.error(message) 导致未来任何与关联流的交互都会出错"></a>WSDC.error(message) 导致未来任何与关联流的交互都会出错</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="title class_">WritableStream</span>(&#123;</span><br><span class="line">  <span class="title function_">start</span>(<span class="params">controller</span>) &#123;</span><br><span class="line">    controller.<span class="title function_">error</span>(<span class="string">&#x27;Stream is broken&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">write</span>(<span class="params">chunk, controller</span>) &#123;&#125;,</span><br><span class="line">  <span class="title function_">close</span>(<span class="params">controller</span>) &#123;&#125;,</span><br><span class="line">  <span class="title function_">abort</span>(<span class="params">err</span>) &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="转换流"><a href="#转换流" class="headerlink" title="转换流"></a>转换流</h2><h3 id="TransformStream"><a href="#TransformStream" class="headerlink" title="TransformStream"></a>TransformStream</h3><p><code>TransformStream</code> 接口表示链式管道传输转换流概念的具体实现, 可以传给 <code>ReadableStream.pipeThrough()</code> 方法将流数据从一种格式转换成另一种, 例如, 可以用于解码(编码)视频帧, 解压数据或者将流从 XML 转换成 JSON</p>
<h4 id="TS-构造方法"><a href="#TS-构造方法" class="headerlink" title="TS 构造方法"></a>TS 构造方法</h4><p>创建并返回一个转换流对象, 可以选择为流指定一个转换对象和排队策略</p>
<h5 id="转换流配置项"><a href="#转换流配置项" class="headerlink" title="转换流配置项"></a>转换流配置项</h5><p>transformer 可选的表示转换流的对象, 如果未提供, 则生成的流将是一个恒等交换流, 它将所有写入可写端的分块转发到可读端, 不会有任何该表</p>
<ul>
<li>start(controller) 当 <code>TransformStream</code> 创建时被调用, 通常用于使用 <code>TransformStreamDefaultController.enqueue()</code> 对分块进行排队</li>
<li>transform(chunk, controller) 当一个写入可写端的分块准备好转换时调用, 并执行转换流的工作, 如果没有提供则使用恒等交换</li>
<li>flush(controller) 当所有写入可写端的分块成功转换后被调用, 并且可写端将会关闭</li>
</ul>
<h5 id="写入流队列策略配置项"><a href="#写入流队列策略配置项" class="headerlink" title="写入流队列策略配置项"></a>写入流队列策略配置项</h5><p><code>writableStrategy</code> 可选的定义写入流队列策略的配置项</p>
<ul>
<li>highWaterMark 非负整数, 定义应用在背压之前可以包含在内部队列中的块的总数</li>
<li>size(chunk) 表示每个分块使用的大小(以字节为单位)</li>
</ul>
<h5 id="读取流队列策略配置项"><a href="#读取流队列策略配置项" class="headerlink" title="读取流队列策略配置项"></a>读取流队列策略配置项</h5><p><code>readableStrategy</code> 可选的定义读取流队列策略的配置项</p>
<ul>
<li>highWaterMark 非负整数, 定义应用在背压之前可以包含在内部队列中的块的总数</li>
<li>size(chunk) 表示每个分块使用的大小(以字节为单位)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> writableStrategy = <span class="keyword">new</span> <span class="title class_">CountQueuingStrategy</span>(&#123; <span class="attr">highWaterMark</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> readableStrategy = <span class="keyword">new</span> <span class="title class_">CountQueuingStrategy</span>(&#123; <span class="attr">highWaterMark</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> ts = <span class="keyword">new</span> <span class="title class_">TransformStream</span>(&#123;</span><br><span class="line">  <span class="comment">// 当创建实例时执行, 通常用于使用 enqueue 对分块进行排队</span></span><br><span class="line">  <span class="title function_">start</span>(<span class="params">controller</span>) &#123;&#125;,</span><br><span class="line">  <span class="comment">// 当一个写入可写端的分块准备好转换时调用，并且执行转换流的工作</span></span><br><span class="line">  <span class="comment">// 如果不提供此方法则使用恒等变换并且分块将在没有更改的情况下排队</span></span><br><span class="line">  <span class="title function_">transform</span>(<span class="params">chunk, controller</span>) &#123;&#125;,</span><br><span class="line">  <span class="comment">// 当所有写入可写端的分块成功转换后被调用, 并且可写端将会关闭</span></span><br><span class="line">  <span class="title function_">flush</span>(<span class="params">controller</span>) &#123;&#125;,</span><br><span class="line">  writableStrategy,</span><br><span class="line">  readableStrategy,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="TS-实例属性"><a href="#TS-实例属性" class="headerlink" title="TS 实例属性"></a>TS 实例属性</h4><ul>
<li>readable 只读属性, 转换流的 readable 端</li>
<li>writable 只读属性, 转换流的 writable 端</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> writableStrategy = <span class="keyword">new</span> <span class="title class_">ByteLengthQueuingStrategy</span>(&#123;</span><br><span class="line">  <span class="attr">highWaterMark</span>: <span class="number">1024</span> * <span class="number">1024</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="property">body</span>;</span><br><span class="line"><span class="keyword">const</span> ts = <span class="keyword">new</span> <span class="title class_">TransformStream</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title function_">transform</span>(<span class="params">chunk, controller</span>) &#123;</span><br><span class="line">      controller.<span class="title function_">enqueue</span>(chunk.<span class="title function_">toUpperCase</span>());</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  writableStrategy</span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="title class_">WritableStream</span>(&#123;</span><br><span class="line">  <span class="title function_">write</span>(<span class="params">chunk, controller</span>) &#123;</span><br><span class="line">    el.<span class="title function_">append</span>(chunk);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;./lorem-ipsum.txt&#x27;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">response</span>) =&gt;</span></span><br><span class="line">  response.<span class="property">body</span>.<span class="title function_">pipeThrough</span>(ts).<span class="title function_">pipeTo</span>(ws)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="默认转换流控制器"><a href="#默认转换流控制器" class="headerlink" title="默认转换流控制器"></a>默认转换流控制器</h3><blockquote>
<p><strong>无构造函数</strong>, <code>TransformStreamDefaultController</code> 实例会在构造 <code>TransformStream</code> 时被自动创建</p>
</blockquote>
<p><code>TransformStreamDefaultController</code> 接口提供操作关联的 <code>ReadableStream</code> 和 <code>WritableStream</code> 的方法</p>
<h4 id="TSDC-实例属性"><a href="#TSDC-实例属性" class="headerlink" title="TSDC 实例属性"></a>TSDC 实例属性</h4><ul>
<li>desiredSize 只读属性, 返回填充满内部队列的可读端所需要的大小</li>
</ul>
<h4 id="TSDC-实例方法"><a href="#TSDC-实例方法" class="headerlink" title="TSDC 实例方法"></a>TSDC 实例方法</h4><h5 id="TSDC-enqueue-chunk"><a href="#TSDC-enqueue-chunk" class="headerlink" title="TSDC.enqueue(chunk)"></a>TSDC.enqueue(chunk)</h5><p>将给定的 chunk 加入流的可读端</p>
<h5 id="TSDC-error-reason"><a href="#TSDC-error-reason" class="headerlink" title="TSDC.error(reason)"></a>TSDC.error(reason)</h5><p>导致转换流的可读端和可写端都会出错</p>
<h5 id="TSDC-terminate"><a href="#TSDC-terminate" class="headerlink" title="TSDC.terminate()"></a>TSDC.terminate()</h5><p>关闭流的可读端并且流的可写端出错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ts = <span class="keyword">new</span> <span class="title class_">TransformStream</span>(&#123;</span><br><span class="line">  <span class="title function_">transform</span>(<span class="params">chunk, controller</span>) &#123;</span><br><span class="line">    controller.<span class="title function_">enqueue</span>(<span class="keyword">new</span> <span class="title class_">TextEncoder</span>().<span class="title function_">encode</span>(chunk));</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">flush</span>(<span class="params">controller</span>) &#123;</span><br><span class="line">    controller.<span class="title function_">terminate</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="TextEncoder"><a href="#TextEncoder" class="headerlink" title="TextEncoder"></a>TextEncoder</h2><p>接受码位流作为输入并提供 UTF-8 字节流作为输出</p>
<h3 id="TE-构造函数"><a href="#TE-构造函数" class="headerlink" title="TE 构造函数"></a>TE 构造函数</h3><p>创建并返回一个新的 <code>TextEncoder</code> 实例, 该实例将生成具有 <code>UTF-8</code> 编码的字节流</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> te = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br></pre></td></tr></table></figure>

<h3 id="TE-实例属性"><a href="#TE-实例属性" class="headerlink" title="TE 实例属性"></a>TE 实例属性</h3><ul>
<li>encoding 只读属性, 总是返回 utf-8</li>
</ul>
<h3 id="TE-实例方法"><a href="#TE-实例方法" class="headerlink" title="TE 实例方法"></a>TE 实例方法</h3><h4 id="TE-encode-string"><a href="#TE-encode-string" class="headerlink" title="TE.encode(string)"></a>TE.encode(string)</h4><p>接受一个字符串输入并返回一个 <code>UTF-8</code> 编码的文本的 <code>Uint8Array</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> te = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br><span class="line"><span class="keyword">const</span> u8arr = te.<span class="title function_">encode</span>(<span class="string">&#x27;hello world&#x27;</span>); <span class="comment">// Uint8Array [104, 101, 108, 108, 111, 32, 119, 111, 114, 108, 100]</span></span><br></pre></td></tr></table></figure>

<h4 id="TE-encodeInto-string-Uint8Array"><a href="#TE-encodeInto-string-Uint8Array" class="headerlink" title="TE.encodeInto(string, Uint8Array)"></a>TE.encodeInto(string, Uint8Array)</h4><p>接受一个字符串和一个目标(Uint8Array 用于存放 UTF-8 编码的文本), 并且返回一个只是编码进度的对象, 此方法性能会比 encode() 更高</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> te = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br><span class="line"><span class="keyword">const</span> uint8Arr = <span class="keyword">new</span> <span class="title class_">Unit8Array</span>(<span class="number">8</span>);</span><br><span class="line">te.<span class="title function_">encodeInto</span>(<span class="string">&#x27;hello world&#x27;</span>, uint8Arr);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(uint8Arr.<span class="title function_">join</span>());</span><br></pre></td></tr></table></figure>

<h2 id="TextDecoder"><a href="#TextDecoder" class="headerlink" title="TextDecoder"></a>TextDecoder</h2><p><code>TextDecoder</code> 接口表示一个文本解码器, 一个解码器只支持一种特定文本编码, 解码器将字节流作为输入并提供码位流作为输出</p>
<h3 id="TD-构造函数"><a href="#TD-构造函数" class="headerlink" title="TD 构造函数"></a>TD 构造函数</h3><p>根据参数指定的编码创建并返回一个新的 <code>TextDecoder</code> 实例</p>
<ul>
<li>label 可选的一个字符串, 默认 <code>utf-8</code>, 可以为任意有效的编码</li>
<li>options 可选的配置项<ul>
<li>fatal 布尔值, 表示在解码无效数据时, <code>decode()</code> 方法是否必须抛出 <code>TypeError</code>, 默认 false</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> td1 = <span class="keyword">new</span> <span class="title class_">TextDecoder</span>(<span class="string">&#x27;iso-8859-2&#x27;</span>);</span><br><span class="line"><span class="comment">// Allow TypeError exception to be thrown</span></span><br><span class="line"><span class="keyword">const</span> td2 = <span class="keyword">new</span> <span class="title class_">TextDecoder</span>(<span class="string">&#x27;csiso2022kr&#x27;</span>, &#123; <span class="attr">fatal</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="TD-实例属性"><a href="#TD-实例属性" class="headerlink" title="TD 实例属性"></a>TD 实例属性</h3><ul>
<li>encoding 只读属性, 表示将使用的编码格式</li>
<li>fatal 只读属性, 表示错误模式是否致命</li>
<li>ignoreBOM 只读属性, 表示是否忽略字节顺序标记(BOM)</li>
</ul>
<h3 id="TD-实例方法"><a href="#TD-实例方法" class="headerlink" title="TD 实例方法"></a>TD 实例方法</h3><h4 id="TD-decode-buffer-stream-false"><a href="#TD-decode-buffer-stream-false" class="headerlink" title="TD.decode(buffer, {stream: false})"></a>TD.decode(buffer, {stream: false})</h4><p>返回一个使用指定编码格式解码的字符串</p>
<ul>
<li>buffer 可选的一个 ArrayBuffer, TypedArray 或包含要解码的编码文本的 DataView 对象</li>
<li>options 可选的配置项<ul>
<li>stream 默认 false 不使用分块方式, true 表示以分块方式处理数据,后续调用 decode 将跟随附加数据</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> te = <span class="keyword">new</span> <span class="title class_">TextEncoder</span>();</span><br><span class="line"><span class="keyword">const</span> array = te.<span class="title function_">encode</span>(<span class="string">&#x27;hello world&#x27;</span>);</span><br><span class="line"><span class="comment">// Unit8Array(6) [228,189,160,229,165,189]</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;encode-value&#x27;</span>).<span class="property">textContent</span> = array;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> td = <span class="keyword">new</span> <span class="title class_">TextDecoder</span>();</span><br><span class="line"><span class="keyword">const</span> str = td.<span class="title function_">decode</span>(array);</span><br><span class="line"><span class="comment">// 你好</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;decode-value&#x27;</span>).<span class="property">textContent</span> = str;</span><br></pre></td></tr></table></figure>

<h2 id="TextEncoderStream"><a href="#TextEncoderStream" class="headerlink" title="TextEncoderStream"></a>TextEncoderStream</h2><p>将一个字符串流转换为 <code>UTF-8</code> 编码的字节, 与 <code>TextEncoder</code> 的流形式等价</p>
<h3 id="TES-构造函数"><a href="#TES-构造函数" class="headerlink" title="TES 构造函数"></a>TES 构造函数</h3><p>创建并返回一个新的 <code>TextEncoderStream</code> 实例, 该对象使用 <code>UTF-8</code> 编码将字符串流转换为字节</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> body = textStream.<span class="title function_">pipeThrough</span>(<span class="keyword">new</span> <span class="title class_">TextEncoderStream</span>());</span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;./dest&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  body,</span><br><span class="line">  <span class="attr">headers</span>: &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain;chagrset=UTF-8&#x27;</span> &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="TES-实例属性"><a href="#TES-实例属性" class="headerlink" title="TES 实例属性"></a>TES 实例属性</h3><ul>
<li>encoding 只读属性, 总是返回 utf-8</li>
<li>readable 只读属性, 返回此对象控制的 <code>ReadableStream</code> 实例</li>
<li>writable 只读属性, 返回此对象控制的 <code>WritableStream</code> 实例</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tes = <span class="keyword">new</span> <span class="title class_">TextEncoderStream</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(tes.<span class="property">readable</span>); <span class="comment">// a ReadableStream</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(tes.<span class="property">writable</span>); <span class="comment">// a WritableStream</span></span><br></pre></td></tr></table></figure>

<h2 id="TextDecoderStream"><a href="#TextDecoderStream" class="headerlink" title="TextDecoderStream"></a>TextDecoderStream</h2><p>将二进制编码的文本流转换字符串流, 与 <code>TextDecoder</code> 的流形式等价</p>
<h3 id="TDS-构造函数"><a href="#TDS-构造函数" class="headerlink" title="TDS 构造函数"></a>TDS 构造函数</h3><ul>
<li>label 可选的一个字符串, 默认 <code>utf-8</code>, 可以为任意有效的编码</li>
<li>options 可选的配置项<ul>
<li>fatal 布尔值, 表示在错误的模式, 如果为 true, decoder 则在遇到错误时抛出一个 DOMException, 默认为 false</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://example.com&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> stream = response.<span class="property">body</span>.<span class="title function_">pipeThrough</span>(<span class="keyword">new</span> <span class="title class_">TextDecoderStream</span>());</span><br></pre></td></tr></table></figure>

<h3 id="TDS-实例属性"><a href="#TDS-实例属性" class="headerlink" title="TDS 实例属性"></a>TDS 实例属性</h3><ul>
<li>encoding 只读属性, 表示将使用的编码格式</li>
<li>fatal 只读属性, 表示错误是否致命</li>
<li>ignoreBOM 只读属性, 表示是否忽略字节顺序标记</li>
<li>readable 只读属性, 返回此对象控制的 <code>ReadableStream</code> 实例</li>
<li>writable 只读属性, 返回此对象控制的 <code>WritableStream</code> 实例</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tds = <span class="keyword">new</span> <span class="title class_">TextDecoderStream</span>(<span class="string">&#x27;utf-8&#x27;</span>, &#123; <span class="attr">fatal</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(tds.<span class="property">readable</span>); <span class="comment">// a ReadableStream</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(tds.<span class="property">writable</span>); <span class="comment">// a WritableStream</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2024\03\3689deed511f\" rel="bookmark">BroadcastChannel</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2023\07\ab14d13f34d4\" rel="bookmark">Element.insert*</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2023\04\0af048824359\" rel="bookmark">FileSystemAPI</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2024\02\9e4187fea759\" rel="bookmark">EventSource</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2023\04\ec2526e79bc5\" rel="bookmark">IntersectionObserver</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>luoleiself
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://luoleiself.github.io/2023/04/628a49166594/" title="Stream">https://luoleiself.github.io/2023/04/628a49166594/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/API/" rel="tag"># API</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/04/0af048824359/" rel="prev" title="FileSystemAPI">
      <i class="fa fa-chevron-left"></i> FileSystemAPI
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/04/ec2526e79bc5/" rel="next" title="IntersectionObserver">
      IntersectionObserver <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E8%AF%BB%E6%B5%81"><span class="nav-number">1.</span> <span class="nav-text">可读流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ReadableStream"><span class="nav-number">1.1.</span> <span class="nav-text">ReadableStream</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RS-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-number">1.1.1.</span> <span class="nav-text">RS 构造方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%AF%E8%AF%BB%E6%B5%81%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">可读流配置项</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%AF%E8%AF%BB%E6%B5%81%E9%98%9F%E5%88%97%E7%AD%96%E7%95%A5%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">可读流队列策略配置项</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RS-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">1.1.2.</span> <span class="nav-text">RS 实例属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RS-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-number">1.1.3.</span> <span class="nav-text">RS 实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#RS-cancel-reason"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">RS.cancel(reason)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RS-getReader-mode"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">RS.getReader(mode)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RS-pipeThrough-transformStream-options"><span class="nav-number">1.1.3.3.</span> <span class="nav-text">RS.pipeThrough(transformStream, options)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RS-pipeTo-destination-options"><span class="nav-number">1.1.3.4.</span> <span class="nav-text">RS.pipeTo(destination, options)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RS-tee"><span class="nav-number">1.1.3.5.</span> <span class="nav-text">RS.tee()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E8%AF%BB%E5%8F%96%E6%B5%81"><span class="nav-number">1.2.</span> <span class="nav-text">默认读取流</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RSDR-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.1.</span> <span class="nav-text">RSDR 构造方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSDR-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">1.2.2.</span> <span class="nav-text">RSDR 实例属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSDR-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.3.</span> <span class="nav-text">RSDR 实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#RSDR-cancel-reason"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">RSDR.cancel(reason)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RSDR-read"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">RSDR.read()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RSDR-releaseLock"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">RSDR.releaseLock()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E8%8A%82%E8%AF%BB%E5%8F%96%E6%B5%81"><span class="nav-number">1.3.</span> <span class="nav-text">字节读取流</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RSBYOBR-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-number">1.3.1.</span> <span class="nav-text">RSBYOBR 构造方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSBYOBR-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">1.3.2.</span> <span class="nav-text">RSBYOBR 实例属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSBYOBR-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-number">1.3.3.</span> <span class="nav-text">RSBYOBR 实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#RSBYOBR-cancel-reason"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">RSBYOBR.cancel(reason)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RSBYOBR-read-view"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">RSBYOBR.read(view)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RSBYOBR-releaseLock"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">RSBYOBR.releaseLock()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E8%AF%BB%E5%8F%96%E6%B5%81%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">1.4.</span> <span class="nav-text">默认读取流控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RSDC-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">1.4.1.</span> <span class="nav-text">RSDC 实例属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RSDC-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.2.</span> <span class="nav-text">RSDC 实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#RSDC-close"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">RSDC.close()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RSDC-enqueue-chunk"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">RSDC.enqueue(chunk)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RSDC-error-message"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">RSDC.error(message)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E8%8A%82%E8%AF%BB%E5%8F%96%E6%B5%81%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">1.5.</span> <span class="nav-text">字节读取流控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RBSC-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">1.5.1.</span> <span class="nav-text">RBSC 实例属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RBSC-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-number">1.5.2.</span> <span class="nav-text">RBSC 实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#RBSC-close"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">RBSC.close()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RBSC-enqueue-chunk"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">RBSC.enqueue(chunk)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RBSC-error-message"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">RBSC.error(message)</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E5%86%99%E6%B5%81"><span class="nav-number">2.</span> <span class="nav-text">可写流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#WritableStream"><span class="nav-number">2.1.</span> <span class="nav-text">WritableStream</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WS-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-number">2.1.1.</span> <span class="nav-text">WS 构造方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%AF%E5%86%99%E6%B5%81%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-number">2.1.1.1.</span> <span class="nav-text">可写流配置项</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%AF%E5%86%99%E6%B5%81%E9%98%9F%E5%88%97%E7%AD%96%E7%95%A5%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-number">2.1.1.2.</span> <span class="nav-text">可写流队列策略配置项</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WS-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">2.1.2.</span> <span class="nav-text">WS 实例属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WS-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-number">2.1.3.</span> <span class="nav-text">WS 实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#WS-close"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">WS.close()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WS-abort-reason"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">WS.abort(reason)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WS-getWriter"><span class="nav-number">2.1.3.3.</span> <span class="nav-text">WS.getWriter()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E5%86%99%E5%85%A5%E6%B5%81"><span class="nav-number">2.2.</span> <span class="nav-text">默认写入流</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WSDW-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-number">2.2.1.</span> <span class="nav-text">WSDW 构造方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WSDW-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">2.2.2.</span> <span class="nav-text">WSDW 实例属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WSDW-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-number">2.2.3.</span> <span class="nav-text">WSDW 实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#WSDW-abort-reason"><span class="nav-number">2.2.3.1.</span> <span class="nav-text">WSDW.abort(reason)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WSDW-close"><span class="nav-number">2.2.3.2.</span> <span class="nav-text">WSDW.close()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WSDW-releaseLock"><span class="nav-number">2.2.3.3.</span> <span class="nav-text">WSDW.releaseLock()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WSDW-write-chunk"><span class="nav-number">2.2.3.4.</span> <span class="nav-text">WSDW.write(chunk)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E5%86%99%E5%85%A5%E6%B5%81%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">2.3.</span> <span class="nav-text">默认写入流控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WSDC-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">2.3.1.</span> <span class="nav-text">WSDC 实例属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WSDC-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-number">2.3.2.</span> <span class="nav-text">WSDC 实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#WSDC-error-message-%E5%AF%BC%E8%87%B4%E6%9C%AA%E6%9D%A5%E4%BB%BB%E4%BD%95%E4%B8%8E%E5%85%B3%E8%81%94%E6%B5%81%E7%9A%84%E4%BA%A4%E4%BA%92%E9%83%BD%E4%BC%9A%E5%87%BA%E9%94%99"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">WSDC.error(message) 导致未来任何与关联流的交互都会出错</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E6%B5%81"><span class="nav-number">3.</span> <span class="nav-text">转换流</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TransformStream"><span class="nav-number">3.1.</span> <span class="nav-text">TransformStream</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TS-%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="nav-number">3.1.1.</span> <span class="nav-text">TS 构造方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E6%B5%81%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">转换流配置项</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%86%99%E5%85%A5%E6%B5%81%E9%98%9F%E5%88%97%E7%AD%96%E7%95%A5%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">写入流队列策略配置项</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96%E6%B5%81%E9%98%9F%E5%88%97%E7%AD%96%E7%95%A5%E9%85%8D%E7%BD%AE%E9%A1%B9"><span class="nav-number">3.1.1.3.</span> <span class="nav-text">读取流队列策略配置项</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TS-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">3.1.2.</span> <span class="nav-text">TS 实例属性</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E8%BD%AC%E6%8D%A2%E6%B5%81%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">3.2.</span> <span class="nav-text">默认转换流控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TSDC-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">3.2.1.</span> <span class="nav-text">TSDC 实例属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TSDC-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-number">3.2.2.</span> <span class="nav-text">TSDC 实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#TSDC-enqueue-chunk"><span class="nav-number">3.2.2.1.</span> <span class="nav-text">TSDC.enqueue(chunk)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TSDC-error-reason"><span class="nav-number">3.2.2.2.</span> <span class="nav-text">TSDC.error(reason)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#TSDC-terminate"><span class="nav-number">3.2.2.3.</span> <span class="nav-text">TSDC.terminate()</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TextEncoder"><span class="nav-number">4.</span> <span class="nav-text">TextEncoder</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TE-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="nav-number">4.1.</span> <span class="nav-text">TE 构造函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TE-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">4.2.</span> <span class="nav-text">TE 实例属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TE-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-number">4.3.</span> <span class="nav-text">TE 实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TE-encode-string"><span class="nav-number">4.3.1.</span> <span class="nav-text">TE.encode(string)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TE-encodeInto-string-Uint8Array"><span class="nav-number">4.3.2.</span> <span class="nav-text">TE.encodeInto(string, Uint8Array)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TextDecoder"><span class="nav-number">5.</span> <span class="nav-text">TextDecoder</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TD-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="nav-number">5.1.</span> <span class="nav-text">TD 构造函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TD-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">5.2.</span> <span class="nav-text">TD 实例属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TD-%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="nav-number">5.3.</span> <span class="nav-text">TD 实例方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TD-decode-buffer-stream-false"><span class="nav-number">5.3.1.</span> <span class="nav-text">TD.decode(buffer, {stream: false})</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TextEncoderStream"><span class="nav-number">6.</span> <span class="nav-text">TextEncoderStream</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TES-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="nav-number">6.1.</span> <span class="nav-text">TES 构造函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TES-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">6.2.</span> <span class="nav-text">TES 实例属性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#TextDecoderStream"><span class="nav-number">7.</span> <span class="nav-text">TextDecoderStream</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TDS-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="nav-number">7.1.</span> <span class="nav-text">TDS 构造函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TDS-%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="nav-number">7.2.</span> <span class="nav-text">TDS 实例属性</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="luoleiself"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">luoleiself</p>
  <div class="site-description" itemprop="description">努力的往前飞, 再累也无所谓, 黑夜过后的光芒有多美...</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">48</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/luoleiself" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoleiself" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:luoleiself@163.com" title="E-Mail → mailto:luoleiself@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://developer.mozilla.org/zh-CN/" title="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;zh-CN&#x2F;" rel="noopener" target="_blank">MDN</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">luoleiself</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">631k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:33</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><!-- canvas-nest -->
<!-- modify source/_data/footer.swig -->
<!-- modify _config.next.yml -> custom_file_path:footer -->
<!--
<script color="0,0,255" opacity="0.7" zIndex="-1" count="200" src="//cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script> 
-->
<style>
.highlight-container ::selection {
  color: #fc7237
};
</style>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/lozad.js/1.14.0/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
