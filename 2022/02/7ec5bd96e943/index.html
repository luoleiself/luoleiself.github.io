<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon-32x32.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"luoleiself.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="ReactReact 18.3.1 设计思想 变换, 设计 React 的核心前提是认为 UI 只是把数据通过映射关系变换成另一种形式的数据。同样的输入必会有同样的输出。这恰好就是纯函数。 抽象, 需要把 UI 抽象成多个隐藏内部细节，又可复用的函数。通过在一个函数中调用另一个函数来实现复杂的 UI 组合, 将两个或者多个不同的抽象通过组合再次抽象成一个抽象  不变性, 不直接操作数据源, 副本替">
<meta property="og:type" content="article">
<meta property="og:title" content="React.md">
<meta property="og:url" content="https://luoleiself.github.io/2022/02/7ec5bd96e943/index.html">
<meta property="og:site_name" content="luoleiself&#39;s blog">
<meta property="og:description" content="ReactReact 18.3.1 设计思想 变换, 设计 React 的核心前提是认为 UI 只是把数据通过映射关系变换成另一种形式的数据。同样的输入必会有同样的输出。这恰好就是纯函数。 抽象, 需要把 UI 抽象成多个隐藏内部细节，又可复用的函数。通过在一个函数中调用另一个函数来实现复杂的 UI 组合, 将两个或者多个不同的抽象通过组合再次抽象成一个抽象  不变性, 不直接操作数据源, 副本替">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-02-15T07:37:49.000Z">
<meta property="article:modified_time" content="2025-04-09T08:26:33.715Z">
<meta property="article:author" content="luoleiself">
<meta property="article:tag" content="js">
<meta property="article:tag" content="jsx">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://luoleiself.github.io/2022/02/7ec5bd96e943/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>React.md | luoleiself's blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5fa63b434a4b3e74b6258584372c74c0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="luoleiself's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">luoleiself's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/luoleiself" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://luoleiself.github.io/2022/02/7ec5bd96e943/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="luoleiself">
      <meta itemprop="description" content="努力的往前飞, 再累也无所谓, 黑夜过后的光芒有多美...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="luoleiself's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          React.md
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-15 15:37:49" itemprop="dateCreated datePublished" datetime="2022-02-15T15:37:49+08:00">2022-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-09 16:26:33" itemprop="dateModified" datetime="2025-04-09T16:26:33+08:00">2025-04-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES/" itemprop="url" rel="index"><span itemprop="name">ES</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>68k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>1:02</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="React"><a href="#React" class="headerlink" title="React"></a>React</h2><p>React 18.3.1</p>
<h2 id="设计思想"><a href="#设计思想" class="headerlink" title="设计思想"></a>设计思想</h2><ul>
<li>变换, 设计 React 的核心前提是认为 UI 只是把数据通过映射关系变换成另一种形式的数据。同样的输入必会有同样的输出。这恰好就是纯函数。</li>
<li>抽象, 需要把 UI 抽象成多个隐藏内部细节，又可复用的函数。通过在一个函数中调用另一个函数来实现复杂的 UI</li>
<li>组合, 将两个或者多个不同的抽象通过组合再次抽象成一个抽象</li>
</ul>
<p>不变性, 不直接操作数据源, 副本替换</p>
<ul>
<li>可以保持以前版本的数据完好无损, 并在以后重用它们</li>
<li>使组件比较其数据是否已更改的成本非常低, 提高子组件的渲染性能</li>
</ul>
<p>状态</p>
<ul>
<li><p>只有当在组件树中 相同的 位置渲染 相同的 组件时, React 才会一直保留着组件的 state</p>
</li>
<li><p>在一般安全的情况下采用批处理方式处理 state 更新</p>
</li>
<li><p>使用不可变的数据模型, 把可以改变 state 的函数串联起来作为原点放置在顶层</p>
</li>
<li><p>状态不存在于组件内, 状态是由 React 保存的, React 通过组件在渲染树中的位置将它保存的每个状态与正确的组件关联起来</p>
<ul>
<li>这个变量是否通过 props 从父组件中获取，如果是，则不是一个状态</li>
<li>这个变量是否在组件的整个生命周期中都保持不变，如果是，则不是一个状态</li>
<li>这个变量是否可以通过其他状态(state)或者属性(props)计算得到，如果是，则不是一个状态</li>
<li>这个变量是否在组件的 render 方法中使用，如果不在，则不是一个状态</li>
</ul>
</li>
</ul>
<p>不能直接声明 async 函数式组件</p>
<ul>
<li>返回类型不匹配, React 组件需要返回 React 元素(JSX), 而 async 函数默认返回一个 Promise, 导致 React 无法正确渲染组件</li>
<li>生命周期和状态管理, 异步操作通常涉及到副作用, 这些不应该在组件的渲染阶段进行, 它们应该在组件的生命周期方法或者特定的钩子中</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// state</span></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> prevCount = count;</span><br><span class="line"><span class="comment">// events</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123; count++ &#125;, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// render</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">render</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">innerHTML</span> = count;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// diff</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">reconcile</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (prevCount !== count) &#123;</span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">    prevCount = count;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// scheduler</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">workloop</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">reconcile</span>()</span><br><span class="line">  <span class="comment">// window.scheduler.postTask(() =&gt; &#123; //... &#125;)</span></span><br><span class="line">  <span class="comment">// 为什么 react 官方不使用这个 API</span></span><br><span class="line">  <span class="comment">// 因为 requestIdleCallback, scheduler.postTack 无法满足优先级调用, </span></span><br><span class="line">  <span class="comment">// 有了优先级, 就可以知道当下什么任务最紧急</span></span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">requestIdleCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">workloop</span>();</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">workloop</span>();</span><br></pre></td></tr></table></figure>

<h3 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>一个异步函数, 执行数据变更然后响应更新状态, <a href="#useTransition">useTransition</a>, <a href="#useActionState">useActionState</a>, <a href="#useOptimistic">useOptimistic</a></p>
<span id="more"></span>

<h3 id="构建-state-原则"><a href="#构建-state-原则" class="headerlink" title="构建 state 原则"></a>构建 state 原则</h3><ul>
<li><p>合并关联的 state, 如果总是同时更新两个或更多的 state 变量时, 考虑将它们合并为一个单独的 state</p>
</li>
<li><p>避免互相矛盾的 state, 当 state 结构中存在多个相互矛盾不一致的 state 时, 应避免这种情况</p>
</li>
<li><p>避免冗余的 state, 如果渲染期间从组件的 props 或其它现有的 state 中计算出一些信息, 则不应该作为 state</p>
</li>
<li><p>避免重复的 state, 当同一数据在多个 state 之间或多个嵌套对象中重复时, 这很难保持它们同步, 应避免这种情况</p>
</li>
<li><p>避免深度嵌套的 state, 深度分层的 state 更新起来很不方面, 尽量以扁平化方式构建 state</p>
</li>
<li><p>尽量避免在 state 中镜像 props, 会与从父组件传递的属性失去同步(将不会更新), 只有想要忽略特定 props 属性的所有更新时, 使用镜像 props 才有意义, 约定 prop 名称以 <code>initial</code> 或 <code>default</code> 开头, 以说明该 prop 的新值将被忽略</p>
</li>
</ul>
<h3 id="响应式值"><a href="#响应式值" class="headerlink" title="响应式值"></a>响应式值</h3><p>props 和 state 并不是唯一的响应式值, 从它们计算出的值都是响应式的, 如果 props 或 state 发生变化, 组件将重新渲染, 从中计算出的值也会随之变化, 所以需要将响应式值包括在 Effect 的依赖项中</p>
<ul>
<li>所有在组件内部直接声明的变量和函数</li>
</ul>
<h3 id="对-state-进行保留和重置"><a href="#对-state-进行保留和重置" class="headerlink" title="对 state 进行保留和重置"></a>对 state 进行保留和重置</h3><ul>
<li>将组件渲染在不同的位置, 可以重置 state</li>
<li>使用 key 重置 state, key 不是全局唯一的, 只是标识父组件内部的顺序</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Scoreboard</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [isPlayerA, setIsPlayerA] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line">  <span class="comment">/* 如果只用一个 Counter 组件通过 props 传递 person 属性的方式切换用户会出现 state 不会被重置*/</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 第 1 种方式: 在不同位置上, 渲染两个 Counter 组件, 在切换不同的用户时可以重置 state */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;isPlayerA &amp;&amp; <span class="tag">&lt;<span class="name">Counter</span> <span class="attr">person</span>=<span class="string">&quot;Taylor&quot;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;!isPlayerA &amp;&amp; <span class="tag">&lt;<span class="name">Counter</span> <span class="attr">person</span>=<span class="string">&quot;Sarah&quot;</span> /&gt;</span> &#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* 第 2 种方式: 在同一位置上, 使用 key 为 Counter 组件添加标识, 让 React 区分组件 */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;isPlayerA </span></span><br><span class="line"><span class="language-xml">        ? (<span class="tag">&lt;<span class="name">Counter</span> <span class="attr">key</span>=<span class="string">&quot;Taylor&quot;</span> <span class="attr">person</span>=<span class="string">&quot;Taylor&quot;</span> /&gt;</span>) </span></span><br><span class="line"><span class="language-xml">        : (<span class="tag">&lt;<span class="name">Counter</span> <span class="attr">key</span>=<span class="string">&quot;Sarah&quot;</span> <span class="attr">person</span>=<span class="string">&quot;Sarah&quot;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setIsPlayerA(!isPlayerA) &#125;&gt;下一位玩家！<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Counter 组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params">&#123; person &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [score, setScore] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [hover, setHover] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> className = <span class="string">&#x27;counter&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (hover) &#123;</span><br><span class="line">    className += <span class="string">&#x27; hover&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&#123;className&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onPointerEnter</span>=<span class="string">&#123;()</span> =&gt;</span> setHover(true)&#125;</span></span><br><span class="line"><span class="language-xml">      onPointerLeave=&#123;() =&gt; setHover(false)&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;person&#125; 的分数：&#123;score&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setScore(score + 1)&#125;&gt;加一<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="React-Component-deprected"><a href="#React-Component-deprected" class="headerlink" title="React.Component(deprected)"></a>React.Component(deprected)</h2><h3 id="组件的生命周期"><a href="#组件的生命周期" class="headerlink" title="组件的生命周期"></a>组件的生命周期</h3><ul>
<li><p>constructor(props)</p>
<ul>
<li>初始化内部 state，只能在构造函数中直接为 state 赋值，其他方法中应使用 this.setState()</li>
<li>为事件处理函数绑定实例</li>
</ul>
</li>
<li><p>static getDerivedStateFromProps(props, state)</p>
<ul>
<li>在 render() 方法执行前调用, 初始化挂载及后续更新都会被调用</li>
<li>返回一个对象来更新 state, 如果返回 null, 则不更新任何内容</li>
<li>无法访问组件实例</li>
</ul>
</li>
<li><p>render() class 组件中唯一必须实现的方法, 返回以下类型之一</p>
<ul>
<li>React 元素</li>
<li>数组或者 Fragments</li>
<li>Portals</li>
<li>字符串或者数值类型</li>
<li>布尔类型或者 null,什么都不渲染</li>
</ul>
</li>
<li><p>componentDidMount()</p>
<ul>
<li>组件挂载后立即调，DOM 节点的初始化应该放在这里</li>
</ul>
</li>
<li><p>static getDerivedStateFromProps(props, state)</p>
</li>
<li><p>shouldComponentUpdate(nextProps, nextState)</p>
<ul>
<li>返回值影响组件是否会重新渲染</li>
<li>默认返回值为 true</li>
<li>首次渲染或者使用 forceUpdate() 时不会调用该方法</li>
<li>返回 false 不会调用 render() 和 componentDidUpdate() 方法</li>
</ul>
</li>
<li><p>render()</p>
</li>
<li><p>getSnapshotBeforeUpdate(prevProps, prevState)</p>
<ul>
<li>在最近一次渲染输出(提交到 DOM 节点)之前调用</li>
<li>返回值作为 componentDidUpdate 方法的第三个参数 snapshot 传递,否则此参数为 undefined</li>
</ul>
</li>
<li><p>componentDidUpdate(prevProps, prevState, snapshot)</p>
</li>
<li><p>componentWillUnmount() 组件卸载及销毁之前直接调用,此方法中不应该使用 setState() 方法,组件不会被重新渲染</p>
</li>
</ul>
<h3 id="迁移到函数式组件"><a href="#迁移到函数式组件" class="headerlink" title="迁移到函数式组件"></a>迁移到函数式组件</h3><ul>
<li>static contextType 绑定 context, 等同于在函数式组件中使用 <a href="#useContext">useContext</a></li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="comment">// 方式1: 静态属性绑定 context;</span></span><br><span class="line">  <span class="comment">// 方式2: 类组件外部绑定 Button.contextType = ThemeContext;</span></span><br><span class="line">  <span class="keyword">static</span> contextType = <span class="title class_">ThemeContext</span>; </span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 类组件中读取 context;</span></span><br><span class="line">    <span class="keyword">const</span> theme = <span class="variable language_">this</span>.<span class="property">context</span>;</span><br><span class="line">    <span class="keyword">const</span> className = <span class="string">&#x27;button-&#x27;</span> + theme;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;this.props.children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 方式2：类组件外部绑定</span></span><br><span class="line"><span class="comment">// Button.contextType = ThemeContext;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 等同于函数式组件使用 useContext;</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> theme = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">const</span> className = <span class="string">&#x27;button-&#x27;</span> + theme;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;this.props.children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>static defaultProps 类组件设置默认 props<ul>
<li>当 props 为 undefined 或者缺少时有效(为 null 无效)</li>
<li>类似于函数式组件中使用默认值</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;blue&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">redner</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;this.props.color&#125;</span>&gt;</span>button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类似于函数式组件使用默认值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params">&#123;color = <span class="string">&#x27;blue&#x27;</span>&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;color&#125;</span>&gt;</span>button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>static propTypes 类组件的 props 的类型约束, 仅在渲染和开发过程中进行检查, 函数式组件使用 TypeScript</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">PropTypes</span> <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Greeting</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">PropTypes</span>.<span class="property">string</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="深入-JSX"><a href="#深入-JSX" class="headerlink" title="深入 JSX"></a>深入 JSX</h2><ul>
<li><p>只能返回一个根元素</p>
</li>
<li><p>标签必须闭合</p>
</li>
<li><p>大部分属性使用驼峰方式</p>
</li>
<li><p>自定义的组件必须以大写字母开头</p>
</li>
<li><p>React 将 boolean, null, undefined 视为空值, 不做任何渲染</p>
</li>
<li><p>直接在 JSX 中渲染对象 React 将报错 (not valid React element)</p>
</li>
</ul>
<h3 id="使用-TypeScript"><a href="#使用-TypeScript" class="headerlink" title="使用 TypeScript"></a>使用 TypeScript</h3><ul>
<li>DOM 事件, React.SyntheticEvent 是所有事件的基类型</li>
<li>子元素<ul>
<li>使用 React.ReactNode 类型作为子元素传递的所有可能类型的并集</li>
<li>使用 React.ReactElement 类型, 它只包含 JSX 元素, 而不包括 JS 原始类型, 例如 string 或 number</li>
</ul>
</li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">ModalRendererProps</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">React</span>.<span class="property">ReactNode</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ModalRendererProps</span> &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">children</span>: <span class="title class_">React</span>.<span class="property">ReactElement</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>样式属性, 使用 React.CSSProperties 来描述传递给 style 属性的对象, 这个类型是所有可能的 css 属性的并集</li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MyComponentProps</span> &#123;</span><br><span class="line">  <span class="attr">style</span>: <span class="title class_">React</span>.<span class="property">CSSProperties</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JSX-中的-Props"><a href="#JSX-中的-Props" class="headerlink" title="JSX 中的 Props"></a>JSX 中的 Props</h3><ul>
<li><p>JavaScript 表达式作为 Props</p>
</li>
<li><p>字符串字面量</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个JSX表达式是等价的,</span></span><br><span class="line">&lt;<span class="title class_">MyComponent</span> message=<span class="string">&quot;hello world&quot;</span> /&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">message</span>=<span class="string">&#123;</span>&#x27;<span class="attr">hello</span> <span class="attr">world</span>&#x27;&#125; /&gt;</span></span></span><br><span class="line"><span class="comment">// 字符串字面量赋值给 prop 时，它的值是未转义的</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">message</span>=<span class="string">&quot;<span class="symbol">&amp;lt;</span>3&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">message</span>=<span class="string">&#123;</span>&#x27;&lt;<span class="attr">3</span>&#x27;&#125; /&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>Props 默认值为 True</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">MyTextBox</span> autocomplete /&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyTextBox</span> <span class="attr">autocomplete</span>=<span class="string">&#123;true&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>属性展开</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此方法容易将不必要的 props 传递给不相关的组件，</span></span><br><span class="line"><span class="comment">// 或者将无效的 HTML 属性传递给 DOM,谨慎使用该语法.</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Button</span> = (<span class="params">props</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; kind, ...other &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> className = kind === <span class="string">&#x27;primary&#x27;</span> ? <span class="string">&#x27;PrimaryButton&#x27;</span> : <span class="string">&#x27;SecondaryButton&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span> &#123;<span class="attr">...other</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">kind</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> console.log(&#x27;clicked!&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        Hello World!</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="JSX-中的-children"><a href="#JSX-中的-children" class="headerlink" title="JSX 中的 children"></a>JSX 中的 children</h3><ul>
<li>包含在开始和结束标签之间的 JSX 内容将作为特定属性 props.children 传递给组件.</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params">&#123;title, children&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">title</span>=<span class="string">&#123;title&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">title</span>=<span class="string">&#x27;my-component&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      This is children</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>tag p<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">MyComponent</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>批量子元素</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用子元素回调 numTimes 次，来重复生成组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Repeat</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> items = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; props.<span class="property">numTimes</span>; i++) &#123;</span><br><span class="line">    items.<span class="title function_">push</span>(props.<span class="title function_">children</span>(i));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;items&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ListOfTenThings</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Repeat</span> <span class="attr">numTimes</span>=<span class="string">&#123;10&#125;</span>&gt;</span>&#123;(index) =&gt; <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>This is item &#123;index&#125; in the list<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">Repeat</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="React-Hook"><a href="#React-Hook" class="headerlink" title="React Hook"></a>React Hook</h2><p>一个特殊的函数, 只能在组件或自定义 Hook 的顶层调用</p>
<ul>
<li>React 16.8 新增</li>
<li>可以在函数组件内”钩入” React State 及生命周期等特性的函数</li>
<li>不能在 class 组件中使用</li>
</ul>
<h3 id="Hook-规则"><a href="#Hook-规则" class="headerlink" title="Hook 规则"></a>Hook 规则</h3><ul>
<li>只能在函数最顶层调用 Hook, 不能在循环、条件判断或者嵌套函数中调用</li>
<li>只能在 React 的函数组件中调用 Hook, 不能在其他 JavaScript 函数中调用</li>
<li>对 Hook 的每个调用完全独立于对同一个 Hook 的其他调用</li>
</ul>
<h3 id="React-内置-Hook"><a href="#React-内置-Hook" class="headerlink" title="React 内置 Hook"></a>React 内置 Hook</h3><h4 id="useId"><a href="#useId" class="headerlink" title="useId  "></a>useId <em id="useId"></em> <!--markdownlint-disable-line--></h4><p>生成传递给无障碍属性的唯一 ID, 不应该被用来生成数据列表中的 key, key 的值在兄弟节点之间必须是唯一的, key 值不能改变</p>
<ul>
<li>能够确保与服务器端渲染一起工作</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id = <span class="title function_">useId</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useId&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PasswordFiled</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> passwordHintId = <span class="title function_">useId</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">aria-describedby</span>=<span class="string">&#123;passwordHintId&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&#123;passwordHintId&#125;</span>&gt;</span>密码至少包含 18 个字符<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h4><ul>
<li>用于保存渲染间的数据</li>
<li>更新变量并触发 React 再次渲染组件</li>
<li>调用 set 函数不会改变已经执行的代码中当前的 state</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(initialState);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useState 实现原理</span></span><br><span class="line"><span class="keyword">let</span> componentHooks = []; <span class="comment">// 把 state 存储在外面</span></span><br><span class="line"><span class="keyword">let</span> currentHookIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useState</span>(<span class="params">initialValue</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> pair = componentHooks[currentHookIndex];</span><br><span class="line">  <span class="keyword">if</span>(pair)&#123;</span><br><span class="line">    currentHookIndex++;</span><br><span class="line">    <span class="keyword">return</span> pair;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 第一次渲染时</span></span><br><span class="line">  <span class="keyword">let</span> setState = <span class="keyword">function</span> (<span class="params">nextState</span>) &#123;</span><br><span class="line">    pair[<span class="number">0</span>] = nextState;</span><br><span class="line">    <span class="title function_">updateDOM</span>(); <span class="comment">// 更新DOM</span></span><br><span class="line">  &#125;</span><br><span class="line">  pair = [initialValue, setState];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 存储这个 pair 用于将来的渲染</span></span><br><span class="line">  <span class="comment">// 并且为下一次 hook 的调用做准备</span></span><br><span class="line">  componentHooks[currentHookIndex] = pair;</span><br><span class="line">  currentHookIndex++;</span><br><span class="line">  <span class="keyword">return</span> pair;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>初始 state 参数只在第一次渲染时会被用到</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> [fruit, setFruit] = <span class="title function_">useState</span>(<span class="string">&#x27;banana&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> [todos, setTodos] = <span class="title function_">useState</span>([&#123; <span class="attr">text</span>: <span class="string">&#x27;learn React Hooks&#x27;</span> &#125;]);</span><br><span class="line"><span class="title function_">setTodos</span>([...todos, &#123; <span class="attr">text</span>: <span class="string">&#x27;Hello setTodos&#x27;</span> &#125;]); <span class="comment">// 和 this.setState 的区别: 不会进行 state 合并</span></span><br></pre></td></tr></table></figure>

<ul>
<li>函数式更新, 新的 state 需要通过之前的 state 计算得出</li>
<li>React 将更新函数放入队列中, 在下一次渲染期间, React 将通过队列将所有更新函数应用于先前的状态来计算下一个状态</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setCount</span>(<span class="function">(<span class="params">prevCount</span>) =&gt;</span> prevCount - <span class="number">1</span>);</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;setCount.bind(null,</span> (<span class="attr">prevCount</span>) =&gt;</span> prevCount + 1)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>和当前的 state 合并更新, 如果更新函数返回值和当前 state 完全相同，则重渲染会被跳过</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setState</span>(<span class="function">(<span class="params">prevState</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; ...prevState, ...updateValues &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>惰性初始 state, 初始 state 需要通过复杂计算获得, 可以使用回调函数返回计算后的初始 state</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ... 初始 state 的复杂计算</span></span><br><span class="line">  <span class="keyword">return</span> initialState;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer  "></a>useReducer <em id="useReducer"></em> <!--markdownlint-disable-line--></h4><p>整合组件的状态更新逻辑</p>
<p>将组件拥有的许多状态更新逻辑的事件处理程序整合到一个 外部函数 中, 这个函数称为 reducer</p>
<ul>
<li>每个 action 都描述了一个单一的用户交互, 即使它会引发数据的多个变化</li>
<li>reducer 用于更新 state 的纯函数, 即当输入相同时, 输出也相同, 参数为 state 和 action</li>
<li>init 用于计算初始值的函数, 如果存在, 使用 <code>init(initialArg)</code> 的执行结果作为初始值, 否则使用 initialArg</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialArg, init);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现原理</span></span><br><span class="line"><span class="keyword">import</span> &#123;useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span>(action.<span class="property">type</span>)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;delete&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Unknow action: &#x27;</span> + action.<span class="property">tye</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useReducer</span>(<span class="params">reducer, initialState</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(initialState);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> dispatch = <span class="keyword">function</span> (<span class="params">action</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> nextState = <span class="title function_">reducer</span>(state, action);</span><br><span class="line">    <span class="title function_">setState</span>(nextState);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [state, dispatch];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>指定初始 state<ul>
<li>(redux 的参数约定)将初始 state 作为第二个参数传入 useReducer,可传入 undefined.</li>
<li>如果 Reducer Hook 的返回值和当前 state 相同, React 将跳过子组件的渲染及副作用的执行</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useReducer&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计数器 Demo</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;increment&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;decrement&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      Count: &#123;state.count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;decrement&#x27; &#125;)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;increment&#x27; &#125;)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>惰性初始化</p>
<ul>
<li>useReducer 的第三个参数, initialArg 将作为 init 函数的参数并返回新的 state</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">init</span>(<span class="params">initialState</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; ...initialState &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; ...state &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params">&#123; initialState &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState, init);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;...state&#125;<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="useContext"><a href="#useContext" class="headerlink" title="useContext  "></a>useContext <em id="useContext"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>React 19 直接将 &lt;Context&gt; 渲染为提供者, 不再需要使用 &lt;Context.Provider&gt;</p>
</blockquote>
<p>深度传递信息</p>
<p>Context 允许父组件向其下层无论多深的任何组件提供信息, 而无需通过 props 显式传递</p>
<ul>
<li>接收一个 context 对象(React.createContext 的返回值)并返回该 context 的当前值</li>
<li>仍需要在上层组件树中使用 Provider 提供 context, React 19 可以省略 .Provider</li>
</ul>
<p>使用 Context: 如果以下方法不适合再考虑使用</p>
<ul>
<li>从传递 props 开始, 这样做能够清晰的展示组件的数据流</li>
<li>抽象组件并将 jsx 作为 children 传递, 将使用 props 传递的属性抽象为 children 组件传递</li>
</ul>
<p>使用场景:</p>
<ul>
<li>主题</li>
<li>当前账户</li>
<li>路由</li>
<li>状态管理</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> someValue = <span class="title function_">useContext</span>(someContext);</span><br></pre></td></tr></table></figure>

<ul>
<li>控制主题</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createContext, useContext, useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> themes = &#123;</span><br><span class="line">  <span class="attr">light</span>: &#123;</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&#x27;30px&#x27;</span>,</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;#0088ff&#x27;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&#x27;#eeeeee&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">dark</span>: &#123;</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&#x27;30px&#x27;</span>,</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&#x27;#222222&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ThemeContext</span> = <span class="title function_">createContext</span>(themes);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ContextDemo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, setTheme] = <span class="title function_">useState</span>(<span class="string">&#x27;dark&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// React 19 可以省略 .Provider</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;themes[theme]&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>ContextDemo<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>current theme: &#123;theme&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ThemeButton</span> <span class="attr">onClick</span>=<span class="string">&#123;setTheme.bind(null,</span> (<span class="attr">prevState</span>) =&gt;</span> (prevState === &#x27;dark&#x27; ? &#x27;light&#x27; : &#x27;dark&#x27;))&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ThemeButton</span>(<span class="params">&#123;onClick&#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 使用 useContext 代替 ThemeContext.consumer 消费组件</span></span><br><span class="line">  <span class="keyword">const</span> theme = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">...theme</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      useContext button</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>嵌套 Context</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createContext, useContext, useReducer&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TasksContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TasksDispatchContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// React 19 可以省略 .Provider</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">TasksProvider.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">TasksProvider.Provider</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TasksProvider</span>(<span class="params">&#123;children&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [tasks, dispatch] = <span class="title function_">useReducer</span>(tasksReducer, initialTasks);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// React 19 可以省略 .Provider</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">TasksContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;tasks&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">TasksDispatchContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;dispatch&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">TasksDispatchContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">TasksContext.Provider</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tasksReducer</span>(<span class="params">state, action</span>)&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>层级标题</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createContext, useContext&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">LevelContext</span> = <span class="title function_">createContext</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Heading</span>(<span class="params">&#123;children&#125;</span>)&#123;</span><br><span class="line">  <span class="comment">// 组件内部读取上层的 level</span></span><br><span class="line">  <span class="keyword">const</span> level = <span class="title function_">useContext</span>(<span class="title class_">LevelContext</span>);</span><br><span class="line">  <span class="keyword">switch</span>(level)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h5</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h6</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;unknown level: &#x27;</span> + level);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Section</span>(<span class="params">&#123;children&#125;</span>)&#123;</span><br><span class="line">  <span class="comment">// 使用 useContext 读取上层的 level, 不需要在 props 接收 level</span></span><br><span class="line">  <span class="keyword">const</span> level = <span class="title function_">useContext</span>(<span class="title class_">LevelContext</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* React 19 可以省略 .Provider */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">LevelContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;level</span> + <span class="attr">1</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">LevelContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &#123;<span class="comment">/* </span></span><br><span class="line"><span class="comment">      在 Section 内部使用 useContext 读取上层的 level,</span></span><br><span class="line"><span class="comment">      不需要在此处向 Section 内部传递 level </span></span><br><span class="line"><span class="comment">    */</span>&#125;</span><br><span class="line">    &lt;<span class="title class_">Section</span>&gt; </span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Heading</span>&gt;</span>主标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>副标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>副标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>副标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Section</span>&gt;</span></span></span><br><span class="line">    &lt;/<span class="title class_">Section</span>&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h4><p>Effect 允许指定由渲染本身, 而不是特定事件引起的副作用</p>
<p>Effect 是一种 脱围 机制, 可以逃出 React 并使组件和一些外部系统同步, 例如非 React 组件, 网络, 浏览器DOM</p>
<ul>
<li>异步执行，不会阻塞浏览器更新</li>
<li>useEffect 每次在调用一个新的 effect 之前对前一个 effect 进行清理，防止内存泄漏或崩溃的问题</li>
<li>尽量避免使用 对象 和 函数 作为 Effect 依赖, 否则会使 Effect 更频繁地重新同步</li>
<li>如果 Effect 的不同部分因不同原因需要重新运行, 将其拆分为多个 Effect</li>
<li>默认情况下，它在第一次渲染之后和每次更新之后都会执行</li>
<li>第二个参数为依赖项数组, 控制 effect 的执行时机<ul>
<li>依赖项为空数组, 表示只会在组件挂载后执行</li>
<li>没有依赖项数组时, 表示每次重新渲染后重新执行</li>
</ul>
</li>
</ul>
<p>不使用 Effect 的情况:</p>
<ul>
<li>不必使用 Effect 来转换渲染所需的数据, 例如想在渲染列表前先做筛选</li>
<li>不必使用 Effect 来处理用户事件</li>
</ul>
<p>日志出现两次挂载的原因, React 在开发环境中会在初始化挂载组件后, 立即再挂载一次, 帮助查找问题所在</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(setup, dependencies?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 组件卸载时调用, 可选</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// effect 会比较数组中所有参数是否和前一次的参数全等，如果有一个不相等则执行 effect</span></span><br><span class="line">  <span class="comment">// 依赖项数组为空，只执行一次 effect</span></span><br><span class="line">&#125;, [count]); <span class="comment">// 仅在 count 更改时更新</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// 没有依赖项数组：每次重新渲染后重新运行</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="在-Effect-中请求数据"><a href="#在-Effect-中请求数据" class="headerlink" title="在 Effect 中请求数据"></a>在 Effect 中请求数据</h5><ul>
<li>Effect 不能在服务器上运行, 服务器渲染的 HTML 将只包含没有数据的 Loading 状态</li>
<li>在 Effect 中请求数据容易造成网络瀑布, 当请求一些数据再渲染子组件, 然后重复这样的过程来请求子组件的数据</li>
<li>在 Effect 中直接请求数据通常意味着不会预加载或缓存数据</li>
<li>不符合工效学, 在调用 fetch 时, 需要编写大量样板代码, 以避免像竞争条件这样的 bug</li>
</ul>
<p>替代方法, 如果以下方法都不适合可以继续在 effect 中请求数据</p>
<ul>
<li>使用框架内置的数据获取机制</li>
<li>使用或构建客户端缓存, 流行的开源解决方案包括 react query, useSWR, React Router</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState, useEffect&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [person, setPerson] = <span class="title function_">useState</span>(<span class="string">&#x27;Tom&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> [bio, setBio] = <span class="title function_">useState</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [serverUrl, setServerUrl] = <span class="title function_">useState</span>(<span class="string">&#x27;https://localhost:3000/&#x27;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ignore 被初始化为 false, 并且在 cleanup 中被设置为 true</span></span><br><span class="line">    <span class="comment">// 这样可以确保不会受到 竞争条件 的影响</span></span><br><span class="line">    <span class="keyword">let</span> ignore = <span class="literal">false</span>;</span><br><span class="line">    <span class="title function_">setBio</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="title function_">fetchDo</span>(person).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(!ignore) &#123;</span><br><span class="line">        <span class="title function_">setBio</span>(res);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      ignore = <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [person])</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> conn = <span class="title function_">createConnect</span>(serverUrl);</span><br><span class="line">    conn.<span class="title function_">connect</span>();</span><br><span class="line">    <span class="comment">// 返回一个 cleanup 函数断开链接</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> conn.<span class="title function_">disconnect</span>();</span><br><span class="line">  &#125;,[serverUrl])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useEffectEvent-experimental"><a href="#useEffectEvent-experimental" class="headerlink" title="useEffectEvent(experimental)"></a>useEffectEvent(experimental)</h4><ul>
<li>只在 Effect 内部调用</li>
<li>永远不要把它们传递给其他的组件或 Hook</li>
</ul>
<p>从 Effect 中提取非响应式逻辑, 在 响应式逻辑(Effect) 中使用响应式值而不用担心引起周围代码因为变化而重新执行</p>
<ul>
<li>EffectEvent 是非响应式的并且必须从依赖项中删除</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onSomething = <span class="title function_">useEffectEvent</span>(callback);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useContext, useEffect, useEffectEvent&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="comment">// 聊天室应用</span></span><br><span class="line"><span class="comment">// https://zh-hans.react.dev/learn/separating-events-from-effects</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params">&#123;url&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;items&#125; = <span class="title function_">useContext</span>(<span class="title class_">ShoppingCartContext</span>);</span><br><span class="line">  <span class="keyword">const</span> numberOfItems = items.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 非响应式逻辑, 内部读取的 numberOfItems 一直都是最新的</span></span><br><span class="line">  <span class="comment">// 但是 numberOfItems 自己变化不会引起重新渲染</span></span><br><span class="line">  <span class="keyword">const</span> onVisit = <span class="title function_">useEffectEvent</span>(<span class="function"><span class="params">visitedUrl</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">logVisit</span>(visitedUrl, numberOfItems);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Effect 内部依然是响应式的, url 变化会去调用 onVisit</span></span><br><span class="line">    <span class="title function_">onVisit</span>(url);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 日志 logVisit 想加入购物车数量时, 需要添加依赖项 numberOfItems</span></span><br><span class="line">    <span class="comment">// 如果依赖项加入 numberOfItems, 就改变了 logVisit 日志的作用</span></span><br><span class="line">    <span class="comment">// 使用 useEffectEvent 提取非响应式逻辑</span></span><br><span class="line">    <span class="comment">// logVisit(url, numberOfItems); // 缺少依赖项 numberOfItems</span></span><br><span class="line">  &#125;,[url]);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useLayoutEffect"><a href="#useLayoutEffect" class="headerlink" title="useLayoutEffect"></a>useLayoutEffect</h4><blockquote>
<p>只在客户端运行, 在服务器渲染期间不会运行</p>
</blockquote>
<p>在浏览器重新绘制屏幕之前触发, 可能会影响性能, 尽可能使用 useEffect</p>
<ul>
<li>它会在所有的 DOM 变更之后同步调用 effect, 可以使用它来读取 DOM 布局并同步触发重渲染</li>
<li>计算布局, 不希望用户看到某些元素在移动</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useLayoutEffect</span>(setup, dependencies?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef, useState, useLayoutEffect&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createPortal&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Tooltip</span>(<span class="params">&#123;children, targetRect&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [tooltipHeight, setTooltipHeight] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;height&#125; = ref.<span class="property">current</span>.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">    <span class="title function_">setTooltipHeight</span>(height); <span class="comment">// 重新渲染提示框的位置</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> tooltipX = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> tooltipY = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(targetRect !== <span class="literal">null</span>)&#123;</span><br><span class="line">    tooltipX = targetRect.<span class="property">left</span>;</span><br><span class="line">    tooltipY = targetRect.<span class="property">top</span> - tooltipHeight;</span><br><span class="line">    <span class="keyword">if</span>(tooltipY &lt; <span class="number">0</span>)&#123;</span><br><span class="line">      tooltipY = targetRect.<span class="property">bottom</span>; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createPortal</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ToolTipContainer</span> <span class="attr">x</span>=<span class="string">&#123;tooltipX&#125;</span> <span class="attr">y</span>=<span class="string">&#123;tooltipY&#125;</span> <span class="attr">contentRef</span>=<span class="string">&#123;ref&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ToolTipContainer</span>&gt;</span></span>,</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useInsertionEffect"><a href="#useInsertionEffect" class="headerlink" title="useInsertionEffect"></a>useInsertionEffect</h4><blockquote>
<p>只在客户端运行, 在服务器渲染期间不会运行</p>
</blockquote>
<p>为 CSS-in-js 库的作者特意打造的, 除非正在使用 CSS-in-js 库并且需要注入样式, 否则应该使用 useEffect 或 useLayoutEffect</p>
<ul>
<li>为布局副作用触发之前将元素插入到 DOM 中</li>
<li>不能在内部更新状态</li>
</ul>
<p>CSS-in-js 常见的实现方法:</p>
<ul>
<li>使用编译器静态提取到 CSS 文件</li>
<li>内联样式, 例如 <code>&lt;div style=&#123;&#123;opacity: 1&#125;&#125;&gt;</code></li>
<li>运行时注入 <code>&lt;style&gt;</code> 标签</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useInsertionEffect</span>(setup, dependencies?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useInsertionEffect&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isInserted = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useCSS</span>(<span class="params">rule</span>)&#123;</span><br><span class="line">  <span class="title function_">useInsertionEffec</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 在此注入 &lt;style&gt; 标签</span></span><br><span class="line">    <span class="keyword">if</span>(!isInserted.<span class="title function_">has</span>(rule))&#123;</span><br><span class="line">      isInserted.<span class="title function_">add</span>(rule);</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(<span class="title function_">getStyleForRule</span>(rule));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> rule;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> className = <span class="title function_">useCss</span>(<span class="string">&#x27;...&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h4><blockquote>
<p>允许在多次渲染中缓存函数的 Hook, 通常应用于性能优化</p>
</blockquote>
<ul>
<li>把内联回调函数及依赖项数组作为参数传入 useCallback，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新</li>
<li>优化针对于子组件渲染</li>
<li>第二个参数为依赖项数组<ul>
<li>没有依赖项数组时, 每次都会返回一个新的函数</li>
<li>依赖项为空数组时, 不需要依赖项</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cachedFn = <span class="title function_">useCallback</span>(fn, dependencies);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedCallback = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">doSomething</span>(a, b);</span><br><span class="line">&#125;, [a, b]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每次都返回一个新函数: 没有依赖项数组</span></span><br><span class="line"><span class="keyword">const</span> cachedFn = <span class="title function_">useCallback</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">doSomething</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h4><p>缓存每次重新渲染都需要计算的结果</p>
<p>把“创建”函数和依赖项数组作为参数传入 useMemo，它仅会在某个依赖项改变时才重新计算 memoized 值</p>
<ul>
<li>优化针对于当前组件高开销的计算</li>
<li>传入 useMemo 的函数会在渲染期间执行</li>
<li>第二个参数为依赖项数组<ul>
<li>没有依赖项数组时, 每次渲染都会计算新的值</li>
<li>依赖项为空数组时, 不需要依赖项</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cachedValue = <span class="title function_">useMemo</span>(calculateValue, dependencies);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState, useEffect, useMemo, memo&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TodoList</span>(<span class="params">&#123;todos, tab&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> visibleTodos = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">filterTodos</span>(todos, tab), [todos, tab]);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// memoized component</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MemoizedChildren</span> = <span class="title function_">memo</span>(<span class="title class_">Parent</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">MyComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> children = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;,[])</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">MemoizedChildren</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">MemoizedChildren</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> children = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;memo children...&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>memo children...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(count+<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(count);</span><br><span class="line">  &#125;,[count]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>Click me!<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useRef"><a href="#useRef" class="headerlink" title="useRef  "></a>useRef <em id="useRef"></em> <!--markdownlint-disable-line--></h4><p>希望 React 记住某些信息, 但又不想让这些信息触发新的渲染时, 使用 ref</p>
<ul>
<li>ref 在重新渲染之间由 React 保留, 更改 ref 不会触发更新</li>
<li>通过 <code>.current</code> 访问该 ref 的值, 不要在渲染期间写入或读取 ref.current, 会破坏这些预期行为</li>
<li>引用 DOM 节点, 在 DOM 节点被移除时, React 将重置 ref 的值为 null</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> refContainer = <span class="title function_">useRef</span>(initialValue);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> refDemo = <span class="title function_">useRef</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(refDemo.<span class="property">current</span>); <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TextInputWithFocusButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputEl = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleBtnClick</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// `current` 指向已挂载到 DOM 上的文本输入元素</span></span><br><span class="line">    inputEl.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputEl&#125;</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleBtnClick&#125;</span>&gt;</span>Focus the input<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>批量操作 DOM, 使用 ref 回调, 将函数传递给 ref 属性, 当需要设置 ref 时, React 将调用 ref 回调并传入 DOM 节点,<ul>
<li>并在需要清除它时传入 null</li>
<li>或者手动返回一个回调函数, 在回调函数内管理 map</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef, useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setupCatList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> catList = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    catList.<span class="title function_">push</span>(<span class="string">&quot;https://loremflickr.com/320/240/cat?lock=&quot;</span> + i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> catList;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 批量 ref, 使用 ref 回调</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> itemsRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [catList, setCatList] = <span class="title function_">useState</span>(setupCatList);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getMap</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!itemsRef.<span class="property">current</span>)&#123;</span><br><span class="line">      itemsRef.<span class="property">current</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> itemsRef.<span class="property">current</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">scrollToCat</span>(<span class="params">cat</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> map = <span class="title function_">getMap</span>();</span><br><span class="line">    <span class="keyword">const</span> node = map.<span class="title function_">get</span>(cat); <span class="comment">// 获取 map 中存储的 DOM 节点</span></span><br><span class="line"></span><br><span class="line">    node.<span class="title function_">scrollToView</span>(&#123;</span><br><span class="line">      <span class="attr">behivor</span>: <span class="string">&#x27;smooth&#x27;</span>,</span><br><span class="line">      <span class="attr">block</span>: <span class="string">&#x27;nearest&#x27;</span>,</span><br><span class="line">      <span class="attr">inline</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> scrollToCat(catList[0])&#125;&gt;first<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> scrollToCat(catList[1])&#125;&gt;second<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> scrollToCat(catList[2])&#125;&gt;third<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;catList.map(cat =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">key</span>=<span class="string">&#123;cat&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">node</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">              const map = getMap();</span></span><br><span class="line"><span class="language-xml">              if(node)&#123;</span></span><br><span class="line"><span class="language-xml">                map.set(cat, node);</span></span><br><span class="line"><span class="language-xml">              &#125; else &#123;</span></span><br><span class="line"><span class="language-xml">                // 方式1: 清除 DOM</span></span><br><span class="line"><span class="language-xml">                map.delete(cat);</span></span><br><span class="line"><span class="language-xml">              &#125;</span></span><br><span class="line"><span class="language-xml">              // 方式2: 清除 DOM</span></span><br><span class="line"><span class="language-xml">              return () =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">                map.delete(cat);</span></span><br><span class="line"><span class="language-xml">              &#125;</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;cat&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>不能访问其他组件的 DOM 节点, 借助 <a href="#forwardRef">forwardRef</a> 函数, React 19 支持 props 传递 ref 引用</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyInput</span>(<span class="params">props</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">input</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 报错, 不能访问其他组件的 DOM 节点, 需要结合 forwardRef 使用</span></span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>(); </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MyInput</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useImperativeHandle"><a href="#useImperativeHandle" class="headerlink" title="useImperativeHandle"></a>useImperativeHandle</h4><blockquote>
<p>自定义由 ref 暴露出来的句柄</p>
</blockquote>
<ul>
<li><p>useImperativeHandle 应当和 <a href="#forwardRef">forwardRef</a> 一起使用</p>
</li>
<li><p>使用 ref 时自定义暴露给父组件的实例值</p>
</li>
<li><p>createHandle 函数不需要参数, 返回想要暴露的 ref 的句柄</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useImperativeHandle</span>(ref, createHandle, dependencies?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef, forwardRef, useImperativeHandle&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyInput</span> = <span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> realInputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">shaking</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;input shaking...&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 限制对外层暴露的功能</span></span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 只暴露 focus 和 scrollIntoView 方法</span></span><br><span class="line">    <span class="title function_">focus</span>(<span class="params"></span>)&#123;</span><br><span class="line">      realInputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">scrollIntoView</span>(<span class="params"></span>)&#123;</span><br><span class="line">      realInputRef.<span class="property">current</span>.<span class="title function_">scrollIntoView</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">shake</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="title function_">shaking</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;realInputRef&#125;</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>)&#123;</span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    inputRef.<span class="property">current</span>?.<span class="title function_">shake</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MyInput</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>input Focus<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useDebugValue"><a href="#useDebugValue" class="headerlink" title="useDebugValue"></a>useDebugValue</h4><blockquote>
<p>可用于在 React 开发者工具中为自定义 Hook 添加标签</p>
</blockquote>
<ul>
<li>第二个可选参数, 只有在Hook被检查时才会被调用，接收debug值作为参数，并返回一个格式化的显示值</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useDebugValue</span>(value， format?);</span><br><span class="line"></span><br><span class="line"><span class="comment">// useDebugValue(date, date =&gt; date.toLocalDateString());</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useDebugValue, useSyncExternalStore&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useOnlineStatus</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> isOnline = <span class="title function_">useSyncExternalStore</span>(subscribe, <span class="function">() =&gt;</span> navigator.<span class="property">onLine</span>, <span class="function">() =&gt;</span> <span class="literal">true</span>);</span><br><span class="line">  <span class="comment">// 在开发者工具中为 StatusBar 组件添加标签</span></span><br><span class="line">  <span class="title function_">useDebugValue</span>(isOnline ? <span class="string">&#x27;Online&#x27;</span> : <span class="string">&#x27;Offline&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> isOnline;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">StatusBar</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> isOnline = <span class="title function_">useOnlineStatus</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">StatusBar</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useActionState-experimental"><a href="#useActionState-experimental" class="headerlink" title="useActionState(experimental)  "></a>useActionState(experimental) <em id='useActionState'></em> <!--markdownlint-disable-line--></h4><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>可以根据某个表单动作的结果更新 state 的 Hook</p>
<p>调用 useActionState 时在参数中传入现有的表单动作函数以及一个初始状态, 返回一个新的 action 函数和一个 form state 以供在 form 中使用, 这个新的 form state 也会作为参数传入提供的表单动作函数</p>
<ul>
<li><p>form state 是一个只在表单被提交触发 action 后才会被更新的值</p>
</li>
<li><p>如果 action 是一个 url, form 的行为就是普通表单提交</p>
</li>
<li><p>如果 action 是一个函数, form 的行为由这个函数控制, action 同时会重写 <code>&lt;button&gt;</code>、<code>&lt;input type=&quot;submit&quot;/&gt;</code>、<code>&lt;input type=&quot;image&quot;/&gt;</code> 的 formAction(表单提交的 url) 属性</p>
</li>
<li><p>action 作为函数, 当表单被提交时触发</p>
<ul>
<li>prevState 第一个参数为上一次调用 action 函数的返回值, 第一次调用时传入的是 initialState</li>
<li>formData 余下的参数为普通表单动作接到的参数</li>
</ul>
</li>
<li><p>initialState state 的初始值</p>
</li>
<li><p>permalink 可选,</p>
</li>
</ul>
<p>返回值</p>
<ul>
<li>当前的 state, 第一次渲染时, 该值为传入的 initialState, 在 action 被调用后该值会变成 action 的返回值</li>
<li>新的 action 函数, 用于 form 组件的 action 参数或表单中任意一个 button 组件的 formAction 参数中传递</li>
<li>isPending, 用于表明是否有正在 pending 的 Transition</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, formAction, isPending] = <span class="title function_">useActionState</span>(fn, initialState, permalink?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useActionState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params">prevState, formData</span>)&#123;</span><br><span class="line">  <span class="comment">// 异步操作</span></span><br><span class="line">  <span class="comment">// await fetch();</span></span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(), <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> prevState + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">StatusForm</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, formAction, isPending] = <span class="title function_">useActionState</span>(increment, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// action 是 url 则直接提交表单, 如果是函数, 则控制表单的提交行为</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#123;formAction&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;isPending ? &#x27;加载中...&#x27; : state&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;/* form 的 action, enctype, method, target 属性可以被 button, type=&quot;submit&quot;, type=&quot;image&quot; */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;/* 的 formaction, formenctype, formmethod, formtarget 属性重写*/&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">formAction</span>=<span class="string">&#123;formAction&#125;</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* button 和 input type=&quot;submit&quot;, input type=&quot;image&quot; 是等价的 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">formAction</span>=<span class="string">&#123;formAction&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;image&quot;</span> <span class="attr">formAction</span>=<span class="string">&#123;formAction&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useOptimistic-experimental"><a href="#useOptimistic-experimental" class="headerlink" title="useOptimistic(experimental)  "></a>useOptimistic(experimental) <em id='useOptimistic'></em> <!--markdownlint-disable-line--></h4><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>核心思想是 <code>乐观更新</code>, 即在异步操作完成之前, 假设操作会成功并立即更新 UI, 这种技术有助于使应用程序在感觉上响应地更加快速.</p>
<p>通过维护两个状态来实现: 一个是当前的实际状态, 另一个是乐观状态</p>
<p>当异步操作开始时, useOptimistic 会立即更新乐观状态, 并触发 UI 重新渲染</p>
<ul>
<li>异步操作成功, 同步乐观状态和真实状态</li>
<li>异步操作失败, 自动回滚乐观状态</li>
</ul>
<p>参数</p>
<ul>
<li>state 初始时和没有挂起操作时要返回的值</li>
<li>updateFn 接受当前的 state 和传递给 addOptimistic 的乐观值, 并返回结果乐观状态. 它必须是一个纯函数</li>
</ul>
<p>返回值</p>
<ul>
<li>optimisticState 结果乐观状态. 除非有操作挂起, 否则它等于 state, 在这种情况下, 它等于 updateFn 返回的值</li>
<li>addOptimistic 触发乐观更新时调用的 dispatch 函数, 接收一个任意类型的参数 optimisticValue, 并以 state 和 optimisticValue 作为参数调用 updateFn</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useOptimistic&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">cnost [optimisticState, addOptimistic] = <span class="title function_">useOptimistic</span>(state, updateFn);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">AppContainer</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [optimisticState, addOptimistic] = <span class="title function_">useOptimistic</span>(state, <span class="function">(<span class="params">currentState, optimisticValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使用乐观值, 合并并返回新 state</span></span><br><span class="line">    <span class="keyword">return</span> [...currentState, optimisticValue];</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>乐观的更新表单</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useOptimistic, useRef, useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Thread</span>(<span class="params">&#123;messages, sendMessage&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> formRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [optimisticMessages, addOptimisticMessage] = <span class="title function_">useOptimistic</span>(messages, <span class="function">(<span class="params">state, optimisticValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使用乐观值, 合并返回新的 state</span></span><br><span class="line">    <span class="keyword">return</span> [...state, &#123;<span class="attr">text</span>: optimisticValue, <span class="attr">sending</span>: <span class="literal">true</span>&#125;];</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">formAction</span>(<span class="params">formData</span>)&#123;</span><br><span class="line">    <span class="title function_">addOptimisticMessage</span>(formData.<span class="title function_">get</span>(<span class="string">&#x27;message&#x27;</span>));</span><br><span class="line">    formRef.<span class="property">current</span>.<span class="title function_">reset</span>();</span><br><span class="line">    <span class="comment">// 异步操作</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sendMessage</span>(formData); </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;optimisticMessages.map((message, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;message.text&#125;</span></span><br><span class="line"><span class="language-xml">          &#123;message.sending &amp;&amp; <span class="tag">&lt;<span class="name">small</span>&gt;</span>发送中...<span class="tag">&lt;/<span class="name">small</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#123;formAction&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;formRef&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;hello...&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [messages, setMessages] = <span class="title function_">useState</span>([</span><br><span class="line">    &#123;<span class="attr">text</span>: <span class="string">&#x27;你好, 在这!&#x27;</span>, <span class="attr">sending</span>: <span class="literal">false</span>, <span class="attr">key</span>: <span class="number">1</span>&#125;</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params">formData</span>)&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> <span class="built_in">setTimeout</span>(reject, <span class="number">3000</span>)); <span class="comment">// 模拟异步操作 失败</span></span><br><span class="line">      <span class="title function_">setMessages</span>(<span class="function"><span class="params">messages</span> =&gt;</span> [...messages, &#123;<span class="attr">text</span>: formData.<span class="title function_">get</span>(<span class="string">&#x27;message&#x27;</span>)&#125;]); <span class="comment">// 更新状态</span></span><br><span class="line">    &#125; <span class="keyword">catch</span>(err) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Thread</span> <span class="attr">messages</span>=<span class="string">&#123;messages&#125;</span> <span class="attr">sendMessage</span>=<span class="string">&#123;sendMessage&#125;/</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useDeferredValue"><a href="#useDeferredValue" class="headerlink" title="useDeferredValue"></a>useDeferredValue</h4><p>将某个值的更新延迟到更合适的时机, 以避免不必要的渲染或阻塞主线程</p>
<ul>
<li><p>React 内部通过调度机制(Scheduler)将 useDeferredValue 的更新标记为低优先级任务</p>
</li>
<li><p>React 处理高优先级任务时, 会暂时跳过 useDeferredValue 的更新直到主线程空闲时再处理</p>
</li>
<li><p>如果 value 有新的更新(Object.is 进行比较), React 会重新启动一个可被中断的渲染任务</p>
</li>
<li><p>不能阻止额外的网络请求</p>
</li>
<li><p>不会引起任何固定的延迟, 一旦 React 完成原始的重新渲染, 它会立即开始使用新的延迟值处理后台重新渲染, 由事件(例如 输入)引起的任何更新都会中断后台重新渲染, 并被优先处理</p>
</li>
<li><p>由 useDeferredValue 引起的后台重新渲染在提交到屏幕之前不会触发 Effect, 如果后台重新渲染被暂停, Effect 将在数据加载后和 UI 更新后运行</p>
<ul>
<li>value 延迟的值</li>
<li>initialValue 可选, 组件初始渲染时使用的值, 如果省略在初始渲染期间不会延迟</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> deferredValue = <span class="title function_">useDeferredValue</span>(value, initialValue);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState, useDeferredValue, <span class="title class_">Suspense</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> deferredQuery = <span class="title function_">useDeferredValue</span>(query);</span><br><span class="line">  <span class="keyword">const</span> isStale = query !== deferredQuery;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> style = &#123;</span><br><span class="line">    <span class="attr">opacity</span>: isStale ? <span class="number">0.5</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">transition</span>: isStale ? <span class="string">&#x27;opacity 0.2s 0.2s linear&#x27;</span>: <span class="string">&#x27;opacity 0.2s 0.2s linear&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 每次输入时, 旧的列表会略微变暗, 直到新的结果列表加载完毕</span></span><br><span class="line">  <span class="comment">// 或者使用 CSS 过渡来延迟变暗的过程</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Search albums:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;query&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setQuery(e.target.value)&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;style-id&quot;</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;/* 查询结果列表 */&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">SearhReasults</span> <span class="attr">query</span>=<span class="string">&#123;deferredQuery&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useTransition"><a href="#useTransition" class="headerlink" title="useTransition  "></a>useTransition <em id='useTransition'></em> <!--markdownlint-disable-line--></h4><p>将某些 状态更新 标记为 <code>过渡</code> 状态, 允许 React 在后台处理这些更新, 而不阻塞用户界面. 通过将更新任务调整优先级来实现</p>
<ul>
<li>isPending 是否存在待处理的 transition</li>
<li>startTransition 调用此函数将状态更新标记为 transition, 传递给此函数的函数 React 会立即执行并将在其执行期间发生的所有状态更新标记为 transition<ul>
<li>如果在其执行期间, 尝试在 setTimeout 中执行状态更新, 这些状态更新不会被标记为 transition</li>
<li>只有在可以访问该状态的 set 函数时, 才能将其对应的状态更新包装为 transition</li>
<li>标记为 transition 的状态更新将被其状态更新打断</li>
<li>不能用于控制文本输入</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [isPending, startTransition] = <span class="title function_">useTransition</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useTransition, useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 切换标签页</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TabContainer</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [isPending, startTransition] = <span class="title function_">useTransition</span>();</span><br><span class="line">  <span class="keyword">const</span> [tab, setTab] = <span class="title function_">useState</span>(<span class="string">&#x27;about&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">selectTab</span>(<span class="params">nextTab</span>)&#123;</span><br><span class="line">    <span class="title function_">startTransition</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">setTab</span>(nextTab);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过 action 执行非阻塞更新</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CheckoutForm</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [isPending, startTransition] = <span class="title function_">useTransition</span>();</span><br><span class="line">  <span class="keyword">const</span> [quantity, setQuantity] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">updateQuantityAction</span> = <span class="keyword">async</span> newQuantity =&gt; &#123;</span><br><span class="line">    <span class="comment">// To access the pending state of a transition,</span></span><br><span class="line">    <span class="comment">// call startTransition again.</span></span><br><span class="line">    <span class="title function_">startTransition</span>(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> savedQuantity = <span class="keyword">await</span> <span class="title function_">updateQuantity</span>(newQuantity);</span><br><span class="line">      <span class="title function_">startTransition</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setQuantity</span>(savedQuantity);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Checkout<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Item</span> <span class="attr">action</span>=<span class="string">&#123;updateQuantityAction&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Total</span> <span class="attr">quantity</span>=<span class="string">&#123;quantity&#125;</span> <span class="attr">isPending</span>=<span class="string">&#123;isPending&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useSyncExternalStore"><a href="#useSyncExternalStore" class="headerlink" title="useSyncExternalStore"></a>useSyncExternalStore</h4><p>订阅外部 store</p>
<ul>
<li>subscribe 接收一个单独的 callback 参数并把它订阅到 store 上, 当 store 发生改变时调用提供的 callback, 引起组件重新渲染<ul>
<li>返回值为 cleanup 清除函数</li>
</ul>
</li>
<li>getSnapshot 返回组件需要的 store 中的数据快照, store 不变的情况下, 重复调用必须返回同一个值, 否则, React 就会重新渲染组件</li>
<li>getServerSnapshot 返回 store 中数据的初始快照, 只会在服务器渲染时, 以及在客户端进行 hydration 时被用到</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> snapshot = <span class="title function_">useSyncExternalStore</span>(subscribe, getSnapshot, getServerSnapshot?);</span><br></pre></td></tr></table></figure>

<ul>
<li>监听 store</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useSyncExternalStore&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> nextId = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> todos = [&#123;<span class="attr">id</span>: nextId++, <span class="attr">text</span>: <span class="string">&#x27;Todo # 1&#x27;</span>&#125;];</span><br><span class="line"><span class="keyword">let</span> listeners = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todosStore = &#123;</span><br><span class="line">  <span class="title function_">addTodo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    todos = [...todos, &#123;<span class="attr">id</span>: nextId++, <span class="attr">text</span>: <span class="string">&#x27;Todo # &#x27;</span> + nextId&#125;];</span><br><span class="line">    <span class="title function_">emitChange</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">subscribe</span>(<span class="params">listener</span>)&#123;</span><br><span class="line">    <span class="comment">// 接收一个 callback, 并返回一个 cleanup 函数</span></span><br><span class="line">    listeners = [...listeners, listener];</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      listeners = listeners.<span class="title function_">filter</span>(<span class="function"><span class="params">l</span> =&gt;</span> l !== listener);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getSnapshot</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> todos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">emitChange</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> listener <span class="keyword">of</span> listeners)&#123;</span><br><span class="line">    <span class="title function_">listener</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TodosApp</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> todos = <span class="title function_">useSyncExternalStore</span>(todosStore.<span class="property">subscribe</span>, todosStore.<span class="property">getSnapshot</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> todosStore.addTodo()&#125;&gt;Add Todo<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;todos.map(todo =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span>&gt;</span>&#123;todo.text&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>订阅浏览器 API</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useSyncExternalStore&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">subscribe</span>(<span class="params">callback</span>)&#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;online&#x27;</span>, callback);</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, callback);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;online&#x27;</span>, callback);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, callback);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useOnlineStatus</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> isOnline = <span class="title function_">useSyncExternalStore</span>(subscribe, <span class="function">() =&gt;</span> navigator.<span class="property">onLine</span>, <span class="function">() =&gt;</span> <span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">return</span> isOnline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义-Hook"><a href="#自定义-Hook" class="headerlink" title="自定义 Hook"></a>自定义 Hook</h3><ul>
<li>Hook 的名称必须以 use 开头</li>
<li>自定义 Hook 共享的是状态逻辑, 而不是状态本身</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useDemo</span>(<span class="params">prop</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行订阅</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 执行取消订阅</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>网络状态 Hook</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useEffect,useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 无法检测已离线的网络</span></span><br><span class="line"><span class="comment">// 如果在生成初始 HTML 的服务端直接使用它是无效的</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useOnlineStatus</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [isOnline, setIsOnline] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">handleOnline</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="title function_">setIsOnline</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">handleOffline</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="title function_">setIsOnline</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;online&#x27;</span>, handleOnline);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, handleOffline);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;online&#x27;</span>, handleOnline);</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, handleOffline);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,[]);</span><br><span class="line">  <span class="keyword">return</span> isOnline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改进版, 使用 useSyncExternalStore</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">subscribe</span>(<span class="params">callback</span>)&#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;online&#x27;</span>, callback);</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, callback);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;online&#x27;</span>, callback);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, callback);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useOnlineStatus</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useSyncExternalStore</span>(subscribe, <span class="function">() =&gt;</span> navigator.<span class="property">onLine</span>, <span class="function">() =&gt;</span> <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="React-组件"><a href="#React-组件" class="headerlink" title="React 组件"></a>React 组件</h2><h3 id="React-内置组件"><a href="#React-内置组件" class="headerlink" title="React 内置组件"></a>React 内置组件</h3><h4 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h4><p>通常使用 <code>&lt;&gt;...&lt;/&gt;</code> 简写形式代替, 允许在不添加额外节点的情况下将子元素组合</p>
<ul>
<li>如果传递一个 key 给 Fragment 时, 不能使用简写形式</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Fragment</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Post</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostTitle</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostBody</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渲染 key</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Blog</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> posts.<span class="title function_">map</span>(<span class="function"><span class="params">post</span> =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Fragment</span> <span class="attr">key</span>=<span class="string">&#123;post.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostTitle</span> <span class="attr">title</span>=<span class="string">&#123;post.title&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostBody</span> <span class="attr">body</span>=<span class="string">&#123;post.body&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Profiler"><a href="#Profiler" class="headerlink" title="Profiler"></a>Profiler</h4><p>允许编程式测量 React 树的渲染性能, 可以嵌套测量应用的不同部分</p>
<ul>
<li>id 字符串, 用于标识正在测量的 UI 部分</li>
<li>onRender 当包裹的组件树更新时, React 回调此函数, 并传入有关渲染内容和所花费时间的信息</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Profiler</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onRender</span>(<span class="params">id, phase, actualDuration, baseDuration, startTime, commitTime</span>)&#123;</span><br><span class="line">  <span class="comment">// id 字符串, 为 Profiler 树的属性</span></span><br><span class="line">  <span class="comment">// phase 标识书的渲染阶段, 取值: mount, update, nested-update</span></span><br><span class="line">  <span class="comment">// actualDuration 渲染 Profiler 树的毫秒数</span></span><br><span class="line">  <span class="comment">// baseDuration 估算在没有任何优化的情况下重新渲染整棵 Profiler 子树所需的毫秒数</span></span><br><span class="line">  <span class="comment">// startTime 开始渲染此次更新时的时间戳</span></span><br><span class="line">  <span class="comment">// commitTime React 提交此次更新时的时间戳</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Profiler</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">onRender</span>=<span class="string">&#123;onRender&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Profiler</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="StrictMode"><a href="#StrictMode" class="headerlink" title="StrictMode"></a>StrictMode</h4><p>为整个应用启动严格模式, 尽早发现组件中的常见错误</p>
<p>所有的检查仅在开发环境中进行, 不会影响生产构建</p>
<ul>
<li>组件将重新渲染一次, 以查找由于非纯渲染而引起的错误</li>
<li>组件将重新运行 Effect 一次, 以查找由于缺少 Effect 清理而引起的错误</li>
<li>组件将被检查是否使用了已弃用的 API</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">StrictMode</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createRoot&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"><span class="comment">// 部分开启严格模式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Header<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Suspense"><a href="#Suspense" class="headerlink" title="Suspense"></a>Suspense</h4><p>允许子组件完成加载前展示后备方案, Suspense 无法检测到 Effect 或事件处理程序中获取数据的情况</p>
<ul>
<li>children 真正的 UI 渲染内容, 如果 children 在渲染中被挂起, Suspense 将会渲染 fallback</li>
<li>fallback 真正的 UI 未渲染完成时代替其渲染的备用 UI</li>
</ul>
<p>激活 Suspense 组件的数据源</p>
<ul>
<li>支持 Suspense 的框架如 Relay 和 Next.js</li>
<li>使用 lazy 懒加载组件代码</li>
<li>使用 use 读取 Promise 的值</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Suspense</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="React-API"><a href="#React-API" class="headerlink" title="React API"></a>React API</h2><h3 id="act"><a href="#act" class="headerlink" title="act"></a>act</h3><p>测试助手, 用于在做出断言之前应用挂起的 React 更新, 通常用在测试库中</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;act&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">await</span> <span class="title function_">act</span>(<span class="keyword">async</span> actFn);</span><br></pre></td></tr></table></figure>

<h3 id="cache-experimental"><a href="#cache-experimental" class="headerlink" title="cache(experimental)"></a>cache(experimental)</h3><p>允许缓存数据获取或计算的结果, 在任何组件之外调用创建带有缓存的函数版本</p>
<ul>
<li>仅供与 <code>服务器组件</code> 一起使用</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;cache&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> cachedFn = <span class="title function_">cache</span>(fn);</span><br></pre></td></tr></table></figure>

<h3 id="createContext"><a href="#createContext" class="headerlink" title="createContext"></a>createContext</h3><p>创建一个 Context 提供给子组件, 通常和 <a href="#useContext">useContext</a> 配合使用</p>
<h3 id="forwardRef"><a href="#forwardRef" class="headerlink" title="forwardRef  "></a>forwardRef <em id="forwardRef"></em> <!--markdownlint-disable-line--></h3><blockquote>
<p>React 19 不再支持, 直接使用 prop 传递 ref 引用</p>
</blockquote>
<p>允许组件使用 ref 将 DOM 节点暴露给父组件</p>
<ul>
<li>render 渲染函数, React 将使用 props 和 ref 调用此函数, 返回的 JSX 作为组件的输出</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">SomeComponent</span> = <span class="title function_">forwardRef</span>(render);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;forwardRef, useRef&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyInput</span> = <span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">MyInput</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;/</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="lazy"><a href="#lazy" class="headerlink" title="lazy"></a>lazy</h3><p>在组件第一次被渲染之前延迟加载组件的代码, 通过将懒加载组件或其任何父级包装到 Suspense 边界中实现</p>
<ul>
<li>load 该函数返回一个 Promise 或一个 thenable 对象, React 首次调用 load 后将等待解析, 然后将解析值的 .default 渲染为 React 组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">LazyComponent</span> = <span class="title function_">lazy</span>(load);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;lazy&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MarkdownPreview</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./MarkdownPreview.js&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span>/&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MarkdownPreview</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspene</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="memo"><a href="#memo" class="headerlink" title="memo"></a>memo</h3><p>允许组件在 props 没有改变的情况下跳过重新渲染</p>
<p>只有当组件经常使用完全相同的 props 进行渲染时, 并且其重新渲染逻辑是非常昂贵的, 使用 memo 优化才有意义</p>
<ul>
<li>记忆化只与从父组件传递给组件的 props 有关, 即使组件已被记忆化, 当其使用的 context 发生变化时, 仍将重新渲染</li>
<li>componennt 要进行缓存的组件, memo 不会修改该组件, 而是返回一个新的、记忆化的组件, 接受任何有效的 React 组件, 包含函数式组件和 <a href="#forwardRef">forwardRef</a> 组件</li>
<li>arePropsEqual 该函数接收两个参数, 组件的上一个 props 和新的 props 进行比较<ul>
<li>新的 props 和旧的 props 具有相同的输出时返回 true</li>
<li>否则返回 false</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MemoizedComponent</span> = <span class="title function_">memo</span>(component, arePropsEqual?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;memo&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Greeting</span> = <span class="title function_">memo</span>(<span class="keyword">function</span> <span class="title function_">Greeting</span>(<span class="params">&#123;name&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="startTransition"><a href="#startTransition" class="headerlink" title="startTransition"></a>startTransition</h3><p>在不阻塞 UI 的情况下更新 state</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;startTransition&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TabContainer</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [tab, setTab] = <span class="title function_">useState</span>(<span class="string">&#x27;about&#x27;</span>);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">selectTab</span>(<span class="params">tab</span>)&#123;</span><br><span class="line">    <span class="title function_">startTransition</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="title function_">selectTab</span>(tab);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="use-experimental"><a href="#use-experimental" class="headerlink" title="use(experimental)"></a>use(experimental)</h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>读取类似于 Promise 或 context 的资源的值</p>
<ul>
<li>可以在 循环 或 条件 语句中调用 use, 调用 use 的函数仍然必须是一个 组件 或 Hook</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = <span class="title function_">use</span>(resource);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;use&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MessageComponent</span>(<span class="params">&#123;messagePromise&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> message = <span class="title function_">use</span>(messagePromise);</span><br><span class="line">  <span class="keyword">const</span> theme = <span class="title function_">use</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="experimental-taintObjectReference-experimental"><a href="#experimental-taintObjectReference-experimental" class="headerlink" title="experimental_taintObjectReference(experimental)"></a>experimental_taintObjectReference(experimental)</h3><p>允许阻止特定对象实例被传递给客户端组件, 例如 user 对象</p>
<ul>
<li>message 对象被传递给客户端组件时显示的消息</li>
<li>object 被污染的对象, React 会阻止直接将 函数 和 类 传递给客户端组件, 并把默认的错误消息替换在 message 中定义的内容</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">experimental_taintObjectReference</span>(message, object);</span><br></pre></td></tr></table></figure>

<h3 id="taintUniqueValue-experimental"><a href="#taintUniqueValue-experimental" class="headerlink" title="taintUniqueValue(experimental)"></a>taintUniqueValue(experimental)</h3><p>阻止将唯一值传递给客户端组件, 例如 密码、密钥或令牌</p>
<ul>
<li>message  value 被传递给客户端组件时显示的消息</li>
<li>lifetime 指定 value 应该被污染多长时间的任何对象, 只要此对象仍然存在, 将阻止把 value 发送给任何客户端组件</li>
<li>value 具有高熵的字符串或字节的唯一序列</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">taintUniqueValue</span>(message, lifetime, value);</span><br></pre></td></tr></table></figure>

<h2 id="ReactDOM-Hook"><a href="#ReactDOM-Hook" class="headerlink" title="ReactDOM Hook"></a>ReactDOM Hook</h2><h3 id="useFormStatus-experimental"><a href="#useFormStatus-experimental" class="headerlink" title="useFormStatus(experimental)"></a>useFormStatus(experimental)</h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>获取上一次表单提交状态信息 Hook, 必须从在 <a href="#form">&lt;form&gt;</a> 内渲染的组件中调用, 仅会返回父级 form 的状态信息, 不会返回同一组件或子组件中渲染的然和 form 的状态信息</p>
<ul>
<li>pending 标识父级 form 是否正在等待提交, 如果调用 useFormStatus 的组件未嵌套在 form 中, 总是返回 false</li>
<li>data 包含父级 form 正在提交的 formData 数据, 如果没有进行提交为 null</li>
<li>method  标识父级 form 使用 GET 或 POST 进行提交, 默认使用 GET</li>
<li>action 传递给父级 form 的 action 属性的函数引用, 如果没有父级 form 则为 null</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;pending, data, method, action&#125; = <span class="title function_">useFormStatus</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useFormStatus&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Submit</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;pending, data, method&#125; = <span class="title function_">useFormStatus</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">disabled</span>=<span class="string">&#123;pending&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;pending ? &#x27;提交...&#x27; : &#x27;提交&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;data ? `请求 $&#123;data.get(&#x27;username&#x27;)&#125;...` : &#x27;&#x27;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>method 为 &#123;method&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params">&#123;action&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#123;action&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Submit</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">action</span>=<span class="string">&#123;submitForm&#125;/</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>不会返回同一组件或子组件中渲染的 form 的状态信息, 仅获取父级 form 的状态信息</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// useFormStatus 不会跟踪此组件中渲染的表单, pending 永远不会为 true</span></span><br><span class="line">  <span class="comment">// 需要将 useFormStatus 改成在 Form 组件的子组件中调用</span></span><br><span class="line">  <span class="keyword">const</span> &#123;pending&#125; = <span class="title function_">useFormStatus</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#123;submit&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ReactDOM-组件"><a href="#ReactDOM-组件" class="headerlink" title="ReactDOM 组件"></a>ReactDOM 组件</h2><h3 id="自定义-HTML-元素"><a href="#自定义-HTML-元素" class="headerlink" title="自定义 HTML 元素"></a>自定义 HTML 元素</h3><p>渲染一个带连字符的标签 如 <code>&lt;my-elment&gt;</code>, React 会认为渲染自定义 HTML 元素</p>
<ul>
<li>所有自定义元素的 props 都将被序列化为字符串, 并且总是使用属性(attribute)进行设置</li>
<li>自定义元素接受 <code>class</code> 而不是 <code>className</code>, 接受 <code>for</code> 而不是 <code>htmlFor</code></li>
<li>如果使用 is 属性渲染一个内置的浏览器 HTML 元素, 将被视为自定义元素</li>
</ul>
<h3 id="属性差异"><a href="#属性差异" class="headerlink" title="属性差异"></a>属性差异</h3><p>在 React 中，所有的 DOM 特性和属性（包括事件处理）都应该是小驼峰命名的方式。例如，与 HTML 中的 tabindex 属性对应的 React 的属性是 tabIndex。例外的情况是 <code>aria-*</code> 以及 <code>data-*</code> 属性，一律使用小写字母命名。比如, 你依然可以用 aria-label 作为 aria-label。</p>
<ul>
<li><p>dangerouslySetInnerHTML React 为浏览器 DOM 提供 innerHTML 的替换方案</p>
<ul>
<li>不能同时传递 children 和 dangerouslySetInnerHTML</li>
<li>直接设置 HTML 存在风险</li>
<li>key 为 __html</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createMarkup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">__html</span>: <span class="string">&#x27;First &amp;middot; Second&#x27;</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">dangerouslySetInnerHTML</span>=<span class="string">&#123;createMarkup()&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>for JavaScript 中的保留字，React 中内置元素使用 htmlFor 代替</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;label htmlFor=<span class="string">&quot;htmlFor&quot;</span>&gt;htmlFor&lt;/label&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;htmlFor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;htmlFor&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>suppressContentEditableWarning 此属性禁用 当 DOM 元素拥有 contentEditable 属性时，React 发出警告</p>
</li>
<li><p>suppressHydrationWarning 此属性禁用警告, 如果 React 服务器与客户端渲染不同的内容时发出警告</p>
</li>
</ul>
<h3 id="lt-form-gt"><a href="#lt-form-gt" class="headerlink" title="&lt;form&gt;  "></a>&lt;form&gt; <em id='form'></em> <!--markdownlint-disable-line--></h3><p>React &lt;form&gt; action, &lt;input&gt; 和 &lt;button&gt; 的 formAction 支持传入函数, 以便使用 Actions 自动提交表单, 当 &lt;form&gt; action 提交成功时, React 将自动为 <code>非受控组件</code> 重置表单</p>
<ul>
<li><p>React 不支持在 option 元素上传递 selected 属性</p>
</li>
<li><p>checked 控制复选框或单选按钮是否被选中</p>
</li>
<li><p>value 控制文本框、下拉框、文本域的输入文本</p>
</li>
</ul>
<p>以下属性仅在 <code>非受控元素</code> 中有效</p>
<ul>
<li>defaultChecked 指定复选框或单选按钮的初始值</li>
<li>defaultValue 指定文本框、下拉框、文本域的初始值</li>
</ul>
<h3 id="合成事件"><a href="#合成事件" class="headerlink" title="合成事件"></a>合成事件</h3><p>事件处理程序接收到一个 React 合成的事件对象, <code>SyntheticEvent</code> 为 React 的事件包装器, 是所有事件的基类型</p>
<ul>
<li><p>事件: on + 事件名称 + Capture(捕获阶段触发)</p>
</li>
<li><p>事件处理器: handle + 事件名称</p>
</li>
<li><p>阻止事件冒泡手动调用 <code>e.stopPropagation()</code></p>
</li>
<li><p>阻止部分 html 元素的浏览器默认行为调用 <code>e.preventDefault()</code></p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params"></span>) =&gt; &#123; <span class="comment">/*...*/</span> &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">handleClickCapture</span> = (<span class="params"></span>) =&gt; &#123; <span class="comment">/*...*/</span> &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span> <span class="attr">onClickCapture</span>=<span class="string">&#123;handleClickCapture&#125;</span>    &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>为什么要使用合成事件</strong> <!--markdownlint-disable-line--></p>
<ul>
<li>跨浏览器兼容性, 不同浏览器实现原生 DOM 事件的方式有所不同</li>
<li>事件委托, React 利用事件委托将所有的事件处理器绑定在根节点上, 然后根据事件冒泡机制将事件派发到相应的组件<ul>
<li>减少内存开销, 避免了为每个元素都创建单独的事件处理器</li>
<li>提高性能, 事件处理器的减少, 减少了初始化和更新时的开销</li>
<li>动态插入的元素也能正常工作, 由于事件委托在根节点上, 即使后来动态插入的元素也能正确触发事件</li>
</ul>
</li>
<li>批量更新, React 的合成事件系统允许它对状态更新进行批量处理</li>
<li>防止内存泄漏, React 的合成事件系统会在事件处理完成之后自动清除事件处理器</li>
<li>事件池, React 实现了一个事件池机制, 可以重用事件对象, 减少垃圾回收的压力</li>
<li>简化事件处理逻辑, React 的合成事件系统提供了统一的 API 来处理各种类型的事件</li>
<li>更好的调试体验, React 提供了一些有用的调试工具和功能</li>
</ul>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><p>除了以下标准属性, React 针对不同事件额外附加了其他 属性, 如 ClipboardEvent 事件附加了 clipboardData</p>
<ul>
<li>bubbles 布尔值, 返回是否会在 DOM 中冒泡传播</li>
<li>cancelable 布尔值, 返回事件是否可以被取消</li>
<li>currentTarget DOM 节点, 返回当前事件处理程序所附加到的节点在 React 树中的位置</li>
<li>defaultPrevented 布尔值, 返回是否调用了 preventDefault</li>
<li>eventPhase 数字, 返回事件当前所处的阶段</li>
<li>isTrusted 布尔值, 返回事件是否由用户发起</li>
<li>target DOM 节点, 返回事件发生的节点(可能是远程子节点)</li>
<li>timestamp 数字, 返回事件发生的时间</li>
<li>nativeEvent DOM event 对象, 浏览器的原生事件对象</li>
</ul>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ul>
<li><p>preventDefault 阻止事件的默认浏览器行为</p>
</li>
<li><p>stopPropagation 阻止事件在 React 树中的传播</p>
</li>
<li><p>isDefaultPrevented 布尔值, 返回是否调用了 preventDefault 方法</p>
</li>
<li><p>isPropagationStopped 布尔值, 返回是否调用 stopPropagation 方法</p>
</li>
<li><p>persist 不适用 ReactDOM, 在 React Native 中, 调用此函数以读取事件后的属性</p>
</li>
<li><p>isPersistent 不适用 ReactDOM, 在 React Native 中, 返回是否调用了 persist</p>
</li>
</ul>
<h3 id="支持文档元数据"><a href="#支持文档元数据" class="headerlink" title="支持文档元数据"></a>支持文档元数据</h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>在组件中添加 title, link, meta 文档元数据标签, React 将自动将它们提升到文档的 head 部分. 旧版本需要借助 <code>react-helmet</code> 库实现</p>
<h2 id="ReactDOM-API"><a href="#ReactDOM-API" class="headerlink" title="ReactDOM API"></a>ReactDOM API</h2><h3 id="createPortal"><a href="#createPortal" class="headerlink" title="createPortal"></a>createPortal</h3><p>允许将 JSX 作为 children 渲染到 DOM 的不同部分</p>
<ul>
<li>children React 可以渲染的任何内容</li>
<li>domNode 某个已经存在的 DOM 节点</li>
<li>key 用作 portal key 的独特字符串或数字</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createPortalDOM = <span class="title function_">createPortal</span>(children, domNode, key?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createPortal&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createPortalDOM = <span class="title function_">createPortal</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>, <span class="variable language_">document</span>.<span class="property">body</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;createPortalDOM&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="flushSync"><a href="#flushSync" class="headerlink" title="flushSync"></a>flushSync</h3><p>允许强制 React 立即同步更新 DOM, 使用此方法可能严重影响应用程序的性能</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">flushSync</span>(callback);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef, useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;flushSync&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> listRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [text, setText] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> [todos, setTodos] = <span class="title function_">useState</span>([]); </span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleAdd</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> newTodo = &#123;<span class="attr">id</span>: nextId++, <span class="attr">text</span>: text&#125;;</span><br><span class="line">    <span class="comment">// 强制 React 立即同步更新 DOM</span></span><br><span class="line">    <span class="title function_">flushSync</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="title function_">setText</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">      <span class="title function_">setTodos</span>([...todos, newTodo]);</span><br><span class="line">    &#125;);</span><br><span class="line">    listRef.<span class="property">current</span>.<span class="property">lastChild</span>.<span class="title function_">scrollIntoView</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="comment">/* ... */</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="findDOMNode-deprected"><a href="#findDOMNode-deprected" class="headerlink" title="findDOMNode(deprected)"></a>findDOMNode(deprected)</h3><blockquote>
<p>React 18 开始, 使用 ref 代替</p>
</blockquote>
<p>获取组件实例对用的浏览器 DOM 节点</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> domNode = <span class="title function_">findDOMNode</span>(componentInstance);</span><br></pre></td></tr></table></figure>

<h3 id="hydrate-deprected"><a href="#hydrate-deprected" class="headerlink" title="hydrate(deprected)"></a>hydrate(deprected)</h3><blockquote>
<p>React 18 开始, 使用 <a href="#hydrateRoot">hydrateRoot</a> 代替</p>
</blockquote>
<p>允许 React 17 及以下版本中使用 <code>react-dom/server</code> 生成的 HTML 内容作为浏览器 DOM 节点, 并在其中显示 React 组件</p>
<ul>
<li>reactNode 用于渲染现有的 HTML, 通常是 JSX 片段, 并且使用像 <code>renderToString(&lt;App/&gt;)</code> 的 ReactDOM Server 方法渲染</li>
<li>domNode 在服务器中被渲染为根节点的 DOM 元素</li>
<li>callback React 将在组件 hydrate 后调用</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">hydrate</span>(reactNode, domNode, callback?);</span><br></pre></td></tr></table></figure>

<h3 id="render-deprected"><a href="#render-deprected" class="headerlink" title="render(deprected)"></a>render(deprected)</h3><blockquote>
<p>React 18 开始, 使用 <a href="#createRoot">createRoot</a> 代替</p>
</blockquote>
<p>将一段 JSX 片段渲染到浏览器 DOM 容器节点中</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(reactNode, domNode, callback?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;render&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">App</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./App.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="unmountComponentAtNode-deprected"><a href="#unmountComponentAtNode-deprected" class="headerlink" title="unmountComponentAtNode(deprected)"></a>unmountComponentAtNode(deprected)</h3><blockquote>
<p>React 18 开始, 使用 root.unmount 代替</p>
</blockquote>
<p>从 DOM 中移除一个已挂载的 React 组件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">unmountComponentAtNode</span>(domNode);</span><br></pre></td></tr></table></figure>

<h3 id="preconnect-experimental"><a href="#preconnect-experimental" class="headerlink" title="preconnect(experimental)  "></a>preconnect(experimental) <em id="preconnect"></em> <!--markdownlint-disable-line--></h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>提前连接到一个期望从中加载资源的服务器</p>
<ul>
<li>对同一服务器进行多次调用 preconnect 具有与单次调用相同的结果</li>
<li>在浏览器中, 可以在任何情况下调用 preconnect</li>
<li>服务器端渲染时, 只有在渲染组件或在从渲染组件中发起的异步上下文中调用 preconnect 时才会生效, 任何其他调用都会被忽略</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">preconnect</span>(href);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;preconnect&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">AppRoot</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 预连接到主机</span></span><br><span class="line">  <span class="title function_">preconnect</span>(<span class="string">&#x27;https://example.com&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="prefetchDNS-experimental"><a href="#prefetchDNS-experimental" class="headerlink" title="prefetchDNS(experimental)"></a>prefetchDNS(experimental)</h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>允许提前查找期望从中加载资源的服务器的 IP, 和 <a href="#preconnect">preconnect</a> 类似</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">prefetchDNS</span>(href);</span><br></pre></td></tr></table></figure>

<h3 id="preinit-experimental"><a href="#preinit-experimental" class="headerlink" title="preinit(experimental)  "></a>preinit(experimental) <em id="preinit"></em> <!--markdownlint-disable-line--></h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>React 框架通常会内置资源处理方案, 不需要手动调用此 API</p>
<p>预获取和评估样式表或外部脚本</p>
<ul>
<li><p>对于具有相同的 href 的多个 preinit 调用具有与单个调用相同的结果</p>
</li>
<li><p>在浏览器中, 可以在任何情况下调用 preinit</p>
</li>
<li><p>在服务器端渲染时, 只有在渲染组件或在从渲染组件中发起的异步上下文中调用 preinit 时才会生效, 任何其他调用都会被忽略</p>
</li>
<li><p>href 要下载并执行的资源的 url</p>
</li>
<li><p>options</p>
<ul>
<li>as 标识资源的类型, 可能的值 script, style</li>
<li>precedence 与样式表一起使用时必需, 指定样式表相对于其他样式表的插入位置, 可能的值 reset, low, meduim, high</li>
<li>crossOrigin 标识要使用的 CORS 策略, 可能的值为 anonymous, use-credentials</li>
<li>integrity 标识资源的加密哈希, 用于验证其真实性</li>
<li>nonce 标识使用严格 CSP(安全内容策略) 时允许资源的加密随机数</li>
<li>fetchPriority 建议获取资源的相对优先级, 可能的值为 auto(默认), high, low</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">preinit</span>(href, options);</span><br></pre></td></tr></table></figure>

<h3 id="preinitModule-experimental"><a href="#preinitModule-experimental" class="headerlink" title="preinitModule(experimental)  "></a>preinitModule(experimental) <em id="preinitModule"></em> <!--markdownlint-disable-line--></h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>React 框架通常会内置资源处理方案, 不需要手动调用此 API</p>
<p>预获取和评估 ESM 模块</p>
<p>执行时机参考 <a href="#preinit">preinit</a></p>
<ul>
<li>href 要下载并执行的模块的 url</li>
<li>options<ul>
<li>as 只能取值 script</li>
<li>crossOrigin 同 <a href="#preinit">preinit</a></li>
<li>integrity 同 <a href="#preinit">preinit</a></li>
<li>nonce 同 <a href="#preinit">preinit</a></li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">preinitModule</span>(href, options)</span><br></pre></td></tr></table></figure>

<h3 id="preload-experimental"><a href="#preload-experimental" class="headerlink" title="preload(experimental)"></a>preload(experimental)</h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>React 框架通常会内置资源处理方案, 不需要手动调用此 API</p>
<p>预获取期望使用的资源, 比如样式表、字体、外部脚本</p>
<p>执行时机和参数参考 <a href="#preinit">preinit</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">preload</span>(href, options);</span><br></pre></td></tr></table></figure>

<h3 id="preloadModule-experimental"><a href="#preloadModule-experimental" class="headerlink" title="preloadModule(experimental)"></a>preloadModule(experimental)</h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>React 框架通常会内置资源处理方案, 不需要手动调用此 API</p>
<p>预获取期望使用的 ESM 模块</p>
<p>执行时机和参数参考 <a href="#preinitModule">preinitModule</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">preloadModule</span>(href, options);</span><br></pre></td></tr></table></figure>

<h2 id="ReactDOM-Client-API"><a href="#ReactDOM-Client-API" class="headerlink" title="ReactDOM Client API"></a>ReactDOM Client API</h2><p><code>react-dom/client</code> API 允许在客户端(浏览器) 渲染 React 组件, 通常在应用程序项目顶层调用</p>
<h3 id="createRoot"><a href="#createRoot" class="headerlink" title="createRoot  "></a>createRoot <em id="createRoot"></em> <!--markdownlint-disable-line--></h3><p>允许在浏览器的 DOM 节点中创建根节点以显示 React 组件</p>
<ul>
<li>domNode 某个已经存在的 DOM 节点</li>
<li>options<ul>
<li>onCaughtError(experimental) 当 React 捕获到错误边界时调用, React 19 支持</li>
<li>onUncaughtError(experimental) 当错误边界抛出了一个无法捕获的错误时调用, React 19 支持</li>
<li>onRecoverableError 当 React 自动从错误中恢复时调用</li>
<li>identifierPrefix 一个字符串, React 使用此字符串作为 <a href="#useId">useId</a> 生成的 id 的前缀, 当在一个页面中使用多个根节点时可以避免冲突</li>
</ul>
</li>
</ul>
<p>返回值</p>
<ul>
<li>root.render(reactNode) 将一段 JSX 片段渲染为 React 组件并显示, 首次调用时 React 将清空根节点所有已经存在的 HTML</li>
<li>root.unmount() 销毁 React 根节点中的一个已经渲染的树</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> root = <span class="title function_">createRoot</span>(domNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createPortal&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createRoot&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line">root.<span class="title function_">render</span>(reactNode);</span><br></pre></td></tr></table></figure>

<h3 id="hydrateRoot"><a href="#hydrateRoot" class="headerlink" title="hydrateRoot  "></a>hydrateRoot <em id="hydrateRoot"></em> <!--markdownlint-disable-line--></h3><!-- 允许在先前路由 `react-dom/server` 生成的浏览器 HTML DOM 节点中展示 React 组件 -->
<p>用 hydrateRoot 函数将 React 连接到 React 在服务器端环境中渲染的 HTML 中</p>
<p>开发模式下, React 会在 hydrate 期间发出不匹配警告. 在不匹配的情况下, 不能保证内容差异会被修补, 出于性能原因, 这很重要, 因为在大多数应用程序中, 不匹配很少见, 因此验证所有标记将是非常昂贵而不可行的</p>
<ul>
<li>domNode 一个在服务器端渲染时呈现为根元素的 DOM 元素</li>
<li>reactNode 用于渲染已存在 HTML 的 React 节点, 通常是 JSX 片段, 并且使用像 <code>renderToPipeableStream(&lt;App/&gt;)</code> 的方法渲染</li>
<li>options 参数同 <a href="#createRoot">createRoot</a> 的 options</li>
</ul>
<p>返回值</p>
<ul>
<li>root.render(reactNode) 更新一个 hydrate 根组件中的 React 组件来渲染浏览器端 DOM 元素</li>
<li>root.unmount() 销毁 React 根节点内的渲染树</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> root = <span class="title function_">hydrateRoot</span>(domNode, reactNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState, useEffect&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;hydreateRoot&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// eg1</span></span><br><span class="line"><span class="comment">// index.html</span></span><br><span class="line"><span class="comment">// 由 react-dom/server 生成的 HMTL 内容</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Is Server<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [isClient, setIsClient] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">setIsClient</span>(<span class="literal">true</span>);</span><br><span class="line">  &#125;,[]);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;isClient ? &#x27;Is Client&#x27; : &#x27;Is Server&#x27;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">hydreateRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>), <span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// eg2</span></span><br><span class="line"><span class="comment">// index.html</span></span><br><span class="line"><span class="comment">// 由 react-dom/server 生成的 HTML 内容</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello world! <span class="comment">&lt;!-- --&gt;</span>0<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;Type something here&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params">&#123;counter&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello world! &#123;counter&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;Type something here&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title function_">hydrateRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>), <span class="language-xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">counter</span>=<span class="string">&#123;0&#125;/</span>&gt;</span></span>);</span><br><span class="line"><span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">counter</span>=<span class="string">&#123;i&#125;/</span>&gt;</span></span>);</span><br><span class="line">  i++;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="ReactDOM-Server-API"><a href="#ReactDOM-Server-API" class="headerlink" title="ReactDOM Server API"></a>ReactDOM Server API</h2><p><code>react-dom/server</code> API 允许在服务器端将 React 组件渲染为 HTML, 仅在服务器端应用程序顶层调用</p>
<h3 id="Node-js-流服务器-API"><a href="#Node-js-流服务器-API" class="headerlink" title="Node.js 流服务器 API"></a>Node.js 流服务器 API</h3><h4 id="renderToNodeStream-deprected"><a href="#renderToNodeStream-deprected" class="headerlink" title="renderToNodeStream(deprected)"></a>renderToNodeStream(deprected)</h4><blockquote>
<p>React 18 开始, 改用 <a href="#renderToPipeableStream">renderToPipeableStream</a></p>
</blockquote>
<p>输出 HTML 字符串的 Node.js 只读流, 此方法会缓冲所有输出, 因此实际上它并没有提供任何流式传输的好处</p>
<p>在客户端使用 <a href="#hydrateRoot">hydrateRoot</a> 使服务器生成的 HTML 具有交互功能</p>
<ul>
<li>reactNode 要渲染为 HTML 的 React 节点</li>
<li>options<ul>
<li>identifierPrefix 字符串前缀, 由 <a href="#useId">useId</a> 生成的 id 使用</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stream = <span class="title function_">renderToNodeStream</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<h4 id="renderToStaticNodeStream-deprected"><a href="#renderToStaticNodeStream-deprected" class="headerlink" title="renderToStaticNodeStream(deprected)"></a>renderToStaticNodeStream(deprected)</h4><blockquote>
<p>React 19 开始废弃</p>
</blockquote>
<p>将 Node.js 只读流渲染为非交互式 React 树, 无法 hydrate 交互功能</p>
<p>输出 HTML 字符串的 Node.js 只读流, 此方法会缓冲所有输出, 因此实际上它并没有提供任何流式传输的好处</p>
<p>此方法输出的 HTML 不能被客户端 hydrate 转换成具有交互功能</p>
<ul>
<li>options<ul>
<li>identifierPrefix 字符串前缀, 由 <a href="#useId">useId</a> 生成的 id 使用</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stream = <span class="title function_">renderToStaticNodeStream</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<h4 id="renderToPipeableStream"><a href="#renderToPipeableStream" class="headerlink" title="renderToPipeableStream  "></a>renderToPipeableStream <em id="renderToPipeableStream"></em> <!--markdownlint-disable-line--></h4><p>将一个 React 组件树渲染为管道化(pipeable)的 Node.js 流</p>
<p>在客户端使用 <a href="#hydrateRoot">hydrateRoot</a> 使服务器生成的 HTML 具有交互功能</p>
<ul>
<li><p>options</p>
<ul>
<li>bootstrapScriptContent 指定被放入 script 标签中作为其内容的字符串</li>
<li>bootstrapScripts 一个字符串数组, 将被转化为 script 标签嵌入页面</li>
<li>bootstrapModules 和 bootstrapScripts 类似, 但是嵌入页面的是 <code>&lt;script type=&quot;module&quot;&gt;</code></li>
<li>identifierPrefix 字符串前缀, 由 <a href="#useId">useId</a> 生成的 id 使用</li>
<li>namespaceURI 一个字符串, 指定与流相关联的 命名控件 URI, 默认是常规的 HTML, 可以指定 SVG</li>
<li>nonce 标识使用严格 CSP(安全内容策略) 时允许资源的加密随机数</li>
<li>onAllReady 函数, 在所有渲染完成时触发, 包括 shell 和 所有额外的 content, 可以代替 onShellReady 用于爬虫和静态内容生成</li>
<li>onShellReady 函数, 在 shell 初始化渲染后立即调用</li>
<li>onShellError 函数, 在 shell 发生错误渲染时调用</li>
<li>onError 函数, 出现异常错误时触发</li>
<li>progressiveChunkSize 一个块中的字节数</li>
</ul>
</li>
<li><p>返回值: 包含 pipe() 和 abort() 方法的对象</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;pipe, abort&#125; = <span class="title function_">renderToPipeableStream</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;renderToPipeableStream&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/server&#x27;</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;pipe, abort&#125; = <span class="title function_">renderTopipeableStream</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, &#123;</span><br><span class="line">    <span class="attr">bootstrapScriptContent</span>: <span class="string">`window.assetMap = function()&#123; alert(&#x27;assetMap&#x27;) &#125;`</span>,</span><br><span class="line">    <span class="attr">bootstrapScripts</span>: [<span class="string">&#x27;./main.js&#x27;</span>],</span><br><span class="line">    <span class="title function_">onShellReady</span>(<span class="params"></span>)&#123;</span><br><span class="line">      response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line">      <span class="title function_">pipe</span>(response);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Web-流服务器-API"><a href="#Web-流服务器-API" class="headerlink" title="Web 流服务器 API"></a>Web 流服务器 API</h3><p>具有 web 流的环境中可用, 包括 浏览器, Deno, 以及一些现代 Edge 运行时</p>
<ul>
<li>ReadableStream</li>
<li>WritableStream</li>
<li>TransformStream</li>
</ul>
<h4 id="renderToReadableStream"><a href="#renderToReadableStream" class="headerlink" title="renderToReadableStream"></a>renderToReadableStream</h4><p>将 React 树渲染后发送至 web 流</p>
<p>参数配置参考 <a href="#renderToPipeableStream">renderToPipeableStream</a> 的 options</p>
<p>在客户端使用 <a href="#hydrateRoot">hydrateRoot</a> 使服务器生成的 HTML 具有交互功能</p>
<ul>
<li>返回一个 Promise<ul>
<li>如果 shell 渲染成功, 则 Promise 将 resolve 为 web 可读流</li>
<li>如果 shell 渲染失败, 则 Promise 将 reject</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stream = <span class="title function_">renderToReadableStream</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;renderToReadableStream&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/server&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">request</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="title function_">renderToReadableStream</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>,&#123;</span><br><span class="line">    <span class="attr">bootstrapScripts</span>: [<span class="string">&#x27;./main.js&#x27;</span>],</span><br><span class="line">    <span class="attr">identifierPrefix</span>: <span class="string">&#x27;w&#x27;</span>,</span><br><span class="line">    <span class="title function_">onError</span>(<span class="params">error</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">      <span class="title function_">logServerCrashReport</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(stream, &#123;</span><br><span class="line">    <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span>&#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="非流环境-API"><a href="#非流环境-API" class="headerlink" title="非流环境 API"></a>非流环境 API</h3><h4 id="renderToString"><a href="#renderToString" class="headerlink" title="renderToString"></a>renderToString</h4><p>将 React 树渲染为一个 HTML 字符串, 不支持流式传输或等待数据</p>
<p>在客户端使用 <a href="#hydrateRoot">hydrateRoot</a> 使服务器生成的 HTML 具有交互功能</p>
<ul>
<li><p>不完全支持 Suspense, 如果某个组件触发 Suspense, API 不会等待其内容解析完成, 将找到最近的 Suspense 边界并在 HTML 中渲染其 fallback 属性</p>
</li>
<li><p>options</p>
<ul>
<li>identifierPrefix 字符串前缀, 由 <a href="#useId">useId</a> 生成的 id 使用</li>
</ul>
</li>
<li><p>返回一个 HTML 字符串</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> html = <span class="title function_">renderToString</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;renderToString&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/server&#x27;</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> html = <span class="title function_">renderToString</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>);</span><br><span class="line">  response.<span class="title function_">send</span>(html);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="renderToStaticMarkup"><a href="#renderToStaticMarkup" class="headerlink" title="renderToStaticMarkup"></a>renderToStaticMarkup</h4><p>将非交互的 React 组件渲染成 HTML 字符串, 无法 hydrate 交互功能</p>
<ul>
<li><p>renderToStaticMarkup 的输出无法进行二次渲染, 仅需要呈现纯静态内容时使用</p>
</li>
<li><p>renderToStaticMarkup 对 Suspense 的支持有限, 如果一个组件触发了 Suspense, API 立即将后备方案作为 HTML 输出</p>
</li>
<li><p>renderToStaticMarkup 在浏览器中可以使用, 不建议在客户端代码中使用它</p>
</li>
<li><p>options</p>
<ul>
<li>identifierPrefix 字符串前缀, 由 <a href="#useId">useId</a> 生成的 id 使用</li>
</ul>
</li>
<li><p>返回一个 HTML 字符串</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> html = <span class="title function_">renderToStaticMarkup</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;renderToStaticMarkup&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/server&#x27;</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> html = <span class="title function_">renderToStaticMarkup</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>);</span><br><span class="line">  response.<span class="title function_">send</span>(html);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="ReactDOM-Static-API"><a href="#ReactDOM-Static-API" class="headerlink" title="ReactDOM Static API"></a>ReactDOM Static API</h2><p>允许为 React 组件生成静态 HTML</p>
<h3 id="prerender"><a href="#prerender" class="headerlink" title="prerender"></a>prerender</h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>使用 可读的 Web 流将 React 树渲染为静态 HTML, 仅在支持 Web 流的环境中使用, 包括 浏览器、Deno 和一些现代的边缘运行时环境</p>
<ul>
<li>options <em id='prerender_options'></em> <!--markdownlint-disable-line--><ul>
<li>bootstrapScriptContent, 插入 script 标签内的资源</li>
<li>bootstrapScripts, 引入资源链接</li>
<li>bootstrapModules, 引入资源链接, 使用 模块 方式</li>
<li>identifierPrefix, useId Hooks 的前缀</li>
<li>namespaceURI, 根命名空间 URI</li>
<li>onError, 函数, 发生错误时调用</li>
<li>progressiveChunkSize, 块的大小</li>
<li>signal, 中断信号, 允许中断 SSR</li>
</ul>
</li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; prelude &#125; = <span class="keyword">await</span> <span class="title function_">prerender</span>(reactNode, options);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; prerender &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/static&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">request</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; prelude &#125; = <span class="keyword">await</span> <span class="title function_">prerender</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, &#123;</span><br><span class="line">    <span class="attr">bootstrapScripts</span>: [<span class="string">&#x27;/main.js&#x27;</span>]</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(prelude, &#123;</span><br><span class="line">    <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span>&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="prerenderToNodeStream"><a href="#prerenderToNodeStream" class="headerlink" title="prerenderToNodeStream"></a>prerenderToNodeStream</h3><blockquote>
<p>React 19 支持</p>
</blockquote>
<p>使用 Node.js 流将 React 树渲染为静态 HTML, 仅在支持 Node.js 流的环境中使用</p>
<ul>
<li>options, 参数同 <a href="#prerender_options">prerender options</a></li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; prelude &#125; = <span class="keyword">await</span> <span class="title function_">prerenderToNodeStream</span>(reactNode, options);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; prerenderToNodeStream &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/static&#x27;</span>;</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, <span class="title function_">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; prelude &#125; = <span class="keyword">await</span> <span class="title function_">prerenderToNodeStream</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, &#123;</span><br><span class="line">    <span class="attr">bootstrapScripts</span>: [<span class="string">&#x27;/main.js&#x27;</span>]</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line">  prelude.<span class="title function_">pipe</span>(res);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="React-Server-Component"><a href="#React-Server-Component" class="headerlink" title="React Server Component"></a>React Server Component</h2><p>服务器组件是一种新型的组件, 它在打包之前, 在独立于客户端应用程序或 SSR 服务器的环境中提前渲染. 服务器组件可以在构建时运行一次, 也可以在每次请求时在 web 服务器中运行.</p>
<p>异步组件是服务器组件的一个新特性, 允许在渲染中 await.</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h3><ul>
<li>‘use client’ 只能使用 单引号 或 双引号</li>
</ul>
<p>定义了在 <code>模块依赖树</code> 上的服务器和客户端代码的边界，而不是在 <code>渲染树</code> 上.</p>
<ul>
<li>‘use server’ 只能使用 单引号 或 双引号</li>
</ul>
<p>标记可以从客户端代码调用的服务器函数, 由于网络调用始终是异步的, ‘use server’ 只能用于异步函数</p>
<h2 id="react-transition-group"><a href="#react-transition-group" class="headerlink" title="react-transition-group"></a><a target="_blank" rel="noopener" href="https://reactcommunity.org/react-transition-group/">react-transition-group</a></h2><h3 id="Transition"><a href="#Transition" class="headerlink" title="Transition"></a>Transition</h3><p>包含 4 个状态</p>
<ul>
<li>entering</li>
<li>entered</li>
<li>exiting</li>
<li>exited</li>
</ul>
<p>props</p>
<ul>
<li>nodeRef 执行动画的关联 DOM 节点, 早期的版本使用 findDOMNode(deprected) 查找 DOM 节点, 报错的替换方案</li>
<li>in 切换 enter 和 exit 的状态</li>
<li>appear 控制组件首次挂载时的默认行为</li>
<li>enter 控制进入的动画</li>
<li>exit 控制退出的动画</li>
<li>timeout 动画的时长</li>
<li>addEvenetListener 添加自定义的事件</li>
<li>onEnter</li>
<li>onEntering</li>
<li>onEntered</li>
<li>onExit</li>
<li>onExiting</li>
<li>onExited</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState, useRef&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Transition</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-transition-group&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [isProp, setInProp] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> nodeRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Transition</span> <span class="attr">nodeRef</span>=<span class="string">&#123;nodeRef&#125;</span> <span class="attr">in</span>=<span class="string">&#123;inProp&#125;</span> <span class="attr">timeout</span>=<span class="string">&#123;500&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>react-transition-group Transition component<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Transition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setInProp(true)&#125;&gt;Click to Enter<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CSSTransition"><a href="#CSSTransition" class="headerlink" title="CSSTransition"></a>CSSTransition</h3><p>继承 Transition 的所有 props, 使用 CSS 设置动画</p>
<ul>
<li>classNames 当组件在 appear, enter, exit 时应用于组件的动画名称前缀</li>
</ul>
<p>classNames=”my-node” 将会应用以下几种样式</p>
<ul>
<li>my-node-appear, my-node-appear-active, my-node-appear-done</li>
<li>my-node-enter, my-node-enter-active, my-node-enter-done</li>
<li>my-node-exit, my-node-exit-active, my-node-exit-done</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState, useRef&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">CSSTransition</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-transition-group&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [inProp, setInProp] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> nodeRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">CSSTransition</span> <span class="attr">nodeRef</span>=<span class="string">&#123;nodeRef&#125;</span> <span class="attr">in</span>=<span class="string">&#123;inProp&#125;</span> <span class="attr">timeout</span>=<span class="string">&#123;500&#125;</span> <span class="attr">classNames</span>=<span class="string">&quot;my-node&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;nodeRef&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          react-transition-group CSSTransition component</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">CSSTransition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setInProp(true)&#125;&gt;Click to Enter<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">  .<span class="property">my</span>-node-enter,</span><br><span class="line">  .<span class="property">my</span>-node-appear &#123;</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="property">my</span>-node-enter-active,</span><br><span class="line">  .<span class="property">my</span>-node-appear-active &#123;</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attr">transition</span>: opacity 500ms;</span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="property">my</span>-node-exit &#123;</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="property">my</span>-node-exit-active &#123;</span><br><span class="line">    <span class="attr">opacity</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attr">transition</span>: opacity 500ms;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h3 id="SwitchTransition"><a href="#SwitchTransition" class="headerlink" title="SwitchTransition"></a>SwitchTransition</h3><p>切换两个组件的动画, 需要使用 key 作为 Transition 或 CSSTransition 的 props</p>
<ul>
<li>mode 动画的模式 in-out|out-in, 默认 out-in</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState, useRef&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">SwitchTransition</span>, <span class="title class_">CSSTransition</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-transition-group&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">const</span> helloRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> goodByeRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> nodeRef = state ? goodByeRef : helloRef;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">SwitchTransition</span> <span class="attr">mode</span>=<span class="string">&quot;out-in&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">CSSTransition</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">key</span>=<span class="string">&#123;state</span> ? &#x27;<span class="attr">goodeBye</span>, <span class="attr">world</span>&#x27; <span class="attr">:</span> &#x27;<span class="attr">hello</span> <span class="attr">world</span>&#x27;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">nodeRef</span>=<span class="string">&#123;nodeRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">classNames</span>=<span class="string">&quot;fade&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      &gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">ref</span>=<span class="string">&#123;nodeRef&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setState(state =&gt; !state)&#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          &#123;state ? &#x27;goodBye, world&#x27; : &#x27;hello world&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">CSSTransition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">SwitchTransition</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TransitionGroup"><a href="#TransitionGroup" class="headerlink" title="TransitionGroup"></a>TransitionGroup</h3><p>管理多个动画列表</p>
<ul>
<li>component 指定渲染的元素, 默认 div</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">TransitionGroup</span>, <span class="title class_">CSSTransition</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;raect-transition-group&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> [books, setBooks] = <span class="title function_">useState</span>([]);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">TransitionGroup</span> <span class="attr">component</span>=<span class="string">&quot;ul&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;books.map(&#123;id, name, author, date&#125; =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        return (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">CSSTransition</span> <span class="attr">key</span>=<span class="string">&#123;id&#125;</span> <span class="attr">timeout</span>=<span class="string">&#123;500&#125;</span> <span class="attr">classNames</span>=<span class="string">&quot;book&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;name&#125;-&#123;author&#125;-&#123;date&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">CSSTransition</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        )</span></span><br><span class="line"><span class="language-xml">      &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">TransitionGroup</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="CSSInJs"><a href="#CSSInJs" class="headerlink" title="CSSInJs"></a>CSSInJs</h2><h3 id="标签函数"><a href="#标签函数" class="headerlink" title="标签函数"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Template_literals#%E5%B8%A6%E6%A0%87%E7%AD%BE%E7%9A%84%E6%A8%A1%E6%9D%BF">标签函数</a></h3><p>模板字符串的高级用法</p>
<p>标签函数第一个参数包含一个字符串数组, 其余的参数与表达式相关</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = <span class="string">&quot;Mike&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">28</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">myTag</span>(<span class="params">strings, personExp, ageExp</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> str0 = strings[<span class="number">0</span>]; <span class="comment">// &quot;That &quot;</span></span><br><span class="line">  <span class="keyword">const</span> str1 = strings[<span class="number">1</span>]; <span class="comment">// &quot; is a &quot;</span></span><br><span class="line">  <span class="keyword">const</span> str2 = strings[<span class="number">2</span>]; <span class="comment">// &quot;.&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> ageStr = ageExp &gt; <span class="number">99</span> ? <span class="string">&quot;centenarian&quot;</span> : <span class="string">&quot;youngster&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 我们甚至可以返回使用模板字面量构建的字符串</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;str0&#125;</span><span class="subst">$&#123;personExp&#125;</span><span class="subst">$&#123;str1&#125;</span><span class="subst">$&#123;ageStr&#125;</span><span class="subst">$&#123;str2&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> output = myTag<span class="string">`That <span class="subst">$&#123;person&#125;</span> is a <span class="subst">$&#123;age&#125;</span>.`</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(output);</span><br><span class="line"><span class="comment">// That Mike is a youngster.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下都是等价的写法</span></span><br><span class="line">fn<span class="string">`some string here`</span>;</span><br><span class="line"><span class="title function_">fn</span>([<span class="string">&#x27;some string here&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> aVar = <span class="string">&#x27;good&#x27;</span>;</span><br><span class="line">fn<span class="string">`this is a <span class="subst">$&#123;aVar&#125;</span> day`</span>;</span><br><span class="line"><span class="title function_">fn</span>([<span class="string">&#x27;this is a &#x27;</span>, <span class="string">&#x27;day&#x27;</span>], aVar);</span><br></pre></td></tr></table></figure>

<h3 id="styled-components"><a href="#styled-components" class="headerlink" title="styled-components"></a><a target="_blank" rel="noopener" href="https://styled-components.com/docs/basics">styled-components</a></h3><p>影响打包性能, 导致 js 文件体积变大</p>
<p>动态生成唯一的 className, 对样式覆写不太友好</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">&#x27;styled-components&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>基本使用, 使用标签函数创建样式化的组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Title</span> = styled.<span class="property">h1</span><span class="string">`</span></span><br><span class="line"><span class="string">  font-size: 1.5em;</span></span><br><span class="line"><span class="string">  text-align: center;</span></span><br><span class="line"><span class="string">  color: #bf4f74;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Wrapper</span> = styled.<span class="property">section</span><span class="string">`</span></span><br><span class="line"><span class="string">  padding: 4em;</span></span><br><span class="line"><span class="string">  background: yellowlight;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Wrapper</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Title</span>&gt;</span>title<span class="tag">&lt;/<span class="name">Title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Wrapper</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渲染结果</span></span><br><span class="line">&lt;section&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&lt;/section&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>样式扩展</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 Button 组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Button</span> = styled.<span class="property">button</span><span class="string">`</span></span><br><span class="line"><span class="string">  color: #bf4f74;</span></span><br><span class="line"><span class="string">  font-size: 1em;</span></span><br><span class="line"><span class="string">  margin: 1em;</span></span><br><span class="line"><span class="string">  padding: 0.25em 1em;</span></span><br><span class="line"><span class="string">  border: 2px solid #bf4f74;</span></span><br><span class="line"><span class="string">  border-radius: 3px;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="comment">// 基于 Button 组件扩展并覆盖样式</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TomatoButton</span> = <span class="title function_">styled</span>(<span class="title class_">Button</span>)<span class="string">`</span></span><br><span class="line"><span class="string">  color: tomato;</span></span><br><span class="line"><span class="string">  border-color: tomato;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span>&gt;</span>Normal Button<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">TomatoButton</span>&gt;</span>Tomato Button<span class="tag">&lt;/<span class="name">TomatoButton</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渲染结果</span></span><br><span class="line">&lt;button&gt;<span class="title class_">Normal</span> <span class="title class_">Button</span>&lt;/button&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span>Tomato Button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>样式化任何组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// react-router-dom&#x27;s Link Component</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Link</span> = (<span class="params">&#123;className, children&#125;</span>) =&gt; (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">StyledLink</span> = <span class="title function_">styled</span>(<span class="title class_">Link</span>)<span class="string">`</span></span><br><span class="line"><span class="string">  color: #bf4f74;</span></span><br><span class="line"><span class="string">  font-weight: bold;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Link</span>&gt;</span>UnStyled Link<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">StyledLink</span>&gt;</span>Styled Link<span class="tag">&lt;/<span class="name">StyledLink</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>支持伪类, 伪元素, 嵌套样式</li>
</ul>
<h4 id="as-更改渲染结果"><a href="#as-更改渲染结果" class="headerlink" title="as 更改渲染结果"></a>as 更改渲染结果</h4><p>as props 更改样式化组件呈现的标签或组件</p>
<ul>
<li>as 接收标签</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span>&gt;</span>Normal Button<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">as</span>=<span class="string">&quot;a&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Link with Button styles<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">TomatoButton</span> <span class="attr">as</span>=<span class="string">&quot;a&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Link with Tomato Button styles<span class="tag">&lt;/<span class="name">TomatoButton</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渲染结果</span></span><br><span class="line">&lt;button&gt;<span class="title class_">Normal</span> <span class="title class_">Button</span>&lt;/button&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Link with Button styles<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>Link with Tomato Button styles<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>as 接收组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收 props 并将 props.children 反转</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ReverseButton</span> = props =&gt; <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> &#123; <span class="attr">...props</span> &#125; <span class="attr">children</span>=<span class="string">&#123;</span> <span class="attr">props.children.split</span>(&#x27;&#x27;)<span class="attr">.reverse</span>() &#125; /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span>&gt;</span>Normal Button<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Button</span> <span class="attr">as</span>=<span class="string">&#123;</span> <span class="attr">ReverseButton</span> &#125;&gt;</span>Custom Button with Normal Button styles<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渲染结果</span></span><br><span class="line">&lt;button&gt;<span class="title class_">Normal</span> <span class="title class_">Button</span>&lt;/button&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span>selyts nottuB lamroN htiw nottuB motsuC<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="获取-props"><a href="#获取-props" class="headerlink" title="获取 props"></a>获取 props</h4><p>添加 <code>$</code> 前缀将 props 转换为短暂的 props, 防止样式化组件使用的 props 被传入到底层的 React 组件或者 DOM 元素上</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Button</span> = styled.<span class="property">button</span>&lt;&#123; $primary?: <span class="built_in">boolean</span> &#125;&gt;<span class="string">`</span></span><br><span class="line"><span class="string">  background: <span class="subst">$&#123;props =&gt; props.$primary ? <span class="string">&#x27;#bf4f74&#x27;</span> : <span class="string">&#x27;white&#x27;</span>&#125;</span>;</span></span><br><span class="line"><span class="string">  color: <span class="subst">$&#123;props =&gt; props.$primary ? <span class="string">&#x27;white&#x27;</span> : <span class="string">&#x27;#bf4f74&#x27;</span>&#125;</span>;</span></span><br><span class="line"><span class="string">  font-size: 1em;</span></span><br><span class="line"><span class="string">  margin: 1em;</span></span><br><span class="line"><span class="string">  padding: 0.25em 1em;</span></span><br><span class="line"><span class="string">  border: 2px solid #bf4f74;</span></span><br><span class="line"><span class="string">  border-radius: 3px;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span>&gt;</span>Normal Button<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> $<span class="attr">primary</span>&gt;</span>Primary Button<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渲染结果</span></span><br><span class="line">&lt;button&gt;<span class="title class_">Normal</span>&lt;/button&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span>&gt;</span>Primary<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span> <span class="comment">// 和 Normal button 样式相反</span></span><br></pre></td></tr></table></figure>

<h4 id="attrs-属性重写"><a href="#attrs-属性重写" class="headerlink" title="attrs 属性重写"></a>attrs 属性重写</h4><p>attrs 修改样式化组件的属性, 如果想防止样式化组件使用的 props 被传入到底层 React 组件或者 DOM 元素上, 使用 <code>$</code> 前缀修饰 props 将其转换为短暂的 props</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">styled.<span class="property">tagName</span>.<span class="title function_">attrs</span>(&#123;&#125; | <span class="title class_">Function</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Input</span> = styled.<span class="property">input</span>.<span class="property">attrs</span>&lt;&#123; $size?: <span class="built_in">string</span> &#125;&gt;(<span class="function"><span class="params">props</span> =&gt;</span> (&#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="attr">$size</span>: props.<span class="property">$size</span> || <span class="string">&#x27;1em&#x27;</span></span><br><span class="line">&#125;))<span class="string">`</span></span><br><span class="line"><span class="string">  border: 2px solid #BF4F74;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  /* use the dynamically computed prop */</span></span><br><span class="line"><span class="string">  margin: <span class="subst">$&#123;props =&gt; props.$size&#125;</span>;</span></span><br><span class="line"><span class="string">  padding: <span class="subst">$&#123;props =&gt; props.$size&#125;</span>;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">PassWordInput</span> = <span class="title function_">styled</span>(<span class="title class_">Input</span>).<span class="title function_">attrs</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;password&#x27;</span>&#125;)<span class="string">`</span></span><br><span class="line"><span class="string">  border: 2px solid aqua;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Input</span> <span class="attr">placeholder</span>=<span class="string">&quot;A bigger text input&quot;</span> $<span class="attr">size</span>=<span class="string">&quot;2em&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PassWordInput</span> <span class="attr">placeholder</span>=<span class="string">&quot;A normal password input&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渲染结果</span></span><br><span class="line">&lt;input <span class="keyword">type</span>=<span class="string">&quot;text&quot;</span> placeholder=<span class="string">&quot;A bigger text input&quot;</span>/&gt; <span class="comment">// margin 和 padding 都为传入的 2em</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;A normal password input&quot;</span>/&gt;</span></span> <span class="comment">// margin 和 padding 都为默认的 1em</span></span><br></pre></td></tr></table></figure>

<h4 id="其他组件和API"><a href="#其他组件和API" class="headerlink" title="其他组件和API"></a>其他组件和API</h4><ul>
<li>StyleSheetManager 管理样式化组件的辅助组件</li>
<li>ThemeProvider<ul>
<li>theme</li>
</ul>
</li>
<li>ThemeConsumer</li>
<li>withTheme 高阶组件, 传递的组件将接收到一个包含 theme prop 的 theme 对象</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;withTheme&#125; <span class="keyword">from</span> <span class="string">&#x27;styled-components&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params">props</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span> <span class="attr">props.theme.color</span>&#125;&#125;&gt;</span>Button<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">withTheme</span>(<span class="title class_">App</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>useTheme 获取 ThemeProvider 传递的 theme 的 Hook</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">ThemeProvider</span>, <span class="title class_">ThemeConsumer</span>, useTheme&#125; <span class="keyword">from</span> <span class="string">&#x27;styled-components&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeProvider</span> <span class="attr">theme</span>=<span class="string">&#123;&#123;color:</span> &#x27;<span class="attr">mediumseagreen</span>&#x27;&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeProvider</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> theme = <span class="title function_">useTheme</span>();</span><br><span class="line">  <span class="keyword">const</span> style = &#123;<span class="attr">color</span>: theme.<span class="property">color</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      Button</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeConsumer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;theme =&gt; <span class="tag">&lt;<span class="name">button</span> <span class="attr">style</span>=<span class="string">&#123;&#123;color:</span> <span class="attr">theme.coloer</span>&#125;&#125;&gt;</span>Button<span class="tag">&lt;/<span class="name">button</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeConsumer</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>isStyledComponent 判断是否是样式化组件</li>
<li>createGlobalStyle 创建全局样式</li>
<li>css 创建样式片段</li>
<li>keyframes 创建动画的辅助函数</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;keyframes&#125; <span class="keyword">from</span> <span class="string">&#x27;styled-components&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> fadeIn = keyframes<span class="string">`</span></span><br><span class="line"><span class="string">  0% &#123;</span></span><br><span class="line"><span class="string">    opacity:0</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  100% &#123;</span></span><br><span class="line"><span class="string">    opacity: 1;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">FadeInButton</span> = styled.<span class="property">button</span><span class="string">`</span></span><br><span class="line"><span class="string">  animation: 1s <span class="subst">$&#123;fadeIn&#125;</span> ease-out;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<h2 id="tailwindCSS"><a href="#tailwindCSS" class="headerlink" title="tailwindCSS"></a>tailwindCSS</h2><p>tailwindcss</p>
<p>@tailwindcss/postcss</p>
<p>postcss</p>
<p>v3 版本支持 <code>tailwind.config.js</code> 配置文件</p>
<p>应用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- bg-[#1da1f2] 使用任意值 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;3xl:text-lg text-gray-900 bg-white font-display rounded-sm bg-[#1da1f2]&quot;</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用任意值(arbitrary values) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bg-[#316ff6] lg:top-[117px]&quot;</span>&gt;</span>使用任意值<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grid grid-cols-[24rem_2.5rem_minmax(0, 1fr)]&quot;</span>&gt;</span>使用任意值<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;max-h-[calc(100vh - (--spacing(6)))]&quot;</span>&gt;</span>使用任意值<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- css 属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;[mask-type:luminance] hover:[mask-type:alpha]&quot;</span>&gt;</span>css 属性<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 样式优先级: 编译后样式末尾添加 !important --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;bg-red-500!&quot;</span>&gt;</span>样式优先级<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h3><ul>
<li><p>@tailwind 插入样式到 base, components, utilities, variants, v4 不再支持该指令</p>
<ul>
<li>base 用于重置规则或应用于html元素的默认样式</li>
<li>components 基于类的样式, 能够使用实用程序覆盖这些样式</li>
<li>utilities 实用程序用于小型、单一用途的类, 这些类应始终优先于任何其他样式</li>
</ul>
</li>
<li><p>@import CSS 指令, 导入 tailwindcss</p>
</li>
<li><p>@theme 添加自定义主题变量或重置默认主题</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导入 tailwindcss */</span></span><br><span class="line"><span class="comment">/* 使用前缀, 如果存在类名冲突的情况时给 tailwind 生成的 class 和 css 变量添加前缀 */</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;tailwindcss&#x27;</span> prefix(tw);</span><br><span class="line"><span class="comment">/* 给 tailwindcss 所有样式末尾添加 !important */</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;tailwindcss&#x27;</span> important;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 自定义主题变量 */</span></span><br><span class="line"><span class="comment">/* 命名空间颜色变量前缀: --color-*  */</span></span><br><span class="line"><span class="comment">/* 命令空间字体变量前缀: --font-*  */</span></span><br><span class="line"><span class="comment">/* 命令空间间距变量前缀: --spacing-*  */</span></span><br><span class="line"><span class="comment">/* 命令空间圆角变量前缀: --radius-*  */</span></span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line"><span class="keyword">@theme</span> &#123;</span><br><span class="line">  <span class="attr">--color-dblue-300</span>: <span class="number">#0088ff</span>;</span><br><span class="line">  <span class="attr">--spacing-50</span>: <span class="string">&#x27;50rem&#x27;</span>;</span><br><span class="line">  <span class="attr">--tab-size-github</span>: <span class="number">8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>@source 排除不被 tailwind 自动识别的资源</p>
</li>
<li><p>@apply 将已有的实用程序应用到自定义样式中</p>
</li>
<li><p>@layer 指定自定义样式应该放在哪个层中</p>
</li>
<li><p>@utility 添加实用程序</p>
<ul>
<li>--value(–theme-key-*) 解析一组主题 keys 的应用程序的值</li>
</ul>
</li>
<li><p>@variant 在样式中应用 tailwind 的变体</p>
</li>
<li><p>@custom-variant 添加自定义的变体</p>
</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@import</span> <span class="string">&#x27;tailwindcss&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加默认样式 */</span></span><br><span class="line"><span class="keyword">@layer</span> base &#123;</span><br><span class="line">  <span class="selector-tag">h1</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="built_in">var</span>(--text-<span class="number">2</span>xl);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加基于类的样式 */</span></span><br><span class="line"><span class="keyword">@layer</span> components &#123;</span><br><span class="line"> <span class="selector-class">.card</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">var</span>(--color-white);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="built_in">var</span>(--rounded-lg);</span><br><span class="line">    <span class="attribute">padding</span>: <span class="built_in">var</span>(--spacing-<span class="number">6</span>);</span><br><span class="line">    <span class="attribute">box-shadow</span>: <span class="built_in">var</span>(--shadow-xl);</span><br><span class="line">    <span class="keyword">@apply</span> rounded-<span class="number">2</span>xl;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义实用程序 */</span></span><br><span class="line"><span class="keyword">@utility</span> content-auto &#123;</span><br><span class="line">  <span class="attribute">content-visibility</span>: auto;</span><br><span class="line">  &amp;::-webkit-scrollbar &#123;</span><br><span class="line">    <span class="attribute">display</span>: none;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@utility</span> tab-* &#123;</span><br><span class="line">  <span class="attribute">tab-size</span>: <span class="built_in">--value</span>(integer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加应用程序到自定义样式中 */</span></span><br><span class="line"><span class="selector-class">.select2-dropdown</span> &#123;</span><br><span class="line">  <span class="keyword">@apply</span> rounded-b-lg shadow-md;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加变体 */</span></span><br><span class="line"><span class="selector-class">.my-element</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: white;</span><br><span class="line">  <span class="keyword">@variant</span> dark &#123;</span><br><span class="line">    <span class="attribute">background</span>: black;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- use @layer components difine classes --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span>use @layer components difine classes<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- use utility --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content-auto hover:content-auto&quot;</span>&gt;</span>Hello World!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- use `--value(--theme-key-*)` function resolve utility value --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- --value(type) validate the bare value --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tab-2 tab-4&quot;</span>&gt;</span>Function utility<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>@reference 直接在 css 模块, style 标签内, 其他组件内使用 @apply, @variant, 自定义的主题中定义的样式避免重复的 css 输出</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* 使用自定义主题 */</span></span></span><br><span class="line"><span class="language-css">  <span class="keyword">@reference</span> <span class="string">&#x27;../../app.css&#x27;</span>;</span></span><br><span class="line"><span class="language-css">  <span class="comment">/* 使用默认主题 */</span></span></span><br><span class="line"><span class="language-css">  <span class="keyword">@reference</span> <span class="string">&#x27;tailwindcss&#x27;</span>; </span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">h1</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="keyword">@apply</span> text-<span class="number">2</span>xl font-bold text-red-<span class="number">500</span>;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>@config 加载旧版本的 js 配置文件, v4 兼容旧版本</li>
<li>@plugin 加载旧版本的 js 配置文件中的插件, v4 兼容旧版本</li>
</ul>
<h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><ul>
<li>--alpha() 调整颜色的透明度</li>
<li>--spacing() 生成主题的间距值</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.my-element</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">--alpha</span>(<span class="built_in">var</span>(--color-lime-<span class="number">300</span>) / <span class="number">50%</span>);</span><br><span class="line">  <span class="attribute">margin</span>: <span class="built_in">--spacing</span>(<span class="number">4</span>);</span><br><span class="line">  <span class="attribute">margin</span>: <span class="built_in">calc</span>(<span class="built_in">var</span>(--spacing) * <span class="number">4</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>theme() 在编译时允许使用 tailwind 配置的值, 函数在构建时执行， v4 兼容旧版本</li>
<li>screen() 使用 tailwind 配置的值创建媒体查询</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.my-element</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="built_in">theme</span>(spacing.<span class="number">12</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="classnames"><a href="#classnames" class="headerlink" title="classnames"></a>classnames</h2><h2 id="react-icons"><a href="#react-icons" class="headerlink" title="react-icons"></a>react-icons</h2>
    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\02\f3581d54a2fe\" rel="bookmark">React-Nextjs.md</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\02\5ad505cb0ced\" rel="bookmark">React-Redux.md</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\02\0eb429a8209b\" rel="bookmark">React-Router.md</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\03\0734d1c7c12c\" rel="bookmark">JS</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\02\18f2de6d45f9\" rel="bookmark">JSUtils</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>luoleiself
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://luoleiself.github.io/2022/02/7ec5bd96e943/" title="React.md">https://luoleiself.github.io/2022/02/7ec5bd96e943/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/js/" rel="tag"># js</a>
              <a href="/tags/jsx/" rel="tag"># jsx</a>
              <a href="/tags/React/" rel="tag"># React</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/12/869c5fdf0d37/" rel="prev" title="微信小程序">
      <i class="fa fa-chevron-left"></i> 微信小程序
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/02/0eb429a8209b/" rel="next" title="React-Router.md">
      React-Router.md <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#React"><span class="nav-number">1.</span> <span class="nav-text">React</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3"><span class="nav-number">2.</span> <span class="nav-text">设计思想</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Actions"><span class="nav-number">2.1.</span> <span class="nav-text">Actions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA-state-%E5%8E%9F%E5%88%99"><span class="nav-number">2.2.</span> <span class="nav-text">构建 state 原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E5%80%BC"><span class="nav-number">2.3.</span> <span class="nav-text">响应式值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9-state-%E8%BF%9B%E8%A1%8C%E4%BF%9D%E7%95%99%E5%92%8C%E9%87%8D%E7%BD%AE"><span class="nav-number">2.4.</span> <span class="nav-text">对 state 进行保留和重置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-Component-deprected"><span class="nav-number">3.</span> <span class="nav-text">React.Component(deprected)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">3.1.</span> <span class="nav-text">组件的生命周期</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%81%E7%A7%BB%E5%88%B0%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E4%BB%B6"><span class="nav-number">3.2.</span> <span class="nav-text">迁移到函数式组件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%B1%E5%85%A5-JSX"><span class="nav-number">4.</span> <span class="nav-text">深入 JSX</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-TypeScript"><span class="nav-number">4.1.</span> <span class="nav-text">使用 TypeScript</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSX-%E4%B8%AD%E7%9A%84-Props"><span class="nav-number">4.2.</span> <span class="nav-text">JSX 中的 Props</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSX-%E4%B8%AD%E7%9A%84-children"><span class="nav-number">4.3.</span> <span class="nav-text">JSX 中的 children</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-Hook"><span class="nav-number">5.</span> <span class="nav-text">React Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hook-%E8%A7%84%E5%88%99"><span class="nav-number">5.1.</span> <span class="nav-text">Hook 规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-%E5%86%85%E7%BD%AE-Hook"><span class="nav-number">5.2.</span> <span class="nav-text">React 内置 Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#useId"><span class="nav-number">5.2.1.</span> <span class="nav-text">useId  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useState"><span class="nav-number">5.2.2.</span> <span class="nav-text">useState</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useReducer"><span class="nav-number">5.2.3.</span> <span class="nav-text">useReducer  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useContext"><span class="nav-number">5.2.4.</span> <span class="nav-text">useContext  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useEffect"><span class="nav-number">5.2.5.</span> <span class="nav-text">useEffect</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8-Effect-%E4%B8%AD%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE"><span class="nav-number">5.2.5.1.</span> <span class="nav-text">在 Effect 中请求数据</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useEffectEvent-experimental"><span class="nav-number">5.2.6.</span> <span class="nav-text">useEffectEvent(experimental)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useLayoutEffect"><span class="nav-number">5.2.7.</span> <span class="nav-text">useLayoutEffect</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useInsertionEffect"><span class="nav-number">5.2.8.</span> <span class="nav-text">useInsertionEffect</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useCallback"><span class="nav-number">5.2.9.</span> <span class="nav-text">useCallback</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useMemo"><span class="nav-number">5.2.10.</span> <span class="nav-text">useMemo</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useRef"><span class="nav-number">5.2.11.</span> <span class="nav-text">useRef  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useImperativeHandle"><span class="nav-number">5.2.12.</span> <span class="nav-text">useImperativeHandle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useDebugValue"><span class="nav-number">5.2.13.</span> <span class="nav-text">useDebugValue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useActionState-experimental"><span class="nav-number">5.2.14.</span> <span class="nav-text">useActionState(experimental)  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useOptimistic-experimental"><span class="nav-number">5.2.15.</span> <span class="nav-text">useOptimistic(experimental)  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useDeferredValue"><span class="nav-number">5.2.16.</span> <span class="nav-text">useDeferredValue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useTransition"><span class="nav-number">5.2.17.</span> <span class="nav-text">useTransition  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useSyncExternalStore"><span class="nav-number">5.2.18.</span> <span class="nav-text">useSyncExternalStore</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Hook"><span class="nav-number">5.3.</span> <span class="nav-text">自定义 Hook</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-%E7%BB%84%E4%BB%B6"><span class="nav-number">6.</span> <span class="nav-text">React 组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#React-%E5%86%85%E7%BD%AE%E7%BB%84%E4%BB%B6"><span class="nav-number">6.1.</span> <span class="nav-text">React 内置组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Fragment"><span class="nav-number">6.1.1.</span> <span class="nav-text">Fragment</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Profiler"><span class="nav-number">6.1.2.</span> <span class="nav-text">Profiler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#StrictMode"><span class="nav-number">6.1.3.</span> <span class="nav-text">StrictMode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Suspense"><span class="nav-number">6.1.4.</span> <span class="nav-text">Suspense</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-API"><span class="nav-number">7.</span> <span class="nav-text">React API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#act"><span class="nav-number">7.1.</span> <span class="nav-text">act</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cache-experimental"><span class="nav-number">7.2.</span> <span class="nav-text">cache(experimental)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#createContext"><span class="nav-number">7.3.</span> <span class="nav-text">createContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#forwardRef"><span class="nav-number">7.4.</span> <span class="nav-text">forwardRef  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lazy"><span class="nav-number">7.5.</span> <span class="nav-text">lazy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memo"><span class="nav-number">7.6.</span> <span class="nav-text">memo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#startTransition"><span class="nav-number">7.7.</span> <span class="nav-text">startTransition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use-experimental"><span class="nav-number">7.8.</span> <span class="nav-text">use(experimental)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#experimental-taintObjectReference-experimental"><span class="nav-number">7.9.</span> <span class="nav-text">experimental_taintObjectReference(experimental)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#taintUniqueValue-experimental"><span class="nav-number">7.10.</span> <span class="nav-text">taintUniqueValue(experimental)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReactDOM-Hook"><span class="nav-number">8.</span> <span class="nav-text">ReactDOM Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#useFormStatus-experimental"><span class="nav-number">8.1.</span> <span class="nav-text">useFormStatus(experimental)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReactDOM-%E7%BB%84%E4%BB%B6"><span class="nav-number">9.</span> <span class="nav-text">ReactDOM 组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-HTML-%E5%85%83%E7%B4%A0"><span class="nav-number">9.1.</span> <span class="nav-text">自定义 HTML 元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7%E5%B7%AE%E5%BC%82"><span class="nav-number">9.2.</span> <span class="nav-text">属性差异</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lt-form-gt"><span class="nav-number">9.3.</span> <span class="nav-text">&lt;form&gt;  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6"><span class="nav-number">9.4.</span> <span class="nav-text">合成事件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7"><span class="nav-number">9.4.1.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95"><span class="nav-number">9.4.2.</span> <span class="nav-text">方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%94%AF%E6%8C%81%E6%96%87%E6%A1%A3%E5%85%83%E6%95%B0%E6%8D%AE"><span class="nav-number">9.5.</span> <span class="nav-text">支持文档元数据</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReactDOM-API"><span class="nav-number">10.</span> <span class="nav-text">ReactDOM API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#createPortal"><span class="nav-number">10.1.</span> <span class="nav-text">createPortal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#flushSync"><span class="nav-number">10.2.</span> <span class="nav-text">flushSync</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#findDOMNode-deprected"><span class="nav-number">10.3.</span> <span class="nav-text">findDOMNode(deprected)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hydrate-deprected"><span class="nav-number">10.4.</span> <span class="nav-text">hydrate(deprected)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#render-deprected"><span class="nav-number">10.5.</span> <span class="nav-text">render(deprected)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unmountComponentAtNode-deprected"><span class="nav-number">10.6.</span> <span class="nav-text">unmountComponentAtNode(deprected)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preconnect-experimental"><span class="nav-number">10.7.</span> <span class="nav-text">preconnect(experimental)  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prefetchDNS-experimental"><span class="nav-number">10.8.</span> <span class="nav-text">prefetchDNS(experimental)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preinit-experimental"><span class="nav-number">10.9.</span> <span class="nav-text">preinit(experimental)  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preinitModule-experimental"><span class="nav-number">10.10.</span> <span class="nav-text">preinitModule(experimental)  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preload-experimental"><span class="nav-number">10.11.</span> <span class="nav-text">preload(experimental)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preloadModule-experimental"><span class="nav-number">10.12.</span> <span class="nav-text">preloadModule(experimental)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReactDOM-Client-API"><span class="nav-number">11.</span> <span class="nav-text">ReactDOM Client API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#createRoot"><span class="nav-number">11.1.</span> <span class="nav-text">createRoot  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hydrateRoot"><span class="nav-number">11.2.</span> <span class="nav-text">hydrateRoot  </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReactDOM-Server-API"><span class="nav-number">12.</span> <span class="nav-text">ReactDOM Server API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-js-%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8-API"><span class="nav-number">12.1.</span> <span class="nav-text">Node.js 流服务器 API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToNodeStream-deprected"><span class="nav-number">12.1.1.</span> <span class="nav-text">renderToNodeStream(deprected)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToStaticNodeStream-deprected"><span class="nav-number">12.1.2.</span> <span class="nav-text">renderToStaticNodeStream(deprected)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToPipeableStream"><span class="nav-number">12.1.3.</span> <span class="nav-text">renderToPipeableStream  </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8-API"><span class="nav-number">12.2.</span> <span class="nav-text">Web 流服务器 API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToReadableStream"><span class="nav-number">12.2.1.</span> <span class="nav-text">renderToReadableStream</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E6%B5%81%E7%8E%AF%E5%A2%83-API"><span class="nav-number">12.3.</span> <span class="nav-text">非流环境 API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToString"><span class="nav-number">12.3.1.</span> <span class="nav-text">renderToString</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToStaticMarkup"><span class="nav-number">12.3.2.</span> <span class="nav-text">renderToStaticMarkup</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReactDOM-Static-API"><span class="nav-number">13.</span> <span class="nav-text">ReactDOM Static API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#prerender"><span class="nav-number">13.1.</span> <span class="nav-text">prerender</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prerenderToNodeStream"><span class="nav-number">13.2.</span> <span class="nav-text">prerenderToNodeStream</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-Server-Component"><span class="nav-number">14.</span> <span class="nav-text">React Server Component</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Directives"><span class="nav-number">14.1.</span> <span class="nav-text">Directives</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#react-transition-group"><span class="nav-number">15.</span> <span class="nav-text">react-transition-group</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Transition"><span class="nav-number">15.1.</span> <span class="nav-text">Transition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSSTransition"><span class="nav-number">15.2.</span> <span class="nav-text">CSSTransition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SwitchTransition"><span class="nav-number">15.3.</span> <span class="nav-text">SwitchTransition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TransitionGroup"><span class="nav-number">15.4.</span> <span class="nav-text">TransitionGroup</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CSSInJs"><span class="nav-number">16.</span> <span class="nav-text">CSSInJs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%87%E7%AD%BE%E5%87%BD%E6%95%B0"><span class="nav-number">16.1.</span> <span class="nav-text">标签函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#styled-components"><span class="nav-number">16.2.</span> <span class="nav-text">styled-components</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#as-%E6%9B%B4%E6%94%B9%E6%B8%B2%E6%9F%93%E7%BB%93%E6%9E%9C"><span class="nav-number">16.2.1.</span> <span class="nav-text">as 更改渲染结果</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-props"><span class="nav-number">16.2.2.</span> <span class="nav-text">获取 props</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#attrs-%E5%B1%9E%E6%80%A7%E9%87%8D%E5%86%99"><span class="nav-number">16.2.3.</span> <span class="nav-text">attrs 属性重写</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E7%BB%84%E4%BB%B6%E5%92%8CAPI"><span class="nav-number">16.2.4.</span> <span class="nav-text">其他组件和API</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tailwindCSS"><span class="nav-number">17.</span> <span class="nav-text">tailwindCSS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%87%E4%BB%A4"><span class="nav-number">17.1.</span> <span class="nav-text">指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">17.1.1.</span> <span class="nav-text">函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#classnames"><span class="nav-number">18.</span> <span class="nav-text">classnames</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#react-icons"><span class="nav-number">19.</span> <span class="nav-text">react-icons</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="luoleiself"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">luoleiself</p>
  <div class="site-description" itemprop="description">努力的往前飞, 再累也无所谓, 黑夜过后的光芒有多美...</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">49</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/luoleiself" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoleiself" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:luoleiself@163.com" title="E-Mail → mailto:luoleiself@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://developer.mozilla.org/zh-CN/" title="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;zh-CN&#x2F;" rel="noopener" target="_blank">MDN</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">luoleiself</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">645k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:47</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><!-- canvas-nest -->
<!-- modify source/_data/footer.swig -->
<!-- modify _config.next.yml -> custom_file_path:footer -->
<!--
<script color="0,0,255" opacity="0.7" zIndex="-1" count="200" src="//cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script> 
-->
<style>
.highlight-container ::selection {
  color: #fc7237
};
</style>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/lozad.js/1.14.0/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
