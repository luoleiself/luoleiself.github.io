<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon-32x32.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"luoleiself.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="ReactReact 18.3.1 设计思想 只有当在组件树中 相同的 位置渲染 相同的 组件时, React 才会一直保留着组件的 state 在一般安全的情况下采用批处理方式处理 state 更新  变换设计 React 的核心前提是认为 UI 只是把数据通过映射关系变换成另一种形式的数据。同样的输入必会有同样的输出。这恰好就是纯函数。 抽象需要把 UI 抽象成多个隐藏内部细节，又可复用的函数">
<meta property="og:type" content="article">
<meta property="og:title" content="React.md">
<meta property="og:url" content="https://luoleiself.github.io/2022/02/7ec5bd96e943/index.html">
<meta property="og:site_name" content="luoleiself&#39;s blog">
<meta property="og:description" content="ReactReact 18.3.1 设计思想 只有当在组件树中 相同的 位置渲染 相同的 组件时, React 才会一直保留着组件的 state 在一般安全的情况下采用批处理方式处理 state 更新  变换设计 React 的核心前提是认为 UI 只是把数据通过映射关系变换成另一种形式的数据。同样的输入必会有同样的输出。这恰好就是纯函数。 抽象需要把 UI 抽象成多个隐藏内部细节，又可复用的函数">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-02-15T07:37:49.000Z">
<meta property="article:modified_time" content="2024-08-08T11:03:35.762Z">
<meta property="article:author" content="luoleiself">
<meta property="article:tag" content="js">
<meta property="article:tag" content="jsx">
<meta property="article:tag" content="React">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://luoleiself.github.io/2022/02/7ec5bd96e943/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>React.md | luoleiself's blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5fa63b434a4b3e74b6258584372c74c0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="luoleiself's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">luoleiself's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/luoleiself" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://luoleiself.github.io/2022/02/7ec5bd96e943/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="luoleiself">
      <meta itemprop="description" content="努力的往前飞, 再累也无所谓, 黑夜过后的光芒有多美...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="luoleiself's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          React.md
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-15 15:37:49" itemprop="dateCreated datePublished" datetime="2022-02-15T15:37:49+08:00">2022-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-08 19:03:35" itemprop="dateModified" datetime="2024-08-08T19:03:35+08:00">2024-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES/" itemprop="url" rel="index"><span itemprop="name">ES</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES/React/" itemprop="url" rel="index"><span itemprop="name">React</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>80k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>1:13</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="React"><a href="#React" class="headerlink" title="React"></a>React</h2><p>React 18.3.1</p>
<h2 id="设计思想"><a href="#设计思想" class="headerlink" title="设计思想"></a>设计思想</h2><ul>
<li>只有当在组件树中 相同的 位置渲染 相同的 组件时, React 才会一直保留着组件的 state</li>
<li>在一般安全的情况下采用批处理方式处理 state 更新</li>
</ul>
<h3 id="变换"><a href="#变换" class="headerlink" title="变换"></a>变换</h3><p>设计 React 的核心前提是认为 UI 只是把数据通过映射关系变换成另一种形式的数据。同样的输入必会有同样的输出。这恰好就是纯函数。</p>
<h3 id="抽象"><a href="#抽象" class="headerlink" title="抽象"></a>抽象</h3><p>需要把 UI 抽象成多个隐藏内部细节，又可复用的函数。通过在一个函数中调用另一个函数来实现复杂的 UI</p>
<h3 id="组合"><a href="#组合" class="headerlink" title="组合"></a>组合</h3><p>将两个或者多个不同的抽象通过组合再次抽象成一个抽象</p>
<h3 id="状态"><a href="#状态" class="headerlink" title="状态"></a>状态</h3><p>使用不可变的数据模型, 把可以改变 state 的函数串联起来作为原点放置在顶层</p>
<p>状态不存在于组件内, 状态是由 React 保存的, React 通过组件在渲染树中的位置将它保存的每个状态与正确的组件关联起来</p>
<ul>
<li>这个变量是否通过 props 从父组件中获取，如果是，则不是一个状态</li>
<li>这个变量是否在组件的整个生命周期中都保持不变，如果是，则不是一个状态</li>
<li>这个变量是否可以通过其他状态(state)或者属性(props)计算得到，如果是，则不是一个状态</li>
<li>这个变量是否在组件的 render 方法中使用，如果不在，则不是一个状态</li>
</ul>
<span id="more"></span>

<h4 id="不变性"><a href="#不变性" class="headerlink" title="不变性"></a>不变性</h4><ul>
<li>不直接操作数据源, 副本替换, 可以保持以前版本的数据完好无损, 并在以后重用它们</li>
<li>不直接操作数据源, 副本替换, 使组件比较其数据是否已更改的成本非常低, 提高子组件的渲染性能</li>
</ul>
<h4 id="构建-state-原则"><a href="#构建-state-原则" class="headerlink" title="构建 state 原则"></a>构建 state 原则</h4><ul>
<li><p>合并关联的 state, 如果总是同时更新两个或更多的 state 变量时, 考虑将它们合并为一个单独的 state</p>
</li>
<li><p>避免互相矛盾的 state, 当 state 结构中存在多个相互矛盾不一致的 state 时, 应避免这种情况</p>
</li>
<li><p>避免冗余的 state, 如果渲染期间从组件的 props 或其它现有的 state 中计算出一些信息, 则不应该作为 state</p>
</li>
<li><p>避免重复的 state, 当同一数据在多个 state 之间或多个嵌套对象中重复时, 这很难保持它们同步, 应避免这种情况</p>
</li>
<li><p>避免深度嵌套的 state, 深度分层的 state 更新起来很不方面, 尽量以扁平化方式构建 state</p>
</li>
<li><p>尽量避免在 state 中镜像 props, 会与从父组件传递的属性失去同步(将不会更新), 只有想要忽略特定 props 属性的所有更新时, 使用镜像 props 才有意义, 约定 prop 名称以 <code>initial</code> 或 <code>default</code> 开头, 以说明该 prop 的新值将被忽略</p>
</li>
</ul>
<h4 id="响应式值"><a href="#响应式值" class="headerlink" title="响应式值"></a>响应式值</h4><p>props 和 state 并不是唯一的响应式值, 从它们计算出的值都是响应式的, 如果 props 或 state 发生变化, 组件将重新渲染, 从中计算出的值也会随之变化, 所以需要将响应式值包括在 Effect 的依赖项中</p>
<ul>
<li>所有在组件内部直接声明的变量和函数</li>
</ul>
<h4 id="对-state-进行保留和重置"><a href="#对-state-进行保留和重置" class="headerlink" title="对 state 进行保留和重置"></a>对 state 进行保留和重置</h4><ul>
<li>将组件渲染在不同的位置, 可以重置 state</li>
<li>使用 key 重置 state, key 不是全局唯一的, 只是标识父组件内部的顺序</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Scoreboard</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [isPlayerA, setIsPlayerA] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line">  <span class="comment">/* 如果只用一个 Counter 组件通过 props 传递 person 属性的方式切换用户会出现 state 不会被重置*/</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* 第 1 种方式: 在不同位置上, 渲染两个 Counter 组件, 在切换不同的用户时可以重置 state */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;isPlayerA &amp;&amp; <span class="tag">&lt;<span class="name">Counter</span> <span class="attr">person</span>=<span class="string">&quot;Taylor&quot;</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;!isPlayerA &amp;&amp; <span class="tag">&lt;<span class="name">Counter</span> <span class="attr">person</span>=<span class="string">&quot;Sarah&quot;</span> /&gt;</span> &#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      &#123;/* 第 2 种方式: 在同一位置上, 使用 key 为 Counter 组件添加标识, 让 React 区分组件 */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;isPlayerA </span></span><br><span class="line"><span class="language-xml">        ? (<span class="tag">&lt;<span class="name">Counter</span> <span class="attr">key</span>=<span class="string">&quot;Taylor&quot;</span> <span class="attr">person</span>=<span class="string">&quot;Taylor&quot;</span> /&gt;</span>) </span></span><br><span class="line"><span class="language-xml">        : (<span class="tag">&lt;<span class="name">Counter</span> <span class="attr">key</span>=<span class="string">&quot;Sarah&quot;</span> <span class="attr">person</span>=<span class="string">&quot;Sarah&quot;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setIsPlayerA(!isPlayerA) &#125;&gt;下一位玩家！<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Counter 组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params">&#123; person &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [score, setScore] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [hover, setHover] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> className = <span class="string">&#x27;counter&#x27;</span>;</span><br><span class="line">  <span class="keyword">if</span> (hover) &#123;</span><br><span class="line">    className += <span class="string">&#x27; hover&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">className</span>=<span class="string">&#123;className&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onPointerEnter</span>=<span class="string">&#123;()</span> =&gt;</span> setHover(true)&#125;</span></span><br><span class="line"><span class="language-xml">      onPointerLeave=&#123;() =&gt; setHover(false)&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;person&#125; 的分数：&#123;score&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setScore(score + 1)&#125;&gt;加一<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="React-Component-deprected"><a href="#React-Component-deprected" class="headerlink" title="React.Component(deprected)"></a>React.Component(deprected)</h2><h3 id="组件的生命周期"><a href="#组件的生命周期" class="headerlink" title="组件的生命周期"></a>组件的生命周期</h3><ul>
<li><p>constructor(props)</p>
<ul>
<li>初始化内部 state，只能在构造函数中直接为 state 赋值，其他方法中应使用 this.setState()</li>
<li>为事件处理函数绑定实例</li>
</ul>
</li>
<li><p>static getDerivedStateFromProps(props, state)</p>
<ul>
<li>在 render() 方法执行前调用, 初始化挂载及后续更新都会被调用</li>
<li>返回一个对象来更新 state, 如果返回 null, 则不更新任何内容</li>
<li>无法访问组件实例</li>
</ul>
</li>
<li><p>render() class 组件中唯一必须实现的方法, 返回以下类型之一</p>
<ul>
<li>React 元素</li>
<li>数组或者 Fragments</li>
<li>Portals</li>
<li>字符串或者数值类型</li>
<li>布尔类型或者 null,什么都不渲染</li>
</ul>
</li>
<li><p>componentDidMount()</p>
<ul>
<li>组件挂载后立即调，DOM 节点的初始化应该放在这里</li>
</ul>
</li>
<li><p>static getDerivedStateFromProps(props, state)</p>
</li>
<li><p>shouldComponentUpdate(nextProps, nextState)</p>
<ul>
<li>返回值影响组件是否会重新渲染</li>
<li>默认返回值为 true</li>
<li>首次渲染或者使用 forceUpdate() 时不会调用该方法</li>
<li>返回 false 不会调用 render() 和 componentDidUpdate() 方法</li>
</ul>
</li>
<li><p>render()</p>
</li>
<li><p>getSnapshotBeforeUpdate(prevProps, prevState)</p>
<ul>
<li>在最近一次渲染输出(提交到 DOM 节点)之前调用</li>
<li>返回值作为 componentDidUpdate 方法的第三个参数 snapshot 传递,否则此参数为 undefined</li>
</ul>
</li>
<li><p>componentDidUpdate(prevProps, prevState, snapshot)</p>
</li>
<li><p>componentWillUnmount() 组件卸载及销毁之前直接调用,此方法中不应该使用 setState() 方法,组件不会被重新渲染</p>
</li>
</ul>
<h2 id="深入-JSX"><a href="#深入-JSX" class="headerlink" title="深入 JSX"></a>深入 JSX</h2><ul>
<li><p>只能返回一个根元素</p>
</li>
<li><p>标签必须闭合</p>
</li>
<li><p>大部分属性使用驼峰方式</p>
</li>
<li><p>自定义的组件必须以大写字母开头</p>
</li>
<li><p>React 将 boolean, null, undefined 视为空值, 不做任何渲染</p>
</li>
</ul>
<h3 id="JSX-中的-Props"><a href="#JSX-中的-Props" class="headerlink" title="JSX 中的 Props"></a>JSX 中的 Props</h3><ul>
<li><p>JavaScript 表达式作为 Props</p>
</li>
<li><p>字符串字面量</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个JSX表达式是等价的,</span></span><br><span class="line">&lt;<span class="title class_">MyComponent</span> message=<span class="string">&quot;hello world&quot;</span> /&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">message</span>=<span class="string">&#123;</span>&#x27;<span class="attr">hello</span> <span class="attr">world</span>&#x27;&#125; /&gt;</span></span></span><br><span class="line"><span class="comment">// 字符串字面量赋值给 prop 时，它的值是未转义的</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">message</span>=<span class="string">&quot;<span class="symbol">&amp;lt;</span>3&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">message</span>=<span class="string">&#123;</span>&#x27;&lt;<span class="attr">3</span>&#x27;&#125; /&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>Props 默认值为 True</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="title class_">MyTextBox</span> autocomplete /&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">MyTextBox</span> <span class="attr">autocomplete</span>=<span class="string">&#123;true&#125;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>属性展开</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此方法容易将不必要的 props 传递给不相关的组件，</span></span><br><span class="line"><span class="comment">// 或者将无效的 HTML 属性传递给 DOM,谨慎使用该语法.</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Button</span> = (<span class="params">props</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; kind, ...other &#125; = props;</span><br><span class="line">  <span class="keyword">const</span> className = kind === <span class="string">&#x27;primary&#x27;</span> ? <span class="string">&#x27;PrimaryButton&#x27;</span> : <span class="string">&#x27;SecondaryButton&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span> &#123;<span class="attr">...other</span>&#125; /&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">App</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Button</span> <span class="attr">kind</span>=<span class="string">&#x27;primary&#x27;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> console.log(&#x27;clicked!&#x27;)&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        Hello World!</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="JSX-中的-children"><a href="#JSX-中的-children" class="headerlink" title="JSX 中的 children"></a>JSX 中的 children</h3><ul>
<li>包含在开始和结束标签之间的 JSX 内容将作为特定属性 props.children 传递给组件.</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params">&#123;title, children&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">title</span>=<span class="string">&#123;title&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">title</span>=<span class="string">&#x27;my-component&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      This is children</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>tag p<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">MyComponent</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>批量子元素</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用子元素回调 numTimes 次，来重复生成组件</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Repeat</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> items = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; props.<span class="property">numTimes</span>; i++) &#123;</span><br><span class="line">    items.<span class="title function_">push</span>(props.<span class="title function_">children</span>(i));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;items&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ListOfTenThings</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Repeat</span> <span class="attr">numTimes</span>=<span class="string">&#123;10&#125;</span>&gt;</span>&#123;(index) =&gt; <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>This is item &#123;index&#125; in the list<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;<span class="tag">&lt;/<span class="name">Repeat</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="React-Hook"><a href="#React-Hook" class="headerlink" title="React Hook"></a>React Hook</h2><p>一个特殊的函数, 只能在组件或自定义 Hook 的顶层调用</p>
<ul>
<li>React 16.8 新增</li>
<li>可以在函数组件内”钩入” React State 及生命周期等特性的函数</li>
<li>不能在 class 组件中使用</li>
</ul>
<h3 id="Hook-规则"><a href="#Hook-规则" class="headerlink" title="Hook 规则"></a>Hook 规则</h3><ul>
<li>只能在函数最顶层调用 Hook, 不能在循环、条件判断或者嵌套函数中调用</li>
<li>只能在 React 的函数组件中调用 Hook, 不能在其他 JavaScript 函数中调用</li>
<li>对 Hook 的每个调用完全独立于对同一个 Hook 的其他调用</li>
</ul>
<h3 id="React-内置-Hook"><a href="#React-内置-Hook" class="headerlink" title="React 内置 Hook"></a>React 内置 Hook</h3><h4 id="useId"><a href="#useId" class="headerlink" title="useId  "></a>useId <em id="useId"></em> <!--markdownlint-disable-line--></h4><p>生成传递给无障碍属性的唯一 ID, 不能用来生成数据列表中的 key</p>
<ul>
<li>能够确保与服务器端渲染一起工作</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id = <span class="title function_">useId</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useId&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">PasswordFiled</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> passwordHintId = <span class="title function_">useId</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">aria-describedby</span>=<span class="string">&#123;passwordHintId&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&#123;passwordHintId&#125;</span>&gt;</span>密码至少包含 18 个字符<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useState"><a href="#useState" class="headerlink" title="useState"></a>useState</h4><ul>
<li>用于保存渲染间的数据</li>
<li>更新变量并触发 React 再次渲染组件</li>
<li>调用 set 函数不会改变已经执行的代码中当前的 state</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(initialState);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// useState 实现原理</span></span><br><span class="line"><span class="keyword">let</span> componentHooks = []; <span class="comment">// 把 state 存储在外面</span></span><br><span class="line"><span class="keyword">let</span> currentHookIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useState</span>(<span class="params">initialValue</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> pair = componentHooks[currentHookIndex];</span><br><span class="line">  <span class="keyword">if</span>(pair)&#123;</span><br><span class="line">    currentHookIndex++;</span><br><span class="line">    <span class="keyword">return</span> pair;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 第一次渲染时</span></span><br><span class="line">  pair = [initialValue, setState];</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">setState</span>(<span class="params">nextState</span>)&#123;</span><br><span class="line">    pair[<span class="number">0</span>] = nextState;</span><br><span class="line">    <span class="title function_">updateDOM</span>(); <span class="comment">// 更新DOM</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 存储这个 pair 用于将来的渲染</span></span><br><span class="line">  <span class="comment">// 并且为下一次 hook 的调用做准备</span></span><br><span class="line">  componentHooks[currentHookIndex] = pair;</span><br><span class="line">  currentHookIndex++;</span><br><span class="line">  <span class="keyword">return</span> pair;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>初始 state 参数只在第一次渲染时会被用到</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> [fruit, setFruit] = <span class="title function_">useState</span>(<span class="string">&#x27;banana&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> [todos, setTodos] = <span class="title function_">useState</span>([&#123; <span class="attr">text</span>: <span class="string">&#x27;learn React Hooks&#x27;</span> &#125;]);</span><br><span class="line"><span class="title function_">setTodos</span>([...todos, &#123; <span class="attr">text</span>: <span class="string">&#x27;Hello setTodos&#x27;</span> &#125;]); <span class="comment">// 和 this.setState 的区别: 不会进行 state 合并</span></span><br></pre></td></tr></table></figure>

<ul>
<li>函数式更新, 新的 state 需要通过之前的 state 计算得出</li>
<li>React 将更新函数放入队列中, 在下一次渲染期间, React 将通过队列将所有更新函数应用于先前的状态来计算下一个状态</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setCount</span>(<span class="function">(<span class="params">prevCount</span>) =&gt;</span> prevCount - <span class="number">1</span>);</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;setCount.bind(null,</span> (<span class="attr">prevCount</span>) =&gt;</span> prevCount + 1)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>和当前的 state 合并更新, 如果更新函数返回值和当前 state 完全相同，则重渲染会被跳过</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">setState</span>(<span class="function">(<span class="params">prevState</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; ...prevState, ...updateValues &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>惰性初始 state, 初始 state 需要通过复杂计算获得, 可以使用回调函数返回计算后的初始 state</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ... 初始 state 的复杂计算</span></span><br><span class="line">  <span class="keyword">return</span> initialState;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="useReducer"><a href="#useReducer" class="headerlink" title="useReducer  "></a>useReducer <em id="useReducer"></em> <!--markdownlint-disable-line--></h4><p>整合组件的状态更新逻辑</p>
<p>将组件拥有的许多状态更新逻辑的事件处理程序整合到一个 外部函数 中, 这个函数称为 reducer</p>
<ul>
<li>每个 action 都描述了一个单一的用户交互, 即使它会引发数据的多个变化</li>
<li>reducer 用于更新 state 的纯函数, 即当输入相同时, 输出也相同, 参数为 state 和 action</li>
<li>init 用于计算初始值的函数, 如果存在, 使用 <code>init(initialArg)</code> 的执行结果作为初始值, 否则使用 initialArg</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialArg, init);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现原理</span></span><br><span class="line"><span class="keyword">import</span> &#123;useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>)&#123;</span><br><span class="line">  <span class="keyword">switch</span>(action.<span class="property">type</span>)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;add&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;delete&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Unknow action: &#x27;</span> + action.<span class="property">tye</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useReducer</span>(<span class="params">reducer, initialState</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = <span class="title function_">useState</span>(initialState);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">dispatch</span>(<span class="params">action</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> nextState = <span class="title function_">reducer</span>(state, action);</span><br><span class="line">    <span class="title function_">setState</span>(nextState);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [state, dispatch];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>指定初始 state<ul>
<li>(redux 的参数约定)将初始 state 作为第二个参数传入 useReducer,可传入 undefined.</li>
<li>如果 Reducer Hook 的返回值和当前 state 相同, React 将跳过子组件的渲染及副作用的执行</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useReducer&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计数器 Demo</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;increment&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> + <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;decrement&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">count</span>: state.<span class="property">count</span> - <span class="number">1</span> &#125;;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      Count: &#123;state.count&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;decrement&#x27; &#125;)&#125;&gt;-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> dispatch(&#123; type: &#x27;increment&#x27; &#125;)&#125;&gt;+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>惰性初始化</p>
<ul>
<li>useReducer 的第三个参数, initialArg 将作为 init 函数的参数并返回新的 state</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">init</span>(<span class="params">initialState</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; ...initialState &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reducer</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; ...state &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Counter</span>(<span class="params">&#123; initialState &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState, init);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;&gt;</span>&#123;...state&#125;<span class="tag">&lt;/&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="useContext"><a href="#useContext" class="headerlink" title="useContext  "></a>useContext <em id="useContext"></em> <!-- markdownlint-disable-line --></h4><p>深度传递信息</p>
<p>Context 允许父组件向其下层无论多深的任何组件提供信息, 而无需通过 props 显式传递</p>
<ul>
<li>接收一个 context 对象(React.createContext 的返回值)并返回该 context 的当前值</li>
<li>仍需要在上层组件树中使用 Provider 提供 context</li>
</ul>
<p>使用 Context: 如果以下方法不适合再考虑使用</p>
<ul>
<li>从传递 props 开始, 这样做能够清晰的展示组件的数据流</li>
<li>抽象组件并将 jsx 作为 children 传递, 将使用 props 传递的属性抽象为 children 组件传递</li>
</ul>
<p>使用场景:</p>
<ul>
<li>主题</li>
<li>当前账户</li>
<li>路由</li>
<li>状态管理</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> someValue = <span class="title function_">useContext</span>(someContext);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createContext, useContext, useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> themes = &#123;</span><br><span class="line">  <span class="attr">light</span>: &#123;</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&#x27;30px&#x27;</span>,</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;#0088ff&#x27;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&#x27;#eeeeee&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">dark</span>: &#123;</span><br><span class="line">    <span class="attr">height</span>: <span class="string">&#x27;30px&#x27;</span>,</span><br><span class="line">    <span class="attr">color</span>: <span class="string">&#x27;#ffffff&#x27;</span>,</span><br><span class="line">    <span class="attr">background</span>: <span class="string">&#x27;#222222&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ThemeContext</span> = <span class="title function_">createContext</span>(themes);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ContextDemo</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [theme, setTheme] = <span class="title function_">useState</span>(<span class="string">&#x27;dark&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ThemeContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;themes[theme]&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>ContextDemo<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>current theme: &#123;theme&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ThemeButton</span> <span class="attr">onClick</span>=<span class="string">&#123;setTheme.bind(null,</span> (<span class="attr">prevState</span>) =&gt;</span> (prevState === &#x27;dark&#x27; ? &#x27;light&#x27; : &#x27;dark&#x27;))&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ThemeContext.Provider</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ThemeButton</span>(<span class="params">&#123;onClick&#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// 使用 useContext 代替 ThemeContext.consumer 消费组件</span></span><br><span class="line">  <span class="keyword">const</span> theme = <span class="title function_">useContext</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onClick&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">...theme</span> &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">      useContext button</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>层级标题</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createContext, useContext&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">LevelContext</span> = <span class="title function_">createContext</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Heading</span>(<span class="params">&#123;children&#125;</span>)&#123;</span><br><span class="line">  <span class="comment">// 组件内部读取上层的 level</span></span><br><span class="line">  <span class="keyword">const</span> level = <span class="title function_">useContext</span>(<span class="title class_">LevelContext</span>);</span><br><span class="line">  <span class="keyword">switch</span>(level)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h5</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h6</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;unknown level: &#x27;</span> + level);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Section</span>(<span class="params">&#123;children&#125;</span>)&#123;</span><br><span class="line">  <span class="comment">// 使用 useContext 读取上层的 level, 不需要在 props 接收 level</span></span><br><span class="line">  <span class="keyword">const</span> level = <span class="title function_">useContext</span>(<span class="title class_">LevelContext</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">LevelContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;level</span> + <span class="attr">1</span>&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">LevelContext.Provider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &#123;<span class="comment">/* </span></span><br><span class="line"><span class="comment">      在 Section 内部使用 useContext 读取上层的 level,</span></span><br><span class="line"><span class="comment">      不需要在此处向 Section 内部传递 level </span></span><br><span class="line"><span class="comment">    */</span>&#125;</span><br><span class="line">    &lt;<span class="title class_">Section</span>&gt; </span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Heading</span>&gt;</span>主标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">Section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>副标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>副标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>副标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">Heading</span>&gt;</span>子子标题<span class="tag">&lt;/<span class="name">Heading</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">Section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Section</span>&gt;</span></span></span><br><span class="line">    &lt;/<span class="title class_">Section</span>&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>嵌套 Context</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createContext, useContext, useReducer&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TasksContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TasksDispatchContext</span> = <span class="title function_">createContext</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">TasksProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">TasksProvider</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TasksProvider</span>(<span class="params">&#123;children&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [tasks, dispatch] = <span class="title function_">useReducer</span>(tasksReducer, initialTasks);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">TasksContext</span> <span class="attr">value</span>=<span class="string">&#123;tasks&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">TasksDispatchContext</span> <span class="attr">value</span>=<span class="string">&#123;dispatch&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">TasksDispatchContext</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">TasksContext</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">tasksReducer</span>(<span class="params">state, action</span>)&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useEffect"><a href="#useEffect" class="headerlink" title="useEffect"></a>useEffect</h4><p>Effect 允许指定由渲染本身, 而不是特定事件引起的副作用</p>
<ul>
<li>异步执行，不会阻塞浏览器更新</li>
<li>useEffect 每次在调用一个新的 effect 之前对前一个 effect 进行清理，防止内存泄漏或崩溃的问题</li>
<li>尽量避免使用 对象 和 函数 作为 Effect 依赖, 否则会使 Effect 更频繁地重新同步</li>
<li>如果 Effect 的不同部分因不同原因需要重新运行, 将其拆分为多个 Effect</li>
<li>默认情况下，它在第一次渲染之后和每次更新之后都会执行</li>
<li>第二个参数为依赖项数组, 控制 effect 的执行时机<ul>
<li>依赖项为空数组, 表示只会在组件挂载后执行</li>
<li>没有依赖项数组时, 表示每次重新渲染后重新执行</li>
</ul>
</li>
</ul>
<p>不使用 Effect 的情况:</p>
<ul>
<li>不必为了渲染而使用 Effect 来转换数据</li>
<li>不必使用 Effect 来处理用户事件</li>
</ul>
<p>日志出现两次挂载的原因, React 在开发环境中会在初始化挂载组件后, 立即再挂载一次, 帮助查找问题所在</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(setup, dependencies?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 组件卸载时调用, 可选</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// effect 会比较数组中所有参数是否和前一次的参数全等，如果有一个不相等则执行 effect</span></span><br><span class="line">  <span class="comment">// 依赖项数组为空，只执行一次 effect</span></span><br><span class="line">&#125;, [count]); <span class="comment">// 仅在 count 更改时更新</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// 没有依赖项数组：每次重新渲染后重新运行</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="在-Effect-中请求数据"><a href="#在-Effect-中请求数据" class="headerlink" title="在 Effect 中请求数据"></a>在 Effect 中请求数据</h5><ul>
<li>Effect 不能在服务器上运行, 服务器渲染的 HTML 将只包含没有数据的 Loading 状态</li>
<li>在 Effect 中请求数据容易造成网络瀑布, 当请求一些数据再渲染子组件, 然后重复这样的过程来请求子组件的数据</li>
<li>在 Effect 中直接请求数据通常意味着不会预加载或缓存数据</li>
<li>不符合工效学, 在调用 fetch 时, 需要编写大量样板代码, 以避免像竞争条件这样的 bug</li>
</ul>
<h4 id="useEffectEvent"><a href="#useEffectEvent" class="headerlink" title="useEffectEvent"></a>useEffectEvent</h4><ul>
<li>只在 Effect 内部调用</li>
<li>永远不要把它们传递给其他的组件或 Hook</li>
</ul>
<p>从 Effect 中提取非响应式逻辑, 在 响应式逻辑(Effect) 中使用响应式值而不用担心引起周围代码因为变化而重新执行</p>
<ul>
<li>EffectEvent 是非响应式的并且必须从依赖项中删除</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> onSomething = <span class="title function_">useEffectEvent</span>(callback);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useContext, useEffect, useEffectEvent&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="comment">// 聊天室应用</span></span><br><span class="line"><span class="comment">// https://zh-hans.react.dev/learn/separating-events-from-effects</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Page</span>(<span class="params">&#123;url&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;items&#125; = <span class="title function_">useContext</span>(<span class="title class_">ShoppingCartContext</span>);</span><br><span class="line">  <span class="keyword">const</span> numberOfItems = items.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 非响应式逻辑, 内部读取的 numberOfItems 一直都是最新的</span></span><br><span class="line">  <span class="comment">// 但是 numberOfItems 自己变化不会引起重新渲染</span></span><br><span class="line">  <span class="keyword">const</span> onVisit = <span class="title function_">useEffectEvent</span>(<span class="function"><span class="params">visitedUrl</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">logVisit</span>(visitedUrl, numberOfItems);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Effect 内部依然是响应式的, url 变化会去调用 onVisit</span></span><br><span class="line">    <span class="title function_">onVisit</span>(url);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 日志 logVisit 想加入购物车数量时, 需要添加依赖项 numberOfItems</span></span><br><span class="line">    <span class="comment">// 如果依赖项加入 numberOfItems, 就改变了 logVisit 日志的作用</span></span><br><span class="line">    <span class="comment">// 使用 useEffectEvent 提取非响应式逻辑</span></span><br><span class="line">    <span class="comment">// logVisit(url, numberOfItems); // 缺少依赖项 numberOfItems</span></span><br><span class="line">  &#125;,[url]);</span><br><span class="line"></span><br><span class="line"> <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useLayoutEffect"><a href="#useLayoutEffect" class="headerlink" title="useLayoutEffect"></a>useLayoutEffect</h4><blockquote>
<p>只在客户端运行, 在服务器渲染期间不会运行</p>
</blockquote>
<p>在浏览器重新绘制屏幕之前触发, 可能会影响性能, 尽可能使用 useEffect</p>
<ul>
<li>它会在所有的 DOM 变更之后同步调用 effect, 可以使用它来读取 DOM 布局并同步触发重渲染</li>
<li>计算布局, 不希望用户看到某些元素在移动</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useLayoutEffect</span>(setup, dependencies?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef, useState, useLayoutEffect&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createPortal&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Tooltip</span>(<span class="params">&#123;children, targetRect&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> ref = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [tooltipHeight, setTooltipHeight] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useLayoutEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;height&#125; = ref.<span class="property">current</span>.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">    <span class="title function_">setTooltipHeight</span>(height); <span class="comment">// 重新渲染提示框的位置</span></span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> tooltipX = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> tooltipY = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>(targetRect !== <span class="literal">null</span>)&#123;</span><br><span class="line">    tooltipX = targetRect.<span class="property">left</span>;</span><br><span class="line">    tooltipY = targetRect.<span class="property">top</span> - tooltipHeight;</span><br><span class="line">    <span class="keyword">if</span>(tooltipY &lt; <span class="number">0</span>)&#123;</span><br><span class="line">      tooltipY = targetRect.<span class="property">bottom</span>; </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">createPortal</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ToolTipContainer</span> <span class="attr">x</span>=<span class="string">&#123;tooltipX&#125;</span> <span class="attr">y</span>=<span class="string">&#123;tooltipY&#125;</span> <span class="attr">contentRef</span>=<span class="string">&#123;ref&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;children&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ToolTipContainer</span>&gt;</span></span>,</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useInsertionEffect"><a href="#useInsertionEffect" class="headerlink" title="useInsertionEffect"></a>useInsertionEffect</h4><blockquote>
<p>只在客户端运行, 在服务器渲染期间不会运行</p>
</blockquote>
<p>为 CSS-in-js 库的作者特意打造的, 除非正在使用 CSS-in-js 库并且需要注入样式, 否则应该使用 useEffect 或 useLayoutEffect</p>
<ul>
<li>为布局副作用触发之前将元素插入到 DOM 中</li>
<li>不能在内部更新状态</li>
</ul>
<p>CSS-in-js 常见的实现方法:</p>
<ul>
<li>使用编译器静态提取到 CSS 文件</li>
<li>内联样式, 例如 <code>&lt;div style=&#123;&#123;opacity: 1&#125;&#125;&gt;</code></li>
<li>运行时注入 <code>&lt;style&gt;</code> 标签</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useInsertionEffect</span>(setup, dependencies?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useInsertionEffect&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> isInserted = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useCSS</span>(<span class="params">rule</span>)&#123;</span><br><span class="line">  <span class="title function_">useInsertionEffec</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 在此注入 &lt;style&gt; 标签</span></span><br><span class="line">    <span class="keyword">if</span>(!isInserted.<span class="title function_">has</span>(rule))&#123;</span><br><span class="line">      isInserted.<span class="title function_">add</span>(rule);</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">head</span>.<span class="title function_">appendChild</span>(<span class="title function_">getStyleForRule</span>(rule));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> rule;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> className = <span class="title function_">useCss</span>(<span class="string">&#x27;...&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&#123;className&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useActionState-experimental"><a href="#useActionState-experimental" class="headerlink" title="useActionState(experimental)"></a>useActionState(experimental)</h4><p>可以根据某个表单动作的结果更新 state 的 Hook</p>
<p>调用 useActionState 时在参数中传入现有的表单动作函数以及一个初始状态, 返回一个新的 action 函数和一个 form state 以供在 form 中使用, 这个新的 form state 也会作为参数传入提供的表单动作函数</p>
<ul>
<li><p>form state 是一个只在表单被提交触发 action 后才会被更新的值</p>
</li>
<li><p>如果 action 是一个 url, form 的行为就是普通表单提交</p>
</li>
<li><p>如果 action 是一个函数, form 的行为由这个函数控制, action 同时会重写 <code>&lt;button&gt;</code>、<code>&lt;input type=&quot;submit&quot;/&gt;</code>、<code>&lt;input type=&quot;image&quot;/&gt;</code> 的 formAction(表单提交的 url) 属性</p>
</li>
<li><p>action 作为函数, 当表单被提交时触发</p>
<ul>
<li>第一个参数为上一次调用 action 函数的返回值, 第一次调用时传入的是 initialState</li>
<li>余下的参数为普通表单动作接到的参数</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, formAction] = <span class="title function_">useActionState</span>(action, initialState, permalink?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useActionState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params">prevState, formData</span>)&#123;</span><br><span class="line">  <span class="comment">// await fetch();</span></span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">resolve</span>(), <span class="number">2000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> prevState + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">StatusForm</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [state, formAction] = <span class="title function_">useActionState</span>(increment, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">// action 是 url 则直接提交表单, 如果是函数, 则控制表单的提交行为</span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#123;formAction&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;state&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;/* form 的 action, enctype, method, target 属性可以被 button, type=&quot;submit&quot;, type=&quot;image&quot; */&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;/* 的 formaction, formenctype, formmethod, formtarget 属性重写*/&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">formAction</span>=<span class="string">&#123;formAction&#125;</span>&gt;</span>+1<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* button 和 input type=&quot;submit&quot;, input type=&quot;image&quot; 是等价的 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">formAction</span>=<span class="string">&#123;formAction&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;image&quot;</span> <span class="attr">formAction</span>=<span class="string">&#123;formAction&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useCallback"><a href="#useCallback" class="headerlink" title="useCallback"></a>useCallback</h4><blockquote>
<p>允许在多次渲染中缓存函数的 Hook, 通常应用于性能优化</p>
</blockquote>
<ul>
<li>把内联回调函数及依赖项数组作为参数传入 useCallback，它将返回该回调函数的 memoized 版本，该回调函数仅在某个依赖项改变时才会更新</li>
<li>优化针对于子组件渲染</li>
<li>第二个参数为依赖项数组<ul>
<li>没有依赖项数组时, 每次都会返回一个新的函数</li>
<li>依赖项为空数组时, 不需要依赖项</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cachedFn = <span class="title function_">useCallback</span>(fn, dependencies);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedCallback = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">doSomething</span>(a, b);</span><br><span class="line">&#125;, [a, b]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 每次都返回一个新函数: 没有依赖项数组</span></span><br><span class="line"><span class="keyword">const</span> cachedFn = <span class="title function_">useCallback</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="title function_">doSomething</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="useMemo"><a href="#useMemo" class="headerlink" title="useMemo"></a>useMemo</h4><p>缓存每次重新渲染都需要计算的结果</p>
<p>把“创建”函数和依赖项数组作为参数传入 useMemo，它仅会在某个依赖项改变时才重新计算 memoized 值</p>
<ul>
<li>优化针对于当前组件高开销的计算</li>
<li>传入 useMemo 的函数会在渲染期间执行</li>
<li>第二个参数为依赖项数组<ul>
<li>没有依赖项数组时, 每次渲染都会计算新的值</li>
<li>依赖项为空数组时, 不需要依赖项</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cachedValue = <span class="title function_">useMemo</span>(calculateValue, dependencies);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useMemo&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TodoList</span>(<span class="params">&#123;todos, tab&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> visibleTodos = <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> <span class="title function_">filterTodos</span>(todos, tab), [todos, tab]);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useRef"><a href="#useRef" class="headerlink" title="useRef  "></a>useRef <em id="useRef"></em> <!--markdownlint-disable-line--></h4><p>希望 React 记住某些信息, 但又不想让这些信息触发新的渲染时, 使用 ref</p>
<ul>
<li>ref 在重新渲染之间由 React 保留, 更改 ref 不会触发更新</li>
<li>通过 .current 访问该 ref 的值, 不要在渲染期间写入或读取 ref.current, 会破坏这些预期行为</li>
<li>引用 DOM 节点, 在 DOM 节点被移除时, React 将重置 ref 的值为 null</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> refContainer = <span class="title function_">useRef</span>(initialValue);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> refDemo = <span class="title function_">useRef</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(refDemo.<span class="property">current</span>); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TextInputWithFocusButton</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> inputEl = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleBtnClick</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// `current` 指向已挂载到 DOM 上的文本输入元素</span></span><br><span class="line">    inputEl.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputEl&#125;</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleBtnClick&#125;</span>&gt;</span>Focus the input<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>批量操作 DOM, 使用 ref 回调, 将函数传递给 ref 属性, 当需要设置 ref 时, React 将调用 ref 回调并传入 DOM 节点,<ul>
<li>并在需要清除它时传入 null</li>
<li>或者手动返回一个回调函数, 在回调函数内管理 map</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef, useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setupCatList</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> catList = [];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    catList.<span class="title function_">push</span>(<span class="string">&quot;https://loremflickr.com/320/240/cat?lock=&quot;</span> + i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> catList;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 批量 ref, 使用 ref 回调</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> itemsRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [catList, setCatList] = <span class="title function_">useState</span>(setupCatList);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getMap</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!itemsRef.<span class="property">current</span>)&#123;</span><br><span class="line">      itemsRef.<span class="property">current</span> = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> itemsRef.<span class="property">current</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">scrollToCat</span>(<span class="params">cat</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> map = <span class="title function_">getMap</span>();</span><br><span class="line">    <span class="keyword">const</span> node = map.<span class="title function_">get</span>(cat); <span class="comment">// 获取 map 中存储的 DOM 节点</span></span><br><span class="line"></span><br><span class="line">    node.<span class="title function_">scrollToView</span>(&#123;</span><br><span class="line">      <span class="attr">behivor</span>: <span class="string">&#x27;smooth&#x27;</span>,</span><br><span class="line">      <span class="attr">block</span>: <span class="string">&#x27;nearest&#x27;</span>,</span><br><span class="line">      <span class="attr">inline</span>: <span class="string">&#x27;center&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> scrollToCat(catList[0])&#125;&gt;first<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> scrollToCat(catList[1])&#125;&gt;second<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> scrollToCat(catList[2])&#125;&gt;third<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;catList.map(cat =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">key</span>=<span class="string">&#123;cat&#125;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">ref</span>=<span class="string">&#123;</span> <span class="attr">node</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">              const map = getMap();</span></span><br><span class="line"><span class="language-xml">              if(node)&#123;</span></span><br><span class="line"><span class="language-xml">                map.set(cat, node);</span></span><br><span class="line"><span class="language-xml">              &#125; else &#123;</span></span><br><span class="line"><span class="language-xml">                // 方式1: 清除 DOM</span></span><br><span class="line"><span class="language-xml">                map.delete(cat);</span></span><br><span class="line"><span class="language-xml">              &#125;</span></span><br><span class="line"><span class="language-xml">              // 方式2: 清除 DOM</span></span><br><span class="line"><span class="language-xml">              return () =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">                map.delete(cat);</span></span><br><span class="line"><span class="language-xml">              &#125;</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          &gt;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;cat&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>不能访问其他组件的 DOM 节点, 借助 <a href="#forwardRef">forwardRef</a> 函数</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyInput</span>(<span class="params">props</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">input</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// 报错, 不能访问其他组件的 DOM 节点, 需要结合 forwardRef 使用</span></span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>(); </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MyInput</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useImperativeHandle"><a href="#useImperativeHandle" class="headerlink" title="useImperativeHandle"></a>useImperativeHandle</h4><blockquote>
<p>自定义由 ref 暴露出来的句柄</p>
</blockquote>
<ul>
<li><p>useImperativeHandle 应当和 <a href="#forwardRef">forwardRef</a> 一起使用</p>
</li>
<li><p>使用 ref 时自定义暴露给父组件的实例值</p>
</li>
<li><p>createHandle 函数不需要参数, 返回想要暴露的 ref 的句柄</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useImperativeHandle</span>(ref, createHandle, dependencies?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef, forwardRef, useImperativeHandle&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyInput</span> = <span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> realInputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">// 限制对外层暴露的功能</span></span><br><span class="line">  <span class="title function_">useImperativeHandle</span>(ref, <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// 只暴露 focus 和 scrollIntoView 方法</span></span><br><span class="line">    <span class="title function_">focus</span>(<span class="params"></span>)&#123;</span><br><span class="line">      realInputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">scrollIntoView</span>(<span class="params"></span>)&#123;</span><br><span class="line">      realInputRef.<span class="property">current</span>.<span class="title function_">scrollIntoView</span>();</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;realInputRef&#125;</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>)&#123;</span><br><span class="line">    inputRef.<span class="property">current</span>.<span class="title function_">focus</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MyInput</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>input Focus<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useDebugValue"><a href="#useDebugValue" class="headerlink" title="useDebugValue"></a>useDebugValue</h4><blockquote>
<p>可用于在 React 开发者工具中为自定义 Hook 添加标签</p>
</blockquote>
<ul>
<li>第二个可选参数, 只有在Hook被检查时才会被调用，接收debug值作为参数，并返回一个格式化的显示值</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useDebugValue</span>(value， format?);</span><br><span class="line"></span><br><span class="line"><span class="comment">// useDebugValue(date, date =&gt; date.toLocalDateString());</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useDebugValue, useSyncExternalStore&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useOnlineStatus</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> isOnline = <span class="title function_">useSyncExternalStore</span>(subscribe, <span class="function">() =&gt;</span> navigator.<span class="property">onLine</span>, <span class="function">() =&gt;</span> <span class="literal">true</span>);</span><br><span class="line">  <span class="comment">// 在开发者工具中为 StatusBar 组件添加标签</span></span><br><span class="line">  <span class="title function_">useDebugValue</span>(isOnline ? <span class="string">&#x27;Online&#x27;</span> : <span class="string">&#x27;Offline&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> isOnline;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">StatusBar</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> isOnline = <span class="title function_">useOnlineStatus</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">StatusBar</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useDeferredValue"><a href="#useDeferredValue" class="headerlink" title="useDeferredValue"></a>useDeferredValue</h4><blockquote>
<p>允许延迟更新 UI 的非关键部分, 以让其他部分先更新</p>
</blockquote>
<ul>
<li>当 useDeferredValue 接收到与之前不同的值时, 除了当前渲染, 它还会安排一个后台重新渲染, 这个后台是可被中断的, 如果 value 有新的更新, React 会从头开始重新启动后台渲染</li>
<li>useDeferredValue 本身不能阻止额外的网络请求</li>
<li>useDeferredValue 本身不会引起任何固定的延迟, 一旦 React 完成原始的重新渲染, 它会立即开始使用新的延迟值处理后台重新渲染, 由事件(例如 输入)引起的任何更新都会中断后台重新渲染, 并被优先处理</li>
<li>由 useDeferredValue 引起的后台重新渲染在提交到屏幕之前不会触发 Effect, 如果后台重新渲染被暂停, Effect 将在数据加载后和 UI 更新后运行</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> deferredValue = <span class="title function_">useDeferredValue</span>(value, initialValue);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState, useDeferredValue, <span class="title class_">Suspense</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [query, setQuery] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> deferredQuery = <span class="title function_">useDeferredValue</span>(query);</span><br><span class="line">  <span class="keyword">const</span> isStale = query !== deferredQuery;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> sty = &#123;</span><br><span class="line">    <span class="attr">opacity</span>: isStale ? <span class="number">0.5</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">transition</span>: isStale ? <span class="string">&#x27;opacity 0.2s 0.2s linear&#x27;</span>: <span class="string">&#x27;opacity 0.2s 0.2s linear&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 每次输入时, 旧的列表会略微变暗, 直到新的结果列表加载完毕</span></span><br><span class="line">  <span class="comment">// 或者使用 CSS 过渡来延迟变暗的过程</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Search albums:</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;query&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> setQuery(e.target.value)&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;sty&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;/* 查询结果列表 */&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">SearhReasults</span> <span class="attr">query</span>=<span class="string">&#123;deferredQuery&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useSyncExternalStore"><a href="#useSyncExternalStore" class="headerlink" title="useSyncExternalStore"></a>useSyncExternalStore</h4><p>订阅外部 store</p>
<ul>
<li>subscribe 接收一个单独的 callback 参数并把它订阅到 store 上, 当 store 发生改变时调用被提供的 callback, 引起组件重新渲染</li>
<li>getSnapshot 返回组件需要的 store 中的数据快照, store 不变的情况下, 重复调用必须返回同一个值, 否则, React 就会重新渲染组件</li>
<li>getServerSnapshot 返回 store 中数据的初始快照, 只会在服务器渲染时, 以及在客户端进行 hydration 时被用到</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> snapshot = <span class="title function_">useSyncExternalStore</span>(subscribe, getSnapshot, getServerSnapshot?);</span><br></pre></td></tr></table></figure>

<ul>
<li>监听 store</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useSyncExternalStore&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> nextId = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> todos = [&#123;<span class="attr">id</span>: nextId++, <span class="attr">text</span>: <span class="string">&#x27;Todo # 1&#x27;</span>&#125;];</span><br><span class="line"><span class="keyword">let</span> listeners = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todosStore = &#123;</span><br><span class="line">  <span class="title function_">addTodo</span>(<span class="params"></span>)&#123;</span><br><span class="line">    todos = [...todos, &#123;<span class="attr">id</span>: nextId++, <span class="attr">text</span>: <span class="string">&#x27;Todo # &#x27;</span> + nextId&#125;];</span><br><span class="line">    <span class="title function_">emitChange</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">subscribe</span>(<span class="params">listener</span>)&#123;</span><br><span class="line">    <span class="comment">// 接收一个 callback, 并返回一个 cleanup 函数</span></span><br><span class="line">    listeners = [...listeners, listener];</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      listeners = listeners.<span class="title function_">filter</span>(<span class="function"><span class="params">l</span> =&gt;</span> l !== listener);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getSnapshot</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> todos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">emitChange</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> listener <span class="keyword">of</span> listeners)&#123;</span><br><span class="line">    <span class="title function_">listener</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TodosApp</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> todos = <span class="title function_">useSyncExternalStore</span>(todosStore.<span class="property">subscribe</span>, todos.<span class="property">getSnapshot</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> todosStore.addTodo()&#125;&gt;Add Todo<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;todos.map(todo =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;todo.id&#125;</span>&gt;</span>&#123;todo.text&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>订阅浏览器 API</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useSyncExternalStore&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">subscribe</span>(<span class="params">callback</span>)&#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;online&#x27;</span>, callback);</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, callback);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;online&#x27;</span>, callback);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, callback);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useOnlineStatus</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> isOnline = <span class="title function_">useSyncExternalStore</span>(subscribe, <span class="function">() =&gt;</span> navigator.<span class="property">onLine</span>, <span class="function">() =&gt;</span> <span class="literal">true</span>);</span><br><span class="line">  <span class="keyword">return</span> isOnline;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useOptimistic-experimental"><a href="#useOptimistic-experimental" class="headerlink" title="useOptimistic(experimental)"></a>useOptimistic(experimental)</h4><p>更乐观的更新用户界面, 这种技术有助于使应用程序在感觉上响应地更加快速</p>
<ul>
<li><p>界面立即更新为预期的结果, 而不是等待服务器的响应来反映更改</p>
</li>
<li><p>允许在进行异步操作时显示不同 state, 接受 state 作为参数, 并返回该 state 的副本, 在异步操作(如网络请求)期间可以不同</p>
</li>
<li><p>optimisticState 结果乐观状态, 除非有操作挂起, 否则它等于 state, 在这种情况下, 它等于 updateFn 返回的值</p>
</li>
<li><p>addOptimistic 触发乐观更新时调用的 dispatch 函数, 接收一个任意类型的参数 optimisticValue, 并以 state 和 optimisticValue 作为参数调用 updateFn</p>
</li>
<li><p>updateFn 接受当前的 state 和传递给 addOptimistic 的乐观值, 并返回结果乐观状态</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnost [optimisticState, addOptimistic] = <span class="title function_">useOptimistic</span>(state, updateFn);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useOptimistic, useRef, useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Thread</span>(<span class="params">&#123;messages, sendMessage&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> formRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [optimisticMessages, addOptimisticMessage] = <span class="title function_">useOptimistic</span>(messages, <span class="function">(<span class="params">state, optimisticValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 使用乐观值</span></span><br><span class="line">    <span class="comment">// 合并返回新的 state</span></span><br><span class="line">    <span class="keyword">return</span> [...state, &#123;<span class="attr">text</span>: optimisticValue, <span class="attr">sending</span>: <span class="literal">true</span>&#125;];</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">formAction</span>(<span class="params">formData</span>)&#123;</span><br><span class="line">    <span class="title function_">addOptimisticMessage</span>(formData.<span class="title function_">get</span>(<span class="string">&#x27;message&#x27;</span>));</span><br><span class="line">    formRef.<span class="property">current</span>.<span class="title function_">reset</span>();</span><br><span class="line">    <span class="comment">// 异步操作</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">sendMessage</span>(formData); </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;optimisticMessages.map((message, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;message.text&#125;</span></span><br><span class="line"><span class="language-xml">          &#123;message.sending &amp;&amp; <span class="tag">&lt;<span class="name">small</span>&gt;</span>发送中...<span class="tag">&lt;/<span class="name">small</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ))&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#123;formAction&#125;</span> <span class="attr">ref</span>=<span class="string">&#123;formRef&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;message&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;hello...&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span>&gt;</span>发送<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [messages, setMessages] = <span class="title function_">useState</span>([</span><br><span class="line">    &#123;<span class="attr">text</span>: <span class="string">&#x27;你好, 在这!&#x27;</span>, <span class="attr">sending</span>: <span class="literal">false</span>, <span class="attr">key</span>: <span class="number">1</span>&#125;</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params">formData</span>)&#123;</span><br><span class="line">    <span class="comment">// 模拟异步操作</span></span><br><span class="line">    <span class="keyword">const</span> sentMessage = <span class="keyword">await</span> <span class="title function_">deliverMessage</span>(formData.<span class="title function_">get</span>(<span class="string">&#x27;message&#x27;</span>));</span><br><span class="line">    <span class="comment">// 更新状态</span></span><br><span class="line">    <span class="title function_">setMessages</span>(<span class="function"><span class="params">messages</span> =&gt;</span> [...messages, &#123;<span class="attr">text</span>: sentMessage&#125;]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Thread</span> <span class="attr">messages</span>=<span class="string">&#123;messages&#125;</span> <span class="attr">sendMessage</span>=<span class="string">&#123;sendMessage&#125;/</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">deliverMessage</span>(<span class="params">message</span>)&#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">3000</span>));</span><br><span class="line">  <span class="keyword">return</span> message;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useTransition"><a href="#useTransition" class="headerlink" title="useTransition"></a>useTransition</h4><p>在不阻塞 UI 的情况下更新状态, 将某些状态更新标记为 transition</p>
<ul>
<li>transition 更新不能用于控制文本输入</li>
<li>isPending 是否存在待处理的 transition</li>
<li>startTransition 调用此函数将状态更新标记为 transition, 传递给此函数的函数必须是同步的, React 会立即执行此函数, 并将在其执行期间发生的所有状态更新标记为 transition, 如果在其执行期间, 尝试稍后执行状态更新, 这些状态更新不会被标记为 transition</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [isPending, startTransition] = <span class="title function_">useTransition</span>();</span><br></pre></td></tr></table></figure>

<h3 id="自定义-Hook"><a href="#自定义-Hook" class="headerlink" title="自定义 Hook"></a>自定义 Hook</h3><ul>
<li>Hook 的名称必须以 use 开头</li>
<li>自定义 Hook 共享的是状态逻辑, 而不是状态本身</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">useDemo</span>(<span class="params">prop</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title function_">useState</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 执行订阅</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 执行取消订阅</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>网络状态 Hook</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useEffect,useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 无法检测已离线的网络</span></span><br><span class="line"><span class="comment">// 如果在生成初始 HTML 的服务端直接使用它是无效的</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useOnlineStatus</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [isOnline, setIsOnline] = <span class="title function_">useState</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">handleOnline</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="title function_">setIsOnline</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">handleOffline</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="title function_">setIsOnline</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;online&#x27;</span>, handleOnline);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, handleOffline);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;online&#x27;</span>, handleOnline);</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, handleOffline);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,[]);</span><br><span class="line">  <span class="keyword">return</span> isOnline;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改进版, 使用 useSyncExternalStore</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">subscribe</span>(<span class="params">callback</span>)&#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;online&#x27;</span>, callback);</span><br><span class="line">  <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, callback);</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;online&#x27;</span>, callback);</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&#x27;offline&#x27;</span>, callback);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useOnlineStatus</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">useSyncExternalStore</span>(subscribe, <span class="function">() =&gt;</span> navigator.<span class="property">onLine</span>, <span class="function">() =&gt;</span> <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="React-组件"><a href="#React-组件" class="headerlink" title="React 组件"></a>React 组件</h2><h3 id="React-内置组件"><a href="#React-内置组件" class="headerlink" title="React 内置组件"></a>React 内置组件</h3><h4 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h4><p>通常使用 <code>&lt;&gt;...&lt;/&gt;</code> 简写形式代替, 允许在不添加额外节点的情况下将子元素组合</p>
<ul>
<li>如果传递一个 key 给 Fragment 时, 不能使用简写形式</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Fragment</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Post</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostTitle</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostBody</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 渲染 key</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Blog</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> posts.<span class="title function_">map</span>(<span class="function"><span class="params">post</span> =&gt;</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Fragment</span> <span class="attr">key</span>=<span class="string">&#123;post.id&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostTitle</span> <span class="attr">title</span>=<span class="string">&#123;post.title&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">PostBody</span> <span class="attr">body</span>=<span class="string">&#123;post.body&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Fragment</span>&gt;</span></span></span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Profiler"><a href="#Profiler" class="headerlink" title="Profiler"></a>Profiler</h4><p>允许编程式测量 React 树的渲染性能, 可以嵌套测量应用的不同部分</p>
<ul>
<li>id 字符串, 用于标识正在测量的 UI 部分</li>
<li>onRender 当包裹的组件树更新时, React 回调此函数, 并传入有关渲染内容和所花费时间的信息</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Profiler</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">onRender</span>(<span class="params">id, phase, actualDuration, baseDuration, startTime, commitTime</span>)&#123;</span><br><span class="line">  <span class="comment">// id 字符串, 为 Profiler 树的属性</span></span><br><span class="line">  <span class="comment">// phase 标识书的渲染阶段, 取值: mount, update, nested-update</span></span><br><span class="line">  <span class="comment">// actualDuration 渲染 Profiler 树的毫秒数</span></span><br><span class="line">  <span class="comment">// baseDuration 估算在没有任何优化的情况下重新渲染整棵 Profiler 子树所需的毫秒数</span></span><br><span class="line">  <span class="comment">// startTime 开始渲染此次更新时的时间戳</span></span><br><span class="line">  <span class="comment">// commitTime React 提交此次更新时的时间戳</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Profiler</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">onRender</span>=<span class="string">&#123;onRender&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Profiler</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="StrictMode"><a href="#StrictMode" class="headerlink" title="StrictMode"></a>StrictMode</h4><p>为整个应用启动严格模式, 尽早发现组件中的常见错误</p>
<p>所有的检查仅在开发环境中进行, 不会影响生产构建</p>
<ul>
<li>组件将重新渲染一次, 以查找由于非纯渲染而引起的错误</li>
<li>组件将重新运行 Effect 一次, 以查找由于缺少 Effect 清理而引起的错误</li>
<li>组件将被检查是否使用了已弃用的 API</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">StrictMode</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createRoot&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line">root.<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">App</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"><span class="comment">// 部分开启严格模式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Header<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Suspense"><a href="#Suspense" class="headerlink" title="Suspense"></a>Suspense</h4><p>允许子组件完成加载前展示后备方案, Suspense 无法检测到 Effect 或事件处理程序中获取数据的情况</p>
<ul>
<li>children 真正的 UI 渲染内容, 如果 children 在渲染中被挂起, Suspense 将会渲染 fallback</li>
<li>fallback 真正的 UI 未渲染完成时代替其渲染的备用 UI</li>
</ul>
<p>激活 Suspense 组件的数据源</p>
<ul>
<li>支持 Suspense 的框架如 Relay 和 Next.js</li>
<li>使用 lazy 懒加载组件代码</li>
<li>使用 use 读取 Promise 的值</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Suspense</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="React-API"><a href="#React-API" class="headerlink" title="React API"></a>React API</h2><h3 id="act"><a href="#act" class="headerlink" title="act"></a>act</h3><p>测试助手, 用于在做出断言之前应用挂起的 React 更新, 通常用在测试库中</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;act&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">await</span> <span class="title function_">act</span>(<span class="keyword">async</span> actFn);</span><br></pre></td></tr></table></figure>

<h3 id="cache-experimental"><a href="#cache-experimental" class="headerlink" title="cache(experimental)"></a>cache(experimental)</h3><p>允许缓存数据获取或计算的结果, 在任何组件之外调用创建带有缓存的函数版本</p>
<ul>
<li>仅供与 服务器组件一起使用</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;cache&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> cachedFn = <span class="title function_">cache</span>(fn);</span><br></pre></td></tr></table></figure>

<h3 id="createContext"><a href="#createContext" class="headerlink" title="createContext"></a>createContext</h3><p>创建一个 Context 提供给子组件, 通常和 <a href="#useContext">useContext</a> 配合使用</p>
<h3 id="forwardRef"><a href="#forwardRef" class="headerlink" title="forwardRef  "></a>forwardRef <em id="forwardRef"></em> <!--markdownlint-disable-line--></h3><p>允许组件使用 ref 将 DOM 节点暴露给父组件</p>
<ul>
<li>render 渲染函数, React 将使用 props 和 ref 调用此函数, 返回的 JSX 作为组件的输出</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">SomeComponent</span> = <span class="title function_">forwardRef</span>(render);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;forwardRef, useRef&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyInput</span> = <span class="title function_">forwardRef</span>(<span class="function">(<span class="params">props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span> &#123;<span class="attr">...props</span>&#125;/&gt;</span></span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">MyInput</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;/</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="lazy"><a href="#lazy" class="headerlink" title="lazy"></a>lazy</h3><p>在组件第一次被渲染之前延迟加载组件的代码, 通过将懒加载组件或其任何父级包装到 Suspense 边界中实现</p>
<ul>
<li>load 该函数返回一个 Promise 或一个 thenable 对象, React 首次调用 load 后将等待解析, 然后将解析值的 .default 渲染为 React 组件</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">LazyComponent</span> = <span class="title function_">lazy</span>(load);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;lazy&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MarkdownPreview</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="title function_">import</span>(<span class="string">&#x27;./MarkdownPreview.js&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span>/&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MarkdownPreview</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspene</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="memo"><a href="#memo" class="headerlink" title="memo"></a>memo</h3><p>允许组件在 props 没有改变的情况下跳过重新渲染</p>
<p>只有当组件经常使用完全相同的 props 进行渲染时, 并且其重新渲染逻辑是非常昂贵的, 使用 memo 优化才有意义</p>
<ul>
<li>记忆化只与从父组件传递给组件的 props 有关, 即使组件已被记忆化, 当其使用的 context 发生变化时, 仍将重新渲染</li>
<li>componennt 要进行缓存的组件, memo 不会修改该组件, 而是返回一个新的、记忆化的组件, 接受任何有效的 React 组件, 包含函数式组件和 <a href="#forwardRef">forwardRef</a> 组件</li>
<li>arePropsEqual 该函数接收两个参数, 组件的上一个 props 和新的 props 进行比较<ul>
<li>新的 props 和旧的 props 具有相同的输出时返回 true</li>
<li>否则返回 false</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MemoizedComponent</span> = <span class="title function_">memo</span>(component, arePropsEqual?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;memo&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Greeting</span> = <span class="title function_">memo</span>(<span class="keyword">function</span> <span class="title function_">Greeting</span>(<span class="params">&#123;name&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="startTransition"><a href="#startTransition" class="headerlink" title="startTransition"></a>startTransition</h3><p>在不阻塞 UI 的情况下更新 state</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;startTransition&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TabContainer</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [tab, setTab] = <span class="title function_">useState</span>(<span class="string">&#x27;about&#x27;</span>);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">selectTab</span>(<span class="params">tab</span>)&#123;</span><br><span class="line">    <span class="title function_">startTransition</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="title function_">selectTab</span>(tab);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="use-experimental"><a href="#use-experimental" class="headerlink" title="use(experimental)"></a>use(experimental)</h3><p>读取类似于 Promise 或 context 的资源的值</p>
<ul>
<li>可以在 循环 或 条件 语句中调用 use, 调用 use 的函数仍然必须是一个 组件 或 Hook</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = <span class="title function_">use</span>(resource);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;use&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MessageComponent</span>(<span class="params">&#123;messagePromise&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> message = <span class="title function_">use</span>(messagePromise);</span><br><span class="line">  <span class="keyword">const</span> theme - <span class="title function_">use</span>(<span class="title class_">ThemeContext</span>);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="experimental-taintObjectReference-experimental"><a href="#experimental-taintObjectReference-experimental" class="headerlink" title="experimental_taintObjectReference(experimental)"></a>experimental_taintObjectReference(experimental)</h3><p>允许阻止特定对象实例被传递给客户端组件, 例如 user 对象</p>
<ul>
<li>message 对象被传递给客户端组件时显示的消息</li>
<li>object 被污染的对象, React 会阻止直接将 函数 和 类 传递给客户端组件, 并把默认的错误消息替换在 message 中定义的内容</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">experimental_taintObjectReference</span>(message, object);</span><br></pre></td></tr></table></figure>

<h3 id="taintUniqueValue-experimental"><a href="#taintUniqueValue-experimental" class="headerlink" title="taintUniqueValue(experimental)"></a>taintUniqueValue(experimental)</h3><p>阻止将唯一值传递给客户端组件, 例如 密码、密钥或令牌</p>
<ul>
<li>message  value 被传递给客户端组件时显示的消息</li>
<li>lifetime 指定 value 应该被污染多长时间的任何对象, 只要此对象仍然存在, 将阻止把 value 发送给任何客户端组件</li>
<li>value 具有高熵的字符串或字节的唯一序列</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">taintUniqueValue</span>(message, lifetime, value);</span><br></pre></td></tr></table></figure>

<h2 id="ReactDOM-Hook"><a href="#ReactDOM-Hook" class="headerlink" title="ReactDOM Hook"></a>ReactDOM Hook</h2><h3 id="useFormStatus-experimental"><a href="#useFormStatus-experimental" class="headerlink" title="useFormStatus(experimental)"></a>useFormStatus(experimental)</h3><p>提供上一次表单提交状态信息, 仅获取父级 form 的状态信息</p>
<ul>
<li>pending 标识父级 form 是否正在等待提交, 如果调用 useFormStatus 的组件未嵌套在 form 中, 总是返回 false</li>
<li>data 包含父级 form 正在提交的 formData 数据, 如果没有进行提交为 null</li>
<li>method  标识父级 form 使用 GET 或 POST 进行提交, 默认使用 GET</li>
<li>action 传递给父级 form 的 action 属性的函数引用, 如果没有父级 form 则为 null</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;pending, data, method, action&#125; = <span class="title function_">useFormStatus</span>();</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useFormStatus&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Submit</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;pending, data, method&#125; = <span class="title function_">useFormStatus</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">disabled</span>=<span class="string">&#123;pending&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;pending ? &#x27;提交...&#x27; : &#x27;提交&#x27;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;data ? `请求 $&#123;data.get(&#x27;username&#x27;)&#125;...` : &#x27;&#x27;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>method 为 &#123;method&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params">&#123;action&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#123;action&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Submit</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">action</span>=<span class="string">&#123;submitForm&#125;/</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>不会返回在同一组件中渲染的 form 的状态信息, 仅获取父级 form 的状态信息</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Form</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// useFormStatus 不会跟踪此组件中渲染的表单, pending 永远不会为 true</span></span><br><span class="line">  <span class="comment">// 需要将 useFormStatus 改成在 Form 组件的子组件中调用</span></span><br><span class="line">  <span class="keyword">const</span> &#123;pending&#125; = <span class="title function_">useFormStatus</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#123;submit&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ReactDOM-组件"><a href="#ReactDOM-组件" class="headerlink" title="ReactDOM 组件"></a>ReactDOM 组件</h2><h3 id="自定义-HTML-元素"><a href="#自定义-HTML-元素" class="headerlink" title="自定义 HTML 元素"></a>自定义 HTML 元素</h3><p>渲染一个带连字符的标签 如 <code>&lt;my-elment&gt;</code>, React 会认为渲染自定义 HTML 元素</p>
<ul>
<li>所有自定义元素的 props 都将被序列化为字符串, 并且总是使用属性(attribute)进行设置</li>
<li>自定义元素接受 <code>class</code> 而不是 <code>className</code>, 接受 <code>for</code> 而不是 <code>htmlFor</code></li>
<li>如果使用 is 属性渲染一个内置的浏览器 HTML 元素, 将被视为自定义元素</li>
</ul>
<h3 id="属性差异"><a href="#属性差异" class="headerlink" title="属性差异"></a>属性差异</h3><p>在 React 中，所有的 DOM 特性和属性（包括事件处理）都应该是小驼峰命名的方式。例如，与 HTML 中的 tabindex 属性对应的 React 的属性是 tabIndex。例外的情况是 <code>aria-*</code> 以及 <code>data-*</code> 属性，一律使用小写字母命名。比如, 你依然可以用 aria-label 作为 aria-label。</p>
<ul>
<li><p>dangerouslySetInnerHTML React 为浏览器 DOM 提供 innerHTML 的替换方案</p>
<ul>
<li>不能同时传递 children 和 dangerouslySetInnerHTML</li>
<li>直接设置 HTML 存在风险</li>
<li>key 为 __html</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createMarkup</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">__html</span>: <span class="string">&#x27;First &amp;middot; Second&#x27;</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">dangerouslySetInnerHTML</span>=<span class="string">&#123;createMarkup()&#125;</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>for JavaScript 中的保留字，React 中内置元素使用 htmlFor 代替</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;label htmlFor=<span class="string">&quot;htmlFor&quot;</span>&gt;htmlFor&lt;/label&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;htmlFor&quot;</span> <span class="attr">id</span>=<span class="string">&quot;htmlFor&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>suppressContentEditableWarning 此属性禁用 当 DOM 元素拥有 contentEditable 属性时，React 发出警告</p>
</li>
<li><p>suppressHydrationWarning 此属性禁用警告, 如果 React 服务器与客户端渲染不同的内容时发出警告</p>
</li>
</ul>
<h4 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h4><ul>
<li><p>React 不支持在 option 元素上传递 selected 属性</p>
</li>
<li><p>checked 控制复选框或单选按钮是否被选中</p>
</li>
<li><p>value 控制文本框、下拉框、文本域的输入文本</p>
</li>
</ul>
<p>以下属性仅在 <code>非受控元素</code> 中有效</p>
<ul>
<li>defaultChecked 指定复选框或单选按钮的初始值</li>
<li>defaultValue 指定文本框、下拉框、文本域的初始值</li>
</ul>
<h3 id="合成事件"><a href="#合成事件" class="headerlink" title="合成事件"></a>合成事件</h3><p>事件处理程序接收到一个 React 合成的事件对象</p>
<p><code>SyntheticEvent</code> 为 React 的事件包装器, 是所有事件的基类型</p>
<ul>
<li><p>事件: on + 事件名称 + Capture(捕获阶段触发)</p>
</li>
<li><p>事件处理器: handle + 事件名称</p>
</li>
<li><p>阻止事件冒泡手动调用 <code>e.stopPropagation()</code></p>
</li>
<li><p>阻止部分 html 元素的浏览器默认行为调用 <code>e.preventDefault()</code></p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleClickCapture</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">onClickCapture</span>=<span class="string">&#123;handleClickCapture&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><p>除了以下标准属性, React 针对不同事件额外附加了其他 属性, 如 ClipboardEvent 事件附加了 clipboardData</p>
<ul>
<li>bubbles 布尔值, 返回是否会在 DOM 中冒泡传播</li>
<li>cancelable 布尔值, 返回事件是否可以被取消</li>
<li>currentTarget DOM 节点, 返回当前事件处理程序所附加到的节点在 React 树中的位置</li>
<li>defaultPrevented 布尔值, 返回是否调用了 preventDefault</li>
<li>eventPhase 数字, 返回事件当前所处的阶段</li>
<li>isTrusted 布尔值, 返回事件是否由用户发起</li>
<li>target DOM 节点, 返回事件发生的节点(可能是远程子节点)</li>
<li>timestamp 数字, 返回事件发生的时间</li>
<li>nativeEvent DOM event 对象, 浏览器的原生事件对象</li>
</ul>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ul>
<li><p>preventDefault 阻止事件的默认浏览器行为</p>
</li>
<li><p>stopPropagation 阻止事件在 React 树中的传播</p>
</li>
<li><p>isDefaultPrevented 布尔值, 返回是否调用了 preventDefault 方法</p>
</li>
<li><p>isPropagationStopped 布尔值, 返回是否调用 stopPropagation 方法</p>
</li>
<li><p>persist 不适用 ReactDOM, 在 React Native 中, 调用此函数以读取事件后的属性</p>
</li>
<li><p>isPersistent 不适用 ReactDOM, 在 React Native 中, 返回是否调用了 persist</p>
</li>
</ul>
<h2 id="ReactDOM-API"><a href="#ReactDOM-API" class="headerlink" title="ReactDOM API"></a>ReactDOM API</h2><h3 id="createPortal"><a href="#createPortal" class="headerlink" title="createPortal"></a>createPortal</h3><p>允许将 JSX 作为 children 渲染到 DOM 的不同部分</p>
<ul>
<li>children React 可以渲染的任何内容</li>
<li>domNode 某个已经存在的 DOM 节点</li>
<li>key 用作 portal key 的独特字符串或数字</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createPortalDOM = <span class="title function_">createPortal</span>(children, domNode, key?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createPortal&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> createPortalDOM = <span class="title function_">createPortal</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>, <span class="variable language_">document</span>.<span class="property">body</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">List</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;createPortalDOM&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="flushSync"><a href="#flushSync" class="headerlink" title="flushSync"></a>flushSync</h3><p>允许强制 React 立即同步更新 DOM, 使用此方法可能严重影响应用程序的性能</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">flushSync</span>(callback);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRef, useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;flushSync&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> listRef = <span class="title function_">useRef</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> [text, setText] = <span class="title function_">useState</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> [todos, setTodos] = <span class="title function_">useState</span>([]); </span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleAdd</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> newTodo = &#123;<span class="attr">id</span>: nextId++, <span class="attr">text</span>: text&#125;;</span><br><span class="line">    <span class="comment">// 强制 React 立即同步更新 DOM</span></span><br><span class="line">    <span class="title function_">flushSync</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">      <span class="title function_">setText</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">      <span class="title function_">setTodos</span>([...todos, newTodo]);</span><br><span class="line">    &#125;);</span><br><span class="line">    listRef.<span class="property">current</span>.<span class="property">lastChild</span>.<span class="title function_">scrollIntoView</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="comment">/* ... */</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="findDOMNode-deprected"><a href="#findDOMNode-deprected" class="headerlink" title="findDOMNode(deprected)"></a>findDOMNode(deprected)</h3><p>React 18 开始, 使用 ref 代替</p>
<p>获取组件实例对用的浏览器 DOM 节点</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> domNode = <span class="title function_">findDOMNode</span>(componentInstance);</span><br></pre></td></tr></table></figure>

<h3 id="hydrate-deprected"><a href="#hydrate-deprected" class="headerlink" title="hydrate(deprected)"></a>hydrate(deprected)</h3><p>React 18 开始, 使用 <a href="#hydrateRoot">hydrateRoot</a> 代替</p>
<p>允许 React 17 及以下版本中使用 <code>react-dom/server</code> 生成的 HTML 内容作为浏览器 DOM 节点, 并在其中显示 React 组件</p>
<ul>
<li>reactNode 用于渲染现有的 HTML, 通常是 JSX 片段, 并且使用像 <code>renderToString(&lt;App/&gt;)</code> 的 ReactDOM Server 方法渲染</li>
<li>domNode 在服务器中被渲染为根节点的 DOM 元素</li>
<li>callback React 将在组件 hydrate 后调用</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">hydrate</span>(reactNode, domNode, callback?);</span><br></pre></td></tr></table></figure>

<h3 id="render-deprected"><a href="#render-deprected" class="headerlink" title="render(deprected)"></a>render(deprected)</h3><p>React 18 开始, 使用 <a href="#createRoot">createRoot</a> 代替</p>
<p>将一段 JSX 片段渲染到浏览器 DOM 容器节点中</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">render</span>(reactNode, domNode, callback?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;render&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">App</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;./App.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="unmountComponentAtNode-deprected"><a href="#unmountComponentAtNode-deprected" class="headerlink" title="unmountComponentAtNode(deprected)"></a>unmountComponentAtNode(deprected)</h3><p>React 18 开始, 使用 root.unmount 代替</p>
<p>从 DOM 中移除一个已挂载的 React 组件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">unmountComponentAtNode</span>(domNode);</span><br></pre></td></tr></table></figure>

<h3 id="preconnect-experimental"><a href="#preconnect-experimental" class="headerlink" title="preconnect(experimental)  "></a>preconnect(experimental) <em id="preconnect"></em> <!--markdownlint-disable-line--></h3><p>提前连接到一个期望从中加载资源的服务器</p>
<ul>
<li>对同一服务器进行多次调用 preconnect 具有与单次调用相同的结果</li>
<li>在浏览器中, 可以在任何情况下调用 preconnect</li>
<li>服务器端渲染时, 只有在渲染组件或在从渲染组件中发起的异步上下文中调用 preconnect 时才会生效, 任何其他调用都会被忽略</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">preconnect</span>(href);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;preconnect&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">AppRoot</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="comment">// 预连接到主机</span></span><br><span class="line">  <span class="title function_">preconnect</span>(<span class="string">&#x27;https://example.com&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="prefetchDNS-experimental"><a href="#prefetchDNS-experimental" class="headerlink" title="prefetchDNS(experimental)"></a>prefetchDNS(experimental)</h3><p>允许提前查找期望从中加载资源的服务器的 IP, 和 <a href="#preconnect">preconnect</a> 类似</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">prefetchDNS</span>(href);</span><br></pre></td></tr></table></figure>

<h3 id="preinit-experimental"><a href="#preinit-experimental" class="headerlink" title="preinit(experimental)  "></a>preinit(experimental) <em id="preinit"></em> <!--markdownlint-disable-line--></h3><blockquote>
<p>React 框架通常会内置资源处理方案, 不需要手动调用此 API</p>
</blockquote>
<p>预获取和评估样式表或外部脚本</p>
<ul>
<li><p>对于具有相同的 href 的多个 preinit 调用具有与单个调用相同的结果</p>
</li>
<li><p>在浏览器中, 可以在任何情况下调用 preinit</p>
</li>
<li><p>在服务器端渲染时, 只有在渲染组件或在从渲染组件中发起的异步上下文中调用 preinit 时才会生效, 任何其他调用都会被忽略</p>
</li>
<li><p>href 要下载并执行的资源的 url</p>
</li>
<li><p>options</p>
<ul>
<li>as 标识资源的类型, 可能的值 script, style</li>
<li>precedence 与样式表一起使用时必需, 指定样式表相对于其他样式表的插入位置, 可能的值 reset, low, meduim, high</li>
<li>crossOrigin 标识要使用的 CORS 策略, 可能的值为 anonymous, use-credentials</li>
<li>integrity 标识资源的加密哈希, 用于验证其真实性</li>
<li>nonce 标识使用严格 CSP(安全内容策略) 时允许资源的加密随机数</li>
<li>fetchPriority 建议获取资源的相对优先级, 可能的值为 auto(默认), high, low</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">preinit</span>(href, options);</span><br></pre></td></tr></table></figure>

<h3 id="preinitModule-experimental"><a href="#preinitModule-experimental" class="headerlink" title="preinitModule(experimental)  "></a>preinitModule(experimental) <em id="preinitModule"></em> <!--markdownlint-disable-line--></h3><blockquote>
<p>React 框架通常会内置资源处理方案, 不需要手动调用此 API</p>
</blockquote>
<p>预获取和评估 ESM 模块</p>
<p>执行时机参考 <a href="#preinit">preinit</a></p>
<ul>
<li>href 要下载并执行的模块的 url</li>
<li>options<ul>
<li>as 只能取值 script</li>
<li>crossOrigin 同 <a href="#preinit">preinit</a></li>
<li>integrity 同 <a href="#preinit">preinit</a></li>
<li>nonce 同 <a href="#preinit">preinit</a></li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">preinitModule</span>(href, options)</span><br></pre></td></tr></table></figure>

<h3 id="preload-experimental"><a href="#preload-experimental" class="headerlink" title="preload(experimental)"></a>preload(experimental)</h3><blockquote>
<p>React 框架通常会内置资源处理方案, 不需要手动调用此 API</p>
</blockquote>
<p>预获取期望使用的资源, 比如样式表、字体、外部脚本</p>
<p>执行时机和参数参考 <a href="#preinit">preinit</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">preload</span>(href, options);</span><br></pre></td></tr></table></figure>

<h3 id="preloadModule-experimental"><a href="#preloadModule-experimental" class="headerlink" title="preloadModule(experimental)"></a>preloadModule(experimental)</h3><blockquote>
<p>React 框架通常会内置资源处理方案, 不需要手动调用此 API</p>
</blockquote>
<p>预获取期望使用的 ESM 模块</p>
<p>执行时机和参数参考 <a href="#preinitModule">preinitModule</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">preloadModule</span>(href, options);</span><br></pre></td></tr></table></figure>

<h2 id="客户端-API"><a href="#客户端-API" class="headerlink" title="客户端 API"></a>客户端 API</h2><p><code>react-dom/client</code> API 允许在客户端(浏览器) 渲染 React 组件, 通常在应用程序项目顶层调用</p>
<h3 id="createRoot"><a href="#createRoot" class="headerlink" title="createRoot  "></a>createRoot <em id="createRoot"></em> <!--markdownlint-disable-line--></h3><p>允许在浏览器的 DOM 节点中创建根节点以显示 React 组件</p>
<ul>
<li><p>domNode 某个已经存在的 DOM 节点</p>
</li>
<li><p>options</p>
<ul>
<li>onCaughtError(experimental) 当 React 捕获到错误边界时调用</li>
<li>onUncaughtError(experimental) 当错误边界抛出了一个无法捕获的错误时调用</li>
<li>onRecoverableError 当 React 自动从错误中恢复时调用</li>
<li>identifierPrefix 一个字符串, React 使用此字符串作为 <a href="#useId">useId</a> 生成的 id 的前缀, 当在一个页面中使用多个根节点时可以避免冲突</li>
</ul>
</li>
<li><p>root.render(reactNode) 将一段 JSX 片段渲染为 React 组件并显示, 首次调用时 React 将清空根节点所有已经存在的 HTML</p>
</li>
<li><p>root.unmount() 销毁 React 根节点中的一个已经渲染的树</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> root = <span class="title function_">createRoot</span>(domNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createPortal&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createRoot&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>));</span><br><span class="line">root.<span class="title function_">render</span>(reactNode);</span><br></pre></td></tr></table></figure>

<h3 id="hydrateRoot"><a href="#hydrateRoot" class="headerlink" title="hydrateRoot  "></a>hydrateRoot <em id="hydrateRoot"></em> <!--markdownlint-disable-line--></h3><!-- 允许在先前路由 `react-dom/server` 生成的浏览器 HTML DOM 节点中展示 React 组件 -->
<p>用 hydrateRoot 函数将 React 连接到 React 在服务器端环境中渲染的 HTML 中</p>
<p>开发模式下, React 会在 hydrate 期间发出不匹配警告. 在不匹配的情况下, 不能保证内容差异会被修补, 出于性能原因, 这很重要, 因为在大多数应用程序中, 不匹配很少见, 因此验证所有标记将是非常昂贵而不可行的</p>
<ul>
<li><p>domNode 一个在服务器端渲染时呈现为根元素的 DOM 元素</p>
</li>
<li><p>reactNode 用于渲染已存在 HTML 的 React 节点, 通常是 JSX 片段, 并且使用像 <code>renderToPipeableStream(&lt;App/&gt;)</code> 的方法渲染</p>
</li>
<li><p>options 参数同 <a href="#createRoot">createRoot</a> 的 options</p>
</li>
<li><p>root.render(reactNode) 更新一个 hydrate 根组件中的 React 组件来渲染浏览器端 DOM 元素</p>
</li>
<li><p>root.unmount() 销毁 React 根节点内的渲染树</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> root = <span class="title function_">hydrateRoot</span>(domNode, reactNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useState, useEffect&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;hydreateRoot&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// eg1</span></span><br><span class="line"><span class="comment">// index.html</span></span><br><span class="line"><span class="comment">// 由 react-dom/server 生成的 HMTL 内容</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Is Server<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [isClient, setIsClient] = <span class="title function_">useState</span>(<span class="literal">false</span>);</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="title function_">setIsClient</span>(<span class="literal">true</span>);</span><br><span class="line">  &#125;,[]);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;isClient ? &#x27;Is Client&#x27; : &#x27;Is Server&#x27;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">hydreateRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>), <span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// eg2</span></span><br><span class="line"><span class="comment">// index.html</span></span><br><span class="line"><span class="comment">// 由 react-dom/server 生成的 HTML 内容</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello world! <span class="comment">&lt;!-- --&gt;</span>0<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;Type something here&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params">&#123;counter&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello world! &#123;counter&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">placeholder</span>=<span class="string">&quot;Type something here&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="title function_">hydrateRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>), <span class="language-xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">counter</span>=<span class="string">&#123;0&#125;/</span>&gt;</span></span>);</span><br><span class="line"><span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  root.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> <span class="attr">counter</span>=<span class="string">&#123;i&#125;/</span>&gt;</span></span>);</span><br><span class="line">  i++;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h2 id="服务端-API"><a href="#服务端-API" class="headerlink" title="服务端 API"></a>服务端 API</h2><p><code>react-dom/server</code> API 允许在服务器端将 React 组件渲染为 HTML, 仅在服务器端应用程序顶层调用</p>
<h3 id="Node-js-流服务器-API"><a href="#Node-js-流服务器-API" class="headerlink" title="Node.js 流服务器 API"></a>Node.js 流服务器 API</h3><h4 id="renderToNodeStream-deprected"><a href="#renderToNodeStream-deprected" class="headerlink" title="renderToNodeStream(deprected)"></a>renderToNodeStream(deprected)</h4><p>React 18 开始, 改用 <a href="#renderToPipeableStream">renderToPipeableStream</a></p>
<p>输出 HTML 字符串的 Node.js 只读流, 此方法会缓冲所有输出, 因此实际上它并没有提供任何流式传输的好处</p>
<p>在客户端使用 <a href="#hydrateRoot">hydrateRoot</a> 使服务器生成的 HTML 具有交互功能</p>
<ul>
<li>reactNode 要渲染为 HTML 的 React 节点</li>
<li>options<ul>
<li>identifierPrefix 字符串前缀, 由 <a href="#useId">useId</a> 生成的 id 使用</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stream = <span class="title function_">renderToNodeStream</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<h4 id="renderToPipeableStream"><a href="#renderToPipeableStream" class="headerlink" title="renderToPipeableStream  "></a>renderToPipeableStream <em id="renderToPipeableStream"></em> <!--markdownlint-disable-line--></h4><p>将一个 React 组件树渲染为管道化(pipeable)的 Node.js 流</p>
<p>在客户端使用 <a href="#hydrateRoot">hydrateRoot</a> 使服务器生成的 HTML 具有交互功能</p>
<ul>
<li><p>options</p>
<ul>
<li>bootstrapScriptContent 指定被放入 script 标签中作为其内容的字符串</li>
<li>bootstrapScripts 一个字符串数组, 将被转化为 script 标签嵌入页面</li>
<li>bootstrapModules 和 bootstrapScripts 类似, 但是嵌入页面的是 <code>&lt;script type=&quot;module&quot;&gt;</code></li>
<li>identifierPrefix 字符串前缀, 由 <a href="#useId">useId</a> 生成的 id 使用</li>
<li>namespaceURI 一个字符串, 指定与流相关联的 命名控件 URI, 默认是常规的 HTML, 可以指定 SVG</li>
<li>nonce 标识使用严格 CSP(安全内容策略) 时允许资源的加密随机数</li>
<li>onAllReady 函数, 在所有渲染完成时触发, 包括 shell 和 所有额外的 content, 可以代替 onShellReady 用于爬虫和静态内容生成</li>
<li>onShellReady 函数, 在 shell 初始化渲染后立即调用</li>
<li>onShellError 函数, 在 shell 发生错误渲染时调用</li>
<li>onError 函数, 出现异常错误时触发</li>
<li>progressiveChunkSize 一个块中的字节数</li>
</ul>
</li>
<li><p>返回一个包含了 pipe 和 abort 方法的对象</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;pipe, abort&#125; = <span class="title function_">renderToPipeableStream</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;renderToPipeableStream&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/server&#x27;</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;pipe, abort&#125; = <span class="title function_">renderTopipeableStream</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>, &#123;</span><br><span class="line">    <span class="attr">bootstrapScriptContent</span>: <span class="string">`window.assetMap = function()&#123; alert(&#x27;assetMap&#x27;) &#125;`</span>,</span><br><span class="line">    <span class="attr">bootstrapScripts</span>: [<span class="string">&#x27;./main.js&#x27;</span>],</span><br><span class="line">    <span class="title function_">onShellReady</span>(<span class="params"></span>)&#123;</span><br><span class="line">      response.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/html&#x27;</span>);</span><br><span class="line">      <span class="title function_">pipe</span>(response);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="renderToStaticNodeStream"><a href="#renderToStaticNodeStream" class="headerlink" title="renderToStaticNodeStream"></a>renderToStaticNodeStream</h4><p>将 Node.js 只读流渲染为非交互式 React 树, 无法 hydrate 交互功能</p>
<p>输出 HTML 字符串的 Node.js 只读流, 此方法会缓冲所有输出, 因此实际上它并没有提供任何流式传输的好处</p>
<p>此方法输出的 HTML 不能被客户端 hydrate 转换成具有交互功能</p>
<ul>
<li>options<ul>
<li>identifierPrefix 字符串前缀, 由 <a href="#useId">useId</a> 生成的 id 使用</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stream = <span class="title function_">renderToStaticNodeStream</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<h3 id="Web-流服务器-API"><a href="#Web-流服务器-API" class="headerlink" title="Web 流服务器 API"></a>Web 流服务器 API</h3><p>具有 web 流的环境中可用, 包括 浏览器, Deno, 以及一些现代 Edge 运行时</p>
<ul>
<li>ReadableStream</li>
<li>WritableStream</li>
<li>TransformStream</li>
</ul>
<h4 id="renderToReadableStream"><a href="#renderToReadableStream" class="headerlink" title="renderToReadableStream"></a>renderToReadableStream</h4><p>将 React 树渲染后发送至 web 流</p>
<p>参数配置参考 <a href="#renderToPipeableStream">renderToPipeableStream</a> 的 options</p>
<p>在客户端使用 <a href="#hydrateRoot">hydrateRoot</a> 使服务器生成的 HTML 具有交互功能</p>
<ul>
<li>返回一个 Promise<ul>
<li>如果 shell 渲染成功, 则 Promise 将 resolve 为 web 可读流</li>
<li>如果 shell 渲染失败, 则 Promise 将 reject</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> stream = <span class="title function_">renderToReadableStream</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;renderToReadableStream&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/server&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">handler</span>(<span class="params">request</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> stream = <span class="keyword">await</span> <span class="title function_">renderToReadableStream</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span>,&#123;</span><br><span class="line">    <span class="attr">bootstrapScripts</span>: [<span class="string">&#x27;./main.js&#x27;</span>],</span><br><span class="line">    <span class="attr">identifierPrefix</span>: <span class="string">&#x27;w&#x27;</span>,</span><br><span class="line">    <span class="title function_">onError</span>(<span class="params">error</span>)&#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">      <span class="title function_">logServerCrashReport</span>(error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Response</span>(stream, &#123;</span><br><span class="line">    <span class="attr">headers</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span>&#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="非流环境-API"><a href="#非流环境-API" class="headerlink" title="非流环境 API"></a>非流环境 API</h3><h4 id="renderToString"><a href="#renderToString" class="headerlink" title="renderToString"></a>renderToString</h4><p>将 React 树渲染为一个 HTML 字符串, 不支持流式传输或等待数据</p>
<p>在客户端使用 <a href="#hydrateRoot">hydrateRoot</a> 使服务器生成的 HTML 具有交互功能</p>
<ul>
<li><p>不完全支持 Suspense, 如果某个组件触发 Suspense, API 不会等待其内容解析完成, 将找到最近的 Suspense 边界并在 HTML 中渲染其 fallback 属性</p>
</li>
<li><p>options</p>
<ul>
<li>identifierPrefix 字符串前缀, 由 <a href="#useId">useId</a> 生成的 id 使用</li>
</ul>
</li>
<li><p>返回一个 HTML 字符串</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> html = <span class="title function_">renderToString</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;renderToString&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/server&#x27;</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> html = <span class="title function_">renderToString</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>);</span><br><span class="line">  response.<span class="title function_">send</span>(html);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="renderToStaticMarkup"><a href="#renderToStaticMarkup" class="headerlink" title="renderToStaticMarkup"></a>renderToStaticMarkup</h4><p>将非交互的 React 组件渲染成 HTML 字符串, 无法 hydrate 交互功能</p>
<ul>
<li><p>renderToStaticMarkup 的输出无法进行二次渲染, 仅需要呈现纯静态内容时使用</p>
</li>
<li><p>renderToStaticMarkup 对 Suspense 的支持有限, 如果一个组件触发了 Suspense, API 立即将后备方案作为 HTML 输出</p>
</li>
<li><p>renderToStaticMarkup 在浏览器中可以使用, 不建议在客户端代码中使用它</p>
</li>
<li><p>options</p>
<ul>
<li>identifierPrefix 字符串前缀, 由 <a href="#useId">useId</a> 生成的 id 使用</li>
</ul>
</li>
<li><p>返回一个 HTML 字符串</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> html = <span class="title function_">renderToStaticMarkup</span>(reactNode, options?);</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;renderToStaticMarkup&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/server&#x27;</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> html = <span class="title function_">renderToStaticMarkup</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>);</span><br><span class="line">  response.<span class="title function_">send</span>(html);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="React-Router"><a href="#React-Router" class="headerlink" title="React Router"></a>React Router</h2><h3 id="路由器"><a href="#路由器" class="headerlink" title="路由器"></a>路由器</h3><h4 id="不支持-data-APIs"><a href="#不支持-data-APIs" class="headerlink" title="不支持 data APIs"></a>不支持 data APIs</h4><ul>
<li><code>&lt;BrowserRouter&gt;</code></li>
<li><code>&lt;MemoryRouter&gt;</code></li>
<li><code>&lt;HashRouter&gt;</code></li>
<li><code>&lt;NativeRouter&gt;</code> 用于 React Native</li>
<li><code>&lt;StaticRouter&gt;</code></li>
</ul>
<h4 id="支持-data-APIs"><a href="#支持-data-APIs" class="headerlink" title="支持 data APIs"></a>支持 data APIs</h4><p>使用此方式创建路由, 同时启用用于数据获取的 loader, actions, fetchers 等 API</p>
<ul>
<li>createBrowserRouter</li>
<li>createMemoryRouter</li>
<li>createHashRouter</li>
<li>createStaticRouter</li>
</ul>
<h5 id="createBrowserRouter"><a href="#createBrowserRouter" class="headerlink" title="createBrowserRouter  "></a>createBrowserRouter <em id="createBrowserRouter"></em> <!--markdownlint-disable-line--></h5><ul>
<li>basename 基础路径</li>
<li>future 用于启用新版本语法的标记</li>
<li>hydrationData 当使用服务器端渲染时允许从服务器端获取数据</li>
<li>unstable_dataStrategy 低水平 API, 将会覆盖 React Router 内部的 loader, action 的执行</li>
<li>unstable_patchRoutesOnMis</li>
<li>window 用于区分环境, 对开发者工具或者测试来说非常有用</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>(routes, &#123;</span><br><span class="line">  <span class="attr">basename</span>: <span class="string">&#x27;/app&#x27;</span>,</span><br><span class="line">  <span class="attr">hydrationData</span>: &#123;</span><br><span class="line">    <span class="attr">root</span>: &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="createStaticHandler"><a href="#createStaticHandler" class="headerlink" title="createStaticHandler"></a>createStaticHandler</h5><p>通常用于服务器端渲染的 数据获取和提交, 配合 <code>createStaticRouter</code> 使用</p>
<ul>
<li>routes 路由信息</li>
<li>options<ul>
<li>basename</li>
<li>future</li>
<li>mapRouteProperties</li>
</ul>
</li>
</ul>
<p>返回值</p>
<ul>
<li>query() 执行当前请求的 action, loader 并返回 context 包含了渲染页面的所有数据<ul>
<li>request</li>
<li>opts<ul>
<li>routeId 如果需要调用不同的路由的 action 或 loader, 传入指定的 routeId</li>
<li>requestContext 将请求上下文信息传入 action 或 loader</li>
</ul>
</li>
</ul>
</li>
<li>dataRoutes 路由信息</li>
</ul>
<h5 id="createStaticRouter"><a href="#createStaticRouter" class="headerlink" title="createStaticRouter"></a>createStaticRouter</h5><ul>
<li>routes 路由信息</li>
<li>context 请求的上下文信息</li>
<li>ops<ul>
<li>future</li>
</ul>
</li>
</ul>
<p>返回值</p>
<ul>
<li>router</li>
</ul>
<h5 id="StaticRouterProvider"><a href="#StaticRouterProvider" class="headerlink" title="StaticRouterProvider"></a>StaticRouterProvider</h5><p>接收来自 <code>createStaticHandler</code> 的 context 和  <code>createStaticRouter</code> 的 router, 用于服务器端渲染</p>
<ul>
<li>router 通过 createStaticRouter 创建的路由</li>
<li>context 接收来自 staticHandler.query 的结果作为数据</li>
<li>hydrate 是否禁用客户端自动数据连接</li>
<li>nonce 标识使用严格 CSP(安全内容策略) 时允许资源的加密随机数</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">StrictMode</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createStaticHandler, createStaticRouter, <span class="title class_">StaticRouterProvider</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;renderToString&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/server&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [];</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">renderHtml</span>(<span class="params">req</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;query, dataRoutes&#125; = <span class="title function_">createStaticHandler</span>(routes);</span><br><span class="line">  <span class="keyword">const</span> fetchRequest = <span class="title function_">createFetchRequest</span>(req);</span><br><span class="line">  <span class="keyword">const</span> context = <span class="keyword">await</span> <span class="title function_">query</span>(fetchRequest);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(context <span class="keyword">instanceof</span> <span class="title class_">Response</span>)&#123;</span><br><span class="line">    <span class="keyword">throw</span> context;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> router = <span class="title function_">createStaticRouter</span>(dataRoutes, context);</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">renderToString</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">StaticRouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;</span> <span class="attr">context</span>=<span class="string">&#123;context&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="RouterProvider"><a href="#RouterProvider" class="headerlink" title="RouterProvider"></a>RouterProvider</h5><p>路由根组件, 所有的路由对象或者 Data APIS 都通过此组件注入 React 应用程序</p>
<ul>
<li>router</li>
<li>fallbackElement 后备内容</li>
<li>future</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">StrictMode</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createRoot&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createBrowserRouer, createRoutesFromElements, <span class="title class_">RouterProvider</span>, <span class="title class_">Route</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 JSX 元素创建路由</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>(</span><br><span class="line">  <span class="title function_">createRoutesFromElements</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">path</span>=<span class="string">&quot;/&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Root</span>/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      errorElement=&#123;<span class="tag">&lt;<span class="name">ErrorPage</span>/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      loader=&#123;rootLoader&#125;</span></span><br><span class="line"><span class="language-xml">      action=&#123;rootAction&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">index</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Dashboard</span>/&gt;</span>&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">      &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">);</span><br><span class="line"><span class="comment">// 使用对象形式创建路由</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Root</span>/&gt;</span></span>,</span><br><span class="line">    <span class="attr">loader</span>: rootLoader,</span><br><span class="line">    <span class="attr">action</span>: rootAction,</span><br><span class="line">    <span class="attr">errorElement</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">ErrorPage</span>/&gt;</span></span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;<span class="attr">index</span>: <span class="literal">true</span>, <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Dashboard</span>/&gt;</span></span>&#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">])</span><br><span class="line"><span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)).<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">RouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;</span> <span class="attr">fallbackElement</span>=<span class="string">&#123;</span>&lt;<span class="attr">SpinnerOfDom</span>/&gt;</span>&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="Route"><a href="#Route" class="headerlink" title="Route  "></a>Route <em id="Route"></em> <!--markdownlint-disable-line--></h3><p>React Router 创建路由的 <a href="#internal-component">内置组件</a>, data APIs 由类似 <a href="#createBrowserRouter">createBrowserRouter</a> 创建的路由才有效</p>
<ul>
<li><p>index 标识当路由未匹配到时默认匹配</p>
</li>
<li><p>path 路由</p>
</li>
<li><p>caseSensitive  path 是否区分大小写</p>
</li>
<li><p>element/Component 当路由匹配时渲染</p>
</li>
<li><p>handle 当前路由的任意数据, 作用同 <a href="#useMatches">useMatches</a></p>
</li>
<li><p>使用对象方式创建</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createBrowserRouter&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Root</span> /&gt;</span></span>,</span><br><span class="line">    <span class="attr">errorElement</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">ErrorPage</span> /&gt;</span></span>,</span><br><span class="line">    <span class="attr">loader</span>: <span class="keyword">async</span> (&#123;request, params&#125;) =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">fetch</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">action</span>: <span class="keyword">async</span> (&#123;request&#125;) =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">update</span>(<span class="keyword">await</span> request.<span class="title function_">formData</span>());</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">children</span>: []</span><br><span class="line">  &#125;</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 JSX 元素创建</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createBrowserRouter, createRoutesFromElements, <span class="title class_">Route</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>(<span class="title function_">createRoutesFromElements</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">path</span>=<span class="string">&quot;/&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Root</span>/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    errorElement=&#123;<span class="tag">&lt;<span class="name">ErrorPage</span>/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    lazy=&#123;() =&gt; import(&#x27;./a&#x27;)&#125;</span></span><br><span class="line"><span class="language-xml">    loader=&#123;async (&#123;request, params&#125;) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">      return fetch();</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    action=&#123;async (&#123;request&#125;) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">      return update(await request.formData());</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  &gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">index</span> <span class="attr">path</span>=<span class="string">&quot;&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">DashBoard</span>/&gt;</span>&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">))</span><br></pre></td></tr></table></figure>

<h4 id="Route-action"><a href="#Route-action" class="headerlink" title="Route.action  "></a>Route.action <em id="Route.action"></em> <!--markdownlint-disable-line--></h4><p>当 React Router 抽象了异步 UI 和重新验证的复杂性时, 为应用程序提供了一种使用简单的 HTML 和 HTTP 语句执行数据更改的方法</p>
<p>每当应用程序向路由发送 non-get(POST, PUT, PATCH, DELETE) 请求的时候都会被调用</p>
<p>动态路由参数分别传递给 <a href="#Route.loader">loader</a>, <a href="#useParams">useMatch</a>, <a href="#useParams">useParams</a></p>
<ul>
<li>request  request 请求实例</li>
<li>params 动态路由参数</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createBrowserRouter, createRoutesFromElements, <span class="title class_">Route</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>(</span><br><span class="line">  <span class="title function_">createRoutesFromElements</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">path</span>=<span class="string">&quot;/projects/:id/delete&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">action</span>=<span class="string">&#123;async</span> (&#123;<span class="attr">request</span>, <span class="attr">params</span>&#125;) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        console.log(params.id);</span></span><br><span class="line"><span class="language-xml">        const formData = request.formData();</span></span><br><span class="line"><span class="language-xml">        return deleteProjectById(params.id);</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      &#123;/* .... */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="Route-loader"><a href="#Route-loader" class="headerlink" title="Route.loader  "></a>Route.loader <em id="Route.loader"></em> <!--markdownlint-disable-line--></h4><p>组件渲染之前调用定义的 loader 函数并将返回的数据传入 React 元素</p>
<p>动态路由参数分别传递给 <a href="#Route.action">action</a>, <a href="#useMatch">useMatch</a>, <a href="#useParams">useParams</a></p>
<ul>
<li>params 动态路由参数</li>
<li>request request 请求实例</li>
<li>hydrate 服务器端渲染时处理 hydrate 数据</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createBrowserRouter, createRoutesFromElements, <span class="title class_">Route</span>, useLoaderData&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>(</span><br><span class="line">  <span class="title function_">createRoutesFromElements</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">path</span>=<span class="string">&quot;/projects/:id&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Projects</span>/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      loader=&#123;async (&#123;request, params&#125;) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        console.log(params.id);</span></span><br><span class="line"><span class="language-xml">        const res = await fetch();</span></span><br><span class="line"><span class="language-xml">        if(res.status == 404) &#123;</span></span><br><span class="line"><span class="language-xml">          throw new Response(&#x27;Not Found&#x27;, &#123;status: 404&#125;);</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">        return res.json();</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Projects</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> projects = <span class="title function_">useLoaderData</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    projects</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Route-lazy"><a href="#Route-lazy" class="headerlink" title="Route.lazy"></a>Route.lazy</h4><p>路由懒加载</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createBrowserRouter, createRoutesFromElements, <span class="title class_">Route</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>(</span><br><span class="line">  <span class="title function_">createRoutesFromElements</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">path</span>=<span class="string">&quot;/&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Layout</span>/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;a&quot;</span> <span class="attr">lazy</span>=<span class="string">&#123;()</span> =&gt;</span> import(&#x27;./a&#x27;)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;b&quot;</span> <span class="attr">lazy</span>=<span class="string">&#123;()</span> =&gt;</span> import(&#x27;./b&#x27;)&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="Route-shouldRevalidate"><a href="#Route-shouldRevalidate" class="headerlink" title="Route.shouldRevalidate"></a>Route.shouldRevalidate</h4><p>如果定义了此函数, 将在路由的 loader 调用之前执行此函数验证新数据, 如果返回 false 则不在调用 loader 并且保持当前页面数据不变</p>
<h4 id="Route-errorElement-errorBoundary"><a href="#Route-errorElement-errorBoundary" class="headerlink" title="Route.errorElement/errorBoundary"></a>Route.errorElement/errorBoundary</h4><p>当组件的 loader, action 或者在渲染过程中抛出错误时代替 element 显示</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createBrowserRouter, createRoutesFromElements, <span class="title class_">Route</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>(</span><br><span class="line">  <span class="title function_">createRoutesFromElements</span>(</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">errorElement</span>=<span class="string">&#123;</span>&lt;<span class="attr">ErrorElement</span>/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      loader=&#123;async (&#123;request, params&#125;) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">        const res = await fetch();</span></span><br><span class="line"><span class="language-xml">        if(res.status == 404)&#123;</span></span><br><span class="line"><span class="language-xml">          throw new Response(&#x27;Not Found&#x27;, &#123;status: 404&#125;);</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">        const json = res.json();</span></span><br><span class="line"><span class="language-xml">        return &#123;json&#125;</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;</span></span><br><span class="line"><span class="language-xml">    &gt;</span></span><br><span class="line"><span class="language-xml">      &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="Route-hydrateFallbackElement-hydrateFallback"><a href="#Route-hydrateFallbackElement-hydrateFallback" class="headerlink" title="Route.hydrateFallbackElement/hydrateFallback"></a>Route.hydrateFallbackElement/hydrateFallback</h4><p>初始化服务器端渲染的内容没有被 hyrate 的组件, 如果未使用类似 <a href="#createBrowserRouter">createBrowserRouter</a> 创建的路由则无效, 通常 SSR 的应用不会使用此项</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createBrowserRouter&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">loader</span>: rootLoader,</span><br><span class="line">    <span class="title class_">Component</span>: <span class="title class_">Root</span>,</span><br><span class="line">    <span class="attr">children</span>:[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="string">&#x27;invoice&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;invoice/:id&#x27;</span>,</span><br><span class="line">        <span class="attr">loader</span>: invoiceLoader,</span><br><span class="line">        <span class="title class_">Component</span>: <span class="title class_">Invoice</span>,</span><br><span class="line">        <span class="attr">hydrateFallback</span>: <span class="title class_">InvoiceFallback</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">],</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">future</span>:&#123;</span><br><span class="line">    <span class="attr">v7_partialHydration</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">hydrationData</span>:&#123;</span><br><span class="line">    <span class="attr">root</span>:&#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="React-Router-内置组件"><a href="#React-Router-内置组件" class="headerlink" title="React Router 内置组件  "></a>React Router 内置组件 <em id="internal-component"></em> <!--markdownlint-disable-line--></h3><h4 id="Await"><a href="#Await" class="headerlink" title="Await  "></a>Await <em id="Await"></em> <!--markdownlint-disable-line--></h4><p>用于呈现具有自动错误处理功能的延迟值</p>
<ul>
<li>children React 元素或者一个函数</li>
<li>resolve 返回一个 Promise 当延迟值被 resolve 后渲染</li>
<li>errorElement 当 resolve 被 reject 后渲染</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Await</span>, useLoaderData, defer, <span class="title class_">Route</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">loader</span>=<span class="string">&#123;async</span> () =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">    let book = await getBook();</span></span><br><span class="line"><span class="language-xml">    let reviews = getviews();</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    return defer(&#123;book, reviews&#125;);</span></span><br><span class="line"><span class="language-xml">  &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  element=&#123;<span class="tag">&lt;<span class="name">Book</span>/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">&gt;</span></span><br><span class="line"><span class="language-xml">  &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Book</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;book, reviews&#125; = <span class="title function_">useLoaderData</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Await</span> <span class="attr">resolve</span>=<span class="string">&#123;reviews&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Review</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Await</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Form"><a href="#Form" class="headerlink" title="Form"></a>Form</h4><p>围绕普通 HTML 表单的包装器, 模拟浏览器进行客户端路由和数据更改</p>
<ul>
<li>action</li>
<li>method</li>
<li>navigate 标识表单默认提交行为提交之后的动作是否跳转</li>
<li>fetchKey</li>
<li>replace 标识表单提交行为替换当前历史记录栈</li>
<li>relative 标识表单提交的后的跳转路径</li>
<li>reloadDocument 标识跳过 React Router 的表单提交行为并使用浏览器内置的表单默认行为</li>
<li>state</li>
<li>preventScrollReset 标识表单提交行为是否滚动页面位置</li>
</ul>
<h4 id="Link"><a href="#Link" class="headerlink" title="Link  "></a>Link <em id="Link"></em> <!--markdownlint-disable-line--></h4><p>路由导航</p>
<ul>
<li>relative 相对路径, 默认为 Route 的相对层级</li>
<li>preventScrollRest 标识是否滚动到页面顶部</li>
<li>replace 标识是否替换当前历史记录栈</li>
<li>state 任何状态</li>
<li>reloadDocument</li>
</ul>
<h4 id="NavLink"><a href="#NavLink" class="headerlink" title="NavLink"></a>NavLink</h4><p>特殊的 Link, 可以标识当前活动状态的导航</p>
<ul>
<li>className 通过函数自定义样式</li>
<li>style 通过函数自定义样式</li>
<li>children</li>
<li>end 改变路由匹配逻辑, 当前路由是否以 to 结尾</li>
<li>caseSensitive 是否区分大小写</li>
<li>aria-current</li>
<li>reloadDocument</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">NavLink</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">NavLink</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">to</span>=<span class="string">&quot;/message&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">  <span class="attr">className</span>=<span class="string">&#123;(&#123;isActive,</span> <span class="attr">isPending</span>, <span class="attr">isTransitioning</span>&#125;) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">    return isPending ? &#x27;pending&#x27; : isActive ? &#x27;active&#x27; : &#x27;&#x27;</span></span><br><span class="line"><span class="language-xml">  &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  style=&#123;(&#123;isActive, isPending, isTransitioning&#125;) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">    return &#123;</span></span><br><span class="line"><span class="language-xml">      fontWeight: isActive ? &#x27;bold&#x27; : &#x27;&#x27;,</span></span><br><span class="line"><span class="language-xml">      color: isPending ? &#x27;red&#x27; : &#x27;black&#x27;,</span></span><br><span class="line"><span class="language-xml">      viewTransitionName: isTransitioning ? &#x27;slide&#x27; : &#x27;&#x27;</span></span><br><span class="line"><span class="language-xml">    &#125;</span></span><br><span class="line"><span class="language-xml">  &#125;&#125;</span></span><br><span class="line"><span class="language-xml">/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Navigate"><a href="#Navigate" class="headerlink" title="Navigate"></a>Navigate</h4><p>当组件渲染后改变当前的路由, 通常用在 class 组件中, 建议使用 <a href="#useNavigate">useNavigate</a> Hook</p>
<ul>
<li>to 跳转的目标路由</li>
<li>replace 是否使用替换模式</li>
<li>state 任何状态</li>
<li>relative</li>
</ul>
<h4 id="Outlet"><a href="#Outlet" class="headerlink" title="Outlet"></a>Outlet</h4><p>渲染嵌套子路由</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">DashBoard</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>DashBoard<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;/* ... */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Outlet</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">DashBoard</span>/&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">path</span>=<span class="string">&quot;message&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">DashBoardMessage</span>/&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">        /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;tasks&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">DashBoardTasks</span>/&gt;</span>&#125;/&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Route-1"><a href="#Route-1" class="headerlink" title="Route"></a><a href="#Route">Route</a></h4><p>React Router <a href="#internal-component">内置组件</a></p>
<h4 id="Routes"><a href="#Routes" class="headerlink" title="Routes"></a>Routes</h4><p>匹配组件内的 Route, 通常用于不使用 <a href="#createBrowserRouter">createBrowserRouter</a> 创建的 Route</p>
<h4 id="ScrollRestoration"><a href="#ScrollRestoration" class="headerlink" title="ScrollRestoration"></a>ScrollRestoration</h4><p>在渲染完成之后模拟浏览器在位置更改时的滚动恢复, 以确保滚动位置恢复到正确的位置</p>
<h3 id="React-Router-内置-Hook"><a href="#React-Router-内置-Hook" class="headerlink" title="React Router 内置 Hook"></a>React Router 内置 Hook</h3><h4 id="useActionData"><a href="#useActionData" class="headerlink" title="useActionData"></a>useActionData</h4><p>获取上一个导航操作结果的返回值, 如果没有提交操作则返回 undefined</p>
<h4 id="useAsyncError"><a href="#useAsyncError" class="headerlink" title="useAsyncError"></a>useAsyncError</h4><p>获取最近的 <a href="#Await">Await</a> 组件被 rejection 的结果</p>
<h4 id="useAsyncValue"><a href="#useAsyncValue" class="headerlink" title="useAsyncValue"></a>useAsyncValue</h4><p>获取最近的 <a href="#Await">Await</a> 组件被 resolved 的结果</p>
<h4 id="useBeforeUnload"><a href="#useBeforeUnload" class="headerlink" title="useBeforeUnload"></a>useBeforeUnload</h4><p>当用户离开页面时 (window.onbeforeunload) 保存重要的数据</p>
<h4 id="useBlocker"><a href="#useBlocker" class="headerlink" title="useBlocker"></a>useBlocker</h4><p>阻止用户离开当前页面, 并呈现自定义 UI 提示用户允许确认导航</p>
<ul>
<li>state 当前 blocker 的状态<ul>
<li>unblocked 空闲没有阻止状态</li>
<li>blocked 阻止状态</li>
<li>proceeding 正在从阻断器中前进</li>
</ul>
</li>
<li>proceed() 允许跳转</li>
<li>reset() 重置 blocker 状态并留在当前位置</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> blocker = <span class="title function_">useBlocker</span>();</span><br></pre></td></tr></table></figure>

<h4 id="useFetcher"><a href="#useFetcher" class="headerlink" title="useFetcher"></a>useFetcher</h4><p>不想在更改 URL 的情况下调用 <a href="#Route.loader">loader</a>, <a href="#Route.action">action</a>获取页面的数据并重新验证, 或者需要同时进行多个更新</p>
<p>与服务器的许多交互不是导航事件, useFetcher 允许将 UI 插入到操作或 <a href="#Route.loader">loader</a> 中而不引起导航</p>
<ul>
<li><p>key 默认为 内置组件 生成唯一的 key</p>
</li>
<li><p>fetcher.Form 像 Form <a href="#internal-component">内置组件</a> 一样, 只是不会引起导航</p>
</li>
<li><p>fetcher.state 标识当前 Fetcher 的状态</p>
<ul>
<li>idle 空闲</li>
<li>submiting 由 fetcher 使用 post, put, patch, delete 提交正在调用路由操作</li>
<li>loading fetcher 正在调用 fetcher.load 或者在单独提交或调用用 <code>useRevalidator</code> 之后重新验证</li>
</ul>
</li>
<li><p>fetcher.data 获取从 <a href="#Route.loader">loader</a> 或 <a href="#Route.action">action</a> 加载的数据</p>
</li>
<li><p>fetcher.formData 当使用 fetcher.Form 和 <code>fetcher.submit()</code> 时, formData 可用</p>
</li>
<li><p>fetcher.json 当使用 <code>fetcher.submit(data, &#123;formEnctype: &#39;application/json&#39;&#125;)</code> 提交时可用</p>
</li>
<li><p>fetcher.text 当使用 <code>fetcher.submit(data, &#123;formEnctype: &#39;text/plain&#39;&#125;)</code> 提交时可用</p>
</li>
<li><p>fetcher.formAction 提交时的 form 的 url</p>
</li>
<li><p>fetcher.formMethod 提交时的方法 get, post, put, patch, delete</p>
</li>
<li><p>fetcher.load(href, options) 从 <a href="#Route.loader">loader</a> 中获取数据</p>
</li>
<li><p>fetcher.submit(data, options?) 包含了 <a href="#useSubmit">useSubmit</a> 调用的实例, 接收和 <a href="#useSubmit">useSubmit</a> 相同的参数</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useEffect&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useFetcher&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SomeCompoent</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> fetcher = <span class="title function_">useFetcher</span>(&#123;<span class="attr">key</span>: <span class="string">&#x27;new-key&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    fetcher.<span class="title function_">submit</span>(data, options);</span><br><span class="line">    fetcher.<span class="title function_">load</span>(href);</span><br><span class="line">  &#125;,[fetcher]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染的表单不会引起导航 </span></span><br><span class="line">  <span class="keyword">return</span> （</span><br><span class="line">    &lt;fetcher.<span class="property">Form</span> action=<span class="string">&quot;/fetcher-action&quot;</span> method=<span class="string">&#x27;post&#x27;</span>&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">onclick</span>=<span class="string">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">        if(fetcher.state === &#x27;idle&#x27; &amp;&amp; !fetcher.data)&#123;</span></span><br><span class="line"><span class="language-xml">          fetcher.submit(fetcher.formData?.get(&#x27;username&#x27;), &#123;formEnctype: &#x27;application/json&#x27;&#125;);</span></span><br><span class="line"><span class="language-xml">        &#125;</span></span><br><span class="line"><span class="language-xml">      &#125;&#125;&gt;Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>fetcher.formAction &#123;fetcher.formAction&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>fetcher.formMethod &#123;fetcher.formMethod&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">      &#123;fetcher.<span class="property">json</span> ? (<span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;fetcher.json&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>) : (<span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>json: null<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>)&#125;</span><br><span class="line">      &#123;fetcher.<span class="property">data</span> ? (<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;fetcher.data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>) : (<span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>loading data...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)&#125;</span><br><span class="line">    &lt;/fetcher.<span class="property">Form</span>&gt;</span><br><span class="line">  ）  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useFetchers"><a href="#useFetchers" class="headerlink" title="useFetchers"></a>useFetchers</h4><p>获取除了 load, submit, Form 属性的 fetcher 数组</p>
<h4 id="useFormAction"><a href="#useFormAction" class="headerlink" title="useFormAction"></a>useFormAction</h4><p>用在 Form <a href="#internal-component">内置组件</a> 内部自动解析当前路由的默认和相关操作</p>
<ul>
<li>可以直接计算当前的 formAction</li>
<li>也可以用在 <a href="#useSubmit">useSubmit</a> 或者 <code>fetcher.submit</code> 中</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useFormAction&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">DeleteButton</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> formAction = <span class="title function_">useFormAction</span>(<span class="string">&#x27;destroy&#x27;</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">formAction</span>=<span class="string">&#123;formAction&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">formMethod</span>=<span class="string">&quot;post&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      Delete</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> submit = <span class="title function_">useSubmit</span>();</span><br><span class="line"><span class="keyword">const</span> formAction = <span class="title function_">useFormAction</span>(<span class="string">&#x27;delete&#x27;</span>);</span><br><span class="line"><span class="title function_">submit</span>(formData, &#123;formAction&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="useHref"><a href="#useHref" class="headerlink" title="useHref"></a>useHref</h4><h4 id="useInRouterContext"><a href="#useInRouterContext" class="headerlink" title="useInRouterContext"></a>useInRouterContext</h4><p>返回组件是否在 Router 的上下文环境中渲染的</p>
<h4 id="useLinkClickHandler"><a href="#useLinkClickHandler" class="headerlink" title="useLinkClickHandler"></a>useLinkClickHandler</h4><p>获取 Link 的 click 事件句柄</p>
<h4 id="useLoaderData"><a href="#useLoaderData" class="headerlink" title="useLoaderData"></a>useLoaderData</h4><p>获取路由 <a href="#Route.loader">loader</a> 返回的数据, 当路由 loader 被调用之后, 数据将自动重新验证并从 loader 中返回最新结果</p>
<p>useLoaderData 不会启动获取, 只读取 React Router 内部管理的结果</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">StrictMode</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createRoot&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useLoaderData, createBrowserRouter, createRoutesFromElements, <span class="title class_">RouterProvider</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Albums</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> albums = <span class="title function_">useLoaderData</span>();</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Albums<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">createBrowserRouter</span>(<span class="title function_">createRoutesFromElements</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Route</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">path</span>=<span class="string">&quot;/&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Albums</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">    loader=&#123;async (&#123;request, params&#125;) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">      return fakeFecth();</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;</span></span><br><span class="line"><span class="language-xml">  /&gt;</span></span><br><span class="line">));</span><br><span class="line"><span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)).<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">RouterProvider</span> <span class="attr">router</span>=<span class="string">&#123;router&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">StrictMode</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="useLocation"><a href="#useLocation" class="headerlink" title="useLocation"></a>useLocation</h4><p>获取当前 location 的对象</p>
<ul>
<li>location.hash</li>
<li>location.key</li>
<li>location.pathname</li>
<li>location.search</li>
<li>location.state 通过 <a href="#Link">&lt;Link state/&gt;</a> 或者 <a href="#useNavigate">navigate</a> 创建的</li>
</ul>
<h4 id="useMatch"><a href="#useMatch" class="headerlink" title="useMatch  "></a>useMatch <em id="useMatch"></em> <!--markdownlint-disable-line--></h4><p>返回给定路径相对于当前位置上匹配的数据</p>
<p>动态路由参数分别传递给 <a href="#Route.loader">loader</a>, <a href="#Route.action">action</a>, <a href="#useParams">useParams</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useMatch, useParams&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Random</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> match = <span class="title function_">useMatch</span>(<span class="string">&#x27;/projects/:projectId/tasks/:taskId&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> params = <span class="title function_">useParams</span>();</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(match.<span class="property">params</span>.<span class="property">projectId</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(match.<span class="property">params</span>.<span class="property">taskId</span>);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params.<span class="property">projectId</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params.<span class="property">taskId</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useMatches"><a href="#useMatches" class="headerlink" title="useMatches  "></a>useMatches <em id="useMatches"></em> <!--markdownlint-disable-line--></h4><p>获取当前页面匹配到的路由信息</p>
<h4 id="useNavigate"><a href="#useNavigate" class="headerlink" title="useNavigate  "></a>useNavigate <em id="useNavigate"></em> <!--markdownlint-disable-line--></h4><p>返回一个 navigate 函数, 能够以编程式导航, 该函数接收两个参数</p>
<ul>
<li>to 跳转的目标路由</li>
<li>options<ul>
<li>replace</li>
<li>state</li>
<li>preventScrollReset</li>
<li>relative</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useNavigate&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useLogoutTimer</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> userIsInactive = <span class="title function_">useFakeInactive</span>();</span><br><span class="line">  <span class="keyword">const</span> navigate = <span class="title function_">useNavigate</span>();</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(userIsInactive)&#123;</span><br><span class="line">      fake.<span class="title function_">logout</span>();</span><br><span class="line">      <span class="title function_">naviagte</span>(<span class="string">&#x27;/session-time-out&#x27;</span>, &#123;<span class="attr">state</span>: &#123;<span class="attr">token</span>: <span class="string">&#x27;token&#x27;</span>&#125;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,[userIsInactive]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useNavigation"><a href="#useNavigation" class="headerlink" title="useNavigation"></a>useNavigation</h4><p>获取当前页面的所有导航信息</p>
<ul>
<li>navigation.state</li>
<li>navigation.location</li>
<li>navigation.formData</li>
<li>navigation.json</li>
<li>navigation.text</li>
<li>navigation.formAction</li>
<li>navigation.formMethod</li>
<li>navigation.formEnctype</li>
</ul>
<h4 id="useNavigationType"><a href="#useNavigationType" class="headerlink" title="useNavigationType"></a>useNavigationType</h4><p>返回当前页的导航类型</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">NavigationType</span> = <span class="string">&#x27;POP&#x27;</span> | <span class="string">&#x27;PUSH&#x27;</span> | <span class="string">&#x27;REPLACE&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h4 id="useParams"><a href="#useParams" class="headerlink" title="useParams  "></a>useParams <em id="useParams"></em> <!--markdownlint-disable-line--></h4><p>返回当前 url 中被 Route 匹配到的动态路由参数对象</p>
<p>动态路由参数分别传递给 <a href="#Route.loader">loader</a>, <a href="#Route.action">action</a>, <a href="#useMatch">useMatch</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Books</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;id&#125; = <span class="title function_">useParams</span>();</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="title class_">Route</span></span><br><span class="line">  path=<span class="string">&quot;/books/:id&quot;</span></span><br><span class="line">  element=&#123;<span class="language-xml"><span class="tag">&lt;<span class="name">Books</span>/&gt;</span></span>&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h4 id="useResolvedPath"><a href="#useResolvedPath" class="headerlink" title="useResolvedPath"></a>useResolvedPath</h4><p>返回给定 to 相对于当前位置的 pathname</p>
<h4 id="useRevalidator"><a href="#useRevalidator" class="headerlink" title="useRevalidator"></a>useRevalidator</h4><p>返回一个验证器对象, 允许重新验证数据</p>
<ul>
<li>revalidator.state</li>
<li>revalidator.revalidate()</li>
</ul>
<h4 id="useRouteError"><a href="#useRouteError" class="headerlink" title="useRouteError  "></a>useRouteError <em id="useRouteError"></em> <!--markdownlint-disable-line--></h4><p>用在 errorElement 内部, 捕获由 <a href="#Route.action">action</a>, <a href="#Route.loader">loader</a>, 或者渲染期间抛出的错误</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRouteError, isRouteErrorResponse, <span class="title class_">Route</span>, json&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ErrorBoundary</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> error = <span class="title function_">useRouteError</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_">isRouteErrorResponse</span>(error))&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Oops!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;error.status&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;error.statusText&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;error.data?.message &amp;&amp; <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;error.data.message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Oops<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;<span class="title class_">Route</span></span><br><span class="line">  errorElement=&#123;<span class="language-xml"><span class="tag">&lt;<span class="name">ErrorBoundary</span>/&gt;</span></span>&#125;</span><br><span class="line">  action=&#123;<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="title function_">json</span>(</span><br><span class="line">      &#123;<span class="attr">message</span>: <span class="string">&#x27;email is required&#x27;</span> &#125;,</span><br><span class="line">      &#123;<span class="attr">status</span>: <span class="number">400</span>&#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h4 id="useRouteLoaderData"><a href="#useRouteLoaderData" class="headerlink" title="useRouteLoaderData"></a>useRouteLoaderData</h4><p>路由树上任何位置的当前渲染路线上的数据都可用, 对于树深层需要来自更高层路由的数据的组件以及需要树深层的子路由的数据的父路由非常有用</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useRouteLoaderData&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SomeComp</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> user = <span class="title function_">useRouteLoaderData</span>(<span class="string">&#x27;root&#x27;</span>);</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">createBrowserRouter</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">loader</span>: <span class="function">() =&gt;</span> <span class="title function_">fetchUser</span>(),</span><br><span class="line">    <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">Root</span> /&gt;</span></span></span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">path</span>: <span class="string">&#x27;jobs/:jobId&#x27;</span>,</span><br><span class="line">        <span class="attr">loader</span>: loaderJob,</span><br><span class="line">        <span class="attr">element</span>: <span class="language-xml"><span class="tag">&lt;<span class="name">JobListing</span> /&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<h4 id="useRoutes"><a href="#useRoutes" class="headerlink" title="useRoutes"></a>useRoutes</h4><p>相当于 Routes <a href="#internal-component">内置组件</a> 的函数版本</p>
<h4 id="useSearchParams"><a href="#useSearchParams" class="headerlink" title="useSearchParams"></a>useSearchParams</h4><p>读取或修改当前 URL 的参数部分</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useSearchParams&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> [searchParams, setSearchParams] = <span class="title function_">useSearchParams</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleSumbit</span>(<span class="params">e</span>)&#123;</span><br><span class="line">    e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    <span class="comment">// 序列化字段</span></span><br><span class="line">    <span class="keyword">const</span> params = <span class="title function_">serializeFormQuery</span>(e.<span class="property">target</span>);</span><br><span class="line">    <span class="title function_">setSearchParams</span>(params);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;handleSubmit&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useSubmit"><a href="#useSubmit" class="headerlink" title="useSubmit  "></a>useSubmit <em id="useSubmit"></em> <!--markdownlint-disable-line--></h4><p>Form 表单提交的命令版本</p>
<ul>
<li>submit(data, options?) 手动提交方法<ul>
<li>options 支持 form 表单的大多数属性</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useSubmit, <span class="title class_">Form</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">SearchFiled</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">let</span> submit = <span class="title function_">useSubmit</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 每次表单改动时提交 </span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> <span class="attr">onChange</span>=<span class="string">&#123;(e)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">      submit(null, &#123;method: &#x27;post&#x27;, action: &#x27;/change&#x27;&#125;);</span></span><br><span class="line"><span class="language-xml">    &#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;search&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Search<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Form</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="React-Router-API"><a href="#React-Router-API" class="headerlink" title="React Router API"></a>React Router API</h3><h4 id="json"><a href="#json" class="headerlink" title="json"></a>json</h4><p>格式化数据</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;json&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loader</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="title function_">fetchData</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">json</span>(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="redirect"><a href="#redirect" class="headerlink" title="redirect"></a>redirect</h4><p>路由重定向</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;redirect&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loader</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>();</span><br><span class="line">  <span class="keyword">if</span>(res.<span class="property">status</span> == <span class="number">401</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="redirectDocument"><a href="#redirectDocument" class="headerlink" title="redirectDocument"></a>redirectDocument</h4><p>触发一个文档级别的重定向, 而不是基于客户端导航, 通常用于从一个应用跳转到另一个应用</p>
<h4 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h4><p>导航跳转替换当前的历史记录栈</p>
<h4 id="createRoutesFromElements"><a href="#createRoutesFromElements" class="headerlink" title="createRoutesFromElements"></a>createRoutesFromElements</h4><p>使用 JSX 元素创建路由, 简写形式是 <code>createRoutesFromChildren</code></p>
<h4 id="createSearchParams"><a href="#createSearchParams" class="headerlink" title="createSearchParams"></a>createSearchParams</h4><p><code>new URLSearchParams(init)</code> 的包装写法</p>
<h4 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h4><p>延迟 <a href="#Route.loader">loader</a> 的返回值</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;defer&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">loader</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">defer</span>(&#123;<span class="attr">name</span>: <span class="string">&#x27;zhangsan&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span>&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="generatePath"><a href="#generatePath" class="headerlink" title="generatePath"></a>generatePath</h4><p>根据动态路由参数生成 url</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;generatePath&#125; <span class="keyword">from</span> <span class="string">&#x27;react-router-dom&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">generatePath</span>(<span class="string">&#x27;/users/:id/:name&#x27;</span>, &#123;<span class="attr">id</span>: <span class="number">42</span>, <span class="attr">name</span>: <span class="string">&#x27;zhangsan&#x27;</span>&#125;); <span class="comment">// /users/42/zhangsan</span></span><br></pre></td></tr></table></figure>

<h4 id="isRouteErrorResponse"><a href="#isRouteErrorResponse" class="headerlink" title="isRouteErrorResponse"></a>isRouteErrorResponse</h4><p>判断是否是由 <a href="#useRouteError">useRouteError</a> 捕获的路由错误</p>
<h4 id="matchPath"><a href="#matchPath" class="headerlink" title="matchPath"></a>matchPath</h4><p>将路由路径模式与 URL 路径进行匹配并返回有关的匹配信息, 否则返回 null</p>
<h4 id="matchRoutes"><a href="#matchRoutes" class="headerlink" title="matchRoutes"></a>matchRoutes</h4><p>执行一个路由匹配算法从给定的 routes 集合中找到匹配的路由并返回</p>
<h4 id="renderMatches"><a href="#renderMatches" class="headerlink" title="renderMatches"></a>renderMatches</h4><p>渲染 matchRoutes 匹配结果中的 React 元素</p>
<h4 id="resolvePath"><a href="#resolvePath" class="headerlink" title="resolvePath"></a>resolvePath</h4><p>根据给定的 to 解析为具有绝对路径的真实 path 对象</p>
<h2 id="Redux"><a href="#Redux" class="headerlink" title="Redux"></a>Redux</h2><ul>
<li><p>dispatch 只能处理同步的 action</p>
</li>
<li><p>createStore  创建一个 Redux 存储实例</p>
</li>
<li><p>combineReducers 将多个 reducer 函数合并成为一个更大的 reducer</p>
</li>
<li><p>applyMiddleware 将多个中间件组合成一个 store 增强器</p>
</li>
<li><p>compose 将多个 store 增强器合并成一个单一的 store 增强器</p>
</li>
</ul>
<h3 id="reduxjs-toolkit-RTK"><a href="#reduxjs-toolkit-RTK" class="headerlink" title="@reduxjs/toolkit(RTK)"></a>@reduxjs/toolkit(RTK)</h3><p>消除手写 Redux 逻辑中的样板代码, 防止常见错误, 并提供简化标准的 Redux 任务的 API</p>
<ul>
<li><a href="#RTK-Query">@reduxjs/toolkit/query</a> 独立可选的入口, 允许定义端点(REST, GraphQL或任何异步函数)并生成 reducer 和中间件来完整管理数据获取, 加载状态更新和结果缓存, 还可以自动生成 React Hooks, 可用于组件获取数据</li>
</ul>
<h4 id="configureStore"><a href="#configureStore" class="headerlink" title="configureStore"></a>configureStore</h4><p>通过单个函数调用设置一个完善的 Redux Store, 包括合并 reducer, 添加 thunk 中间件以及设置 Redux Devtools 集成, 与 createStore 相比更容易配置</p>
<ul>
<li>reducer<ul>
<li>如果是一个函数, configureStore 直接使用其作为根 reducer</li>
<li>如果是一个 slice reducers 的对象, configureStore 将使用 combineReducers 合并此对象并自动创建根 reducer</li>
</ul>
</li>
<li>middleware 函数, 接收 <code>getDefaultMiddleware</code> 函数作为参数, 并返回一个中间件数组, 如果未提供, configureStore 将调用 <code>getDefaultMiddleware</code> 设置中间件数组</li>
<li>devTools 是否设置 Redux Devtools, 默认 true</li>
<li>preloadedState 初始化状态</li>
<li>enhancers 增强器函数, 和 middleware 参数作用类似</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;configureStore&#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><ul>
<li>slice reducers 自动传递给 combineReducers</li>
<li>自动添加了 <code>redux-thunk</code> 中间件</li>
<li>添加了 Devtools 中间件来捕获更多意外的变更</li>
<li>自动设置了 Redux Devtools Extension</li>
<li>中间件和 Devtools 增强器被组合在一起添加到了 store 中</li>
</ul>
<h4 id="createAction"><a href="#createAction" class="headerlink" title="createAction  "></a>createAction <em id="createAction"></em> <!--markdownlint-disable-line--></h4><p>用于创建 action 的辅助函数</p>
<ul>
<li><p>type 字符串, 标识 action</p>
</li>
<li><p>prepareAction() 可选, 函数, 接收任意个参数作为 action 的 payload 的值</p>
</li>
<li><p>actionCreator.match 函数可以区分 action 是否是同一类型, TypeScript 中可以识别 action 中 payload 的类型</p>
</li>
</ul>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createAction&#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actionCreator = <span class="title function_">createAction</span>(<span class="keyword">type</span>, prepareAction?);</span><br><span class="line"></span><br><span class="line"><span class="comment">// action 类型常量</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params">amount: <span class="built_in">number</span></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;INCREMENT&#x27;</span>,</span><br><span class="line">    <span class="attr">payload</span>: amount</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> action = <span class="title function_">increment</span>(<span class="number">3</span>);</span><br><span class="line"><span class="comment">// &#123;type: &#x27;INCREMENT&#x27;, payload: 3&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// action 创建函数</span></span><br><span class="line"><span class="keyword">const</span> increment = <span class="title function_">createAction</span>(<span class="string">&#x27;INCREMENT&#x27;</span>, <span class="function">(<span class="params">text: <span class="built_in">string</span>, age: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;INCREMENT&quot;</span>,</span><br><span class="line">    <span class="attr">payload</span>: &#123;</span><br><span class="line">      <span class="attr">text</span>: text,</span><br><span class="line">      <span class="attr">age</span>: age,</span><br><span class="line">      <span class="attr">id</span>: <span class="title function_">nanoid</span>(),</span><br><span class="line">      <span class="attr">createAt</span>: <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> action = <span class="title function_">increment</span>(<span class="string">&#x27;hello createAction&#x27;</span>, <span class="number">18</span>);</span><br><span class="line"><span class="comment">// &#123;type: &quot;INCREMENT&quot;, payload: &#123;text: &quot;hello createAction&quot;, age: 18, id, createAt&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> increment = createAction&lt;<span class="built_in">number</span>&gt;(<span class="string">&#x27;INCREMENT&#x27;</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">someFn</span>(<span class="params">action: Action</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span>(increment.<span class="title function_">match</span>(action))&#123;</span><br><span class="line">    <span class="comment">// action.payload can be used as `number` here</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="createReducer"><a href="#createReducer" class="headerlink" title="createReducer  "></a>createReducer <em id="createReducer"></em> <!--markdownlint-disable-line--></h4><p>一个简化创建 reducer 函数的工具, 内部使用 Immer 通过在 reducer 中编写可变代码, 大大简化了不可变的更新逻辑, 并支持将特定的操作类型直接映射到 case reducer 函数</p>
<ul>
<li>initialState 初始化状态, 可以是一个返回 state 的函数</li>
<li>builderCallback 回调函数接收一个 <code>builder</code> 对象通过 addCase 方法添加 reducer <em id="builderCallback"></em> <!--markdownlint-disable-line--><ul>
<li>addCase() 接收两个参数, 调用必须在 <code>addMatcher</code> 和 <code>addDefaultCase</code> 之前<ul>
<li>actionCreatorOrType 指定 action.type</li>
<li>reducer</li>
</ul>
</li>
<li>addMatcher() 匹配传入的 action, 调用必须在 <code>addCase</code> 之后和 <code>addDefaultCase</code> 之前<ul>
<li>matcher() 匹配函数, 匹配传入的所有可能的 action.type, 并按定义的顺序调用</li>
<li>reducer</li>
</ul>
</li>
<li>addDefaultCase() 添加默认的 reducer<ul>
<li>reducer</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>返回值</p>
<ul>
<li>具有 <code>getInitialState</code> 函数的 reducer 函数, 调用 <code>getInitialState</code> 返回初始状态, 通常用于测试或者配合 React <a href="#useReducer">useReducer</a> Hook</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createReducer&#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="title function_">createReducer</span>(initialState, builderCallback);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通 reducer</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">coutenReducer</span>(<span class="params">state = initialState, action</span>)&#123;</span><br><span class="line">  <span class="keyword">switch</span>(aciton.<span class="property">type</span>)&#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;ADD&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;...state, <span class="attr">value</span>: action.<span class="property">payload</span>&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;DELETE&#x27;</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;...state, <span class="attr">value</span>: action.<span class="property">payload</span>&#125;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;...state&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createReducer</span></span><br><span class="line"><span class="keyword">const</span> counterReducer = <span class="title function_">createReducer</span>(initialState, <span class="function"><span class="params">builder</span> =&gt;</span> &#123;</span><br><span class="line">  builder.<span class="title function_">addCase</span>(<span class="string">&#x27;ADD&#x27;</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    state.<span class="property">value</span>++; <span class="comment">// immer 创建的 state 副本, 直接修改</span></span><br><span class="line">  &#125;).<span class="title function_">addCase</span>(<span class="string">&#x27;DELETE&#x27;</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    state.<span class="property">value</span>--;</span><br><span class="line">  &#125;).<span class="title function_">addCase</span>(<span class="string">&#x27;ADD_BY_AMOUNT&#x27;</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    state.<span class="property">value</span> += action.<span class="property">payload</span>;</span><br><span class="line">  &#125;).<span class="title function_">addMatcher</span>(<span class="function">(<span class="params">action</span>) =&gt;</span> <span class="title function_">isMatchedAction</span>(action.<span class="property">type</span>), <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;).<span class="title function_">addDefaultCase</span>(<span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="createSlice"><a href="#createSlice" class="headerlink" title="createSlice  "></a>createSlice <em id="createSlice"></em> <!--markdownlint-disable-line--></h4><p>支持使用 Immer 库编写 reducer, 接受一个初始状态, 对象或者 reducer 函数, 并自动创建一个与 reducer 和 状态对应的 <a href="#createAction">actionCreator</a>, 在内部调用 <code>createAction</code> 和 <code>createReducer</code></p>
<ul>
<li>name  标识 state, 将作为生成的 <a href="#createAction">actionCreator</a> 的前缀</li>
<li>initialState 初始化状态</li>
<li>reducers reducer 配置<ul>
<li>如果需要自定义 case Reducer, 每个 reducer 将是一个具有 prepare 函数 和 reducer 函数的对象<ul>
<li>prepare()</li>
<li>reducer</li>
</ul>
</li>
<li>如果是一个函数, 将接收一个 create 对象, 具有三个方法<ul>
<li>create.reducer 标准的 reducer</li>
<li>create.prepareReducer 自定义 actionCreator 的 payload</li>
<li>create.asyncThunk 创建异步的函数代替 actionCreator<ul>
<li>pending</li>
<li>fulfilled</li>
<li>rejected</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>extraReducers 函数, 处理自己创建的 <a href="#createAction">actionCreator</a> 之外的情况, 如处理异步请求的状态, 同 <a href="#builderCallback">builderCallback</a></li>
<li>reducerPath 标识 slice 的位置, 默认 name</li>
<li>selectors 接收 state 作为第一个参数和剩余的参数并返回指定结果</li>
</ul>
<p>返回值, 包含上面的部分属性</p>
<ul>
<li>reducer</li>
<li>actions</li>
<li>caseReducers</li>
<li>getInitialState()</li>
<li>selectSlice 关联自动创建的一个 selector</li>
<li>getSelectors()</li>
<li>injectInfo() 注入 slice</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createSlice, configureStore&#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;counter&#x27;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;<span class="attr">value</span>: <span class="number">0</span>&#125;,</span><br><span class="line">  <span class="comment">// reducers 为一个对象</span></span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">      state.<span class="property">value</span>++;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">decrement</span>(<span class="params">state, action</span>)&#123;</span><br><span class="line">      state.<span class="property">value</span>--;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// case reducer, prepareAction</span></span><br><span class="line">    <span class="attr">incrementByAmout</span>: &#123;</span><br><span class="line">      <span class="title function_">reducer</span>(<span class="params">state, action</span>)&#123;</span><br><span class="line">        state.<span class="property">value</span> += action.<span class="property">payload</span>.<span class="property">value</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">prepare</span>(<span class="params">text: string</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">payload</span>: &#123;<span class="attr">text</span>: text, <span class="attr">value</span>: <span class="number">100</span>&#125;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// reducers 为一个函数, 接收一个 create 对象 </span></span><br><span class="line">  <span class="comment">// reducer, prepareReducer, asyncThunk</span></span><br><span class="line">  <span class="title function_">reducers</span>(<span class="params">create</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">increment</span>: create.<span class="title function_">reducer</span>(state, action) =&gt; &#123;</span><br><span class="line">        state.<span class="property">value</span>++;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">decrement</span>: create.<span class="title function_">reducer</span>(state, action) =&gt; &#123;</span><br><span class="line">        state.<span class="property">value</span>--;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">incrementByAmount</span>: create.<span class="title function_">prepareReducer</span>(<span class="function">(<span class="params">text: string</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="attr">payload</span>: &#123;<span class="attr">text</span>: text, <span class="attr">value</span>: <span class="number">100</span>&#125;&#125;</span><br><span class="line">      &#125;, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">        state.<span class="property">value</span> += action.<span class="property">payload</span>.<span class="property">value</span>;</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="attr">fetchTodo</span>: create.<span class="title function_">asyncThunk</span>(<span class="keyword">async</span> (<span class="attr">id</span>: string, thunkApi) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fetch</span>(thunkApi);</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">await</span> res.<span class="title function_">json</span>()) <span class="keyword">as</span> <span class="title class_">Item</span></span><br><span class="line">      &#125;,&#123;</span><br><span class="line">        <span class="attr">pending</span>: <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">loading</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">rejected</span>: <span class="function"><span class="params">state</span> =&gt;</span>&#123;</span><br><span class="line">          state.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fulfilled</span>: <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">          state.<span class="property">loading</span> = <span class="literal">false</span>;</span><br><span class="line">          state.<span class="property">todos</span>.<span class="title function_">push</span>(action.<span class="property">payload</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">extraReducers</span>(<span class="params">builder</span>)&#123;</span><br><span class="line">    builder.<span class="title function_">addCase</span>(<span class="string">&#x27;INCREMENT&#x27;</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">value</span>++;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: &#123;</span><br><span class="line">    <span class="attr">counter</span>: counterSlice.<span class="property">reducer</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">store.<span class="title function_">dispatch</span>(counterSlice.<span class="property">actions</span>.<span class="title function_">increment</span>());</span><br><span class="line">sotre.<span class="title function_">dispatch</span>(counterSlice.<span class="property">actions</span>.<span class="title function_">decrement</span>());</span><br><span class="line">store.<span class="title function_">dispatch</span>(counterSlice.<span class="property">actions</span>.<span class="title function_">incrementByAmount</span>(&#123;<span class="attr">value</span>: <span class="number">10</span>&#125;));</span><br><span class="line"></span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;counter/increment&#x27;</span>&#125;)</span><br><span class="line">store.<span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;counter/decrement&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>两种获取 selector 的方式</p>
<ul>
<li>selectors</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;counter&#x27;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123; <span class="attr">value</span>: <span class="number">0</span> &#125; satisfies <span class="title class_">CounterState</span> <span class="keyword">as</span> <span class="title class_">CounterState</span>,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">selectors</span>: &#123;</span><br><span class="line">    <span class="attr">selectValue</span>: <span class="function">(<span class="params">sliceState</span>) =&gt;</span> sliceState.<span class="property">value</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(counterSlice.<span class="title function_">selectSlice</span>(&#123; <span class="attr">counter</span>: &#123; <span class="attr">value</span>: <span class="number">2</span> &#125; &#125;)) <span class="comment">// &#123; value: 2 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; selectValue &#125; = counterSlice.<span class="property">selectors</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">selectValue</span>(&#123; <span class="attr">counter</span>: &#123; <span class="attr">value</span>: <span class="number">2</span> &#125; &#125;)) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>

<ul>
<li>getSelectors()</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; selectValue &#125; = counterSlice.<span class="title function_">getSelectors</span>(</span><br><span class="line">  <span class="function">(<span class="params">rootState: RootState</span>) =&gt;</span> rootState.<span class="property">aCounter</span>,</span><br><span class="line">)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">selectValue</span>(&#123; <span class="attr">aCounter</span>: &#123; <span class="attr">value</span>: <span class="number">2</span> &#125; &#125;)) <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;selectValue&#125; = counterSlice.<span class="title function_">getSelectors</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">selectValue</span>(&#123;<span class="attr">value</span>: <span class="number">2</span>&#125;)) <span class="comment">//  2</span></span><br></pre></td></tr></table></figure>

<p>dispatch 提交</p>
<ul>
<li>dispatch 提交 action 时, 如果参数是一个 action 对象形式, 则会忽略 case reducer 中配置的 prepare 方法</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> counterSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;counter&#x27;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;</span><br><span class="line">    <span class="attr">count</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="attr">incrementByAmount</span>:&#123;</span><br><span class="line">      <span class="title function_">reducer</span>(<span class="params">state, action</span>)&#123;</span><br><span class="line">        state.<span class="property">count</span> += action.<span class="property">payload</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">prepare</span>(<span class="params">val</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">payload</span>: val + <span class="number">2</span>&#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// action 对象方式提交会忽略 case redcuer 的 prepare 方法</span></span><br><span class="line"><span class="title function_">dipatch</span>(&#123;<span class="attr">type</span>: <span class="string">&#x27;counter/incrementByAmount&#x27;</span>, <span class="attr">payload</span>: <span class="number">1</span>&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="combineSlices"><a href="#combineSlices" class="headerlink" title="combineSlices"></a>combineSlices</h4><p>合并多个 slice 为一个 reducer, 并允许初始化后更多的 reducer 注入</p>
<p>返回值</p>
<ul>
<li>withLazyLoadedSlices() 向 state 添加声明的 slice</li>
<li>inject(slice, options) 添加 slice<ul>
<li>options.overrideExisting 布尔值, 标识是否替换已存在的 slice</li>
</ul>
</li>
<li>selector() 将 reducer 包装在代理中以确保在当前状态未定义的情况下都能恢复到其初始状态</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;combineSlices&#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> lazeSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;counter&#x27;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123;<span class="attr">value</span>: <span class="number">0</span>&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rootReducer = <span class="title function_">combineSlices</span>(staticSlice, userSlice);</span><br><span class="line"><span class="keyword">const</span> injectReducer = rootReducer.<span class="title function_">inject</span>(lazySlice);</span><br><span class="line"><span class="comment">// OR</span></span><br><span class="line"><span class="keyword">const</span> injectSlice = lazySlice.<span class="title function_">injectInfo</span>(rootReducer);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">selectCounterValue</span> = (<span class="params">rootState</span>) =&gt; rootState.<span class="property">counter</span>?.<span class="property">value</span> <span class="comment">// number | undefined</span></span><br><span class="line"><span class="keyword">const</span> wrappedSelectCounterValue = injectReducer.<span class="title function_">selector</span>(<span class="function">(<span class="params">rootState</span>) =&gt;</span> rooState.<span class="property">counter</span>.<span class="property">value</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  <span class="title function_">selectCounterValue</span>(&#123;&#125;), <span class="comment">// undefined</span></span><br><span class="line">  <span class="title function_">selectCounterValue</span>(&#123;<span class="attr">counter</span>: &#123;<span class="attr">value</span>: <span class="number">2</span>&#125;&#125;), <span class="comment">// 2</span></span><br><span class="line">  <span class="title function_">wrappedSelectCounterValue</span>(&#123;&#125;), <span class="comment">// 0</span></span><br><span class="line">  <span class="title function_">wrappedSelectCounterValue</span>(&#123;<span class="attr">counter</span>: &#123;<span class="attr">value</span>: <span class="number">2</span>&#125;&#125;), <span class="comment">// 2</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="createAsyncThunk"><a href="#createAsyncThunk" class="headerlink" title="createAsyncThunk"></a>createAsyncThunk</h4><p>接收一个 <a href="#createAction">actionCreator</a>和一个回调函数并返回一个 Promise, 同时会创建三个 actionCreator 分别对应 pending, fulfilled, rejected 的状态, 不会生成 reducer</p>
<ul>
<li>type actionCreator, 如 <code>users/requestStatus</code> 将被创建为<ul>
<li>pending: <code>users/requestStatus/pending</code></li>
<li>fulfilled: <code>users/requestStatus/fulfilled</code></li>
<li>rejected: <code>users/requestStatus/rejected</code></li>
</ul>
</li>
<li>payloadCreator 函数, 将返回一个 promise, 接收两个参数<ul>
<li>arg 包含了 thunk actionCreator 被 dispatch 时传入的参数, <code>dispatch(fetchUsers(&#123;status: &#39;active&#39;&#125;))</code></li>
<li>thunkApi 包含了 thunk 函数的所有参数<ul>
<li>dispatch()  Redux 的 dispatch 方法</li>
<li>getState()  Redux 的 getState 方法</li>
<li>extra 传递给 thunk 中间件的参数</li>
<li>requestId 自动生成的标识当前请求的唯一 id</li>
<li>signal 信号, AbortController.signal</li>
<li>rejectWithValue(value, [meta]) 修改当前 promise 的状态为 rejected</li>
<li>fulfilledWithValue(value, [meta])  修改当前 promise 的状态为 fulfilled</li>
</ul>
</li>
</ul>
</li>
<li>options<ul>
<li>condition(arg,{getState, extra}): boolean | Promise&lt;boolean&gt; 用来跳过执行 payloadCreator 和 所有的 dispatch</li>
<li>dispatchConditionRejection 布尔值, 如果 condition() 返回 false 所有的 action 都不会 dispatch, 如果想要当 thunk 结束 action 的状态标记为 rejected, 则设置为 true</li>
<li>idGenerator(arg): string 默认的 requestId 由 nanoid() 生成, 自定义生成 id 逻辑</li>
<li>serializeError(error: unknown) =&gt; any 替换内部的 <code>miniSerializeError</code> 方法</li>
<li>getPendingMeta({arg, requestId}, {getState, extra}): any 创建对象和 <code>pendingAction.meta</code> 合并</li>
</ul>
</li>
</ul>
<p>返回值</p>
<ul>
<li>thunk 函数, 带有 3 个状态<ul>
<li>pending</li>
<li>fulfilled</li>
<li>rejected</li>
</ul>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createAsyncThunk, createSlice&#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> promise = <span class="title function_">createAsyncThunk</span>(type, payloadCreator, options?);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fetchUserById = <span class="title function_">createAsyncThunk</span>(<span class="string">&#x27;users/fetchUserById&#x27;</span>, <span class="title function_">async</span>(<span class="attr">userId</span>: number, &#123;requestId, getState, rejectWithValue&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(userId);</span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">data</span>;</span><br><span class="line">  &#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">rejectWithValue</span>(err.<span class="property">response</span>.<span class="property">data</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,&#123;</span><br><span class="line">  <span class="title function_">condition</span>(<span class="params">userId, &#123;getState, extra&#125;</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;users&#125; = <span class="title function_">getState</span>();</span><br><span class="line">    <span class="keyword">const</span> fetchStatus = users.<span class="property">requests</span>[userId];</span><br><span class="line">    <span class="keyword">if</span>(fetchStatus === <span class="string">&#x27;fulfilled&#x27;</span> || fetchStatus === <span class="string">&#x27;loading&#x27;</span>)&#123;</span><br><span class="line">      <span class="comment">// Already fetched or in progress, don&#x27;t need to re-fetch</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> usersSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">  <span class="attr">initialState</span>: &#123; &#125;,</span><br><span class="line">  <span class="attr">reducers</span>:&#123;&#125;,</span><br><span class="line">  <span class="title function_">extraReducers</span>(<span class="params">builder</span>)&#123;</span><br><span class="line">    builder.<span class="title function_">addCase</span>(fetchUserById.<span class="property">pending</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">status</span> = <span class="string">&#x27;loading&#x27;</span>;</span><br><span class="line">    &#125;).<span class="title function_">addCase</span>(fetchUserById.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">status</span> = <span class="string">&#x27;fulfilled&#x27;</span>;</span><br><span class="line">      state.<span class="property">user</span> = action.<span class="property">payload</span>;</span><br><span class="line">    &#125;).<span class="title function_">addCase</span>(fetchUserById.<span class="property">rejected</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">status</span> = <span class="string">&#x27;rejected&#x27;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">dispatch</span>(<span class="title function_">fetchUserById</span>(<span class="number">123</span>));</span><br></pre></td></tr></table></figure>

<h4 id="createEntityAdapter"><a href="#createEntityAdapter" class="headerlink" title="createEntityAdapter"></a>createEntityAdapter</h4><p>生成一组预构建的 reducer 和 seletors, 用于对包含特定类型数据对象实例的规范化状态结构执行 CRUD 操作, 这些 reducer 函数可以作为 case reducer 传递给 <a href="#createReducer">createReducer</a> 和 <a href="#createSlice">createSlice</a>, 也可以作为 <code>createReducer</code> 和 <code>createSlice</code> 的辅助函数</p>
<ul>
<li><p>selectId 可选, 函数, 接收一个 entity 实例并返回一个唯一 id, 如果未提供则默认为 entity =&gt; entity.id</p>
</li>
<li><p>sortComparer 可选, 函数, 接收两个 entity 实例, 返回一个标准的 <code>Array.sort()</code> 排序之后的结果 (1, 0, -1) 以指示它们的排序相对排序, 如果未提供将不会排序, 也不会保证排序</p>
</li>
<li><p>addOne/addMany 向 state 添加 items</p>
</li>
<li><p>setOne/setMany 添加新 items 或替换现有 items</p>
</li>
<li><p>setAll 替换所有 items</p>
</li>
<li><p>removeOne/removeMany 根据 ID 删除 items</p>
</li>
<li><p>removeAll 移除所有 items</p>
</li>
<li><p>updateOne/updateMany 通过提供部分值更新现有 items</p>
</li>
<li><p>upsertOne/upsertMany 添加新 items 或更新现有 items</p>
</li>
<li><p>getInitialState() 如果传入对象参数, 将被合并到 initialState 中并返回</p>
</li>
<li><p>getSelectors() 生成一组标准的 selector 函数</p>
</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createSlice, createAsyncThunk, createEntityAdapter&#125; <span class="keyword">from</span> <span class="string">&#x27;@reduxjs/toolkit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todosAdapter = <span class="title function_">createEntityAdapter</span>(&#123;</span><br><span class="line">  <span class="attr">selectId</span>: <span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">id</span>,</span><br><span class="line">  <span class="attr">sortComparer</span>: <span class="function">(<span class="params">a, b</span>) =&gt;</span> a.<span class="property">id</span> &lt; b.<span class="property">id</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> initialState = todosAdapter.<span class="title function_">getInitialState</span>(&#123;<span class="attr">loading</span>: <span class="string">&#x27;idle&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Thunk 函数</span></span><br><span class="line"><span class="keyword">const</span> fetchTodos = <span class="title function_">createAsyncThunk</span>(<span class="string">&quot;todos/fetchTodos&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> client.<span class="title function_">get</span>(<span class="string">&quot;/fakeApi/todos&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> response.<span class="property">todos</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> saveNewTodo = <span class="title function_">createAsyncThunk</span>(<span class="string">&quot;todos/saveNewTodo&quot;</span>,</span><br><span class="line">  <span class="keyword">async</span> (text) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> initialTodo = &#123; text &#125;;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> client.<span class="title function_">post</span>(<span class="string">&quot;/fakeApi/todos&quot;</span>, &#123; <span class="attr">todo</span>: initialTodo &#125;);</span><br><span class="line">    <span class="keyword">return</span> response.<span class="property">todo</span>;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todosSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;todos&#x27;</span>,</span><br><span class="line">  initialState,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="attr">todoDeleted</span>: todosAdapter.<span class="property">removeOne</span>, <span class="comment">// 根据 id 删除 todo</span></span><br><span class="line">    <span class="title function_">completeTodosCleard</span>(<span class="params">state, action</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> completeIds = <span class="title class_">Object</span>.<span class="title function_">values</span>(state.<span class="property">entities</span>)</span><br><span class="line">        .<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">complete</span>)</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">id</span>);</span><br><span class="line">      <span class="comment">// 删除所有已完成的 todo</span></span><br><span class="line">      todosAdapter.<span class="title function_">removeMany</span>(state, completedIds);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">extraReducers</span>(<span class="params">builder</span>)&#123;</span><br><span class="line">    builder.<span class="title function_">addCase</span>(fetchTodos.<span class="property">pending</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">status</span> = <span class="string">&#x27;loading&#x27;</span>;</span><br><span class="line">    &#125;).<span class="title function_">addCase</span>(fetchTodos.<span class="property">fulfilled</span>, <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">      state.<span class="property">status</span> = <span class="string">&#x27;idle&#x27;</span>;</span><br><span class="line">    &#125;).<span class="title function_">addCase</span>(saveNewTodo.<span class="property">fulfilled</span>, todosAdapter.<span class="property">addOne</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="createSelector"><a href="#createSelector" class="headerlink" title="createSelector  "></a>createSelector <em id="createSelector"></em> <!--markdownlint-disable-line--></h4><p>函数组件每次重新渲染都会重新执行 selector, createSelector 用于创建带有<strong>记忆化</strong>的 selector, 当给定的 inputSelector 没有发生变化时返回已缓存的 selector</p>
<ul>
<li>inputSelectors 创建记忆化 selector 的依赖, 可以是一个函数, 也可以是多个函数组成的数组, 返回值依次作为 resultFn 的参数传入<ul>
<li>selectorFn 接收 state 作为第一个参数和剩余的参数并返回指定结果</li>
</ul>
</li>
<li>resultFn 在 inputSelectors 之后调用并依次接收来自 inputSelectors 函数的返回值作为参数并返回结果</li>
</ul>
<p>返回值, 带有记忆化的函数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;createSelector&#125; <span class="keyword">from</span> <span class="string">&#x27;reselect&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useSelector&#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">selectTodos</span> = state =&gt; state.<span class="property">todos</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">selectTodosStatus</span> = (<span class="params">state, completed</span>) =&gt; completed;</span><br><span class="line"><span class="keyword">const</span> memoizedSelectTodoCount = <span class="title function_">createSelector</span>([selectTodos, selectTodosStatus], <span class="function">(<span class="params">todos, completed</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> todos.<span class="title function_">filter</span>(<span class="function"><span class="params">todo</span> =&gt;</span> todo.<span class="property">completed</span> === completed).<span class="property">length</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CompletedTodosCount</span>(<span class="params">&#123;completed&#125;</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> matchingCount = <span class="title function_">useSelector</span>(<span class="function">(<span class="params">state</span>) =&gt;</span> <span class="title function_">memoizedSelectTodoCount</span>(state, complete));</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;matchingCount&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>Number of done todos<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">CompletedTodosCount</span> <span class="attr">completed</span>=<span class="string">&#123;true&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="reduxjs-toolkit-query"><a href="#reduxjs-toolkit-query" class="headerlink" title="@reduxjs/toolkit/query  "></a>@reduxjs/toolkit/query <em id="RTK-Query"></em> <!--markdownlint-disable-line--></h4><p>独立可选的入口, 允许定义端点(REST, GraphQL或任何异步函数)并生成 reducer 和中间件来完整管理数据获取, 加载状态更新和结果缓存, 还可以自动生成 React Hooks, 可用于组件获取数据</p>
<h3 id="react-redux"><a href="#react-redux" class="headerlink" title="react-redux"></a>react-redux</h3><h4 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h4><ul>
<li>store</li>
<li>serverState</li>
<li>context</li>
<li>stabilityCheck</li>
<li>children</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Provider</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;createRoot&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom/client&#x27;</span>;</span><br><span class="line"><span class="title function_">createRoot</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;root&#x27;</span>)).<span class="title function_">render</span>(</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &#123;/*  */&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="shallowEqual"><a href="#shallowEqual" class="headerlink" title="shallowEqual"></a>shallowEqual</h4><h4 id="useSelector"><a href="#useSelector" class="headerlink" title="useSelector"></a>useSelector</h4><p>使用 selector 函数从 Redux store 中提取数据用于当前组件</p>
<p>使用 <a href="#createSelector">createSelector</a> 创建记忆化的 selector</p>
<ul>
<li>selector</li>
<li>equalityFn</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useSelector, shallowEqual&#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> selectedData = <span class="title function_">useSelector</span>(selectorReturningObject, shallowEqual);</span><br><span class="line"><span class="comment">// OR</span></span><br><span class="line"><span class="keyword">const</span> selectedData = <span class="title function_">useSelector</span>(selectorReturningObject, &#123;<span class="attr">equalityFn</span>: shallowEqual&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">TodoListItem</span>(<span class="params">props</span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> todo = <span class="title function_">useSelector</span>(<span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">todos</span>[props.<span class="property">id</span>]);</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;todo.text&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="useDispatch"><a href="#useDispatch" class="headerlink" title="useDispatch"></a>useDispatch</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useCallback, memo&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;useDispatch&#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">CounterComponent</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> dispatch = <span class="title function_">useDispatch</span>();</span><br><span class="line">  <span class="keyword">const</span> incrementCounter = <span class="title function_">useCallbac</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">dispatch</span>(&#123;<span class="attr">type</span>:<span class="string">&#x27;increment-counter&#x27;</span>&#125;);</span><br><span class="line">  &#125;,[dispatch]);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>CounterComponent<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">MyIncrement</span> <span class="attr">onIncrement</span>=<span class="string">&#123;incrementCounter&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyIncrement</span> = <span class="title function_">memo</span>(<span class="function">(<span class="params">&#123;onIncrement&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;onIncrement&#125;</span>&gt;</span>increment counter<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="useStore"><a href="#useStore" class="headerlink" title="useStore"></a>useStore</h4><p>大多数情况使用 <code>useSelector</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;useStore&#125; <span class="keyword">from</span> <span class="string">&#x27;react-redux&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">MyComponent</span>(<span class="params"></span>)&#123;</span><br><span class="line">  <span class="keyword">const</span> store = <span class="title function_">useStore</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;store.getState().todos.length&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\02\18f2de6d45f9\" rel="bookmark">JSUtils</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\03\28e7482b798b\" rel="bookmark">JS小结</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\06\0bc450a2cb90\" rel="bookmark">Promise</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\07\7319b6133009\" rel="bookmark">Tapable总结</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\08\9fc9b29dd769\" rel="bookmark">Vue3-migration</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>luoleiself
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://luoleiself.github.io/2022/02/7ec5bd96e943/" title="React.md">https://luoleiself.github.io/2022/02/7ec5bd96e943/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/js/" rel="tag"># js</a>
              <a href="/tags/jsx/" rel="tag"># jsx</a>
              <a href="/tags/React/" rel="tag"># React</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/12/869c5fdf0d37/" rel="prev" title="微信小程序">
      <i class="fa fa-chevron-left"></i> 微信小程序
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/02/18f2de6d45f9/" rel="next" title="JSUtils">
      JSUtils <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#React"><span class="nav-number">1.</span> <span class="nav-text">React</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3"><span class="nav-number">2.</span> <span class="nav-text">设计思想</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%98%E6%8D%A2"><span class="nav-number">2.1.</span> <span class="nav-text">变换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1"><span class="nav-number">2.2.</span> <span class="nav-text">抽象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88"><span class="nav-number">2.3.</span> <span class="nav-text">组合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8A%B6%E6%80%81"><span class="nav-number">2.4.</span> <span class="nav-text">状态</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%8F%98%E6%80%A7"><span class="nav-number">2.4.1.</span> <span class="nav-text">不变性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA-state-%E5%8E%9F%E5%88%99"><span class="nav-number">2.4.2.</span> <span class="nav-text">构建 state 原则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F%E5%80%BC"><span class="nav-number">2.4.3.</span> <span class="nav-text">响应式值</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9-state-%E8%BF%9B%E8%A1%8C%E4%BF%9D%E7%95%99%E5%92%8C%E9%87%8D%E7%BD%AE"><span class="nav-number">2.4.4.</span> <span class="nav-text">对 state 进行保留和重置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-Component-deprected"><span class="nav-number">3.</span> <span class="nav-text">React.Component(deprected)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">3.1.</span> <span class="nav-text">组件的生命周期</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%B1%E5%85%A5-JSX"><span class="nav-number">4.</span> <span class="nav-text">深入 JSX</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSX-%E4%B8%AD%E7%9A%84-Props"><span class="nav-number">4.1.</span> <span class="nav-text">JSX 中的 Props</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSX-%E4%B8%AD%E7%9A%84-children"><span class="nav-number">4.2.</span> <span class="nav-text">JSX 中的 children</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-Hook"><span class="nav-number">5.</span> <span class="nav-text">React Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hook-%E8%A7%84%E5%88%99"><span class="nav-number">5.1.</span> <span class="nav-text">Hook 规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-%E5%86%85%E7%BD%AE-Hook"><span class="nav-number">5.2.</span> <span class="nav-text">React 内置 Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#useId"><span class="nav-number">5.2.1.</span> <span class="nav-text">useId  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useState"><span class="nav-number">5.2.2.</span> <span class="nav-text">useState</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useReducer"><span class="nav-number">5.2.3.</span> <span class="nav-text">useReducer  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useContext"><span class="nav-number">5.2.4.</span> <span class="nav-text">useContext  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useEffect"><span class="nav-number">5.2.5.</span> <span class="nav-text">useEffect</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8-Effect-%E4%B8%AD%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE"><span class="nav-number">5.2.5.1.</span> <span class="nav-text">在 Effect 中请求数据</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useEffectEvent"><span class="nav-number">5.2.6.</span> <span class="nav-text">useEffectEvent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useLayoutEffect"><span class="nav-number">5.2.7.</span> <span class="nav-text">useLayoutEffect</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useInsertionEffect"><span class="nav-number">5.2.8.</span> <span class="nav-text">useInsertionEffect</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useActionState-experimental"><span class="nav-number">5.2.9.</span> <span class="nav-text">useActionState(experimental)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useCallback"><span class="nav-number">5.2.10.</span> <span class="nav-text">useCallback</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useMemo"><span class="nav-number">5.2.11.</span> <span class="nav-text">useMemo</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useRef"><span class="nav-number">5.2.12.</span> <span class="nav-text">useRef  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useImperativeHandle"><span class="nav-number">5.2.13.</span> <span class="nav-text">useImperativeHandle</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useDebugValue"><span class="nav-number">5.2.14.</span> <span class="nav-text">useDebugValue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useDeferredValue"><span class="nav-number">5.2.15.</span> <span class="nav-text">useDeferredValue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useSyncExternalStore"><span class="nav-number">5.2.16.</span> <span class="nav-text">useSyncExternalStore</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useOptimistic-experimental"><span class="nav-number">5.2.17.</span> <span class="nav-text">useOptimistic(experimental)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useTransition"><span class="nav-number">5.2.18.</span> <span class="nav-text">useTransition</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Hook"><span class="nav-number">5.3.</span> <span class="nav-text">自定义 Hook</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-%E7%BB%84%E4%BB%B6"><span class="nav-number">6.</span> <span class="nav-text">React 组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#React-%E5%86%85%E7%BD%AE%E7%BB%84%E4%BB%B6"><span class="nav-number">6.1.</span> <span class="nav-text">React 内置组件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Fragment"><span class="nav-number">6.1.1.</span> <span class="nav-text">Fragment</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Profiler"><span class="nav-number">6.1.2.</span> <span class="nav-text">Profiler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#StrictMode"><span class="nav-number">6.1.3.</span> <span class="nav-text">StrictMode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Suspense"><span class="nav-number">6.1.4.</span> <span class="nav-text">Suspense</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-API"><span class="nav-number">7.</span> <span class="nav-text">React API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#act"><span class="nav-number">7.1.</span> <span class="nav-text">act</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cache-experimental"><span class="nav-number">7.2.</span> <span class="nav-text">cache(experimental)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#createContext"><span class="nav-number">7.3.</span> <span class="nav-text">createContext</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#forwardRef"><span class="nav-number">7.4.</span> <span class="nav-text">forwardRef  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lazy"><span class="nav-number">7.5.</span> <span class="nav-text">lazy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memo"><span class="nav-number">7.6.</span> <span class="nav-text">memo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#startTransition"><span class="nav-number">7.7.</span> <span class="nav-text">startTransition</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#use-experimental"><span class="nav-number">7.8.</span> <span class="nav-text">use(experimental)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#experimental-taintObjectReference-experimental"><span class="nav-number">7.9.</span> <span class="nav-text">experimental_taintObjectReference(experimental)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#taintUniqueValue-experimental"><span class="nav-number">7.10.</span> <span class="nav-text">taintUniqueValue(experimental)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReactDOM-Hook"><span class="nav-number">8.</span> <span class="nav-text">ReactDOM Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#useFormStatus-experimental"><span class="nav-number">8.1.</span> <span class="nav-text">useFormStatus(experimental)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReactDOM-%E7%BB%84%E4%BB%B6"><span class="nav-number">9.</span> <span class="nav-text">ReactDOM 组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-HTML-%E5%85%83%E7%B4%A0"><span class="nav-number">9.1.</span> <span class="nav-text">自定义 HTML 元素</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7%E5%B7%AE%E5%BC%82"><span class="nav-number">9.2.</span> <span class="nav-text">属性差异</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E5%8D%95"><span class="nav-number">9.2.1.</span> <span class="nav-text">表单</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%88%E6%88%90%E4%BA%8B%E4%BB%B6"><span class="nav-number">9.3.</span> <span class="nav-text">合成事件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B1%9E%E6%80%A7"><span class="nav-number">9.3.1.</span> <span class="nav-text">属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95"><span class="nav-number">9.3.2.</span> <span class="nav-text">方法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ReactDOM-API"><span class="nav-number">10.</span> <span class="nav-text">ReactDOM API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#createPortal"><span class="nav-number">10.1.</span> <span class="nav-text">createPortal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#flushSync"><span class="nav-number">10.2.</span> <span class="nav-text">flushSync</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#findDOMNode-deprected"><span class="nav-number">10.3.</span> <span class="nav-text">findDOMNode(deprected)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hydrate-deprected"><span class="nav-number">10.4.</span> <span class="nav-text">hydrate(deprected)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#render-deprected"><span class="nav-number">10.5.</span> <span class="nav-text">render(deprected)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unmountComponentAtNode-deprected"><span class="nav-number">10.6.</span> <span class="nav-text">unmountComponentAtNode(deprected)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preconnect-experimental"><span class="nav-number">10.7.</span> <span class="nav-text">preconnect(experimental)  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#prefetchDNS-experimental"><span class="nav-number">10.8.</span> <span class="nav-text">prefetchDNS(experimental)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preinit-experimental"><span class="nav-number">10.9.</span> <span class="nav-text">preinit(experimental)  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preinitModule-experimental"><span class="nav-number">10.10.</span> <span class="nav-text">preinitModule(experimental)  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preload-experimental"><span class="nav-number">10.11.</span> <span class="nav-text">preload(experimental)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#preloadModule-experimental"><span class="nav-number">10.12.</span> <span class="nav-text">preloadModule(experimental)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF-API"><span class="nav-number">11.</span> <span class="nav-text">客户端 API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#createRoot"><span class="nav-number">11.1.</span> <span class="nav-text">createRoot  </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hydrateRoot"><span class="nav-number">11.2.</span> <span class="nav-text">hydrateRoot  </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF-API"><span class="nav-number">12.</span> <span class="nav-text">服务端 API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Node-js-%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8-API"><span class="nav-number">12.1.</span> <span class="nav-text">Node.js 流服务器 API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToNodeStream-deprected"><span class="nav-number">12.1.1.</span> <span class="nav-text">renderToNodeStream(deprected)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToPipeableStream"><span class="nav-number">12.1.2.</span> <span class="nav-text">renderToPipeableStream  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToStaticNodeStream"><span class="nav-number">12.1.3.</span> <span class="nav-text">renderToStaticNodeStream</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-%E6%B5%81%E6%9C%8D%E5%8A%A1%E5%99%A8-API"><span class="nav-number">12.2.</span> <span class="nav-text">Web 流服务器 API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToReadableStream"><span class="nav-number">12.2.1.</span> <span class="nav-text">renderToReadableStream</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E6%B5%81%E7%8E%AF%E5%A2%83-API"><span class="nav-number">12.3.</span> <span class="nav-text">非流环境 API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToString"><span class="nav-number">12.3.1.</span> <span class="nav-text">renderToString</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToStaticMarkup"><span class="nav-number">12.3.2.</span> <span class="nav-text">renderToStaticMarkup</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#React-Router"><span class="nav-number">13.</span> <span class="nav-text">React Router</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8"><span class="nav-number">13.1.</span> <span class="nav-text">路由器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E6%94%AF%E6%8C%81-data-APIs"><span class="nav-number">13.1.1.</span> <span class="nav-text">不支持 data APIs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%AF%E6%8C%81-data-APIs"><span class="nav-number">13.1.2.</span> <span class="nav-text">支持 data APIs</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#createBrowserRouter"><span class="nav-number">13.1.2.1.</span> <span class="nav-text">createBrowserRouter  </span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#createStaticHandler"><span class="nav-number">13.1.2.2.</span> <span class="nav-text">createStaticHandler</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#createStaticRouter"><span class="nav-number">13.1.2.3.</span> <span class="nav-text">createStaticRouter</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#StaticRouterProvider"><span class="nav-number">13.1.2.4.</span> <span class="nav-text">StaticRouterProvider</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RouterProvider"><span class="nav-number">13.1.2.5.</span> <span class="nav-text">RouterProvider</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Route"><span class="nav-number">13.2.</span> <span class="nav-text">Route  </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Route-action"><span class="nav-number">13.2.1.</span> <span class="nav-text">Route.action  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Route-loader"><span class="nav-number">13.2.2.</span> <span class="nav-text">Route.loader  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Route-lazy"><span class="nav-number">13.2.3.</span> <span class="nav-text">Route.lazy</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Route-shouldRevalidate"><span class="nav-number">13.2.4.</span> <span class="nav-text">Route.shouldRevalidate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Route-errorElement-errorBoundary"><span class="nav-number">13.2.5.</span> <span class="nav-text">Route.errorElement&#x2F;errorBoundary</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Route-hydrateFallbackElement-hydrateFallback"><span class="nav-number">13.2.6.</span> <span class="nav-text">Route.hydrateFallbackElement&#x2F;hydrateFallback</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Router-%E5%86%85%E7%BD%AE%E7%BB%84%E4%BB%B6"><span class="nav-number">13.3.</span> <span class="nav-text">React Router 内置组件  </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Await"><span class="nav-number">13.3.1.</span> <span class="nav-text">Await  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Form"><span class="nav-number">13.3.2.</span> <span class="nav-text">Form</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Link"><span class="nav-number">13.3.3.</span> <span class="nav-text">Link  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NavLink"><span class="nav-number">13.3.4.</span> <span class="nav-text">NavLink</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Navigate"><span class="nav-number">13.3.5.</span> <span class="nav-text">Navigate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Outlet"><span class="nav-number">13.3.6.</span> <span class="nav-text">Outlet</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Route-1"><span class="nav-number">13.3.7.</span> <span class="nav-text">Route</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Routes"><span class="nav-number">13.3.8.</span> <span class="nav-text">Routes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ScrollRestoration"><span class="nav-number">13.3.9.</span> <span class="nav-text">ScrollRestoration</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Router-%E5%86%85%E7%BD%AE-Hook"><span class="nav-number">13.4.</span> <span class="nav-text">React Router 内置 Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#useActionData"><span class="nav-number">13.4.1.</span> <span class="nav-text">useActionData</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useAsyncError"><span class="nav-number">13.4.2.</span> <span class="nav-text">useAsyncError</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useAsyncValue"><span class="nav-number">13.4.3.</span> <span class="nav-text">useAsyncValue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useBeforeUnload"><span class="nav-number">13.4.4.</span> <span class="nav-text">useBeforeUnload</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useBlocker"><span class="nav-number">13.4.5.</span> <span class="nav-text">useBlocker</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useFetcher"><span class="nav-number">13.4.6.</span> <span class="nav-text">useFetcher</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useFetchers"><span class="nav-number">13.4.7.</span> <span class="nav-text">useFetchers</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useFormAction"><span class="nav-number">13.4.8.</span> <span class="nav-text">useFormAction</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useHref"><span class="nav-number">13.4.9.</span> <span class="nav-text">useHref</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useInRouterContext"><span class="nav-number">13.4.10.</span> <span class="nav-text">useInRouterContext</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useLinkClickHandler"><span class="nav-number">13.4.11.</span> <span class="nav-text">useLinkClickHandler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useLoaderData"><span class="nav-number">13.4.12.</span> <span class="nav-text">useLoaderData</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useLocation"><span class="nav-number">13.4.13.</span> <span class="nav-text">useLocation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useMatch"><span class="nav-number">13.4.14.</span> <span class="nav-text">useMatch  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useMatches"><span class="nav-number">13.4.15.</span> <span class="nav-text">useMatches  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useNavigate"><span class="nav-number">13.4.16.</span> <span class="nav-text">useNavigate  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useNavigation"><span class="nav-number">13.4.17.</span> <span class="nav-text">useNavigation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useNavigationType"><span class="nav-number">13.4.18.</span> <span class="nav-text">useNavigationType</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useParams"><span class="nav-number">13.4.19.</span> <span class="nav-text">useParams  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useResolvedPath"><span class="nav-number">13.4.20.</span> <span class="nav-text">useResolvedPath</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useRevalidator"><span class="nav-number">13.4.21.</span> <span class="nav-text">useRevalidator</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useRouteError"><span class="nav-number">13.4.22.</span> <span class="nav-text">useRouteError  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useRouteLoaderData"><span class="nav-number">13.4.23.</span> <span class="nav-text">useRouteLoaderData</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useRoutes"><span class="nav-number">13.4.24.</span> <span class="nav-text">useRoutes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useSearchParams"><span class="nav-number">13.4.25.</span> <span class="nav-text">useSearchParams</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useSubmit"><span class="nav-number">13.4.26.</span> <span class="nav-text">useSubmit  </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#React-Router-API"><span class="nav-number">13.5.</span> <span class="nav-text">React Router API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#json"><span class="nav-number">13.5.1.</span> <span class="nav-text">json</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#redirect"><span class="nav-number">13.5.2.</span> <span class="nav-text">redirect</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#redirectDocument"><span class="nav-number">13.5.3.</span> <span class="nav-text">redirectDocument</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#replace"><span class="nav-number">13.5.4.</span> <span class="nav-text">replace</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createRoutesFromElements"><span class="nav-number">13.5.5.</span> <span class="nav-text">createRoutesFromElements</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createSearchParams"><span class="nav-number">13.5.6.</span> <span class="nav-text">createSearchParams</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defer"><span class="nav-number">13.5.7.</span> <span class="nav-text">defer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#generatePath"><span class="nav-number">13.5.8.</span> <span class="nav-text">generatePath</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#isRouteErrorResponse"><span class="nav-number">13.5.9.</span> <span class="nav-text">isRouteErrorResponse</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#matchPath"><span class="nav-number">13.5.10.</span> <span class="nav-text">matchPath</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#matchRoutes"><span class="nav-number">13.5.11.</span> <span class="nav-text">matchRoutes</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderMatches"><span class="nav-number">13.5.12.</span> <span class="nav-text">renderMatches</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resolvePath"><span class="nav-number">13.5.13.</span> <span class="nav-text">resolvePath</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redux"><span class="nav-number">14.</span> <span class="nav-text">Redux</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#reduxjs-toolkit-RTK"><span class="nav-number">14.1.</span> <span class="nav-text">@reduxjs&#x2F;toolkit(RTK)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#configureStore"><span class="nav-number">14.1.1.</span> <span class="nav-text">configureStore</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%B9%E7%82%B9"><span class="nav-number">14.1.1.1.</span> <span class="nav-text">特点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createAction"><span class="nav-number">14.1.2.</span> <span class="nav-text">createAction  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createReducer"><span class="nav-number">14.1.3.</span> <span class="nav-text">createReducer  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createSlice"><span class="nav-number">14.1.4.</span> <span class="nav-text">createSlice  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#combineSlices"><span class="nav-number">14.1.5.</span> <span class="nav-text">combineSlices</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createAsyncThunk"><span class="nav-number">14.1.6.</span> <span class="nav-text">createAsyncThunk</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createEntityAdapter"><span class="nav-number">14.1.7.</span> <span class="nav-text">createEntityAdapter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createSelector"><span class="nav-number">14.1.8.</span> <span class="nav-text">createSelector  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reduxjs-toolkit-query"><span class="nav-number">14.1.9.</span> <span class="nav-text">@reduxjs&#x2F;toolkit&#x2F;query  </span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#react-redux"><span class="nav-number">14.2.</span> <span class="nav-text">react-redux</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Provider"><span class="nav-number">14.2.1.</span> <span class="nav-text">Provider</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#shallowEqual"><span class="nav-number">14.2.2.</span> <span class="nav-text">shallowEqual</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useSelector"><span class="nav-number">14.2.3.</span> <span class="nav-text">useSelector</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useDispatch"><span class="nav-number">14.2.4.</span> <span class="nav-text">useDispatch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useStore"><span class="nav-number">14.2.5.</span> <span class="nav-text">useStore</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="luoleiself"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">luoleiself</p>
  <div class="site-description" itemprop="description">努力的往前飞, 再累也无所谓, 黑夜过后的光芒有多美...</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/luoleiself" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoleiself" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:luoleiself@163.com" title="E-Mail → mailto:luoleiself@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://developer.mozilla.org/zh-CN/" title="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;zh-CN&#x2F;" rel="noopener" target="_blank">MDN</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">luoleiself</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">557k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">8:27</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><!-- canvas-nest -->
<!-- modify source/_data/footer.swig -->
<!-- modify _config.next.yml -> custom_file_path:footer -->
<!--
<script color="0,0,255" opacity="0.7" zIndex="-1" count="200" src="//cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script> 
-->
<style>
.highlight-container ::selection {
  color: #fc7237
};
</style>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/lozad.js/1.14.0/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
