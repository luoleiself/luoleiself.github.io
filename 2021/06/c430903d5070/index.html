<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/favicon-32x32.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"luoleiself.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="全局 API应用实例 API 调用 createApp 返回一个应用实例，该实例提供了一个应用上下文, 应用实例挂载的整个组件树共享相同的上下文  createApp()创建一个应用实例  参数 {Object} rootComponent 根组件选项 {Object} rootProps 传递给根组件的 props    123456789import &amp;#123; createApp &amp;#12">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue3">
<meta property="og:url" content="https://luoleiself.github.io/2021/06/c430903d5070/index.html">
<meta property="og:site_name" content="luoleiself&#39;s blog">
<meta property="og:description" content="全局 API应用实例 API 调用 createApp 返回一个应用实例，该实例提供了一个应用上下文, 应用实例挂载的整个组件树共享相同的上下文  createApp()创建一个应用实例  参数 {Object} rootComponent 根组件选项 {Object} rootProps 传递给根组件的 props    123456789import &amp;#123; createApp &amp;#12">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://luoleiself.github.io/images/vue3-directives-hooks-1.jpg">
<meta property="og:image" content="https://luoleiself.github.io/images/vue3-directives-hooks-2.jpg">
<meta property="og:image" content="https://luoleiself.github.io/images/vue3-directives-hooks-3.jpg">
<meta property="article:published_time" content="2021-06-19T07:19:26.000Z">
<meta property="article:modified_time" content="2025-09-21T14:48:51.438Z">
<meta property="article:author" content="luoleiself">
<meta property="article:tag" content="js">
<meta property="article:tag" content="VueJs">
<meta property="article:tag" content="Vue3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://luoleiself.github.io/images/vue3-directives-hooks-1.jpg">

<link rel="canonical" href="https://luoleiself.github.io/2021/06/c430903d5070/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Vue3 | luoleiself's blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5fa63b434a4b3e74b6258584372c74c0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="luoleiself's blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">luoleiself's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/luoleiself" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://luoleiself.github.io/2021/06/c430903d5070/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="luoleiself">
      <meta itemprop="description" content="努力的往前飞, 再累也无所谓, 黑夜过后的光芒有多美...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="luoleiself's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Vue3
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-06-19 15:19:26" itemprop="dateCreated datePublished" datetime="2021-06-19T15:19:26+08:00">2021-06-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-21 22:48:51" itemprop="dateModified" datetime="2025-09-21T22:48:51+08:00">2025-09-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES/" itemprop="url" rel="index"><span itemprop="name">ES</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES/VueJs/" itemprop="url" rel="index"><span itemprop="name">VueJs</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>83k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>1:16</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="全局-API"><a href="#全局-API" class="headerlink" title="全局 API"></a>全局 API</h2><h3 id="应用实例-API"><a href="#应用实例-API" class="headerlink" title="应用实例 API"></a>应用实例 API</h3><blockquote>
<p>调用 createApp 返回一个应用实例，该实例提供了一个应用上下文, 应用实例挂载的整个组件树共享相同的上下文</p>
</blockquote>
<h4 id="createApp"><a href="#createApp" class="headerlink" title="createApp()"></a>createApp()</h4><p>创建一个应用实例</p>
<ul>
<li>参数<ul>
<li>{Object} rootComponent 根组件选项</li>
<li>{Object} rootProps 传递给根组件的 props</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">/* root component options */</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">/* root component props */</span></span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="createSSRApp"><a href="#createSSRApp" class="headerlink" title="createSSRApp()"></a>createSSRApp()</h4><p>以 <code>SSR</code> 模式创建一个应用实例, 用法和 <code>createApp()</code> 相同</p>
<h4 id="app-mount"><a href="#app-mount" class="headerlink" title="app.mount()"></a>app.mount()</h4><p>将应用实例挂载到一个容器元素中</p>
<ul>
<li>参数可以是一个实际的 DOM 元素或一个 CSS 选择器, 返回根组件实例</li>
<li>如果该组件有 <code>template</code> 模板或定义了 <code>render</code> 函数, 则替换容器内所有现存的 DOM 节点, 否则使用容器元素的 innerHTML 作为模板</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&#x27;./App.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">  <span class="comment">/* */</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// app.mount(&#x27;#app&#x27;);</span></span><br><span class="line">app.<span class="title function_">mount</span>(<span class="title class_">App</span>);</span><br></pre></td></tr></table></figure>

<h4 id="app-unmount"><a href="#app-unmount" class="headerlink" title="app.unmount()"></a>app.unmount()</h4><p>卸载一个已挂载的应用实例, 同时触发该应用组件树内所有组件的卸载生命周期钩子</p>
<h4 id="app-onUnmount"><a href="#app-onUnmount" class="headerlink" title="app.onUnmount()"></a>app.onUnmount()</h4><blockquote>
<p>Vue 3.5 支持</p>
</blockquote>
<p>注册一个回调函数, 在应用卸载时调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">onUnmount</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="app-component"><a href="#app-component" class="headerlink" title="app.component()"></a>app.component()</h4><p>注册或查找全局组件, 根据参数个数区分</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="comment">/* */</span>);</span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&#x27;my-component&#x27;</span>, &#123;</span><br><span class="line">  <span class="comment">/*组件配置项*/</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&#x27;my-component&#x27;</span>); <span class="comment">// 查找已注册的组件</span></span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h4 id="app-directive"><a href="#app-directive" class="headerlink" title="app.directive()  "></a>app.directive() <em id="directive"></em> <!-- markdownlint-disable-line --></h4><p>注册或查找全局指令, 根据参数个数区分</p>
<blockquote>
<p>自定义指令主要是为了<strong>重用</strong>涉及普通元素的底层 DOM 访问的逻辑<br>只有当所需功能只能通过直接的 DOM 操作来实现时, 才应该使用自定义指令</p>
</blockquote>
<p>一个自定义指令由一个包含类似组件生命周期钩子的对象来定义</p>
<ul>
<li><p>当在组件上使用自定义指令时, 它会始终应用于组件的根节点</p>
</li>
<li><p>如果组件存在多个根节点时, 指令将会被忽略并且抛出一个警告</p>
</li>
<li><p>钩子参数</p>
<ul>
<li>el 指令绑定的元素, 可用于直接操作 DOM</li>
<li>binding 一个对象<ul>
<li>value 传递给指令的值, 例如 <code>v-my-directive=&quot;1 + 1&quot;</code> 的值为 2</li>
<li>oldValue 之前的值, 仅在 <a href="#onBeforeUpdate"><code>beforeUpdate</code></a> 和 <a href="#onUpdated"><code>updated</code></a> 中可用</li>
<li>arg 传递给指令的参数, 例如 <code>v-my-directive:name</code> 的参数为 <code>name</code></li>
<li>modifiers 一个包含修饰符的对象, 例如 <code>v-my-directive.foo.bar</code> 的修饰符对象为 <code>&#123;foo: true, bar: true&#125;</code></li>
<li>instance 使用该指令的组件实例</li>
<li>dir 指令的定义对象</li>
</ul>
</li>
<li>vnode 代表绑定元素的底层 VNode</li>
<li>prevVnode 之前的渲染中代表指令所绑定元素的 VNode, 仅在 <a href="#onBeforeUpdate"><code>beforeUpdate</code></a> 和 <a href="#onUpdated"><code>updated</code></a> 中可用</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">v-my-directive:name.foo.bar</span>=<span class="string">&quot;test&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="comment">/* */</span>);</span></span><br><span class="line"><span class="language-javascript">  app.<span class="title function_">directive</span>(<span class="string">&#x27;my-directive&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     * 自定义指令钩子:</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     * created 在绑定元素的 attribute 或事件监听器被应用之前调用</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     * beforeMount 在绑定元素的父组件挂载之前调用</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     * mounted 绑定元素的父组件被挂载时调用</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     * beforeUpdate 在包含组件的 VNode 更新之前调用</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     * updated 在包含组件的 VNode 及其子组件的 VNode 更新之后调用</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     * beforeUnmount 在绑定元素的父组件卸载之前调用</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     * unmounted 卸载绑定元素的父组件时调用</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">     */</span></span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 简化形式: 仅需要在 `mounted` 和 `updated` 上实现相同的行为</span></span></span><br><span class="line"><span class="language-javascript">  app.<span class="title function_">directive</span>(<span class="string">&#x27;my-directive&#x27;</span>, <span class="function">(<span class="params">el, binding</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/* 在 mounted 和 updated 时都调用 */</span></span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="app-use"><a href="#app-use" class="headerlink" title="app.use()"></a>app.use()</h4><p>安装一个 <strong>插件</strong>, 插件可以是一个包含 <code>install()</code> 方法的对象或者是一个安装函数本身</p>
<ul>
<li>参数<ul>
<li>第一个参数为插件本身</li>
<li>可选, 第二个参数作为插件选项将会传递给插件的 <code>install()</code>方法</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="comment">/* */</span>);</span><br><span class="line"><span class="comment">// 包含 install 方法的对象</span></span><br><span class="line"><span class="keyword">const</span> myPlugins = &#123;</span><br><span class="line">  <span class="title function_">install</span>(<span class="params">app, options</span>) &#123;</span><br><span class="line">    <span class="comment">/* 配置此应用 */</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">app.<span class="title function_">use</span>(myPlugins, &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span>,</span><br><span class="line">  <span class="comment">/* 传递给 install 方法的可选的选项 */</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 安装函数</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">app, options</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* 配置此应用 */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="app-mixin"><a href="#app-mixin" class="headerlink" title="app.mixin()"></a>app.mixin()</h4><blockquote>
<p>不推荐使用</p>
</blockquote>
<p>应用一个全局的 mixin, 作用于应用中的每个组件实例 (不推荐使用), 在 Vue 3 中为了向后兼容</p>
<h4 id="app-provide"><a href="#app-provide" class="headerlink" title="app.provide()"></a>app.provide()</h4><p>提供一个值, 可以在应用中的所有后代组件中注入使用</p>
<ul>
<li>参数<ul>
<li>key, 注入的 key</li>
<li>value, 注入的 key 对应的值, 返回应用实例本身</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">  <span class="attr">inject</span>: [<span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;&lt;span&gt;&#123;&#123;name&#125;&#125;&lt;/span&gt;&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">provide</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;hello world&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="app-runWithContext"><a href="#app-runWithContext" class="headerlink" title="app.runWithContext()"></a>app.runWithContext()</h4><blockquote>
<p>Vue 3.3 支持</p>
</blockquote>
<p>使用当前应用作为注入上下文执行回调函数, 在回调同步调用期间, 即使没有当前活动的组件实例, inject() 调用也可以从当前应用提供的值中查找注入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">provide</span>(<span class="string">&#x27;id&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> injected = app.<span class="title function_">runWithContext</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">inject</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(injected); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<h4 id="app-version"><a href="#app-version" class="headerlink" title="app.version"></a>app.version</h4><p>提供当前应用所使用的 Vue 版本号, 插件中可根据此执行不同的逻辑</p>
<h4 id="app-config"><a href="#app-config" class="headerlink" title="app.config"></a>app.config</h4><p>应用实例暴露出的一个 <code>config</code> 对象, 其中包含了对此应用实例的配置</p>
<h5 id="app-config-errorHandler"><a href="#app-config-errorHandler" class="headerlink" title="app.config.errorHandler"></a>app.config.errorHandler</h5><p>用于为应用实例内抛出的未捕获错误指定一个全局处理函数</p>
<h5 id="app-config-warnHandler"><a href="#app-config-warnHandler" class="headerlink" title="app.config.warnHandler"></a>app.config.warnHandler</h5><p>用于为 Vue 的运行时警告指定一个自定义处理函数</p>
<h5 id="app-config-performance"><a href="#app-config-performance" class="headerlink" title="app.config.performance"></a>app.config.performance</h5><p>设置为 <code>true</code> 可在浏览器工具的 <strong>性能/时间线</strong> 页启用对组件初始化、编译、渲染和修改的性能表现追踪</p>
<h5 id="app-config-compilerOptions"><a href="#app-config-compilerOptions" class="headerlink" title="app.config.compilerOptions"></a>app.config.compilerOptions</h5><p>配置 <strong>运行时编译器</strong> 的选项</p>
<ul>
<li><p>app.config.compilerOptions.isCustomElement 用于指定一个检查方法来识别原生自定义元素</p>
</li>
<li><p>app.config.compilerOptions.whitespace 用于调整模板中空格的处理行为 <code>condense(default) | preserve</code></p>
</li>
<li><p>app.config.compilerOptions.delimiters 用于调整模板内文本插值的分隔符, 默认 [‘, ‘]</p>
</li>
<li><p>app.config.compilerOptions.comments 用于调整是否移除模板中的 HTML 注释</p>
</li>
</ul>
<h5 id="app-config-globalProperties"><a href="#app-config-globalProperties" class="headerlink" title="app.config.globalProperties"></a>app.config.globalProperties</h5><p>用于注册能够被应用实例内所有组件实例访问到的全局属性的对象, 对 Vue 2 中 <code>Vue.prototype</code> 使用方式的一种替代</p>
<h5 id="app-config-optionMergeStrategies"><a href="#app-config-optionMergeStrategies" class="headerlink" title="app.config.optionMergeStrategies"></a>app.config.optionMergeStrategies</h5><p>用于定义自定义组件选项的合并策略的对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="comment">/* */</span>);</span><br><span class="line">app.<span class="property">config</span>.<span class="property">errorHandler</span> = (err, instance, info)&#123;<span class="comment">/* */</span>&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">name</span> = <span class="string">&quot;hello world&quot;</span></span><br><span class="line">app.<span class="property">config</span>.<span class="property">globalProperties</span>.<span class="property">$xhr</span> = <span class="function">() =&gt;</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">app.<span class="property">config</span>.<span class="property">compilerOptions</span>.<span class="property">isCustomElement</span> = (tag)&#123;</span><br><span class="line">  <span class="keyword">return</span>  tag.<span class="title function_">startsWith</span>(<span class="string">&#x27;icon-&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="app-config-idPrefix"><a href="#app-config-idPrefix" class="headerlink" title="app.config.idPrefix"></a>app.config.idPrefix</h5><blockquote>
<p>Vue 3.5 支持</p>
</blockquote>
<p>配置此应用中通过 useId() 生成的所有 ID 的前缀</p>
<h5 id="app-config-throwUnhandledErrorInProduction"><a href="#app-config-throwUnhandledErrorInProduction" class="headerlink" title="app.config.throwUnhandledErrorInProduction"></a>app.config.throwUnhandledErrorInProduction</h5><blockquote>
<p>Vue 3.5 支持</p>
</blockquote>
<p>强制在生产模式下抛出未处理的错误</p>
<h3 id="通用"><a href="#通用" class="headerlink" title="通用"></a>通用</h3><h4 id="version"><a href="#version" class="headerlink" title="version"></a>version</h4><p>暴露当前所使用的 Vue 的版本号</p>
<h4 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick()  "></a>nextTick() <em id="nextTick"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>Dom 更新不是同步的, Vue 会在 <code>next tick</code> 更新周期中缓冲所有状态的修改, 以确保进行了多次状态修改, 每个组件都只会被更新一次</p>
</blockquote>
<p>等待下一次 DOM 更新刷新的工具方法, 可以在状态改变后立即使用以等待 DOM 更新完成</p>
<ul>
<li>传递一个回调函数作为参数</li>
<li>或者 await 返回的 Promise</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; version, nextTick &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(version); <span class="comment">// 打印当前使用的 Vue 版本</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;DOM 还未更新&#x27;</span>);</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">nextTick</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;DOM 已更新&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="defineComponent"><a href="#defineComponent" class="headerlink" title="defineComponent()  "></a>defineComponent() <em id="defineComponent"></em> <!-- markdownlint-disable-line --></h4><p>创建一个合成类型的构造函数, 用于手动渲染函数、TSX 和 IDE 工具支持</p>
<ul>
<li>参数为组件选项对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp, defineComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyComponent</span> = <span class="title function_">defineComponent</span>(&#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">count</span>: <span class="number">1</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">count</span>++;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">MyComponent</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>Vue 3.3 支持, 备用签名, 旨在与<a href="#composition-api">组合式 API</a>和<a href="#rendering-func">渲染函数</a>或 JSX 一起使用</li>
<li>参数为 setup 函数, 函数名称作为组件名称使用, 第二个可选参数为其它选项</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp, defineComponent, ref, h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HelloWorld</span> = <span class="title function_">defineComponent</span>(<span class="function">(<span class="params">props, ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染函数或 JSX</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, count.<span class="property">value</span>);</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="comment">/* 其他选项, 例如声明 props 和 emits */</span></span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">foo</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="string">&#x27;Hello Foo&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">visible</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Boolean</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">HelloWorld</span>).<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="defineAsyncComponent"><a href="#defineAsyncComponent" class="headerlink" title="defineAsyncComponent()"></a>defineAsyncComponent()</h4><p>创建一个只有在需要时才会加载的异步组件</p>
<ul>
<li>参数为配置加载行为的选项对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineAsyncComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AsyncComp</span> = <span class="title function_">defineAsyncComponent</span>(&#123;</span><br><span class="line">  <span class="attr">loader</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./Foo.vue&#x27;</span>) <span class="comment">// 工厂函数</span></span><br><span class="line">  <span class="attr">loadingComponent</span>: <span class="title class_">LoadingComponent</span>,  <span class="comment">// 加载异步组件时要使用的组件</span></span><br><span class="line">  <span class="attr">errorComponent</span>: <span class="title class_">ErrorComponent</span>, <span class="comment">// 加载失败时要使用的组件</span></span><br><span class="line">  <span class="attr">delay</span>: <span class="number">200</span>, <span class="comment">// 在显示 loadingComponent 之前的延迟 | 默认值：200（单位 ms）</span></span><br><span class="line">  <span class="comment">// 如果提供了 timeout ，并且加载组件的时间超过了设定值，将显示错误组件</span></span><br><span class="line">  <span class="comment">// 默认值：Infinity（即永不超时，单位 ms）</span></span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">3000</span>,</span><br><span class="line">  <span class="attr">suspensible</span>: <span class="literal">false</span>, <span class="comment">// 定义组件是否可挂起 | 默认值：true</span></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; error 错误信息对象</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; retry 一个函数，用于指示当 promise 加载器 reject 时，加载器是否应该重试</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; fail  一个函数，指示加载程序结束退出</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; attempts 允许的最大重试次数</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="title function_">onError</span>(<span class="params">error, retry, fail, attempts</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">message</span>.<span class="title function_">match</span>(<span class="regexp">/fetch/</span>) &amp;&amp; attempts &lt;= <span class="number">3</span>) &#123;</span><br><span class="line">      <span class="comment">// 请求发生错误时重试，最多可尝试 3 次</span></span><br><span class="line">      <span class="title function_">retry</span>()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 注意，retry/fail 就像 promise 的 resolve/reject 一样：</span></span><br><span class="line">      <span class="comment">// 必须调用其中一个才能继续错误处理。</span></span><br><span class="line">      <span class="title function_">fail</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>参数为异步加载函数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineAsyncComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局注册异步组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AsyncComp</span> = <span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="string">&#x27;./components/AsyncComponent.vue&#x27;</span>);</span><br><span class="line">);</span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&#x27;async-component&#x27;</span>, <span class="title class_">AsyncComp</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 局部注册异步组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; createApp, defineAsyncComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="title function_">createApp</span>(&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">AsyncComponent</span>: <span class="title function_">defineAsyncComponent</span>(<span class="function">() =&gt;</span></span><br><span class="line">      <span class="keyword">import</span>(<span class="string">&#x27;./components/AsyncComponent.vue&#x27;</span>);</span><br><span class="line">    ),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="defineCustomElement"><a href="#defineCustomElement" class="headerlink" title="defineCustomElement()"></a><a href="#defineComponent">defineCustomElement()</a></h4><p>和 <code>defineComponent()</code> 接收的参数相同, 返回值是一个可以通过 <code>customElements.define()</code> 注册的<strong>自定义元素</strong>构造器(继承自 <code>HTMLElement</code>)</p>
<p>这些属性也可以作为第二个参数传递</p>
<ul>
<li>configureApp 一个函数, 可用于配置自定义元素的 Vue 应用实例. Vue 3.5 支持</li>
<li>shadowRoot boolean, 默认为 true, 设置为 false 以在不带 shadow root 的情况下渲染自定义元素, 自定义元素组件中的 &lt;style&gt; 将不再被封装隔离. Vue 3.5 支持</li>
<li>nonce string, 如果提供, 将在注入到 shadow root 样式标签上设置 nonce attribute. Vue 3.5 支持</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineCustomElement &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyVueElement</span> = <span class="title function_">defineCustomElement</span>(&#123;</span><br><span class="line">  <span class="comment">/* 和 defineComponent() 接收的参数相同 */</span></span><br><span class="line">  <span class="attr">props</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">emits</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`...`</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* defineCustomElement 特有的: 注入进入 shadow root 的 css */</span></span><br><span class="line">  <span class="attr">styles</span>: [<span class="string">`/* inlined css */`</span>],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyNewElement</span> = <span class="title function_">defineCustomElement</span>(<span class="title class_">MyVueElement</span>, &#123;</span><br><span class="line">  <span class="comment">// 选项作为第二个参数传递</span></span><br><span class="line">  <span class="title function_">configureApp</span>(<span class="params">app</span>)&#123;</span><br><span class="line">    app.<span class="property">name</span> = <span class="string">&#x27;MyVueElement&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">nonce</span>: <span class="string">&#x27;noncemyvueelement&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">customElements.<span class="title function_">define</span>(<span class="string">&#x27;my-new-element&#x27;</span>, <span class="title class_">MyNewElement</span>);</span><br></pre></td></tr></table></figure>

<h2 id="组合式-API"><a href="#组合式-API" class="headerlink" title="组合式 API  "></a>组合式 API <em id="composition-api"></em> <!-- markdownlint-disable-line --></h2><blockquote>
<p>组合式函数(Composables) 是一个利用 Vue 的组合式 API 来封装和复用有 <strong>状态逻辑</strong> 的函数</p>
</blockquote>
<p>组合式 API 的核心思想是直接在函数作用域内定义响应式状态变量, 并将从多个函数中得到的状态组合起来处理复杂问题, 这种形式更加自由灵活和高效.</p>
<p>组合式 API(composition API) 是一系列 API 的集合, 能够通过函数而不是声明选项的方式书写 Vue 组件来实现更加简洁高效的逻辑复用(<a href="#optional-api">选项式 API</a> 中主要的逻辑复用机制是 mixins), 涵盖以下方面的 API</p>
<ul>
<li>响应式 API: 例如 <a href="#ref">ref()</a> 和 <a href="#reactive">reactive()</a>, 可以直接创建响应式状态、计算属性和侦听器</li>
<li>生命周期钩子: 例如 <a href="#onMounted">onMounted()</a> 和 <a href="#onUnmounted">onUnmounted()</a>, 可以在组件各个生命周期阶段添加逻辑</li>
<li>依赖注入: 例如 provide() 和 inject(), 可以在使用响应式 API 时, 利用 Vue 的依赖注入系统</li>
</ul>
<h3 id="setup"><a href="#setup" class="headerlink" title="setup()"></a>setup()</h3><blockquote>
<p>对于结合单文件组件使用的组合式 API 推荐使用 <code>&lt;script setup&gt;</code> 语法</p>
</blockquote>
<p><code>setup()</code> 钩子是在组件中使用 <a href="#composition-api">组合式 API</a> 的入口, 通常在两个情况下使用</p>
<ul>
<li>需要在<strong>非单文件组件</strong>中使用 <a href="#composition-api">组合式 API</a> 时</li>
<li>需要在基于 <a href="#optional-api">选项式 API</a> 的组件中集成基于 <a href="#composition-api">组合式 API</a> 的代码时</li>
</ul>
<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><ul>
<li><p>在创建组件实例时, 在初始 prop 解析之后立即调用 setup</p>
</li>
<li><p>在生命周期方面, 在 <code>beforeCreate</code> 钩子之前调用</p>
</li>
<li><p>getCurrentInstance</p>
<ul>
<li>支持访问内部组件实例，用于高阶用法或库的开发</li>
<li>只能在 setup 或生命周期钩子中调用</li>
</ul>
</li>
<li><p><code>setup()</code> 应该同步地返回一个对象, 唯一可以使用 <code>async setup()</code> 的情况是该组件是 <a href="#suspense">&lt;Suspense&gt;</a> 组件地后裔</p>
</li>
</ul>
<h4 id="访问-Props"><a href="#访问-Props" class="headerlink" title="访问 Props"></a>访问 Props</h4><ul>
<li><code>setup()</code> 的第一个参数, 是响应式地并且会在传入新的 props 时同步更新</li>
<li>不能直接对 props 进行解构操作, 会丢失响应性, 可以通过 <code>toRefs()</code> 和 <code>toRef()</code> 工具函数辅助完成</li>
</ul>
<h4 id="上下文"><a href="#上下文" class="headerlink" title="上下文"></a>上下文</h4><p><code>setup()</code> 的第二个参数为一个<strong>上下文</strong>对象, 暴露了其他一些在 <code>setup()</code> 中可能会用到的值, 该上下文对象是非响应式的, 可以安全地解构, attrs 和 slots 都是非响应式的, 如果需要根据 attrs 或 slots 的改变执行副作用, 需要在 onBeforeUpdate 钩子中执行相关逻辑</p>
<ul>
<li>attrs 透传 Attributes, 等价于 $attrs, 除了组件声明的 <code>props</code> 和 <code>emits</code> 之外的其他 attribute<ul>
<li>当一个组件以单个元素为根作渲染时, 透传的 attribute 会自动被添加到根元素上, 如果有多个根节点时没有自动 attribute 透传行为, 如果 $attrs 没有被显式绑定将会抛出一个运行时警告</li>
<li>深层组件继承时, 透传的 attribute 不会包含子组件上声明过的 props 或者针对 emits 声明事件的 v-on 侦听函数</li>
</ul>
</li>
<li>slots <a href="#v-slot">插槽</a>, 等价于 $slots</li>
<li>emit 触发事件, 等价于 $emit</li>
<li>expose 用于显示的限制该组件暴露出的属性, 父组件将仅能访问 expose 函数暴露出的内容</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, createApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; emit, expose &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> publicCount = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="title function_">expose</span>(&#123; <span class="attr">count</span>: publicCount &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&#x27;my-event&#x27;</span>, &#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123; publicCount &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="使用-slot-渲染"><a href="#使用-slot-渲染" class="headerlink" title="使用 slot 渲染"></a>使用 <a href="#v-slot">slot</a> 渲染</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp, defineComponent, h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HelloWorld</span> = <span class="title function_">defineComponent</span>(<span class="function">(<span class="params">props, &#123; slots &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 使用 `?.` 可选链运算符判断插槽函数不存在则使用默认值渲染</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> [</span><br><span class="line">    <span class="title function_">h</span>(</span><br><span class="line">      <span class="string">&#x27;p&#x27;</span>,</span><br><span class="line">      slots?.<span class="property">default</span>?.() || <span class="string">&#x27;rendered content from self by default slot...&#x27;</span></span><br><span class="line">    ),</span><br><span class="line">    <span class="title function_">h</span>(</span><br><span class="line">      <span class="string">&#x27;p&#x27;</span>,</span><br><span class="line">      slots?.<span class="property">header</span>?.() || <span class="string">&#x27;rendered content from self by header slot...&#x27;</span></span><br><span class="line">    ),</span><br><span class="line">  ];</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="comment">/* 其它选项 */</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; slots &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span></span><br><span class="line">      <span class="title function_">h</span>(</span><br><span class="line">        <span class="title class_">HelloWorld</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// VNode 生命周期事件琢磨中...</span></span><br><span class="line">          <span class="string">&#x27;onVue:before-mount&#x27;</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child component hooks triggered...&#x27;</span>);</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 传递单个默认插槽函数</span></span><br><span class="line">        <span class="comment">// () =&gt; &#x27;rendered content from father component by default slot...&#x27;,</span></span><br><span class="line">        <span class="comment">// 传递具名插槽函数, 使用插槽函数对象形式传递</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">default</span>: <span class="function">() =&gt;</span></span><br><span class="line">            <span class="string">&#x27;rendered content from father component by default slot...&#x27;</span>,</span><br><span class="line">          <span class="attr">header</span>: <span class="function">() =&gt;</span></span><br><span class="line">            <span class="title function_">h</span>(</span><br><span class="line">              <span class="string">&#x27;span&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;rendered content from father component by header slot...&#x27;</span></span><br><span class="line">            ),</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&#x27;hello-world&#x27;</span>, <span class="title class_">HelloWorld</span>);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="使用-slotscope-渲染"><a href="#使用-slotscope-渲染" class="headerlink" title="使用 slotscope 渲染"></a>使用 <a href="#v-slot">slot</a>scope 渲染</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp, defineComponent, h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HelloWorld</span> = <span class="title function_">defineComponent</span>(<span class="function">(<span class="params">props, &#123; attrs, slots &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> message = <span class="string">&#x27;from hello world component&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> age = attrs.<span class="property">age</span> &gt; <span class="number">0</span> ? attrs.<span class="property">age</span> : <span class="number">18</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(props); <span class="comment">// &#123;&#125;</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(slots); <span class="comment">// &#123;default: renderFnWithContext()&#125;</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(attrs); <span class="comment">// &#123;name: &#x27;from createApp&#x27;, age: -1&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, slots.<span class="title function_">default</span>(&#123; <span class="attr">message</span>: message, <span class="attr">age</span>: age &#125;));</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="comment">/* 其它选项 */</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span></span><br><span class="line">      <span class="title function_">h</span>(</span><br><span class="line">        <span class="title class_">HelloWorld</span>,</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">&#x27;from createApp&#x27;</span>, <span class="attr">age</span>: -<span class="number">1</span> &#125;,</span><br><span class="line">        <span class="comment">// 传递单个默认插槽函数</span></span><br><span class="line">        <span class="function">(<span class="params">slotScope</span>) =&gt;</span></span><br><span class="line">          slotScope.<span class="property">message</span> + <span class="string">&#x27; - &#x27;</span> + slotScope.<span class="property">age</span> + <span class="string">&#x27; - others from createApp&#x27;</span></span><br><span class="line">      );</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&#x27;hello-world&#x27;</span>, <span class="title class_">HelloWorld</span>);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="返回渲染函数"><a href="#返回渲染函数" class="headerlink" title="返回渲染函数"></a>返回<a href="#rendering-func">渲染函数</a></h4><blockquote>
<p>返回<a href="#rendering-func"><strong>渲染函数</strong></a>将会阻止返回其他东西, 对于父组件通过模板引用组件暴露的属性使用 <code>expose()</code> 方法解决</p>
</blockquote>
<ul>
<li>返回一个 <a href="#rendering-func"><strong>渲染函数</strong></a>, 此时在渲染函数中可以直接使用在同一作用域下声明的响应式状态</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, ref, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, &#123; expose &#125;</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">const</span> object = <span class="title function_">reactive</span>(&#123; <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">increment</span> = (<span class="params"></span>) =&gt; ++count.<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">expose</span>(&#123; increment &#125;); <span class="comment">// 组件暴露 increment 方法</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [count.<span class="property">value</span>, object.<span class="property">foo</span>]);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="响应式-核心"><a href="#响应式-核心" class="headerlink" title="响应式: 核心"></a>响应式: 核心</h3><ul>
<li>响应式状态默认是深层次的, 即对深层次的响应式状态的更改也能被检测到</li>
<li>只有代理对象是响应式的, 更改原始对象不会触发更新, 使用响应式系统时仅使用声明对象的代理版本</li>
</ul>
<h4 id="ref"><a href="#ref" class="headerlink" title="ref()  "></a>ref() <em id="ref"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>当在模板中使用了一个 ref, 然后改变这个 ref 的值, Vue 会自动检测到这个变化并相应地更新 DOM, 这个过程通过一个基于依赖追踪的响应式系统实现的, 当一个组件首次渲染时, Vue 会追踪在渲染过程中使用的每一个 ref, 当一个 ref 被修改时, 它会触发追踪它的组件的一次重新渲染, 在标准的 javascript 中无法检测普通变量的修改, 可以通过 getter 和 setter 方法来拦截对象属性的 get 和 set 操作.<br>.value 属性给予了 Vue 一个机会来检测 ref 何时被访问或修改, 在其内部, Vue 在它的 getter 中执行追踪, 在它的 setter 中执行触发, 概念上 ref 可以看作是一个这样的对象.</p>
</blockquote>
<p>接受一个内部值, 返回一个响应式可更改的 ref 对象, 此对象只有一个指向其内部值的属性 <code>.value</code></p>
<ul>
<li>将一个对象赋值给 ref, 那么这个对象将通过 <code>reactive()</code> 转为具有深层次响应式的对象, 如果对象中包含了嵌套的 ref, 它们将被深层地解包</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> obj = <span class="title function_">ref</span>(&#123;</span><br><span class="line">  <span class="attr">nested</span>: &#123; <span class="attr">count</span>: <span class="number">0</span> &#125;,</span><br><span class="line">  <span class="attr">arr</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>],</span><br><span class="line">&#125;);</span><br><span class="line">obj.<span class="property">value</span>.<span class="property">nested</span>.<span class="property">count</span>++;</span><br><span class="line">obj.<span class="property">value</span>.<span class="property">arr</span>.<span class="title function_">push</span>(<span class="string">&#x27;baz&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>一个包含对象类型值的 ref 可以响应式的替换整个对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>); <span class="comment">// 0</span></span><br><span class="line">count.<span class="property">value</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>); <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> objRef = <span class="title function_">ref</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line">objRef.<span class="property">value</span> = &#123; <span class="attr">count</span>: <span class="number">1</span> &#125;; <span class="comment">// 响应式替换</span></span><br></pre></td></tr></table></figure>

<ul>
<li>ref 被传递给函数或是从<strong>一般对象</strong>上被解构时, 不会丢失响应性</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="title function_">ref</span>(<span class="number">0</span>),</span><br><span class="line">  <span class="attr">bar</span>: <span class="title function_">ref</span>(<span class="number">1</span>),</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 该函数接收一个 ref 需要通过 .value 取值, 但会保持响应性</span></span><br><span class="line"><span class="title function_">callSomeFn</span>(obj.<span class="property">foo</span>);</span><br><span class="line"><span class="comment">// 解构 ref 仍然是响应性的</span></span><br><span class="line"><span class="keyword">const</span> &#123; foo, bar &#125; = obj;</span><br></pre></td></tr></table></figure>

<ul>
<li>当 ref 在模板中作为<strong>顶层属性</strong>被访问时, 它们会被自动解包, 不需要使用 <code>.value</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// ref 非渲染上下文顶层属性</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> obj = &#123; <span class="attr">foo</span>: <span class="title function_">ref</span>(<span class="number">1</span>) &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// ref 为渲染上下文顶层属性</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">increment</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    count.<span class="property">value</span>++;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 不需要使用 .value 访问 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;increment&quot;</span>&gt;</span>&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 需要使用 .value 访问 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;obj.foo.value&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="computed"><a href="#computed" class="headerlink" title="computed()  "></a>computed() <em id="computed"></em> <!-- markdownlint-disable-line --></h4><p>返回一个只读的响应式 ref 对象, 该 ref 通过 .value 暴露 getter 函数的返回值</p>
<ul>
<li>接受一个 getter 函数</li>
<li>接受一个带有 get 和 set 函数的对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接受一个 getter 函数</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> plusOne = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> count.<span class="property">value</span> + <span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(plusOne.<span class="property">value</span>); <span class="comment">// 2</span></span><br><span class="line">plusOne.<span class="property">value</span>++; <span class="comment">// 错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 接受一个带有 get 和 set 函数的对象</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> plusOne = <span class="title function_">computed</span>(&#123;</span><br><span class="line">  <span class="attr">get</span>: <span class="function">() =&gt;</span> count.<span class="property">value</span> + <span class="number">1</span>,</span><br><span class="line">  <span class="attr">set</span>: <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    count.<span class="property">value</span> = val - <span class="number">1</span>;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">plusOne.<span class="property">value</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>); <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<h4 id="reactive"><a href="#reactive" class="headerlink" title="reactive()  "></a>reactive() <em id="reactive"></em> <!-- markdownlint-disable-line --></h4><p>返回一个对象的响应式代理</p>
<ul>
<li>对同一个<strong>原始对象</strong>调用 <code>reactive()</code> 总是返回同样的<strong>代理对象</strong></li>
<li>对一个已存在的<strong>代理对象</strong>调用 <code>reactive()</code> 总是返回其本身</li>
</ul>
<p><strong>局限性</strong> <!--markdownlint-disable-line--></p>
<ul>
<li>有限的值类型: 只能用于对象类型(对象、数组、Map、Set 这样的集合类型), 不能持有 <code>string</code>, <code>number</code>, <code>boolean</code> 这样的原始类型</li>
<li>不能替换整个对象: 因为 Vue 的响应式系统是通过属性访问进行追踪的, 因此需要始终保持对响应式对象的<strong>相同引用</strong>,</li>
<li>对解构操作不友好: 将响应式对象的属性赋值或解构至本地变量时、或是将该属性传入一个函数时将失去响应性</li>
</ul>
<p>==建议使用 <code>ref()</code> 作为生命响应式状态的主要 API==</p>
<ul>
<li>将一个 ref 作为响应式对象的属性被访问或修改时自动解包</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// ref 会解包</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123;</span><br><span class="line">  count,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">count</span>); <span class="comment">// 0</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">count</span> === count.<span class="property">value</span>); <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动更新 `state.value`</span></span><br><span class="line">count.<span class="property">value</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>, state.<span class="property">count</span>); <span class="comment">// 1 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动更新 `count` ref</span></span><br><span class="line">state.<span class="property">count</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>, state.<span class="property">count</span>); <span class="comment">// 2 2</span></span><br></pre></td></tr></table></figure>

<ul>
<li>将一个新的 ref 赋值给一个关联了已有 ref 的属性, 那么旧的 ref 会被替换</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> otherCount = <span class="title function_">ref</span>(<span class="number">4</span>);</span><br><span class="line">state.<span class="property">count</span> = otherCount;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>, state.<span class="property">count</span>); <span class="comment">// 2 4</span></span><br></pre></td></tr></table></figure>

<ul>
<li>只有当嵌套在一个深层响应式对象内时, 才会发生 ref 解包, 当其作为 <a href="#shallowReactive"><strong>浅层响应式对象</strong></a> 的属性被访问时不会被解包</li>
<li>当 ref 作为响应式数组或原生集合类型(如 Map)中的元素被访问时, 不会被解包</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; shallowReactive, reactive, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="comment">// 浅层响应式对象, ref 作为其属性被访问时不会被解包</span></span><br><span class="line"><span class="keyword">const</span> sr = <span class="title function_">shallowReactive</span>(&#123;</span><br><span class="line">  <span class="attr">arr</span>: <span class="title function_">ref</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]),</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(sr.<span class="property">arr</span>.<span class="property">value</span>[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 原生集合中包含 ref 元素时, ref 不会解包</span></span><br><span class="line"><span class="keyword">const</span> books = <span class="title function_">reactive</span>([<span class="title function_">ref</span>(<span class="string">&#x27;Vue 3.0&#x27;</span>)]);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(books[<span class="number">0</span>].<span class="property">value</span>); <span class="comment">// 需要使用 .value</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map = <span class="title function_">reactive</span>(<span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="string">&#x27;count&#x27;</span>, <span class="title function_">ref</span>(<span class="number">0</span>)]]));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(<span class="string">&#x27;count&#x27;</span>).<span class="property">value</span>); <span class="comment">// 需要使用 .value</span></span><br></pre></td></tr></table></figure>

<h4 id="readonly"><a href="#readonly" class="headerlink" title="readonly()  "></a>readonly() <em id="readonly"></em> <!-- markdownlint-disable-line --></h4><ul>
<li>接受一个对象(响应式或普通)或一个 ref, 返回原值的只读代理</li>
<li>任何被访问的嵌套属性也是只读的, 它的 ref 解包行为与 reactive() 相同, 但解包得到的值是只读的</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, readonly, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> original = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> copy = <span class="title function_">readonly</span>(original);</span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(copy.<span class="property">count</span>); <span class="comment">// 用于响应性追踪</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 变更 original 会触发依赖于副本的侦听器</span></span><br><span class="line">original.<span class="property">count</span>++;</span><br><span class="line"><span class="comment">// 警告! // 变更副本将失败并导致警告</span></span><br><span class="line">copy.<span class="property">count</span>++;</span><br></pre></td></tr></table></figure>

<h4 id="watch"><a href="#watch" class="headerlink" title="watch()  "></a>watch() <em id="watch"></em> <!-- markdownlint-disable-line --></h4><ul>
<li>侦听一个或多个响应式数据源, 并在数据源变化时调用所给的回调函数, 使用方式和 this.$watch 和 watch 选项完全等效</li>
<li>默认是浅层侦听, 仅在侦听的属性被赋新值时才触发回调, 而嵌套属性的变化不会触发, 如果需要侦听嵌套属性, 使用 <code>deep: true</code> 选项</li>
<li>默认是懒侦听的, 仅在侦听源发生变化时才触发回调, 如果需要在创建侦听器时立即执行一遍回调, 使用 <code>immediate: true</code> 选项</li>
</ul>
<h5 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h5><ul>
<li><p>第一个参数是侦听器的源, 支持包含返回值的函数、ref、响应式对象、或者以上类型的值组成的数组</p>
</li>
<li><p>第二个参数是侦听源发生变化时调用的函数, 函数接收三个参数: 新值、旧值，及一个用于注册副作用清理的回调函数</p>
</li>
<li><p>第三个参数是一个配置项对象</p>
<ul>
<li>immediate 在侦听器创建时立即触发回调, 第一次调用时旧值为 <code>undefined</code></li>
<li>deep 如果源是对象, 强制深度遍历, 以便在深层级变更时触发回调</li>
<li>flush 调整回调函数的刷新时机, 见 <a href="#watchEffect">watchEffect()</a></li>
<li>onTrack/onTrigger 调试侦听器的依赖, 见 <a href="#watchEffect">watchEffect()</a></li>
<li>once 回调函数只会执行一次, 侦听器将在回调函数首次运行后自动停止, Vue 3.4 支持</li>
</ul>
</li>
<li><p>暂停/恢复侦听器, Vue 3.5 支持</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, ref, watch, onWatcherCleanup &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 侦听一个 getter 函数</span></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> state.<span class="property">count</span>,</span><br><span class="line">  <span class="function">(<span class="params">newVal, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/* */</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 当侦听 getter 函数, 回调函数只在此函数的返回值变化时才会触发, 监听深层级变更时触发需要设置 &#123;deep: true&#125;</span></span><br><span class="line">  <span class="comment">// 当前侦听一个响应式对象, 默认自动开启深层级模式</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">once</span>: <span class="literal">true</span>, <span class="comment">// 侦听器只会执行一次后自动停止</span></span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 侦听一个 ref</span></span><br><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_">watch</span>(count, <span class="function">(<span class="params">count, prevCount</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* */</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 侦听多个源</span></span><br><span class="line"><span class="keyword">const</span> stop = <span class="title function_">watch</span>([fooRef, barRef], <span class="function">(<span class="params">[foo, bar], [prevFoo, prevBar]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">/* */</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 停止侦听器</span></span><br><span class="line"><span class="title function_">stop</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 副作用清理</span></span><br><span class="line"><span class="title function_">watch</span>(id, <span class="title function_">async</span> (newValue, oldValue, onCleanup) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; response, cancel &#125; = <span class="title function_">doAsyncWork</span>(newValue);</span><br><span class="line">  <span class="comment">// 当 id 变化时, cancel 被调用</span></span><br><span class="line">  <span class="comment">// 取消之前的未完成的请求</span></span><br><span class="line">  <span class="title function_">onCleanup</span>(cancel);</span><br><span class="line">  data.<span class="property">value</span> = <span class="keyword">await</span> response;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 3.5 支持</span></span><br><span class="line"><span class="keyword">const</span> &#123;stop, pause, resume&#125; = <span class="title function_">watch</span>(id, <span class="title function_">async</span> ()=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; response, cancel &#125; = <span class="title function_">doAsyncWork</span>(id.<span class="property">value</span>);</span><br><span class="line">  <span class="comment">// 注册清理函数</span></span><br><span class="line">  <span class="title function_">onWatcherCleanup</span>(cancel);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 暂停侦听器</span></span><br><span class="line"><span class="title function_">pause</span>();</span><br><span class="line"><span class="comment">// 稍后恢复</span></span><br><span class="line"><span class="title function_">resume</span>();</span><br><span class="line"><span class="comment">// 停止</span></span><br><span class="line"><span class="title function_">stop</span>();</span><br></pre></td></tr></table></figure>

<h5 id="与-watchEffect-的区别"><a href="#与-watchEffect-的区别" class="headerlink" title="与 watchEffect() 的区别"></a>与 <a href="#watchEffect">watchEffect()</a> 的区别</h5><ul>
<li>惰性执行副作用</li>
<li>更具体地说明应触发侦听器重新运行的状态</li>
<li>访问被侦听状态的先前值和当前值</li>
<li>侦听多个源</li>
</ul>
<h4 id="watchEffect"><a href="#watchEffect" class="headerlink" title="watchEffect()  "></a>watchEffect() <em id="watchEffect"></em> <!-- markdownlint-disable-line --></h4><p>立即执行一个函数, 同时响应式地追踪其依赖, 并在依赖更新时重新执行函数</p>
<ul>
<li>第一个参数是要运行的副作用函数, 该函数接收一个函数用来注册清理回调, 清理回调会在该副作用函数下一次执行之前被调用</li>
<li>第二个参数是可选项, 用来调整副作用的刷新时机或调试副作用的依赖</li>
<li>返回值<ul>
<li>一个用来停止该副作用的函数</li>
<li>暂停/恢复侦听器, Vue 3.5 支持</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">const</span> stop = <span class="title function_">watchEffect</span>(</span><br><span class="line">  <span class="function">(<span class="params">onCleanup</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(count.<span class="property">value</span>); <span class="comment">// 输出 0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">flush</span>: <span class="string">&#x27;pre&#x27;</span>,</span><br><span class="line">    <span class="title function_">onTrick</span>(<span class="params">e</span>) &#123;&#125;,</span><br><span class="line">    <span class="title function_">onTrigger</span>(<span class="params">e</span>) &#123;&#125;,</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line">count.<span class="property">value</span>++; <span class="comment">// 输出 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不再需要此侦听器时</span></span><br><span class="line"><span class="title function_">stop</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Vue 3.5 支持</span></span><br><span class="line"><span class="keyword">const</span> &#123;stop, pause, resume&#125; = <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123; &#125;);</span><br><span class="line"><span class="comment">// 暂停侦听器</span></span><br><span class="line"><span class="title function_">pause</span>();</span><br><span class="line"><span class="comment">// 稍后恢复</span></span><br><span class="line"><span class="title function_">resume</span>();</span><br><span class="line"><span class="comment">// 停止</span></span><br><span class="line"><span class="title function_">stop</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li><p>副作用刷新时机, 会在组件更新之前执行副作用</p>
<ul>
<li>如果需要在组件更新后重新运行侦听器副作用</li>
<li>flush<ul>
<li>pre: ‘默认值’, 指定的回调应该在渲染前被调用</li>
<li>post: 将回调推迟到渲染之后调用, 注意：这也将推迟副作用的初始运行，直到组件的首次渲染完成。</li>
<li>sync: ‘始终同步触发’, 低效</li>
</ul>
</li>
</ul>
</li>
<li><p>副作用清除 onCleanup</p>
<ul>
<li>副作用即将重新执行时</li>
<li>侦听器被停止(setup 或 lifeCycle Hooks 中使用过, 则在组件卸载时)</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watchEffect</span>(<span class="title function_">async</span> (onCleanup) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; response, cancel &#125; = <span class="title function_">doAsyncWork</span>(id.<span class="property">value</span>);</span><br><span class="line">  <span class="comment">// cancel 会在 id 更改时调用</span></span><br><span class="line">  <span class="comment">// 取消之前未完成的请求</span></span><br><span class="line">  <span class="title function_">onCleanup</span>(cancel);</span><br><span class="line">  data.<span class="property">value</span> = <span class="keyword">await</span> response;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>侦听器调试, 只能用于开发模式下<ul>
<li>onTrack 响应式 property 和 ref 作为依赖项被追踪时被调用</li>
<li>onTrigger 依赖项变更导致副作用被触发时被调用</li>
</ul>
</li>
</ul>
<h4 id="watchPostEffect"><a href="#watchPostEffect" class="headerlink" title="watchPostEffect()"></a><a href="#watchEffect">watchPostEffect()</a></h4><p><code>watchEffect()</code> 使用 flush: ‘post’ 选项时的别名</p>
<h4 id="watchSyncEffect"><a href="#watchSyncEffect" class="headerlink" title="watchSyncEffect()"></a><a href="#watchEffect">watchSyncEffect()</a></h4><p><code>watchEffect()</code> 使用 flush: ‘sync’ 选项时的别名</p>
<h4 id="onWatcherCleanup"><a href="#onWatcherCleanup" class="headerlink" title="onWatcherCleanup()"></a>onWatcherCleanup()</h4><blockquote>
<p>Vue 3.5 支持</p>
</blockquote>
<p>注册一个清理函数, 在当前侦听器即将重新运行时执行, 只能在 watchEffect 作用函数或 watch 回调函数的同步执行期间调用(不能在异步函数中调用)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;watch, onWatcherCleanup&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="title function_">watch</span>(id, <span class="function">(<span class="params">newId</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;response, cancel&#125; = <span class="title function_">doAsyncWork</span>(newId);</span><br><span class="line">  <span class="comment">// 如果 id 有变化, 则调用 cancel</span></span><br><span class="line">  <span class="comment">// 如果之前的请求未完成, 则取消该请求</span></span><br><span class="line">  <span class="title function_">onWatcherCleanup</span>(cancel)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="响应式-工具"><a href="#响应式-工具" class="headerlink" title="响应式: 工具"></a>响应式: 工具</h3><h4 id="isRef"><a href="#isRef" class="headerlink" title="isRef()"></a>isRef()</h4><p>检查某个值是否是 ref</p>
<h4 id="unref"><a href="#unref" class="headerlink" title="unref()"></a>unref()</h4><p>如果参数是 ref, 则返回 ref 指向的内部值, 否则返回参数本身. 是 <code>isRef(val) ? val.value : val</code> 的一个语法糖</p>
<h4 id="toRef"><a href="#toRef" class="headerlink" title="toRef()"></a>toRef()</h4><p>将值、refs 或 getters 规范化为 refs(Vue 3.3 支持)</p>
<p>基于响应式对象上的一个属性, 新创建一个对应的 ref, 此 ref 与其源属性保持同步, 改变源属性的值将更新 ref 的值, 反之亦然</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, toRef &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">foo</span>: <span class="number">1</span>, <span class="attr">bar</span>: <span class="number">2</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> fooRef = <span class="title function_">toRef</span>(state, <span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="comment">// 更改 ref 会更新源属性</span></span><br><span class="line">fooRef.<span class="property">value</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">foo</span>); <span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 更改源属性会更新 ref</span></span><br><span class="line">state.<span class="property">foo</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(fooRef.<span class="property">value</span>); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<h4 id="toValue"><a href="#toValue" class="headerlink" title="toValue()"></a>toValue()</h4><blockquote>
<p>Vue 3.3 支持</p>
</blockquote>
<p>将值、refs 或 getters 规范化为值, 与 unref() 类似, 不同的是此函数也会规范化 getter 函数, 如果参数是一个 getter, 它将会被调用并且返回它的返回值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; toValue, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="title function_">toValue</span>(<span class="number">1</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="title function_">toValue</span>(<span class="title function_">ref</span>(<span class="number">1</span>)); <span class="comment">// 1</span></span><br><span class="line"><span class="title function_">toValue</span>(<span class="function">() =&gt;</span> <span class="number">1</span>); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<h4 id="toRefs"><a href="#toRefs" class="headerlink" title="toRefs()"></a>toRefs()</h4><blockquote>
<p>方便消费组件可以在不丢失响应性的情况下对返回的对象进行分解/扩散</p>
</blockquote>
<p>将一个响应式对象转换为一个普通对象, 这个普通对象的每个属性都指向源对象相应属性的 ref, 每个单独的 ref 都是使用 <code>toRef()</code> 创建的</p>
<ul>
<li>toRefs 在调用时只为源对象上的可以枚举的属性创建 ref, 如果为可能还不存在的属性创建 ref 时, 使用 toRef</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, toRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">foo</span>: <span class="number">1</span>, <span class="attr">bar</span>: <span class="number">2</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> stateAsRefs = <span class="title function_">toRefs</span>(state);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">stateAsRefs 的类型:</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  foo: Ref&lt;number&gt;,</span></span><br><span class="line"><span class="comment">  bar: Ref&lt;number&gt;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ref 和原始 property 已经 &quot;链接&quot; 起来了</span></span><br><span class="line">state.<span class="property">foo</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stateAsRefs.<span class="property">foo</span>.<span class="property">value</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line">stateAsRefs.<span class="property">foo</span>.<span class="property">value</span>++;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state.<span class="property">foo</span>); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<h4 id="isProxy"><a href="#isProxy" class="headerlink" title="isProxy()"></a>isProxy()</h4><p>检查一个对象是否由 <code>reactive()</code>, <code>readonly()</code>, <code>shallowReactive()</code>, <code>shallowReadonly()</code> 创建的代理</p>
<h4 id="isReactive"><a href="#isReactive" class="headerlink" title="isReactive()"></a>isReactive()</h4><p>检查一个对象是否由 <code>reactive()</code>, <code>shallowReactive()</code> 创建的代理</p>
<h4 id="isReadonly"><a href="#isReadonly" class="headerlink" title="isReadonly()"></a>isReadonly()</h4><p>检查对象是否是由 <code>readonly()</code>, <code>shallowReadonly()</code> 创建的只读代理, 只读对象的属性可以更改, 但不能通过传入的对象直接赋值</p>
<h3 id="响应式-进阶"><a href="#响应式-进阶" class="headerlink" title="响应式: 进阶"></a>响应式: 进阶</h3><h4 id="shallowRef"><a href="#shallowRef" class="headerlink" title="shallowRef()"></a>shallowRef()</h4><p><a href="#ref">ref()</a> 的浅层作用形式</p>
<ul>
<li>浅层 ref 的内部值将会原样存储和暴露, 并且不会被深层递归地转为响应式</li>
<li>只有对 <code>.value</code> 的访问是响应式的</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; shallowRef &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">shallowRef</span>(&#123; <span class="attr">count</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="comment">// 不会触发更改</span></span><br><span class="line">state.<span class="property">value</span>.<span class="property">count</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 会触发更新</span></span><br><span class="line">state.<span class="property">value</span> = &#123; <span class="attr">count</span>: <span class="number">2</span> &#125;;</span><br></pre></td></tr></table></figure>

<h4 id="triggerRef"><a href="#triggerRef" class="headerlink" title="triggerRef()"></a>triggerRef()</h4><p>强制触发依赖一个 <code>浅层 ref</code> 的副作用, 通常对浅引用的内部值进行深度变更后使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; shallowRef, watchEffect, triggerRef &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> shallow = <span class="title function_">shallowRef</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 立刻执行一次副作用, 输出 hello world</span></span><br><span class="line"><span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(shallow.<span class="property">value</span>.<span class="property">name</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 更改不会触发副作用, ref 是浅层的</span></span><br><span class="line">shallow.<span class="property">value</span>.<span class="property">name</span> = <span class="string">&#x27;hello gg&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手动触发浅层 ref 的副作用, 输出 hello gg</span></span><br><span class="line"><span class="title function_">triggerRef</span>(shallow);</span><br></pre></td></tr></table></figure>

<h4 id="customRef"><a href="#customRef" class="headerlink" title="customRef()"></a>customRef()</h4><blockquote>
<p>它需要一个工厂函数，该函数接收 track 和 trigger 函数作为参数，并且应该返回一个带有 get 和 set 的对象</p>
</blockquote>
<p>创建一个自定义的 ref, 显式声明对其依赖追踪和更新触发的控制方式</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span> <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;text&quot;</span> /&gt;</span> <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> text = <span class="title function_">useDebouncedRef</span>(<span class="string">&#x27;hello&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; customRef &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 创建一个防抖 ref, 只在最后一次 set 调用后的一段固定间隔后再调用</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">useDebouncedRef</span>(<span class="params">value, delay = <span class="number">200</span></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">let</span> timeout;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> <span class="title function_">customRef</span>(<span class="function">(<span class="params">track, trigger</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">get</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="title function_">track</span>();</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">return</span> value;</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">set</span>(<span class="params">newValue</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="built_in">clearTimeout</span>(timeout);</span></span><br><span class="line"><span class="language-javascript">          timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            value = newValue;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">trigger</span>();</span></span><br><span class="line"><span class="language-javascript">          &#125;, delay);</span></span><br><span class="line"><span class="language-javascript">        &#125;,</span></span><br><span class="line"><span class="language-javascript">      &#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="shallowReactive"><a href="#shallowReactive" class="headerlink" title="shallowReactive()  "></a>shallowReactive() <em id="shallowReactive"></em> <!-- markdownlint-disable-line --></h4><p><a href="#reactive">reactive()</a> 的浅层作用形式</p>
<ul>
<li>没有深层级的转换, 浅层响应式对象里只有根级别的属性是响应式的</li>
<li>属性的值会被原样存储和暴露, 值为 ref 的属性不会自动解包</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; shallowReactive, isReactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">shallowReactive</span>(&#123; <span class="attr">foo</span>: <span class="number">1</span>, <span class="attr">nested</span>: &#123; <span class="attr">bar</span>: <span class="number">2</span> &#125; &#125;);</span><br><span class="line"><span class="comment">// 更改状态自身的属性是响应式的</span></span><br><span class="line">state.<span class="property">foo</span>++;</span><br><span class="line"><span class="comment">// 嵌套对象不会被转为响应式</span></span><br><span class="line"><span class="title function_">isReactive</span>(state.<span class="property">nested</span>); <span class="comment">// false</span></span><br><span class="line"><span class="comment">// 不是响应式的</span></span><br><span class="line">state.<span class="property">nested</span>.<span class="property">bar</span>++;</span><br></pre></td></tr></table></figure>

<h4 id="shallowReadonly"><a href="#shallowReadonly" class="headerlink" title="shallowReadonly()"></a>shallowReadonly()</h4><p><a href="#readonly">readonly()</a> 的浅层作用形式</p>
<ul>
<li>没有深层级的转换, 只有根层级的属性变为了只读</li>
<li>属性的值会被原样存储和暴露, 值为 ref 的属性不会自动解包</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; shallowReadonly, isReadonly &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = <span class="title function_">shallowReadonly</span>(&#123; <span class="attr">foo</span>: <span class="number">1</span>, <span class="attr">nested</span>: &#123; <span class="attr">bar</span>: <span class="number">2</span> &#125; &#125;);</span><br><span class="line"><span class="comment">// 更改状态自身的属性会失败</span></span><br><span class="line">state.<span class="property">foo</span>++;</span><br><span class="line"><span class="comment">// 可以更改嵌套的属性</span></span><br><span class="line"><span class="title function_">isReadonly</span>(state.<span class="property">nested</span>); <span class="comment">// false</span></span><br><span class="line"><span class="comment">// 允许更改嵌套的属性</span></span><br><span class="line">state.<span class="property">nested</span>.<span class="property">bar</span>++;</span><br></pre></td></tr></table></figure>

<h4 id="toRaw"><a href="#toRaw" class="headerlink" title="toRaw()"></a>toRaw()</h4><blockquote>
<p>可用于临时读取数据而无需承担代理访问/跟踪开销，也可用于写入数据而避免触发更改. 不建议保留对原始对象的持久引用</p>
</blockquote>
<p>返回由 <code>reactive()</code>, <code>readonly()</code>, <code>shallowReactive()</code>, <code>shallowReadonly()</code> 创建的的代理对应的原始对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> foo = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> reactiveFoo = <span class="title function_">reactive</span>(foo);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">toRaw</span>(reactiveFoo) === foo); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h4 id="markRaw"><a href="#markRaw" class="headerlink" title="markRaw()"></a>markRaw()</h4><p>将一个对象标记为不可转为代理并返回该对象本身</p>
<ul>
<li>有些值不应该是响应式的，例如复杂的第三方类实例或 Vue 组件对象</li>
<li>当渲染具有不可变数据源的大列表时，跳过代理转换可以提高性能</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; markRaw, reactive, isReactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> foo = <span class="title function_">markRaw</span>(&#123;&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isReactive</span>(<span class="title function_">reactive</span>(foo))); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 嵌套在其他响应式对象中时也可以使用</span></span><br><span class="line"><span class="keyword">const</span> bar = <span class="title function_">reactive</span>(&#123; foo &#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isReactive</span>(bar.<span class="property">foo</span>)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h4 id="effectScope"><a href="#effectScope" class="headerlink" title="effectScope()  "></a>effectScope() <em id='effectscope'></em> <!-- markdownlint-disable-line --></h4><p>创建一个 effect 作用域, 可以捕获其中所创建的响应式副作用(计算属性和侦听器), 这样捕获到的副作用可以一起处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; effectScope, watch, watchEffect &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 effect 作用域</span></span><br><span class="line"><span class="keyword">const</span> scope = <span class="title function_">effectScope</span>();</span><br><span class="line"></span><br><span class="line">scope.<span class="title function_">run</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> doubled = <span class="title function_">computed</span>(<span class="function">() =&gt;</span> counter.<span class="property">value</span> * <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">watch</span>(doubled, <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(doubled.<span class="property">value</span>, newValue, oldValue)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="title function_">watchEffect</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Count: &#x27;</span>, doubled.<span class="property">value</span>));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 停止当前作用域内的所有 effect</span></span><br><span class="line">scope.<span class="title function_">stop</span>();</span><br></pre></td></tr></table></figure>

<h4 id="getCurrentScope"><a href="#getCurrentScope" class="headerlink" title="getCurrentScope()"></a><a href="#effectscope">getCurrentScope()</a></h4><p>如果存在则返回当前活跃的 effect 作用域</p>
<h4 id="onScopeDispose"><a href="#onScopeDispose" class="headerlink" title="onScopeDispose()"></a><a href="#effectscope">onScopeDispose()</a></h4><blockquote>
<p>此方法可以作为可复用的组合式函数中 <code>onUnmounted</code> 的替代品, 它并不与组件耦合, 因为每个 Vue 组件的 setup 函数也是在一个 effect 作用域中调用的</p>
</blockquote>
<p>在当前活跃的 effect 作用域上注册一个处理回调函数, 当相关的 effect 作用域停止时会调用注册的回调函数, 这个方法可以作为可复用的组合式函数中的 onUnmounted 的替代</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onScopeDispose &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">onScopeDispose</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;活跃的 effect 作用域被停止...&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="生命周期钩子"><a href="#生命周期钩子" class="headerlink" title="生命周期钩子"></a>生命周期钩子</h3><blockquote>
<p>所有生命周期钩子函数必须在组件的 <code>setup()</code> 阶段<strong>同步调用</strong></p>
</blockquote>
<h4 id="onBeforeMount"><a href="#onBeforeMount" class="headerlink" title="onBeforeMount()  "></a>onBeforeMount() <em id="onBeforeMount"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>注册一个回调函数在组件 <strong>挂载之前</strong> 调用, 组件已经完成其响应式状态的设置, 但还没有创建 DOM 节点</p>
<h4 id="onMounted"><a href="#onMounted" class="headerlink" title="onMounted()  "></a>onMounted() <em id="onMounted"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>注册一个回调函数在组件 <strong>挂载完成</strong> 之后执行</p>
<ul>
<li>其所有同步子组件都已经被挂载(不包含 <strong>异步组件</strong> 或 <a href="#suspense">&lt;Suspense&gt;</a> 树内的组件)</li>
<li>其自身的 DOM 树已经创建完成并插入了父容器中, 仅当根容器存在于文档中</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;el&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; ref, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> el = <span class="title function_">ref</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(el.<span class="property">value</span>); <span class="comment">// &lt;div&gt;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="onBeforeUpdate"><a href="#onBeforeUpdate" class="headerlink" title="onBeforeUpdate()  "></a>onBeforeUpdate() <em id="onBeforeUpdate"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>注册一个回调函数在组件因为响应式状态变更而更新其 DOM 树之前调用</p>
<h4 id="onUpdated"><a href="#onUpdated" class="headerlink" title="onUpdated()  "></a>onUpdated() <em id="onUpdated"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>父组件的更新钩子在其子组件的更新钩子之后调用, 钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>注册一个回调函数在组件因为响应式状态变更而更新其 DOM 树之后调用</p>
<ul>
<li>如果需要在某个特定的状态更改后访问更新后的 DOM, 使用 <a href="#nextTick"><code>nextTick()</code></a></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;count&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;count++&quot;</span>&gt;</span>&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; ref, onUpdated &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onUpdated</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;count&#x27;</span>).<span class="property">textContent</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="onBeforeUnmount"><a href="#onBeforeUnmount" class="headerlink" title="onBeforeUnmount()  "></a>onBeforeUnmount() <em id="onBeforeUnmount"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>注册一个回调函数在组件实例被 <strong>卸载之前</strong> 调用, 此时组件实例还保有全部的功能</p>
<h4 id="onUnmounted"><a href="#onUnmounted" class="headerlink" title="onUnmounted()  "></a>onUnmounted() <em id="onUnmounted"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>注册一个回调函数在组件实例被 <strong>卸载之后</strong> 调用</p>
<ul>
<li>其所有子组件都已经被卸载</li>
<li>所有相关的响应式作用(<strong>渲染作用</strong> 以及 <code>setup()</code> 时创建的计算属性和侦听器)都已经停止</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; onMounted, onUnmounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">let</span> intervalId;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    intervalId = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">/* */</span></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(intervalId));</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="onActivated"><a href="#onActivated" class="headerlink" title="onActivated()  "></a>onActivated() <em id="onActivated"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>注册一个回调函数, 如果组件实例是 <code>&lt;KeepAlive&gt;</code> 缓存树的一部分, 当组件被插入到 DOM 中时调用</p>
<h4 id="onDeactivated"><a href="#onDeactivated" class="headerlink" title="onDeactivated()  "></a>onDeactivated() <em id="onDeactivated"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>注册一个回调函数, 如果组件实例是 <code>&lt;KeepAlive&gt;</code> 缓存树的一部分, 当组件从 DOM 中移除时调用</p>
<h4 id="onErrorCaptured"><a href="#onErrorCaptured" class="headerlink" title="onErrorCaptured()  "></a>onErrorCaptured() <em id="onErrorCaptured"></em> <!-- markdownlint-disable-line --></h4><p>注册一个回调函数在捕获了后代组件传递的错误时调用</p>
<h5 id="错误来源"><a href="#错误来源" class="headerlink" title="错误来源"></a>错误来源</h5><ul>
<li>组件渲染</li>
<li>事件处理器</li>
<li>生命周期钩子</li>
<li><code>setup()</code> 函数</li>
<li>侦听器</li>
<li>自定义指令钩子</li>
<li>过渡钩子</li>
</ul>
<p>函数参数包含三个, 通过返回 <code>false</code> 阻止错误继续向上传递</p>
<ul>
<li>错误对象</li>
<li>触发该错误的组件实例</li>
<li>说明错误来源类型的的信息字符串</li>
</ul>
<h5 id="错误传递规则"><a href="#错误传递规则" class="headerlink" title="错误传递规则"></a>错误传递规则</h5><ul>
<li>默认情况下, 所有的错误都会被发送到应用级 <code>app.config.errorHandler</code>(前提已经定义), 这样这些错误都能在一个统一的地方报告给分析服务</li>
<li>如果组件的继承链或组件链上存在多个 <code>errorCaptured</code> 钩子, 对于同一个错误, 这些钩子会被按从底到上的顺序一一调用, 这个过程称为 <strong>向上传递</strong>, 类似于原生 DOM 事件的冒泡机制</li>
<li>如果 <code>errorCaptured</code> 钩子本身抛出了一个错误, 那么这个错误和原来捕获到的错误都将被发送到 <code>app.config.errorHandler</code></li>
<li><code>errorCaptured</code> 钩子可以通过返回 <code>false</code> 来阻止错误继续向上传递</li>
</ul>
<h4 id="onRenderTracked"><a href="#onRenderTracked" class="headerlink" title="onRenderTracked()  "></a>onRenderTracked() <em id="onRenderTracked"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>仅在开发模式下可用, 且在服务器端渲染期间不会被调用</p>
</blockquote>
<p>注册一个回调函数在组件渲染过程中追踪到响应式依赖时调用</p>
<h4 id="onRenderTriggered"><a href="#onRenderTriggered" class="headerlink" title="onRenderTriggered()  "></a>onRenderTriggered() <em id="onRenderTriggered"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>仅在开发模式下可用, 且在服务器端渲染期间不会被调用</p>
</blockquote>
<p>注册一个回调函数在组件的响应式依赖的变更触发了组件渲染时调用</p>
<h4 id="onServerPrefetch"><a href="#onServerPrefetch" class="headerlink" title="onServerPrefetch()  "></a>onServerPrefetch() <em id="onServerPrefetch"></em> <!-- markdownlint-disable-line --></h4><p>注册一个异步函数, 在组件实例在服务器上被渲染之前调用, 可用于执行一些仅存在于服务端的数据抓取过程</p>
<ul>
<li>如果返回一个 Promise, 服务端渲染会在渲染该组件前等待该 Promise 完成</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; ref, onServerPrefetch, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> data = <span class="title function_">ref</span>(<span class="literal">null</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onServerPrefetch</span>(<span class="title function_">async</span> () =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 在服务器上预加载数据</span></span></span><br><span class="line"><span class="language-javascript">    data.<span class="property">value</span> = <span class="keyword">await</span> <span class="title function_">fetchOnServer</span>();</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span>(!data.<span class="property">value</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 在客户端组件挂载时再进行数据加载</span></span></span><br><span class="line"><span class="language-javascript">      data.<span class="property">value</span> = <span class="keyword">await</span> <span class="title function_">fetchOnClient</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="VNode-生命周期事件"><a href="#VNode-生命周期事件" class="headerlink" title="VNode 生命周期事件"></a>VNode 生命周期事件</h4><p>VNode 生命周期事件前缀从 <code>hook:</code> 更改为 <code>vue:</code>, 这些事件也可用于 HTML 元素, 和在组件上的用法一样</p>
<ul>
<li><code>vue:</code> 前缀为固定格式, 生命周期事件名可以使用 <code>kebab-case</code> 或者 <code>camelCase</code> 格式</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Vue 2.x --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child-component</span> @<span class="attr">hook:mounted</span>=<span class="string">&quot;onMounted&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child-component</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Vue 3.x --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child-component</span> @<span class="attr">vue:mounted</span>=<span class="string">&quot;onMounted&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child-component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child-component</span> @<span class="attr">vue:before-update</span>=<span class="string">&quot;onBeforeUpdate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child-component</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 等同于 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">child-component</span> @<span class="attr">vue:beforeUpdate</span>=<span class="string">&quot;onBeforeUpdate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">child-component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, createApp, defineComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HelloWorld</span> = <span class="title function_">defineComponent</span>(<span class="function">(<span class="params">props, ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;hello world component&#x27;</span>);</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="comment">/* 其它选项 */</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`&lt;h1&gt;This is template option.&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;hello-world @vue:before-mount=&quot;helloWorldBeforeMount&quot;&gt;&lt;/hello-world&gt;`</span>,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">helloWorldBeforeMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child component hooks before-mount triggered...&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&#x27;hello-world&#x27;</span>, <span class="title class_">HelloWorld</span>);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h3><h4 id="provide"><a href="#provide" class="headerlink" title="provide()  "></a>provide() <em id="provide"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p><code>provide()</code> 必须在组件的 <code>setup()</code> 阶段同步调用</p>
</blockquote>
<p>允许组件向其所有后代组件注入一个依赖, 不论组件层次深度</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; ref, provide &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">provide</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;hello world&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 或者是返回一个对象的函数</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">provide</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123; <span class="attr">foo</span>: <span class="string">&#x27;foo&#x27;</span> &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">provide</span>(<span class="string">&#x27;count&#x27;</span>, count);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="inject"><a href="#inject" class="headerlink" title="inject()  "></a>inject() <em id="inject"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p><code>inject()</code> 必须在组件的 <code>setup()</code> 阶段同步调用</p>
</blockquote>
<p>注入一个由祖先组件或整个应用(通过 <code>app.provide()</code> ) 提供的值</p>
<ul>
<li><p>第一个参数为注入的 key, 通过遍历父组件链匹配 key 来确定最近的组件所提供的值, 否则将返回 undefined</p>
</li>
<li><p>第二个参数可选, 即在没有匹配到 key 时使用的默认值,</p>
<ul>
<li>如果为一个工厂函数, 则用来返回某些创建复杂的值</li>
<li>如果默认值本身是一个函数, 则需要将 true 作为第三个参数传入, 表明这个函数就是默认值而不是工厂函数</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 注入值的默认方式</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> count = <span class="title function_">inject</span>(<span class="string">&#x27;count&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 注入一个值, 如果为空则使用提供的默认值</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> foo = <span class="title function_">inject</span>(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;default value&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 注入一个值, 如果为空则使用提供的工厂函数</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> bar = <span class="title function_">inject</span>(<span class="string">&#x27;bar&#x27;</span>, <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="title class_">Map</span>());</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 注入一个值, 表明提供的默认值是一个函数</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> fn = <span class="title function_">inject</span>(<span class="string">&#x27;fn&#x27;</span>, <span class="function">() =&gt;</span> &#123;&#125;, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="hasInjectionContext"><a href="#hasInjectionContext" class="headerlink" title="hasInjectionContext()"></a>hasInjectionContext()</h4><blockquote>
<p>Vue 3.3 支持</p>
</blockquote>
<p>如果 <code>inject()</code> 可以在错误的地方被调用而不触发警告, 则返回 true. 适用于希望在内部使用 <code>inject()</code> 而不向用户发出警告的库.</p>
<h2 id="选项式-API"><a href="#选项式-API" class="headerlink" title="选项式 API  "></a>选项式 API <em id="optional-api"></em> <!-- markdownlint-disable-line --></h2><p>选项式 API 以 <code>组件实例</code> 的概念为中心(this), 将响应性相关的细节抽象出来, 并强制按照选项来组织代码, 从而对初学者而言更为友好</p>
<h3 id="辅助"><a href="#辅助" class="headerlink" title="辅助"></a>辅助</h3><h4 id="useAttrs"><a href="#useAttrs" class="headerlink" title="useAttrs()"></a>useAttrs()</h4><p>用于在 SFC 中获取 setup 上下文中的 attrs 对象</p>
<h4 id="useSlots"><a href="#useSlots" class="headerlink" title="useSlots()"></a>useSlots()</h4><p>用于在 SFC 中获取 setup 上下文中的 slots 对象</p>
<h4 id="useModel"><a href="#useModel" class="headerlink" title="useModel()"></a>useModel()</h4><blockquote>
<p>Vue 3.4 支持</p>
</blockquote>
<p>驱动 defineModel() 的底层辅助函数, 优先使用 defineModel()</p>
<h4 id="useTemplateRef"><a href="#useTemplateRef" class="headerlink" title="useTemplateRef()"></a>useTemplateRef()</h4><blockquote>
<p>Vue 3.5 支持</p>
</blockquote>
<p>返回一个浅层 ref, 其值将与模板中的具有匹配 ref 的元素或组件同步</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&quot;input&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123;useTemplateRef, onMounted&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  </span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> imputRef = <span class="title function_">useTemplateRef</span>(<span class="string">&#x27;input&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    inputRef.<span class="property">value</span>.<span class="title function_">focus</span>();</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="useId"><a href="#useId" class="headerlink" title="useId()"></a>useId()</h4><blockquote>
<p>Vue 3.5 支持</p>
</blockquote>
<p>用于为无障碍属性或表单元素生成每个应用内唯一的 ID</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">:for</span>=<span class="string">&quot;id&quot;</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">:id</span>=<span class="string">&quot;id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123;useId&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> id = <span class="title function_">useId</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="useHost"><a href="#useHost" class="headerlink" title="useHost()"></a>useHost()</h4><blockquote>
<p>Vue 3.5 支持</p>
</blockquote>
<p>一个组合式 API 辅助函数, 返回当前 Vue 自定义元素的宿主元素</p>
<h4 id="useShadowRoot"><a href="#useShadowRoot" class="headerlink" title="useShadowRoot()"></a>useShadowRoot()</h4><blockquote>
<p>Vue 3.5 支持</p>
</blockquote>
<p>一个组合式 API 辅助函数, 返回当前 Vue 自定义元素的 shadow root</p>
<h3 id="状态选项"><a href="#状态选项" class="headerlink" title="状态选项"></a>状态选项</h3><h4 id="data"><a href="#data" class="headerlink" title="data"></a>data</h4><blockquote>
<p>以 _ 和 $ 开头的属性不会被组件实例代理, 因为它们可能和 Vue 的内置属性, API 方法冲突</p>
</blockquote>
<p>用于声明组件初始响应式状态的函数</p>
<h4 id="props"><a href="#props" class="headerlink" title="props  "></a>props <em id="props"></em> <!-- markdownlint-disable-line --></h4><p>用于声明组件的 props</p>
<ul>
<li><p>使用字符串数组的简易形式</p>
</li>
<li><p>使用对象的完整形式, 可以对单个 prop 进行更详细的配置</p>
<ul>
<li>type 定义 prop 的类型, 可以为原生构造函数之一</li>
<li>default 为该 prop 指定一个当其没有被传入值或值为 undefined 时的默认值,<br>对象或数组的默认值必须从一个工厂函数返回, 工厂函数也接收原始 prop 对象作为参数</li>
<li>required 定义该 prop 是否必需传入</li>
<li>validator 将 prop 值作为唯一参数传入的自定义验证函数</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 简易形式</span></span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>],</span><br><span class="line">  <span class="comment">// 对象形式</span></span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">String</span>, <span class="comment">// 类型检查</span></span><br><span class="line">    <span class="attr">age</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="number">18</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">validator</span>: <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value &gt; <span class="number">0</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">hobbies</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Array</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">(<span class="params">prop</span>) =&gt;</span> [<span class="string">&#x27;reading&#x27;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="computed-1"><a href="#computed-1" class="headerlink" title="computed"></a>computed</h4><p>用于声明在组件实例上暴露的计算属性</p>
<ul>
<li>包含一个只有 getter 函数的方法, 方法名为计算属性的名称</li>
<li>包含一个具有 get 和 set 函数的对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">age</span>: <span class="number">18</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="comment">// 只读计算属性</span></span><br><span class="line">    <span class="title function_">name</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 可读可写计算属性</span></span><br><span class="line">    <span class="attr">agePlus</span>: &#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">age</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">val</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = <span class="variable language_">this</span>.<span class="property">age</span> + val;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="methods"><a href="#methods" class="headerlink" title="methods"></a>methods</h4><blockquote>
<p>在声明方法时避免使用箭头函数, 因为它们不能通过 this 访问组件实例</p>
</blockquote>
<p>用于声明要混入到组件实例中的方法</p>
<h4 id="watch-1"><a href="#watch-1" class="headerlink" title="watch"></a><a href="#watch">watch</a></h4><p>用于声明在数据更改时调用的侦听回调</p>
<ul>
<li>普通形式</li>
<li>对象形式</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">age</span>: <span class="number">18</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">watch</span>: &#123;</span><br><span class="line">    <span class="comment">// 侦听根级属性</span></span><br><span class="line">    <span class="title function_">age</span>(<span class="params">val, oldVal</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(val, oldVal);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 字符串方法名称</span></span><br><span class="line">    <span class="attr">b</span>: <span class="string">&#x27;otherMethod&#x27;</span>,</span><br><span class="line">    <span class="comment">// 深度侦听属性</span></span><br><span class="line">    <span class="attr">c</span>: &#123;</span><br><span class="line">      <span class="title function_">handler</span>(<span class="params">val, oldVal</span>) &#123;&#125;,</span><br><span class="line">      <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">flush</span>: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">      <span class="title function_">onTrack</span>(<span class="params">e</span>) &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 侦听单个嵌套属性</span></span><br><span class="line">    <span class="string">&#x27;c.d&#x27;</span>: <span class="keyword">function</span> (<span class="params">val, oldVal</span>) &#123;&#125;,</span><br><span class="line">    <span class="comment">// 该回调函数在侦听开始之后立即调用</span></span><br><span class="line">    <span class="attr">e</span>: &#123;</span><br><span class="line">      <span class="title function_">handler</span>(<span class="params">val, oldVal</span>) &#123;&#125;,</span><br><span class="line">      <span class="attr">immediate</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 回调数组, 将会被逐一调用</span></span><br><span class="line">    <span class="attr">f</span>: [</span><br><span class="line">      <span class="string">&#x27;handler&#x27;</span>,</span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">handle2</span>(<span class="params">val, oldVal</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;handle2 triggered&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">handler</span>: <span class="keyword">function</span> <span class="title function_">handle3</span>(<span class="params">val, oldVal</span>) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;handle3 triggered&#x27;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">/* ... */</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="emits"><a href="#emits" class="headerlink" title="emits  "></a>emits <em id="emits"></em> <!-- markdownlint-disable-line --></h4><p>用于声明由组件触发的自定义事件</p>
<ul>
<li>使用字符串数组的简易形式</li>
<li>使用对象的完整形式</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 简易形式</span></span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;check&#x27;</span>],</span><br><span class="line">  <span class="comment">// 对象形式</span></span><br><span class="line">  <span class="attr">emits</span>: &#123;</span><br><span class="line">    <span class="comment">// 没有验证函数</span></span><br><span class="line">    <span class="attr">click</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">// 具有验证函数</span></span><br><span class="line">    <span class="attr">submit</span>: <span class="function">(<span class="params">payload</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (payload.<span class="property">email</span> &amp;&amp; payload.<span class="property">password</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`Invalid submit event payload!`</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">mounted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$emit(<span class="string">&#x27;check&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="expose"><a href="#expose" class="headerlink" title="expose"></a>expose</h4><blockquote>
<p>保持私有的内部状态或方法, 以避免紧耦合</p>
</blockquote>
<p>用于声明当组件实例被父组件通过模板引用访问时暴露的公共属性, 当使用 expose 时, 只有显式列出的属性将在组件实例上暴露</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">expose</span>: [<span class="string">&#x27;publicProp&#x27;</span>, <span class="string">&#x27;publicMethod&#x27;</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="渲染选项"><a href="#渲染选项" class="headerlink" title="渲染选项"></a>渲染选项</h3><h4 id="template"><a href="#template" class="headerlink" title="template"></a>template</h4><blockquote>
<p>通过 <code>template</code> 选项提供的模板将会在运行时即时编译</p>
</blockquote>
<p>用于声明组件的字符串模板</p>
<ul>
<li>如果字符串以 <code>#</code> 开头, 它将被用作 <code>querySelector</code> 的选择器, 并使用所选中元素的 <code>innerHTML</code> 作为模板字符串</li>
<li>如果存在 <code>render</code> 选项, 则 <code>template</code> 选项将被忽略</li>
<li>如果应用的根组件不含任何 <code>template</code> 或 <code>render</code> 选项, Vue 将尝试使用所挂载元素的 <code>innerHTML</code> 来作为模板</li>
</ul>
<h4 id="render"><a href="#render" class="headerlink" title="render"></a>render</h4><blockquote>
<p><code>render</code> 具有比 <code>template</code> 更高的优先级</p>
</blockquote>
<p>用于编程式地创建组件虚拟 DOM 树的函数</p>
<h4 id="compilerOptions"><a href="#compilerOptions" class="headerlink" title="compilerOptions"></a>compilerOptions</h4><p>用于配置组件模板的运行时编译选项, 支持与应用级 <code>app.config.compilerOptions</code> 相同的选项, 并针对当前组件有更高的优先级</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&#x27;#tpl&#x27;</span>,</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, &#123;&#125;, [<span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;This is tag p&#x27;</span>), <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="variable language_">this</span>.<span class="property">name</span>)]);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">compilerOptions</span>: &#123;</span><br><span class="line">    <span class="attr">delimiters</span>: [<span class="string">&#x27;&#123;&#123;&#x27;</span>, <span class="string">&#x27;&#125;&#125;&#x27;</span>],</span><br><span class="line">    <span class="attr">comments</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="title function_">isCustomElement</span>(<span class="params">tag</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> tag.<span class="title function_">startsWith</span>(<span class="string">&#x27;icon-&#x27;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="生命周期选项"><a href="#生命周期选项" class="headerlink" title="生命周期选项"></a>生命周期选项</h3><blockquote>
<p><a href="#composition-api">组合式 API</a> 中的 <code>setup()</code> 钩子函数会在所有 <a href="#optional-api">选项式 API</a> 钩子之前调用</p>
</blockquote>
<h4 id="beforeCreate"><a href="#beforeCreate" class="headerlink" title="beforeCreate"></a>beforeCreate</h4><p>在组件实例初始化完成之后立即调用</p>
<h4 id="created"><a href="#created" class="headerlink" title="created"></a>created</h4><p>在组件实例处理完所有与状态相关的选项后调用, 此时挂载阶段还未开始, <code>$el</code> 属性仍不可用</p>
<h4 id="beforeMount"><a href="#beforeMount" class="headerlink" title="beforeMount"></a><a href="#onBeforeMount">beforeMount</a></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>在组件被 <strong>挂载之前</strong> 调用, 组件已经完成了其响应式状态的设置, 但还没有创建 DOM 节点, 将首次执行 DOM 渲染过程</p>
<h4 id="mounted"><a href="#mounted" class="headerlink" title="mounted"></a><a href="#onMounted">mounted</a></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>在组件被 <strong>挂载之后</strong> 调用</p>
<h4 id="beforeUpdate"><a href="#beforeUpdate" class="headerlink" title="beforeUpdate"></a><a href="#onBeforeUpdate">beforeUpdate</a></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>在组件因为响应式状态变更而更新其 DOM 树之前调用</p>
<h4 id="updated"><a href="#updated" class="headerlink" title="updated"></a><a href="#onUpdated">updated</a></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>在组件因为响应式状态变更而更新其 DOM 树之后调用</p>
<h4 id="beforeUnmount"><a href="#beforeUnmount" class="headerlink" title="beforeUnmount"></a><a href="#onBeforeUnmount">beforeUnmount</a></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>在组件实例被 <strong>卸载之前</strong> 调用</p>
<h4 id="unmounted"><a href="#unmounted" class="headerlink" title="unmounted"></a><a href="#onUnmounted">unmounted</a></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>在组件实例被 <strong>卸载之后</strong> 调用</p>
<h4 id="activated"><a href="#activated" class="headerlink" title="activated"></a><a href="#onActivated">activated</a></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>如果组件实例是 <code>&lt;KeepAlive&gt;</code> 缓存树的一部分, 当组件被插入到 DOM 中时调用</p>
<h4 id="deactivated"><a href="#deactivated" class="headerlink" title="deactivated"></a><a href="#onDeactivated">deactivated</a></h4><blockquote>
<p>钩子函数在服务器端渲染期间不会被调用</p>
</blockquote>
<p>如果组件实例是 <code>&lt;KeepAlive&gt;</code> 缓存树的一部分, 当组件从 DOM 中移除时调用</p>
<h4 id="errorCaptured"><a href="#errorCaptured" class="headerlink" title="errorCaptured"></a><a href="#onErrorCaptured">errorCaptured</a></h4><p>在捕获了后代组件传递的错误时调用</p>
<h4 id="renderTracked"><a href="#renderTracked" class="headerlink" title="renderTracked"></a><a href="#onRenderTracked">renderTracked</a></h4><blockquote>
<p>仅在开发模式下可用, 且在服务器端渲染期间不会被调用</p>
</blockquote>
<p>在一个响应式依赖被组件的渲染作用追踪后调用</p>
<h4 id="renderTriggered"><a href="#renderTriggered" class="headerlink" title="renderTriggered"></a><a href="#onRenderTriggered">renderTriggered</a></h4><blockquote>
<p>仅在开发模式下可用, 且在服务器端渲染期间不会被调用</p>
</blockquote>
<p>在一个响应式依赖被组件触发了重新渲染之后调用</p>
<h4 id="serverPrefetch"><a href="#serverPrefetch" class="headerlink" title="serverPrefetch"></a><a href="#onServerPrefetch">serverPrefetch</a></h4><p>在组件实例在服务器上被渲染之前要完成的异步函数</p>
<h3 id="组合选项"><a href="#组合选项" class="headerlink" title="组合选项"></a>组合选项</h3><h4 id="provide-1"><a href="#provide-1" class="headerlink" title="provide"></a><a href="#provide">provide</a></h4><p>用于提供可以被后代组件注入的值</p>
<h4 id="inject-1"><a href="#inject-1" class="headerlink" title="inject"></a><a href="#inject">inject</a></h4><p>用于声明要通过从上层提供方匹配并注入当前组件的属性</p>
<ul>
<li>一个字符串数组</li>
<li>一个对象<ul>
<li>匹配可注入的 key(String 或者 Symbol)</li>
<li>一个对象<ul>
<li>from 属性表示匹配可用的注入的来源</li>
<li>default 属性用作候补值, 和 props 的默认值类似</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 字符串数组</span></span><br><span class="line">  <span class="attr">inject</span>: [<span class="string">&#x27;foo&#x27;</span>],</span><br><span class="line">  <span class="comment">// 对象形式指定默认值</span></span><br><span class="line">  <span class="attr">inject</span>: &#123;</span><br><span class="line">    <span class="attr">foo</span>: &#123; <span class="attr">default</span>: <span class="string">&#x27;foo&#x27;</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 对象形式指定来源</span></span><br><span class="line">  <span class="attr">inject</span>: &#123;</span><br><span class="line">    <span class="attr">foo</span>: &#123;</span><br><span class="line">      <span class="attr">from</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 对象形式使用工厂函数</span></span><br><span class="line">  <span class="attr">inject</span>: &#123;</span><br><span class="line">    <span class="attr">foo</span>: &#123;</span><br><span class="line">      <span class="attr">from</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="function">() =&gt;</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="mixins"><a href="#mixins" class="headerlink" title="mixins"></a>mixins</h4><blockquote>
<p>Mixin 钩子的调用顺序与提供它们的选项顺序相同, 且会在组件自身的钩子前调用</p>
</blockquote>
<p>一个包含组件选项对象的数组, 这些选项都将被混入到当前组件的实例中(不推荐使用)</p>
<h4 id="extends"><a href="#extends" class="headerlink" title="extends"></a>extends</h4><blockquote>
<p><code>extends</code> 和 <code>mixin</code> 实现上几乎相同, 但是表达的目标不同, <code>mixins</code> 选项基本用于组合功能, <code>extends</code> 一般更关注继承关系, 为<a href="#optional-api">选项式 API</a>设计的</p>
</blockquote>
<p>要继承的 <strong>基类</strong> 组件, 同 <code>mixins</code> 一样, 所有选项都将使用相关的策略进行合并, 不会处理 setup() 钩子的合并</p>
<h3 id="其他杂项"><a href="#其他杂项" class="headerlink" title="其他杂项"></a>其他杂项</h3><h4 id="name"><a href="#name" class="headerlink" title="name"></a>name</h4><blockquote>
<p>使用 name 选项可以覆盖推导出的名称, 或是在没有推导出名字是显式提供一个</p>
</blockquote>
<p>用于显式声明组件展示时的名称</p>
<ul>
<li>在组件自己的模板中递归引用自己时</li>
<li>在 Vue 开发者工具中的组件树显示时</li>
<li>在组件抛出的警告追踪栈信息中显示时</li>
</ul>
<h5 id="场景-1"><a href="#场景-1" class="headerlink" title="场景 1"></a>场景 1</h5><p>使用单文件组件时, 组件会根据其文件名推导出其名称, 例如 <code>MyComponent.vue</code> 的文件会推导出显式名称为 <code>MyComponent</code></p>
<h5 id="场景-2"><a href="#场景-2" class="headerlink" title="场景 2"></a>场景 2</h5><p>当使用 <code>app.component</code> 注册全局组件时, 这个全局 ID 会自动设置为其名称</p>
<h4 id="inheritAttrs"><a href="#inheritAttrs" class="headerlink" title="inheritAttrs  "></a>inheritAttrs <em id="inheritAttrs"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>默认情况下, 父组件传递的没有被子组件解析为 <code>props</code> 的 <code>attributes</code> 绑定会被透传</p>
</blockquote>
<p>用于控制是否启用默认的组件 <code>attribute</code> 透传行为, 默认为 true</p>
<ul>
<li>使用 <a href="#script-setup">&lt;script setup&gt;</a> 的<a href="#composition-api">组合式 API</a> 中声明这个选项时, 需要一个额外的 <code>&lt;script&gt;</code> 块</li>
<li>Vue 3.3 支持, 使用 <a href="#defineOptions">defineOptions</a> 声明</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 单独 script 块声明 inheritAttrs 选项 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">inheritAttrs</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- SFC 组合式 API --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> msg = <span class="string">&#x27;hello world&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> props = <span class="title function_">defineProps</span>([<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;input&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 暴露外部可访问的公共属性</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">defineExpose</span>(&#123; msg &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// vue 3.3 使用宏函数定义其它杂项</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">defineOptions</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;Comp-A&#x27;</span>, <span class="attr">inheritAttrs</span>: <span class="literal">false</span> &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="components"><a href="#components" class="headerlink" title="components"></a>components</h4><p>用于注册对当前组件实例可用的组件的配置对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">Foo</span>,</span><br><span class="line">    <span class="string">&#x27;my-component&#x27;</span>: &#123;</span><br><span class="line">      <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;Register local components...&#x27;</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="directives"><a href="#directives" class="headerlink" title="directives"></a><a href="#directive">directives</a></h4><p>用于注册对当前组件实例可用的指令的配置对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">directives</span>: &#123;</span><br><span class="line">    <span class="comment">// 在模板中启用 v-focus 指令</span></span><br><span class="line">    <span class="attr">focus</span>: &#123;</span><br><span class="line">      <span class="comment">/* 自定义指令的钩子函数配置 */</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="组件实例"><a href="#组件实例" class="headerlink" title="组件实例"></a>组件实例</h3><p>除了 $data 下的嵌套属性外, 其它的属性都是只读的</p>
<h4 id="data-1"><a href="#data-1" class="headerlink" title="$data"></a>$data</h4><p>从 <code>data</code> 选项函数返回的对象, 会被组件赋为响应式, 组件实例将会代理其数据对象的属性访问</p>
<h4 id="props-1"><a href="#props-1" class="headerlink" title="$props"></a><a href="#props">$props</a></h4><p>表示组件当前已解析的 <code>props</code> 对象</p>
<h4 id="el"><a href="#el" class="headerlink" title="$el"></a>$el</h4><p>该组件实例管理的 DOM 根节点, $el 直到组件 <strong>挂载完成</strong> 之前都是 undefined</p>
<h4 id="options"><a href="#options" class="headerlink" title="$options"></a>$options</h4><p>已解析的用于实例化当前组件的组件选项</p>
<ul>
<li>全局 mixin</li>
<li>组件 <code>extends</code> 的基组件</li>
<li>组件级 mixin</li>
</ul>
<h4 id="parent"><a href="#parent" class="headerlink" title="$parent"></a>$parent</h4><p>当前组件可能存在的父组件实例, 如果当前组件是顶层组件, 则为 null</p>
<h4 id="root"><a href="#root" class="headerlink" title="$root"></a>$root</h4><p>当前组件树的根组件实例, 如果当前组件实例没有父组件, 则为本身</p>
<h4 id="slots"><a href="#slots" class="headerlink" title="$slots"></a><a href="#v-slot">$slots</a></h4><p>表示父组件传入 <strong>插槽</strong> 的对象</p>
<h4 id="refs"><a href="#refs" class="headerlink" title="$refs"></a>$refs</h4><p>包含 DOM 元素和组件实例的对象, 通过 <strong>模板引用</strong> 注册</p>
<h4 id="attrs"><a href="#attrs" class="headerlink" title="$attrs"></a>$attrs</h4><p>包含了组件所有透传 <code>attributes</code> 的对象</p>
<h4 id="watch-2"><a href="#watch-2" class="headerlink" title="$watch()"></a><a href="#watch">$watch()</a></h4><p>用于命令式地创建侦听器的 API</p>
<h4 id="emit"><a href="#emit" class="headerlink" title="$emit()"></a>$emit()</h4><p>在当前组件触发一个自定义事件, 任何额外的参数都将传递给事件监听器的回调函数</p>
<h4 id="forceUpdate"><a href="#forceUpdate" class="headerlink" title="$forceUpdate()"></a>$forceUpdate()</h4><p>强制当前组件重新渲染, 仅仅影响实例本身和插入插槽内容的子组件</p>
<h4 id="nextTick-1"><a href="#nextTick-1" class="headerlink" title="$nextTick()"></a><a href="#nextTick">$nextTick()</a></h4><blockquote>
<p>和全局的 <code>nextTick</code> 的区别是传递给 <code>this.$nextTick()</code> 的回调函数会带上绑定当前组件实例上下文的 <code>this</code></p>
</blockquote>
<p>绑定在实例上的 <code>nextTick()</code> 函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">updated</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.$nextTick(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="内置内容"><a href="#内置内容" class="headerlink" title="内置内容"></a>内置内容</h2><h3 id="内置指令"><a href="#内置指令" class="headerlink" title="内置指令"></a>内置指令</h3><h4 id="v-text"><a href="#v-text" class="headerlink" title="v-text"></a>v-text</h4><p>更新元素的文本内容</p>
<h4 id="v-html"><a href="#v-html" class="headerlink" title="v-html"></a>v-html</h4><p>更新元素的 <code>innerHTML</code></p>
<h4 id="v-show"><a href="#v-show" class="headerlink" title="v-show"></a>v-show</h4><p>基于表达式值的真假来改变元素的可见性, 通过设置内联样式的 <code>display</code> CSS 属性来工作</p>
<h4 id="v-if"><a href="#v-if" class="headerlink" title="v-if"></a>v-if</h4><p>基于表达式值的真假来条件性地渲染元素或者模板片段, 同时使用 <code>v-if</code> 和 <code>v-for</code> 时, 前者的优先级更高</p>
<h4 id="v-else"><a href="#v-else" class="headerlink" title="v-else"></a>v-else</h4><p>表示 <code>v-if</code> 或 <code>v-if</code> / <code>v-else-if</code> 链式调用的块</p>
<h4 id="v-for"><a href="#v-for" class="headerlink" title="v-for"></a>v-for</h4><p>基于原始数据多次渲染元素或模板块</p>
<h4 id="v-on"><a href="#v-on" class="headerlink" title="v-on"></a>v-on</h4><blockquote>
<p>和原生 DOM 事件不一样, 组件触发的事件<strong>没有冒泡机制</strong>, 只能监听直接子组件触发的事件, 平级组件或嵌套组件间通信, 应使用一个外部事件总线或<a href="#store">全局状态管理</a>方案</p>
</blockquote>
<p>给元素绑定事件监听器, 缩写 <code>@</code>, 事件名称可以使用 <code>camelCase</code> 或 <code>kebab-case</code> 形式会被自动格式转换</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;$emit(&#x27;increaseBy&#x27;, 1)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MyComponent</span> @<span class="attr">increase-by</span>=<span class="string">&quot;(n) =&gt; count += n&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="内联事件处理器"><a href="#内联事件处理器" class="headerlink" title="内联事件处理器"></a>内联事件处理器</h5><p>事件被触发时执行的内联 javascript 语句(与 onClick 类似)</p>
<ul>
<li><p>需要处理原生 DOM 事件时, 手动传入一个特殊的 $event 变量, 或者使用内联箭头函数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 内联事件处理器  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;count++&quot;</span>&gt;</span>Add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;count&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;log(&#x27;click event&#x27;, $event)&quot;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;(event) =&gt; log(&#x27;click event&#x27;, event)&quot;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="方法事件处理器"><a href="#方法事件处理器" class="headerlink" title="方法事件处理器"></a>方法事件处理器</h5><p>一个指向组件上定义的方法的属性名或是路径</p>
<ul>
<li>自动接收原生 DOM 事件并立即触发执行</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 方法事件处理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;greet&quot;</span>&gt;</span>Greet<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">const name = ref(&#x27;Hello Greet&#x27;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">function greet(evt)&#123;</span></span><br><span class="line"><span class="comment">  console.log(name.value);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="事件修饰符"><a href="#事件修饰符" class="headerlink" title="事件修饰符"></a>事件修饰符</h5><ul>
<li>.stop 调用 <code>event.stopPropagation()</code></li>
<li>.prevent 调用 <code>event.preventDefault()</code></li>
<li>.capture 在捕获模式添加事件监听器</li>
<li>.self 只有事件从元素本身发出才触发处理函数</li>
<li>.{keyAlias} 只有在某些按键下触发处理函数</li>
<li>.once 最多触发一次处理函数</li>
<li>.passive 通过 <code>&#123;passive: true&#125;</code> 附加一个 DOM 事件</li>
</ul>
<h5 id="按键修饰符"><a href="#按键修饰符" class="headerlink" title="按键修饰符"></a>按键修饰符</h5><ul>
<li>.enter</li>
<li>.tab</li>
<li>.delete 捕获 delete 和 backspace 两个按键</li>
<li>.esc</li>
<li>.space</li>
<li>.up</li>
<li>.down</li>
<li>.left 只在鼠标左键事件触发处理函数</li>
<li>.right 只在鼠标右键事件触发处理函数</li>
<li>.middle 只在鼠标中键事件触发处理函数</li>
</ul>
<h5 id="系统按键修饰符"><a href="#系统按键修饰符" class="headerlink" title="系统按键修饰符"></a>系统按键修饰符</h5><ul>
<li>.ctrl</li>
<li>.alt</li>
<li>.shift</li>
<li>.meta</li>
<li>.exact 允许控制触发一个事件所需的确定组合的系统按键修饰符</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 当按下 ctrl 时, 即使同时按下 alt 或者 shift 也会触发 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.ctrl</span>=<span class="string">&quot;onClick&quot;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 仅当按下 ctrl 且未按任何其它键时才会触发 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.ctrl.exact</span>=<span class="string">&quot;onClick&quot;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 仅当没有按下任何系统按键时触发 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click.exact</span>=<span class="string">&quot;onClick&quot;</span>&gt;</span>click<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="v-bind"><a href="#v-bind" class="headerlink" title="v-bind  "></a>v-bind <em id="v-bind"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p><code>v-bind</code> 的绑定顺序会影响渲染结果</p>
</blockquote>
<p>动态的绑定一个或多个 attribute, 也可以是组件的 prop, 缩写 <code>:</code> 或 <code>.</code>(当使用 <code>.prop</code> 修饰符)</p>
<h5 id="绑定修饰符"><a href="#绑定修饰符" class="headerlink" title="绑定修饰符"></a>绑定修饰符</h5><ul>
<li>.camel 将 <code>kebab-case</code> 命名的属性转变为 <code>camelCase</code> 命名</li>
<li>.prop 强制绑定为 DOM property, 3.2 支持</li>
<li>.attr 强制绑定为 DOM attribute, 3.2 支持</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">:view-box.camel</span>=<span class="string">&quot;viewBox&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用 .prop 修饰符，会从组件选项 props 中移除, </span></span><br><span class="line"><span class="comment">  以 .[attr] 形式出现在组件 attrs 参数中并且**不会显示**在 DOM 上 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用 .attr 修饰符，会从组件选项 props 中移除, </span></span><br><span class="line"><span class="comment">  以 ^[attr] 形式出现在组件 attrs 参数中并且**会显示**在 DOM 上 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">:someProperty.prop</span>=<span class="string">&quot;someObject&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 等价于 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">.someProperty</span>=<span class="string">&quot;someObject&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="同名缩写"><a href="#同名缩写" class="headerlink" title="同名缩写"></a>同名缩写</h5><blockquote>
<p>Vue 3.4 支持</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 缩写形式的动态 attribute, 扩展为 :src=&quot;src&quot; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="v-model"><a href="#v-model" class="headerlink" title="v-model  "></a>v-model <em id="v-model"></em> <!-- markdownlint-disable-line --></h4><p>在表单输入元素或组件上创建双向绑定</p>
<ul>
<li>&lt;input&gt;</li>
<li>&lt;select&gt;</li>
<li>&lt;textarea&gt;</li>
<li>components</li>
</ul>
<h5 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h5><ul>
<li>.lazy 监听 change 事件而不是 input 事件</li>
<li>.number 将输入的合法字符换转为数字</li>
<li>.trim 移除输入内容两端空格</li>
</ul>
<h5 id="版本迭代"><a href="#版本迭代" class="headerlink" title="版本迭代"></a>版本迭代</h5><ul>
<li><p><a href="#v-bind"><code>v-bind</code></a> 的 <code>.sync</code> 修饰符和组件的 model 选项被<strong>移除</strong>, 使用 <code>v-model</code> 和参数代替</p>
</li>
<li><p>同一组件上可以使用多个 <code>v-model</code> 进行双向绑定</p>
</li>
<li><p>可自定义 <code>v-model</code> 修饰符</p>
</li>
<li><p>自定义组件时 <code>v-model</code> 的 <code>prop</code> 和 <code>event</code> 默认名称已更改</p>
<ul>
<li>prop: <code>value</code> -&gt; <code>modelValue</code></li>
<li>event: <code>input</code> -&gt; <code>update:modelValue</code></li>
</ul>
</li>
</ul>
<h5 id="migration"><a href="#migration" class="headerlink" title="migration"></a>migration</h5><ul>
<li>所有子组件 <code>.sync</code> 修饰符的部分替换为 <code>v-model</code></li>
<li>未带参数的 <code>v-model</code>, 修改子组件的 prop -&gt; <code>modelValue</code>, event -&gt; <code>update:modelValue</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 带参数 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span> <span class="attr">:title.sync</span>=<span class="string">&quot;pageTitle&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 替换为 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span> <span class="attr">:title</span>=<span class="string">&quot;pageTitle&quot;</span> @<span class="attr">update:title</span>=<span class="string">&quot;pageTile = $event&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123; <span class="attr">title</span>: <span class="title class_">String</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;update:title&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> changePageTitle = <span class="keyword">function</span> (<span class="params">title</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">emit</span>(<span class="string">&#x27;update:title&#x27;</span>, title);</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 未带参数替换为 v-model --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ChildComponent</span> <span class="attr">v-model</span>=<span class="string">&quot;pageTitle&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 以前是`value: String`</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123; <span class="attr">modelValue</span>: <span class="title class_">String</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;update:modelValue&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> changePageTitle = <span class="keyword">function</span> (<span class="params">title</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">emit</span>(<span class="string">&#x27;update:modelValue&#x27;</span>, title); <span class="comment">// 以前是 `this.$emit(&#x27;input&#x27;, title)`</span></span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Vue-2-0"><a href="#Vue-2-0" class="headerlink" title="Vue 2.0"></a>Vue 2.0</h5><ul>
<li><code>v-model</code> 只能使用 <code>value</code> 作为 prop, 并监听子组件抛出的 <code>input</code> 事件, 如果使用其他 prop, 必须使用 <code>v-bind.sync</code> 同步</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span> <span class="attr">:value</span>=<span class="string">&quot;pageTitle&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;pageTitle = $event&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 简写方式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span> <span class="attr">v-model</span>=<span class="string">&quot;pageTitle&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">props</span>: [<span class="string">&#x27;value&#x27;</span>],</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.$emit(<span class="string">&#x27;input&#x27;</span>, <span class="string">&#x27;hello value&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Vue-2-2"><a href="#Vue-2-2" class="headerlink" title="Vue 2.2"></a>Vue 2.2</h5><ul>
<li>增加组件选项 <code>model</code>, 允许自定义 <code>v-model</code> 的 prop 和 event, 只能在组件上使用一个 model</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span> <span class="attr">:value</span>=<span class="string">&quot;pageTitle&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;pageTitle = $event&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 简写方式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span> <span class="attr">v-model</span>=<span class="string">&quot;pageTitle&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">model</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">prop</span>: <span class="string">&#x27;title&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">event</span>: <span class="string">&#x27;change&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">props</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 这将允许 `value` 属性用于其他用途</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">value</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 使用 `title` 代替 `value` 作为 model 的 prop</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">title</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">type</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript">        <span class="attr">default</span>: <span class="string">&#x27;Default title&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Vue-2-3"><a href="#Vue-2-3" class="headerlink" title="Vue 2.3"></a>Vue 2.3</h5><ul>
<li>增加 <code>.sync</code> 修饰符</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span> <span class="attr">:title</span>=<span class="string">&quot;pageTitle&quot;</span> @<span class="attr">update:title</span>=<span class="string">&quot;pageTitle = $event&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 简写方式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span> <span class="attr">:title.sync</span>=<span class="string">&quot;pageTitle&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="Vue-3-x"><a href="#Vue-3-x" class="headerlink" title="Vue 3.x"></a>Vue 3.x</h5><ul>
<li><code>v-model</code> 默认传递 <code>modelValue</code> prop, 并接收子组件抛出的 <code>update:modelValue</code> 事件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 单个 v-model 绑定 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:modelValue</span>=<span class="string">&quot;pageTitle&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">update:modelValue</span>=<span class="string">&quot;pageTitle = $event&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 简写方式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span> <span class="attr">v-model</span>=<span class="string">&quot;pageTitle&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> props = <span class="title function_">defineProps</span>([<span class="string">&#x27;modelValue&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;update:modelValue&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 触发事件</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">emit</span>(<span class="string">&#x27;update:modelValue&#x27;</span>, <span class="string">&#x27;hello modelValue&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>多个 <code>v-model</code> 绑定</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 多个 v-model 绑定 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:title</span>=<span class="string">&quot;pageTitle&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">update:title</span>=<span class="string">&quot;pageTitle = $event&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:content</span>=<span class="string">&quot;pageContent&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">update:content</span>=<span class="string">&quot;pageContent = $event&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 简写方式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">my-component</span> <span class="attr">v-model:title</span>=<span class="string">&quot;pageTitle&quot;</span> <span class="attr">v-model:content</span>=<span class="string">&quot;pageContent&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123; <span class="attr">title</span>: <span class="title class_">String</span>, <span class="attr">content</span>: <span class="title class_">String</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;update:title&#x27;</span>, <span class="string">&#x27;update:content&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">emit</span>(<span class="string">&#x27;update:title&#x27;</span>, <span class="string">&#x27;hello title&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">emit</span>(<span class="string">&#x27;update:content&#x27;</span>, <span class="string">&#x27;hello content&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>处理 <code>v-model</code> 修饰符</p>
<ul>
<li>不带参数: 生成的 prop 名称为 <code>modelModifiers</code> 的对象, 包含传入的修饰符</li>
<li>带参数: 生成的 prop 名称为 <code>arg + &#39;Modifiers&#39;</code></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp, ref, h, defineComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// v-model 不带参数</span></span><br><span class="line"><span class="comment">// &lt;with-out-args v-model.capitalize=&quot;myText&quot; /&gt;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WithoutArgs</span> = <span class="title function_">defineComponent</span>(<span class="function">(<span class="params">props, &#123; emit &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(props);</span><br><span class="line">  <span class="keyword">const</span> emitValue = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">modelModifiers</span>.<span class="property">capitalize</span>) &#123;</span><br><span class="line">      value = value.<span class="title function_">charAt</span>(<span class="number">0</span>).<span class="title function_">toUpperCase</span>() + value.<span class="title function_">slice</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&#x27;update:modelValue&#x27;</span>, value);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, [</span><br><span class="line">      <span class="string">&#x27;without args &#x27;</span>,</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;input&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">        <span class="attr">placeholder</span>: <span class="string">&#x27;write something...&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: props.<span class="property">modelValue</span>,</span><br><span class="line">        <span class="attr">onInput</span>: emitValue,</span><br><span class="line">      &#125;),</span><br><span class="line">    ]);</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;modelValue&#x27;</span>, <span class="string">&#x27;modelModifiers&#x27;</span>],</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;update:modelValue&#x27;</span>],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// v-model 带参数</span></span><br><span class="line"><span class="comment">// &lt;with-args v-model:description.uppercase=&quot;myText&quot; /&gt;</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WithArgs</span> = <span class="title function_">defineComponent</span>(<span class="function">(<span class="params">props, &#123; emit &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(props);</span><br><span class="line">  <span class="keyword">const</span> emitValue = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> value = e.<span class="property">target</span>.<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">descriptionModifiers</span>.<span class="property">uppercase</span>) &#123;</span><br><span class="line">      value = value.<span class="title function_">toUpperCase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">emit</span>(<span class="string">&#x27;update:description&#x27;</span>, value);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, [</span><br><span class="line">      <span class="string">&#x27;with args &#x27;</span>,</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;input&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;text&#x27;</span>,</span><br><span class="line">        <span class="attr">placeholder</span>: <span class="string">&#x27;write something...&#x27;</span>,</span><br><span class="line">        <span class="attr">value</span>: props.<span class="property">description</span>,</span><br><span class="line">        <span class="attr">onInput</span>: emitValue,</span><br><span class="line">      &#125;),</span><br><span class="line">    ]);</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;description&#x27;</span>, <span class="string">&#x27;descriptionModifiers&#x27;</span>],</span><br><span class="line">  <span class="attr">emits</span>: [<span class="string">&#x27;update:description&#x27;</span>],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> v1 = <span class="title function_">ref</span>(<span class="string">&#x27;hello without args&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> v2 = <span class="title function_">ref</span>(<span class="string">&#x27;hello with args&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> [</span><br><span class="line">      <span class="comment">// 渲染 v-model 不带参数的组件</span></span><br><span class="line">      <span class="title function_">h</span>(<span class="title class_">WithoutArgs</span>, &#123;</span><br><span class="line">        <span class="attr">modelValue</span>: v1.<span class="property">value</span>,</span><br><span class="line">        <span class="attr">modelModifiers</span>: &#123; <span class="attr">capitalize</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        <span class="string">&#x27;onUpdate:modelValue&#x27;</span>: <span class="function">(<span class="params">value</span>) =&gt;</span> (v1.<span class="property">value</span> = value),</span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="comment">// 渲染 v-model 带参数的组件</span></span><br><span class="line">      <span class="title function_">h</span>(<span class="title class_">WithArgs</span>, &#123;</span><br><span class="line">        <span class="attr">description</span>: v2.<span class="property">value</span>,</span><br><span class="line">        <span class="attr">descriptionModifiers</span>: &#123; <span class="attr">uppercase</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        <span class="string">&#x27;onUpdate:description&#x27;</span>: <span class="function">(<span class="params">value</span>) =&gt;</span> (v2.<span class="property">value</span> = value),</span><br><span class="line">      &#125;),</span><br><span class="line">    ];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="v-slot"><a href="#v-slot" class="headerlink" title="v-slot  "></a>v-slot <em id="v-slot"></em> <!-- markdownlint-disable-line --></h4><blockquote>
<p>如果混用了 <strong>具名插槽</strong> 和 <strong>默认插槽</strong>, 则需要为 <strong>默认插槽</strong> 使用显式的 <code>&lt;template&gt;</code> 标签, 直接为组件添加 <code>v-slot</code> 指令将导致编译错误</p>
</blockquote>
<p>用于声明具名插槽或是期望接收 props 的作用域插槽, 缩写 <code>#</code></p>
<h5 id="限制使用"><a href="#限制使用" class="headerlink" title="限制使用"></a>限制使用</h5><p>能够合法在函数参数位置使用的 js 表达式, 支持解构语法. 绑定的值是可选的(只有在给作用域插槽传递 props 才需要)</p>
<ul>
<li>&lt;template&gt;</li>
<li>components(用于带有 prop 的单个默认插槽)</li>
</ul>
<h5 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h5><p>组件中包含多个插槽出口, <code>&lt;slot&gt;</code> 内置元素的特殊属性 <code>name</code> 用来给每个插槽分配唯一的 ID 以确定每一处要渲染的内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- BaseComponent 组件模板 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;header&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;footer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 父组件使用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">BaseComponent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">header</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- header 插槽的内容 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 所有位于顶级的非 template 节点都被隐式地当作默认插槽的内容 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is the first tag p<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>This is the second tag p<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">footer</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- footer 插槽的内容 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">BaseComponent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="动态插槽"><a href="#动态插槽" class="headerlink" title="动态插槽"></a>动态插槽</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 动态插槽名，支持 `#SlotName` 缩写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">base-layout</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:</span>[<span class="attr">dynamicSlotName</span>]&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 等同于 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #[<span class="attr">dynamicSlotName</span>]&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">base-layout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="作用域插槽"><a href="#作用域插槽" class="headerlink" title="作用域插槽"></a>作用域插槽</h5><ul>
<li>默认插槽接收 props, 通过子组件标签上的 <code>v-slot</code> 指令接收一个插槽 props 对象</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">slot</span> <span class="attr">text</span>=<span class="string">&quot;hello text&quot;</span> <span class="attr">message</span>=<span class="string">&quot;hello message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 单个默认作用域插槽, 直接使用子组件标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">v-slot</span>=<span class="string">&quot;slotScope&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;slotScope.text&#125;&#125; - &#123;&#123;slotScope.message&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">MyComponent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>具名插槽 props 可以作为 <code>v-slot</code> 指令的值被访问到 <code>v-slot:name=&quot;slotScope&quot;</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 具名作用域插槽 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">MyComponent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">header</span>=<span class="string">&quot;headerScope&quot;</span>&gt;</span> &#123;&#123; headerScope &#125;&#125; <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 使用显式的默认插槽 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>=<span class="string">&quot;&#123; message &#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; message &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Here&#x27;s some contact info<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">MyComponent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="v-pre"><a href="#v-pre" class="headerlink" title="v-pre"></a>v-pre</h4><p>跳过该元素及其所有子元素的编译</p>
<h4 id="v-once"><a href="#v-once" class="headerlink" title="v-once"></a>v-once</h4><p>仅渲染元素和组件一次, 并跳过之后的更新</p>
<h4 id="v-memo"><a href="#v-memo" class="headerlink" title="v-memo"></a>v-memo</h4><blockquote>
<p>Vue 3.2 支持</p>
</blockquote>
<p>缓存一个模板的子树, 根据传入的依赖值数组的比较结果控制子树的更新</p>
<ul>
<li>如果依赖值为空数组, 功能等同于 <code>v-once</code></li>
<li>结合 <code>v-for</code> 使用, 必须确保和 <code>v-for</code> 用在同一个元素上, 否则无效</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 普通用法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-memo</span>=<span class="string">&quot;[valueA, valueB]&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- v-for | v-memo --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span> <span class="attr">v-memo</span>=<span class="string">&quot;[item.id === selected]&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>ID: &#123;&#123; item.id &#125;&#125; - selected: &#123;&#123; item.id === selected &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>more child nodes<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="v-cloak"><a href="#v-cloak" class="headerlink" title="v-cloak"></a>v-cloak</h4><blockquote>
<p>该指令只在没有构建步骤的环境下需要使用</p>
</blockquote>
<p>用于隐藏尚未完成编译的 DOM 模板</p>
<h3 id="内置组件"><a href="#内置组件" class="headerlink" title="内置组件  "></a>内置组件 <em id="built-in-component"></em> <!-- markdownlint-disable-line --></h3><blockquote>
<p>内置组件无需注册便可以直接在模板中使用，同时也支持 <code>tree-shake</code>; 仅在使用时才会包含在构建中<br>在 <a href="#rendering-func"><strong>渲染函数</strong></a> 中使用内置组件时, 需要显式引入</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h, <span class="title class_">KeepAlive</span>, <span class="title class_">Transition</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, ctx</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="title class_">Transition</span>, &#123; <span class="attr">mode</span>: <span class="string">&#x27;out-in&#x27;</span> &#125; <span class="comment">/* ... */</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="lt-Transition-gt"><a href="#lt-Transition-gt" class="headerlink" title="&lt;Transition&gt;"></a>&lt;Transition&gt;</h4><p>为单个元素或组件提供动画过渡效果</p>
<h5 id="lt-Transition-gt-props"><a href="#lt-Transition-gt-props" class="headerlink" title="&lt;Transition&gt; props"></a>&lt;Transition&gt; props</h5><ul>
<li>name</li>
<li>css</li>
<li>type</li>
<li>duration</li>
<li>mode</li>
<li>appear</li>
<li>enterFromClass</li>
<li>enterActiveClass</li>
<li>enterToClass</li>
<li>appearFromClass</li>
<li>appearActiveClass</li>
<li>appearToClass</li>
<li>leaveFromClass</li>
<li>leaveActiveClass</li>
<li>leaveToClass</li>
</ul>
<h5 id="lt-Transition-gt-事件"><a href="#lt-Transition-gt-事件" class="headerlink" title="&lt;Transition&gt; 事件"></a>&lt;Transition&gt; 事件</h5><ul>
<li>@before-enter</li>
<li>@before-leave</li>
<li>@enter</li>
<li>@leave</li>
<li>@appear</li>
<li>@after-enter</li>
<li>@after-leave</li>
<li>@after-appear</li>
<li>@enter-cancelled</li>
<li>@leave-cancelled(v-show only)</li>
<li>@appear-cancelled</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 单个元素 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Transition</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;ok&quot;</span>&gt;</span>toggled content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Transition</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 动态组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Transition</span> <span class="attr">name</span>=<span class="string">&quot;fade&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;out-in&quot;</span> <span class="attr">appear</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Transition</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 事件钩子 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;transition-demo&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Transition</span> @<span class="attr">after-enter</span>=<span class="string">&quot;transitionComplete&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-show</span>=<span class="string">&quot;ok&quot;</span>&gt;</span>toggled content<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Transition</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="lt-TransitionGroup-gt"><a href="#lt-TransitionGroup-gt" class="headerlink" title="&lt;TransitionGroup&gt;"></a>&lt;TransitionGroup&gt;</h4><p>为列表中的多个元素或组件提供过渡效果</p>
<h5 id="lt-TransitionGroup-gt-props"><a href="#lt-TransitionGroup-gt-props" class="headerlink" title="&lt;TransitionGroup&gt; props"></a>&lt;TransitionGroup&gt; props</h5><ul>
<li>tag 如果未定义, 则渲染为片段(fragment)</li>
<li>moveClass 用于自定义过渡期间被应用的 CSS class, 使用 <code>kebab-case</code> 格式</li>
</ul>
<h5 id="lt-TransitionGroup-gt-事件"><a href="#lt-TransitionGroup-gt-事件" class="headerlink" title="&lt;TransitionGroup&gt; 事件"></a>&lt;TransitionGroup&gt; 事件</h5><p><code>&lt;TransitionGroup&gt;</code> 抛出与 <code>&lt;Transition&gt;</code> 相同的事件</p>
<h4 id="lt-KeepAlive-gt"><a href="#lt-KeepAlive-gt" class="headerlink" title="&lt;KeepAlive&gt;"></a>&lt;KeepAlive&gt;</h4><p>缓存包裹在其中的动态切换组件</p>
<h5 id="lt-KeepAlive-gt-props"><a href="#lt-KeepAlive-gt-props" class="headerlink" title="&lt;KeepAlive&gt; props"></a>&lt;KeepAlive&gt; props</h5><ul>
<li>include 哪些组件实例可以被缓存</li>
<li>exclude 哪些组件实例不被缓存</li>
<li>max 最多可以缓存多少组件实例</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 逗号分隔字符串 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">KeepAlive</span> <span class="attr">include</span>=<span class="string">&quot;a,b&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">KeepAlive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- regex (使用 `v-bind`) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">KeepAlive</span> <span class="attr">:include</span>=<span class="string">&quot;/a|b/&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">KeepAlive</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Array (使用 `v-bind`) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">KeepAlive</span> <span class="attr">:include</span>=<span class="string">&quot;[&#x27;a&#x27;, &#x27;b&#x27;]&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;view&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">KeepAlive</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="lt-Teleport-gt"><a href="#lt-Teleport-gt" class="headerlink" title="&lt;Teleport&gt;"></a>&lt;Teleport&gt;</h4><p>移动实际 DOM 节点(非销毁重建),并保持任何组件实例的活动状态</p>
<h5 id="lt-Teleport-gt-props"><a href="#lt-Teleport-gt-props" class="headerlink" title="&lt;Teleport&gt; props"></a>&lt;Teleport&gt; props</h5><ul>
<li>to 必填项, 指定目标容器, 可以是选择器或实际元素</li>
<li>disabled 值为 true 时, 内容将保留在其原始位置不做移动, 值可动态修改</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 正确 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Teleport</span> <span class="attr">to</span>=<span class="string">&quot;#some-id&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Teleport</span> <span class="attr">to</span>=<span class="string">&quot;.some-class&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Teleport</span> <span class="attr">to</span>=<span class="string">&quot;[data-teleport]&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 错误 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Teleport</span> <span class="attr">to</span>=<span class="string">&quot;h1&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Teleport</span> <span class="attr">to</span>=<span class="string">&quot;some-string&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;open = true&quot;</span>&gt;</span>Open Modal<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Teleport</span> <span class="attr">to</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;open&quot;</span> <span class="attr">class</span>=<span class="string">&quot;modal&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Hello from the modal!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;open = false&quot;</span>&gt;</span>Close<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Teleport</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="lt-Suspense-gt"><a href="#lt-Suspense-gt" class="headerlink" title="&lt;Suspense&gt;  "></a>&lt;Suspense&gt; <em id="suspense"></em> <!-- markdownlint-disable-line --></h4><p>用于协调对组件树中嵌套的异步依赖的处理</p>
<h5 id="lt-Suspense-gt-props"><a href="#lt-Suspense-gt-props" class="headerlink" title="&lt;Suspense&gt; props"></a>&lt;Suspense&gt; props</h5><ul>
<li>timeout 渲染新内容耗时超时时间</li>
</ul>
<h5 id="lt-Suspense-gt-事件"><a href="#lt-Suspense-gt-事件" class="headerlink" title="&lt;Suspense&gt; 事件"></a>&lt;Suspense&gt; 事件</h5><ul>
<li>@pending 在 suspense 进入挂起状态时触发</li>
<li>@resolve 在 default 插槽完成获取新内容时触发</li>
<li>@fallback 在 fallback 插槽的内容显示时触发</li>
</ul>
<h5 id="lt-Suspense-gt-插槽"><a href="#lt-Suspense-gt-插槽" class="headerlink" title="&lt;Suspense&gt; 插槽"></a>&lt;Suspense&gt; 插槽</h5><ul>
<li>#default</li>
<li>#fallback</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Suspense</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 具有深层异步依赖的组件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Dashboard</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 在 #fallback 插槽中显示 “正在加载中” --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">template</span> #<span class="attr">fallback</span>&gt;</span> Loading... <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="内置特殊元素"><a href="#内置特殊元素" class="headerlink" title="内置特殊元素"></a>内置特殊元素</h3><blockquote>
<p><code>&lt;component&gt;</code>, <code>&lt;slot&gt;</code>, <code>&lt;template&gt;</code> 具有类似组件的特性, 也是模板语法的一部分. 但它们并非真正的组件<br>同时在模板编译期间会被编译掉. 因此, 它们通常在模板中使用小写字母</p>
</blockquote>
<h4 id="lt-component-gt"><a href="#lt-component-gt" class="headerlink" title="&lt;component&gt;"></a>&lt;component&gt;</h4><p>用于渲染动态组件或元素的 <code>元组件</code></p>
<h5 id="lt-component-gt-props"><a href="#lt-component-gt-props" class="headerlink" title="&lt;component&gt; props"></a>&lt;component&gt; props</h5><ul>
<li>is 要渲染的实际组件由 <code>is</code> prop 决定<ul>
<li>如果是字符串时, 可以是 HTML 标签名或者组件的注册名</li>
<li>或者是直接绑定到组件的定义</li>
</ul>
</li>
</ul>
<h4 id="lt-slot-gt"><a href="#lt-slot-gt" class="headerlink" title="&lt;slot&gt;"></a>&lt;slot&gt;</h4><p>表示模板中的插槽内容出口</p>
<h5 id="lt-slot-gt-props"><a href="#lt-slot-gt-props" class="headerlink" title="&lt;slot&gt; props"></a>&lt;slot&gt; props</h5><ul>
<li>name 指定插槽名, 缺少时将会渲染默认插槽</li>
</ul>
<h4 id="lt-template-gt"><a href="#lt-template-gt" class="headerlink" title="&lt;template&gt;"></a>&lt;template&gt;</h4><p>当使用内置指令而不在 DOM 中渲染元素时, <code>&lt;template&gt;</code> 标签可以作为占位符使用</p>
<h3 id="内置特殊-Attributes"><a href="#内置特殊-Attributes" class="headerlink" title="内置特殊 Attributes"></a>内置特殊 Attributes</h3><h4 id="key"><a href="#key" class="headerlink" title="key"></a>key</h4><p>主要作为 Vue 的虚拟 DOM 算法提示, 在比较新旧节点列表时用于识别 vnode</p>
<h4 id="ref-1"><a href="#ref-1" class="headerlink" title="ref"></a>ref</h4><blockquote>
<p>ref 数组<code>并不</code>保证与源数组相同的顺序</p>
</blockquote>
<p>用于注册元素或子组件的 <code>模板引用</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;root&quot;</span>&gt;</span>This is a root element<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;itemRefs&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; ref, onBeforeUpdate, onUpdated, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> root = <span class="title function_">ref</span>(<span class="literal">null</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> itemRefs = <span class="title function_">ref</span>([]);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 确保在每次更新之前重置 ref</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onBeforeUpdate</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    itemRefs.<span class="property">value</span> = [];</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onUpdated</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(itemRefs.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// DOM元素将在初始渲染后分配给ref</span></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(root.<span class="property">value</span>); <span class="comment">// &lt;div&gt;这是根元素&lt;/div&gt;</span></span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="is"><a href="#is" class="headerlink" title="is"></a>is</h4><ul>
<li>用于动态绑定组件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;Foo&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 三目运算中的组件使用 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;someCondition ? Foo : Bar&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> <span class="title class_">Foo</span> <span class="keyword">from</span> <span class="string">&#x27;./Foo.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> <span class="title class_">Bar</span> <span class="keyword">from</span> <span class="string">&#x27;./Bar.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>元素位置限制</p>
<p>由于 HTML 元素对于放在其中的元素类型的限制, 例如 ul, ol, table, select 等元素仅放置 li, tr, option 时才会显示, 将导致在使用带有此类限制元素的组件时出现问题.</p>
<ul>
<li>用于原生元素时, 将被作为 <code>Customized built-in element</code>, 如果需要用 Vue 组件替换原生元素, 需要加上 <code>vue:</code> 前缀.</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自定义组件 my-row-component 将作为无效内容被忽略 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">my-row-component</span>&gt;</span><span class="tag">&lt;/<span class="name">my-row-component</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用 vue: 前缀才能被解析为一个 vue 组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span> <span class="attr">is</span>=<span class="string">&quot;vue:my-row-component&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="单文件组件"><a href="#单文件组件" class="headerlink" title="单文件组件"></a>单文件组件</h2><h3 id="SFC-语法定义"><a href="#SFC-语法定义" class="headerlink" title="SFC 语法定义"></a>SFC 语法定义</h3><ul>
<li><code>&lt;template&gt;</code> 每个 <code>*.vue</code> 文件最多可以包含一个顶层 <code>&lt;template&gt;</code> 块, 包含的内容将被提取传递给 <code>@vue/compiler-dom</code> 编译生成为 <a href="#rendering-func"><strong>渲染函数</strong></a></li>
<li><code>&lt;script&gt;</code> 每个 <code>*.vue</code> 文件最多可以包含一个 <code>&lt;script&gt;</code> 块(使用 <code>&lt;script setup&gt;</code> 除外), 默认导出是 Vue 的组件选项对象</li>
<li><code>&lt;script setup&gt;</code> 每个 <code>*.vue</code> 文件最多可以包含一个 <code>&lt;script setup&gt;</code> 块, 此脚本块将被预处理为组件的 <code>setup()</code> 函数</li>
<li><code>&lt;style&gt;</code> 每个 <code>*.vue</code> 文件可以包含多个 <code>&lt;style&gt;</code> 块</li>
</ul>
<h4 id="src-导入"><a href="#src-导入" class="headerlink" title="src 导入"></a>src 导入</h4><p>可以将单文件组件拆分成多个文件中, 使用 src 导入外部文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">src</span>=<span class="string">&quot;./template.html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./script.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">src</span>=<span class="string">&quot;./style.css&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="lt-script-setup-gt"><a href="#lt-script-setup-gt" class="headerlink" title="&lt;script setup&gt;"></a>&lt;script setup&gt;</h3><p><em id="script-setup"></em> <!--markdownlint-disable-line--></p>
<blockquote>
<p><code>&lt;script setup&gt;</code> 是在单文件组件(SFC) 中使用 <a href="#composition-api">组合式 API</a> 的编译时语法糖<br><code>&lt;script setup&gt;</code> 中的代码会在每次组件实例被创建的时候执行</p>
</blockquote>
<ul>
<li>更少的样板内容, 更简洁的代码</li>
<li>能够使用纯 TypeScript 声明 props 和 自定义事件</li>
<li>更好的运行时性能(其模板会被编译成同一作用域内的渲染函数, 避免了渲染上下文代理对象)</li>
<li>更好的 IDE 类型推导性能(减少了语言服务器从代码中抽取类型的工作)</li>
</ul>
<h4 id="顶层绑定"><a href="#顶层绑定" class="headerlink" title="顶层绑定"></a>顶层绑定</h4><p>任何在 <code>&lt;script setup&gt;</code> 声明的 <strong>顶层的绑定</strong>(包括变量, 函数声明, 以及 import 导入的内容)都能在模板中直接使用</p>
<h4 id="响应式"><a href="#响应式" class="headerlink" title="响应式"></a>响应式</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> user = <span class="title function_">reactive</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;count++&quot;</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="使用组件"><a href="#使用组件" class="headerlink" title="使用组件"></a>使用组件</h4><p>单文件组件模板中使用组件可以使用 <code>kebab-case</code> 或者 <code>PascalCase</code> 两种格式, 推荐使用后者</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; <span class="title class_">MyComponent</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./MyComponent.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MyComponent</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="动态组件"><a href="#动态组件" class="headerlink" title="动态组件"></a>动态组件</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> <span class="title class_">Foo</span> <span class="keyword">from</span> <span class="string">&#x27;./Foo.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> <span class="title class_">Bar</span> <span class="keyword">from</span> <span class="string">&#x27;./Bar.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;Foo&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 三目运算中的组件使用 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;someCondition ? Foo : Bar&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="递归组件"><a href="#递归组件" class="headerlink" title="递归组件"></a>递归组件</h5><p>一个单文件组件可以通过它的文件名被其自己所引用, 为防止具名的导入和组件自身推导的名字冲突可以使用别名的方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FooBar</span> <span class="keyword">as</span> <span class="title class_">FooBarChild</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./components&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h5 id="命名空间组件"><a href="#命名空间组件" class="headerlink" title="命名空间组件"></a>命名空间组件</h5><p>可以使用带 <code>.</code> 的组件标签来引用嵌套在对象属性中的组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">Form</span> <span class="keyword">from</span> <span class="string">&#x27;./form-components&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Form.Input</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Form.Label</span>&gt;</span>label<span class="tag">&lt;/<span class="name">Form.Label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">Form.Input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="使用自定义指令"><a href="#使用自定义指令" class="headerlink" title="使用自定义指令"></a>使用<a href="#directive">自定义指令</a></h4><p>本地声明自定义指令在 <code>&lt;script setup&gt;</code> 中不需要显式注册, 但必须遵循 <code>vNameOfDirective</code> 的命名规范</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> vMyDirective = &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">mounted</span>(<span class="params">el, binding, vnode, prevVnode</span>)&#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">updated</span>(<span class="params">el, binding, vnode, prevVnode</span>)&#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">unmounted</span>(<span class="params">el, binding, vnode, prevVnode</span>)&#123;&#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-my-directive</span>&gt;</span>This is a heading.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="defineProps-defineEmits"><a href="#defineProps-defineEmits" class="headerlink" title="defineProps|defineEmits"></a>defineProps|defineEmits</h4><ul>
<li><code>defineProps</code> 和 <code>defineEmits</code> 都是只能在 <code>&lt;script setup&gt;</code> 中使用的 <strong>编译器宏</strong>, 不需要导入直接使用, 且会随着 <code>&lt;script setup&gt;</code> 的处理过程一同被编译掉</li>
<li><code>defineProps</code> 接收和 <a href="#props">props</a> 选项相同的值, <code>defineEmits</code> 接收和 <a href="#emits">emits</a> 选项相同的值</li>
<li><code>defineProps</code> 和 <code>defineEmits</code> 在选项传入后会提供恰当的类型推导</li>
<li>传入 <code>defineProps</code> 和 <code>defineEmits</code> 的选项会从 setup 中提升到模块的作用域, 因此, 传入的选项不能引用在 setup 作用域中声明的局部变量</li>
</ul>
<h5 id="使用类型声明时的默认-props-值"><a href="#使用类型声明时的默认-props-值" class="headerlink" title="使用类型声明时的默认 props 值"></a>使用类型声明时的默认 props 值</h5><p>defineProps 不能给使用类型声明的 props 提供默认值, 使用 <code>withDefaults</code> <strong>编译器宏</strong> 解决</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withDefaults &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface <span class="title class_">Props</span> &#123;</span><br><span class="line">  msg?: string</span><br><span class="line">  labels?: string[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> props = <span class="title function_">withDefaults</span>(defineProps&lt;<span class="title class_">Props</span>&gt;(), &#123;</span><br><span class="line">  <span class="attr">msg</span>: <span class="string">&#x27;hello withDefaults&#x27;</span>,</span><br><span class="line">  <span class="attr">labels</span>: <span class="function">() =&gt;</span> [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>]</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="props-emit-类型声明"><a href="#props-emit-类型声明" class="headerlink" title="props|emit 类型声明"></a>props|emit 类型声明</h5><p><code>props</code> 和 <code>emits</code> 都可以通过给 <code>defineProps</code> 和 <code>defineEmits</code> 传递纯类型参数的方式声明</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123; <span class="attr">title</span>: string, <span class="attr">age</span>: number &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">click</span>: <span class="literal">null</span>, <span class="comment">// 没有验证函数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 有验证函数</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">submit</span>: <span class="function">(<span class="params">payload</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (payload.<span class="property">email</span> &amp;&amp; payload.<span class="property">password</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">`Invalid submit event payload!`</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="defineExpose"><a href="#defineExpose" class="headerlink" title="defineExpose()"></a>defineExpose()</h4><p>使用 <code>&lt;script setup&gt;</code> 的组件是 <strong>默认关闭</strong> 的, 不会暴露任何在 <code>&lt;script setup&gt;</code> 中声明的绑定. 使用 defineExpose 显式指定组件中要暴露出去的属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> a = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> b = <span class="title function_">ref</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">defineExpose</span>(&#123; a, b &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="defineOptions"><a href="#defineOptions" class="headerlink" title="defineOptions()  "></a>defineOptions() <em id="defineOptions"></em> <!--markdownlint-disable-line--></h4><blockquote>
<p>Vue 3.3 支持</p>
</blockquote>
<p>在 <code>&lt;script setup&gt;</code> 中使用 <a href="#optional-api">选项式 API</a> 的<strong>宏</strong>, 无法访问 <code>&lt;script setup&gt;</code> 中不是字面常数的局部变量</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; useSlots &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">defineOptions</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Foo&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">inheritAttrs</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> slots = <span class="title function_">useSlots</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Compiled Code --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">name</span>: <span class="string">&#x27;Foo&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">inheritAttrs</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; useSlots &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> slots = <span class="title function_">useSlots</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="defineSlots"><a href="#defineSlots" class="headerlink" title="defineSlots()"></a>defineSlots()</h4><blockquote>
<p>Vue 3.3 支持</p>
</blockquote>
<p>只接受类型参数, 没有运行时参数. 用于为 IDE 提供插槽名称 和 props 类型检查的类型提示</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> slots = defineSlots&lt;&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">default</span>(<span class="attr">props</span>: &#123; <span class="attr">msg</span>: string &#125;): any;</span></span><br><span class="line"><span class="language-javascript">  &#125;&gt;();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="definePropsRefs"><a href="#definePropsRefs" class="headerlink" title="definePropsRefs()"></a>definePropsRefs()</h4><blockquote>
<p>Vue 3.3 支持</p>
</blockquote>
<p>在 <code>&lt;script setup&gt;</code> 中定义一个不会丢失响应性的解构 props 的响应式对象</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// won&#x27;t lose reactivity with destructuring</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> &#123;foo, bar&#125; = definePropsRefs&lt;&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">foo</span>: string,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">bar</span>: number</span></span><br><span class="line"><span class="language-javascript">  &#125;&gt;();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// Ref&lt;string&gt;</span></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(foo.<span class="property">value</span>, bar.<span class="property">value</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="defineRender"><a href="#defineRender" class="headerlink" title="defineRender()"></a>defineRender()</h4><blockquote>
<p>Vue 3.3 支持 <em id="vue3.3"></em> <!-- markdownlint-disable-line --></p>
</blockquote>
<p>在 <code>&lt;script setup&gt;</code> 中定义一个渲染函数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// JSX passed directly</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">defineRender</span>(</span></span><br><span class="line"><span class="language-javascript">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="language-javascript">  );</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// Or using render function</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">defineRender</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> (</span></span><br><span class="line"><span class="language-javascript">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span></span><br><span class="line"><span class="language-xml"><span class="language-javascript">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="language-javascript">    );</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="defineModel"><a href="#defineModel" class="headerlink" title="defineModel()"></a>defineModel()</h4><blockquote>
<p>Vue 3.4 支持</p>
</blockquote>
<p>如果第一个参数为字符串字面量, 则被用作 prop 名称, 否则 prop 名称默认为 <code>modelValue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 声明 modelValue prop, 由父组件通过 v-model 使用</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> model = <span class="title function_">defineModel</span>();</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 或者声明带选项的 modelValue prop</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> model = <span class="title function_">defineModal</span>(&#123; <span class="attr">type</span>: <span class="title class_">String</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 在被修改时, 触发 update:modelValue 事件</span></span></span><br><span class="line"><span class="language-javascript">  model.<span class="property">value</span> = <span class="string">&#x27;hello world&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 声明 count prop, 由父组件通过 v-model:count 使用</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> count = <span class="title function_">defineModel</span>(<span class="string">&#x27;count&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 或者声明带选项的 count prop</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> count = <span class="title function_">defineModel</span>(<span class="string">&#x27;count&#x27;</span>, &#123; <span class="attr">type</span>: <span class="title class_">Number</span>, <span class="attr">default</span>: <span class="number">0</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 在被修改时, 触发 update:count 事件</span></span></span><br><span class="line"><span class="language-javascript">  count.<span class="property">value</span>++;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>底层编译器将其展开为以下内容</p>
<ul>
<li>一个名为 <code>modelValue</code> 的 prop, 本地的 ref 的值与其同步</li>
<li>一个名为 <code>update:modelValue</code> 的事件, 当本地 ref 的值发生变更时触发</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> props = <span class="title function_">defineProps</span>([<span class="string">&#x27;modelValue&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;update:modelValue&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:value</span>=<span class="string">&quot;props.modelValue&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">input</span>=<span class="string">&quot;emit(&#x27;update:modelValue&#x27;, $event.target.value)&quot;</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="修饰符和转换器"><a href="#修饰符和转换器" class="headerlink" title="修饰符和转换器"></a>修饰符和转换器</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> [modelValue, modelModifiers] = <span class="title function_">defineModel</span>();</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 对应 v-model.trim</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span> (modelModifiers.<span class="property">trim</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// ...</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 通过修饰符使用 set 和 get 转换器对其值进行转换</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> [modelValue, modelModifiers] = <span class="title function_">defineModel</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// get() 省略了，因为这里不需要它</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">set</span>(<span class="params">value</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 如果使用了 .trim 修饰符，则返回裁剪过后的值</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (modelModifiers.<span class="property">trim</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> value.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 否则，原样返回</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> value;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 指定名称的修饰符</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> [firstName, firstNameModifiers] = <span class="title function_">defineModel</span>(<span class="string">&#x27;firstName&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(firstNameModifiers.<span class="property">uppercase</span>); <span class="comment">// true</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// Vue 3.4 之前</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> props = <span class="title function_">defineProps</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">firstName</span>: <span class="title class_">String</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">firstNameModifiers</span>: &#123; <span class="attr">default</span>: <span class="function">() =&gt;</span> (&#123;&#125;) &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> emit = <span class="title function_">defineEmits</span>([<span class="string">&#x27;update:firstName&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">console</span>.<span class="title function_">log</span>(props.<span class="property">firstNameModifiers</span>.<span class="property">uppercase</span>); <span class="comment">// true</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MyComponent</span> <span class="attr">v-model:first-name.uppercase</span>=<span class="string">&quot;firstName&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="useSlots-useAttrs"><a href="#useSlots-useAttrs" class="headerlink" title="useSlots()|useAttrs()"></a>useSlots()|useAttrs()</h4><ul>
<li>在 SFC 中使用的辅助函数获取 slots 和 attrs</li>
<li>需要手动从 vue 中导入</li>
<li>返回的值和 <code>setupContext.slots</code> 和 <code>setupContext.attrs</code> 是等价的</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; useSlots, useAttrs &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> slots = <span class="title function_">useSlots</span>();</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> attrs = <span class="title function_">useAttrs</span>();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="与普通-script-一起用"><a href="#与普通-script-一起用" class="headerlink" title="与普通 script 一起用"></a>与普通 script 一起用</h4><ul>
<li>声明无法在 <code>&lt;script setup&gt;</code> 中声明的选项, 例如 <a href="#inheritAttrs">inheritAttrs</a> 或插件的自定义选项(Vue 3.3 使用 <a href="#defineOptions">defineOptions</a> 替代)</li>
<li>声明模块的具名导出(named exports)</li>
<li>运行只需要在模块作用域执行一次的副作用, 或是创建单例对象</li>
</ul>
<h4 id="顶层-await"><a href="#顶层-await" class="headerlink" title="顶层 await"></a>顶层 await</h4><blockquote>
<p><code>&lt;script setup&gt;</code> 中可以使用顶层 await, 结果代码会被编译成 <code>async setup()</code> &gt; <code>async setup()</code> 必须与 <a href="#suspense">&lt;Suspense&gt;</a> <a href="#built-in-component"><strong>内置组件</strong></a>组合使用</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> post = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/post/1&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>())</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h4><p>由于模块执行语义的差异, <code>&lt;script setup&gt;</code> 中的代码依赖单文件组件的上下文, 当将其移动到外部的 <code>.js</code> 或 <code>.ts</code> 文件中时, 对于开发者和工具来说都会感到混乱. 因此, <code>&lt;script setup&gt;</code> 不能和 <code>src</code> 属性一起使用</p>
<h3 id="CSS-功能"><a href="#CSS-功能" class="headerlink" title="CSS 功能"></a>CSS 功能</h3><h4 id="组件作用域"><a href="#组件作用域" class="headerlink" title="组件作用域"></a>组件作用域</h4><blockquote>
<p>使用 <code>scoped</code> 后, 父组件的样式不会透传到子组件中，不过, 子组件的 <strong>根节点</strong> 会同时被父组件的作用域样式和子组件的作用域样式影响, 这样设计是为了让父组件可以从布局的角度出发, 调整其子组件根元素的样式</p>
</blockquote>
<h5 id="深度选择器"><a href="#深度选择器" class="headerlink" title="深度选择器"></a>深度选择器</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.a</span> :<span class="built_in">deep</span>(.b) &#123;</span></span><br><span class="line"><span class="language-css">    <span class="comment">/* */</span></span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="插槽选择器"><a href="#插槽选择器" class="headerlink" title="插槽选择器"></a>插槽选择器</h5><p>默认情况下, 作用域样式不会影响到 <code>&lt;slot /&gt;</code> 渲染出来的内容, 使用 <code>:slotted</code> 伪类以明确地将插槽内容作为选择器的目标</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-pseudo">:slotted</span>(<span class="selector-tag">div</span>) &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="全局选择器"><a href="#全局选择器" class="headerlink" title="全局选择器"></a>全局选择器</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  :<span class="built_in">global</span>(.red) &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="css-Modules"><a href="#css-Modules" class="headerlink" title="css Modules"></a>css Modules</h4><p>一个 <code>&lt;style module&gt;</code> 标签会被编译成 <code>CSS Modules</code> 并且将生成的 CSS class 作为 <code>$style</code> 对象暴露给组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;$style.red&quot;</span>&gt;</span>This is should be red.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">module</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.red</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="自定义注入名称"><a href="#自定义注入名称" class="headerlink" title="自定义注入名称"></a>自定义注入名称</h5><p>module 属性可以接受一个值作为自定义注入名称代替 <code>$style</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">:class</span>=<span class="string">&quot;classes.red&quot;</span>&gt;</span>This is should be red.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">module</span>=<span class="string">&quot;classes&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.red</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: red;</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="与组合式-API一起使用"><a href="#与组合式-API一起使用" class="headerlink" title="与组合式 API一起使用"></a>与<a href="#composition-api">组合式 API</a>一起使用</h5><ul>
<li>使用 <code>useCssModule</code> API 在 <code>setup()</code> 和 <code>&lt;script setup&gt;</code> 中访问注入的 class</li>
<li>使用 <strong>自定义注入名称</strong> 的 <code>&lt;style module&gt;</code>, <code>useCssModule</code> 接收一个匹配的 <code>module</code> attribute 值作为第一个参数</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; h, useCssModule &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 默认情况下, 返回 &lt;style module&gt; 的 class</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> style = <span class="title function_">useCssModule</span>();</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 自定义注入名称, 返回 &lt;style module=&quot;classes&quot;&gt; 的 class</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> classes = <span class="title function_">useCssModule</span>(<span class="string">&#x27;classes&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="CSS-中的-v-bind"><a href="#CSS-中的-v-bind" class="headerlink" title="CSS 中的 v-bind()"></a>CSS 中的 v-bind()</h4><p>单文件组件的 <code>&lt;style&gt;</code> 标签支持使用 <code>v-bind</code> CSS 函数将 CSS 的值链接到动态的组件状态</p>
<ul>
<li><a href="#optional-api">选项式 API</a>使用</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;text&quot;</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">return</span> &#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span> &#125;;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.text</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="built_in">v-bind</span>(color);</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><a href="#composition-api">组合式 API</a> 使用</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> theme = &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scope</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="selector-tag">p</span> &#123;</span></span><br><span class="line"><span class="language-css">    <span class="attribute">color</span>: <span class="built_in">v-bind</span>(<span class="string">&#x27;theme.color&#x27;</span>);</span></span><br><span class="line"><span class="language-css">  &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="进阶-API"><a href="#进阶-API" class="headerlink" title="进阶 API"></a>进阶 API</h2><h3 id="渲染函数"><a href="#渲染函数" class="headerlink" title="渲染函数  "></a>渲染函数 <em id="rendering-func"></em> <!-- markdownlint-disable-line--></h3><ul>
<li>如果组件定义了 setup 并且返回值是一个函数, 则其返回值作为该组件的渲染函数</li>
<li>如果组件定义了 render, 则将其作为渲染函数</li>
<li>如果组件定义了 template, 则将其作为模板进行编译成可执行的渲染函数</li>
<li>如果以上条件都不满足, 则使用容器的 innerHTML 作为模板</li>
</ul>
<h4 id="h"><a href="#h" class="headerlink" title="h()"></a>h()</h4><blockquote>
<p>当创建组件的 vnode 时, 子节点必须以 <strong><a href="#v-slot">插槽</a>函数</strong> 的形式传递, 如果组件只有默认插槽, 可以使用单个 <strong><a href="#v-slot">插槽</a>函数</strong> 传递, 否则, 必须以 <strong><a href="#v-slot">插槽</a>函数</strong> 的对象形式传递</p>
</blockquote>
<p>创建虚拟 DOM 节点(vnode)</p>
<ul>
<li>第一个参数是一个字符串(用于原生元素)或者一个 Vue 组件定义</li>
<li>第二个参数是要传入的 prop, 如果 <strong><a href="#v-slot">插槽</a>函数</strong> 不是对象形式时, 可以省略此参数</li>
<li>第三个参数是子节点</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">h</span>(</span></span><br><span class="line"><span class="language-javascript">    <span class="string">&#x27;div&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">class</span>: <span class="string">&#x27;bar&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">innerHtml</span>: <span class="string">&#x27;hello&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 事件监听以 onXxx 的形式</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">onClick</span>: <span class="function">() =&gt;</span> &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    [<span class="string">&#x27;hello world&#x27;</span>, <span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;gg&#x27;</span>)]</span></span><br><span class="line"><span class="language-javascript">  );</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>创建组件</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> <span class="title class_">Foo</span> <span class="keyword">from</span> <span class="string">&#x27;./Foo.vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 传递 prop</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">h</span>(<span class="title class_">Foo</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 等价于 some-prop=&quot;hello world&quot;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">someProp</span>: <span class="string">&#x27;hello world&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 等价于 @update=&quot;() =&gt; &#123;&#125;&quot;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="attr">onUpdate</span>: <span class="function">() =&gt;</span> &#123;&#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 传递单个默认插槽函数, 可以省略 prop 参数</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">h</span>(<span class="title class_">Foo</span>, <span class="function">() =&gt;</span> <span class="string">&#x27;default slot&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 传递具名插槽函数</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 需要使用 null 来避免插槽对象被当作 prop</span></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">h</span>(<span class="title class_">MyComponent</span>, <span class="literal">null</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;default slot&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">header</span>: <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, <span class="string">&#x27;hello div&#x27;</span>),</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">footer</span>: <span class="function">() =&gt;</span> [<span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;one&#x27;</span>), <span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;two&#x27;</span>)],</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="mergeProps"><a href="#mergeProps" class="headerlink" title="mergeProps()"></a>mergeProps()</h4><blockquote>
<p><code>class</code>, <code>style</code> 将被合并成一个对象, <code>onXxx</code> 将被合并成一个数组</p>
</blockquote>
<p>合并多个 props 对象, 用于处理含有特定的 props 参数的情况</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; h, mergeProps &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> one = &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">class</span>: <span class="string">&#x27;foo&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">onClick</span>: handlerA,</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> two = &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">class</span>: &#123; <span class="attr">bar</span>: <span class="literal">true</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="attr">onClick</span>: handlerB,</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> merged = <span class="title function_">mergeProps</span>(one, two);</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">/**</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   * &#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   *  class: &#x27;foo bar&#x27;,</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   *  onClick: [handlerA, handlerB]</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   * &#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">   */</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="cloneVNode"><a href="#cloneVNode" class="headerlink" title="cloneVNode()"></a>cloneVNode()</h4><p>克隆一个 vnode, 可在原有的基础上添加一些额外的 prop</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; h, cloneVNode &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> original = <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> cloned = <span class="title function_">cloneVNode</span>(original, &#123; <span class="attr">id</span>: <span class="string">&#x27;foo&#x27;</span> &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="isVNode"><a href="#isVNode" class="headerlink" title="isVNode()"></a>isVNode()</h4><p>判断一个值是否为 vnode 类型</p>
<h4 id="resolveComponent"><a href="#resolveComponent" class="headerlink" title="resolveComponent()"></a>resolveComponent()</h4><blockquote>
<p><code>resolveComponent()</code> 只能在 <a href="#rendering-func"><strong>渲染函数</strong></a> 或 <code>setup()</code> 中使用<br>如果可以直接引入组件就不需要使用此方法</p>
</blockquote>
<p>按名称手动解析已注册的组件, 未找到则抛出一个运行时警告并返回组件名字符串</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; h, resolveComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> <span class="title class_">ButtonComponent</span> = <span class="title function_">resolveComponent</span>(<span class="string">&#x27;ButtonComponent&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">h</span>(<span class="title class_">ButtonComponent</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="resolveDirective"><a href="#resolveDirective" class="headerlink" title="resolveDirective()"></a><a href="#directive">resolveDirective()</a></h4><blockquote>
<p><code>resolveDirective()</code> 只能在 <a href="#rendering-func"><strong>渲染函数</strong></a> 或 <code>setup()</code> 中使用<br>如果可以直接引入组件就不需要使用此方法</p>
</blockquote>
<p>按名称手动解析已注册的指令, 未找到则抛出一个运行时警告并返回 undefined</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; resolveDirective &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> myDirective = <span class="title function_">resolveDirective</span>(<span class="string">&#x27;myDirective&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="withDirectives"><a href="#withDirectives" class="headerlink" title="withDirectives()"></a><a href="#directive">withDirectives()</a></h4><p>用于给 vnode 增加自定义指令</p>
<ul>
<li>第一个参数为要添加指令的 vnode</li>
<li>第二个参数为自定义指令数组, 每个自定义指令表示为 <code>[directive, value, argument, modifiers]</code> 形式的数组<ul>
<li>[directive] 指令本身</li>
<li>[directive, value] 上述内容, 指令的值</li>
<li>[directive, value, arg] 上述内容, 一个 String 参数,eg: v-on:click 中的 click</li>
<li>[directive, value, arg, modifiers] 上述内容, 定义任意修饰符的 key:value 键值对</li>
</ul>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; h, withDirectives &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> pin = &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">created</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pin directive created...&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">beforeMount</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pin directive beforeMount...&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">mounted</span>(<span class="params">el, binding, vnode, prevVnode</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">console</span>.<span class="title function_">log</span>(binding.<span class="property">value</span>, binding.<span class="property">arg</span>, binding.<span class="property">modifiers</span>);</span></span><br><span class="line"><span class="language-javascript">      el.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">&#x27;20px&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">      el.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;#08f&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> <span class="function">() =&gt;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// &lt;div v-pin:top.animate=&quot;200&quot;&gt;&lt;/div&gt;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">withDirectives</span>(<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, <span class="string">&#x27;hello withDirectives&#x27;</span>), [</span></span><br><span class="line"><span class="language-javascript">      [pin, <span class="number">200</span>, <span class="string">&#x27;top&#x27;</span>, &#123; <span class="attr">animate</span>: <span class="literal">true</span> &#125;],</span></span><br><span class="line"><span class="language-javascript">    ]);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; withDirectives, resolveDirective &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> foo = <span class="title function_">resolveDirective</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bar = <span class="title function_">resolveDirective</span>(<span class="string">&#x27;bar&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="title function_">withDirectives</span>(<span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>), [</span><br><span class="line">  [foo, <span class="variable language_">this</span>.<span class="property">x</span>],</span><br><span class="line">  [bar, <span class="variable language_">this</span>.<span class="property">y</span>],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h4 id="withModifiers"><a href="#withModifiers" class="headerlink" title="withModifiers()"></a>withModifiers()</h4><p>用于向事件处理函数添加内置 <code>v-on</code> 修饰符</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; h, withModifiers &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> clk = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">return</span> <span class="function">() =&gt;</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">h</span>(</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&#x27;button&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">      &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 等价于 v-on.stop.prevent</span></span></span><br><span class="line"><span class="language-javascript">        <span class="attr">onClick</span>: <span class="title function_">withModifiers</span>(</span></span><br><span class="line"><span class="language-javascript">          <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span></span><br><span class="line"><span class="language-javascript">          &#125;,</span></span><br><span class="line"><span class="language-javascript">          [<span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;prevent&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">        ),</span></span><br><span class="line"><span class="language-javascript">      &#125;,</span></span><br><span class="line"><span class="language-javascript">      <span class="string">&#x27;Click Me&#x27;</span></span></span><br><span class="line"><span class="language-javascript">    );</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="综合使用"><a href="#综合使用" class="headerlink" title="综合使用"></a>综合使用</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  createApp,</span><br><span class="line">  h,</span><br><span class="line">  ref,</span><br><span class="line">  defineComponent,</span><br><span class="line">  resolveComponent,</span><br><span class="line">  resolveDirective,</span><br><span class="line">  withDirectives,</span><br><span class="line">  withModifiers,</span><br><span class="line">  useSlots,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HelloWorld</span> = <span class="title function_">defineComponent</span>(<span class="function">(<span class="params">props, ctx</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> slots = <span class="title function_">useSlots</span>();</span><br><span class="line">  <span class="keyword">const</span> message = <span class="title function_">ref</span>(<span class="string">&#x27;This from hello world component&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> fooV = <span class="title function_">ref</span>(<span class="number">250</span>);</span><br><span class="line">  <span class="keyword">const</span> show = <span class="title function_">ref</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 定义点击切换自定义指令值的方法</span></span><br><span class="line">  <span class="keyword">const</span> changeFooDirective = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    fooV.<span class="property">value</span> = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">100</span>);</span><br><span class="line">    show.<span class="property">value</span> = fooV.<span class="property">value</span> % <span class="number">2</span> === <span class="number">0</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 解析一个已注册的指令, 未找到则抛出运行时警告并返回 undefined</span></span><br><span class="line">  <span class="keyword">const</span> foo = <span class="title function_">resolveDirective</span>(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Must use `.value` to read or write the value wrapped by `ref()`</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">      <span class="comment">/* 调用插槽 */</span></span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, slots?.<span class="property">header</span>?.()),</span><br><span class="line">      <span class="title function_">h</span>(</span><br><span class="line">        <span class="string">&#x27;p&#x27;</span>,</span><br><span class="line">        slots?.<span class="property">default</span>?.(&#123;</span><br><span class="line">          <span class="attr">message</span>: message.<span class="property">value</span>,</span><br><span class="line">          <span class="attr">age</span>: props.<span class="property">age</span> &gt; <span class="number">0</span> ? props.<span class="property">age</span> : <span class="number">18</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">      ),</span><br><span class="line">      show.<span class="property">value</span></span><br><span class="line">        ? <span class="title function_">withDirectives</span>(</span><br><span class="line">          <span class="title function_">h</span>(</span><br><span class="line">            <span class="string">&#x27;p&#x27;</span>,</span><br><span class="line">            <span class="comment">/* 添加指令 v-directive:argument.modifiers=value */</span></span><br><span class="line">            <span class="title function_">withDirectives</span>(</span><br><span class="line">              <span class="title function_">h</span>(<span class="string">&#x27;span&#x27;</span>, [</span><br><span class="line">                <span class="string">&#x27;v-foo:bar1.uppercase=&#x27;</span> + fooV.<span class="property">value</span>,</span><br><span class="line">                <span class="title function_">h</span>(<span class="string">&#x27;br&#x27;</span>),</span><br><span class="line">                <span class="string">&#x27;v-foo:bar2.uppercase=&#x27;</span> + fooV.<span class="property">value</span></span><br><span class="line">              ]),</span><br><span class="line">              [</span><br><span class="line">                [foo, fooV.<span class="property">value</span>, <span class="string">&#x27;bar1&#x27;</span>, &#123; <span class="attr">uppercase</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">                [foo, fooV.<span class="property">value</span>, <span class="string">&#x27;bar2&#x27;</span>, &#123; <span class="attr">uppercase</span>: <span class="literal">true</span> &#125;]</span><br><span class="line">              ]</span><br><span class="line">            )</span><br><span class="line">          ),</span><br><span class="line">          [[foo, fooV.<span class="property">value</span>, <span class="string">&#x27;bar1&#x27;</span>, &#123; <span class="attr">uppercase</span>: <span class="literal">true</span> &#125;]]</span><br><span class="line">        )</span><br><span class="line">        : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">      <span class="title function_">h</span>(</span><br><span class="line">        <span class="string">&#x27;p&#x27;</span>,</span><br><span class="line">        <span class="title function_">h</span>(</span><br><span class="line">          <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">          &#123; <span class="attr">onClick</span>: changeFooDirective &#125;,</span><br><span class="line">          <span class="string">&#x27;Change v-foo value - &#x27;</span> + props.<span class="property">age</span></span><br><span class="line">        )</span><br><span class="line">      ),</span><br><span class="line">    ]);</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">props</span>: [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>],</span><br><span class="line">  <span class="comment">// 定义局部指令</span></span><br><span class="line">  <span class="attr">directives</span>: &#123;</span><br><span class="line">    <span class="attr">foo</span>: &#123;</span><br><span class="line">      <span class="title function_">created</span>(<span class="params">el, binding, vnode, prevVnode</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;directives foo hooks created trigger... &#x27;</span>, binding);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">/* beforeMount, mounted, beforeUpdate, updated, beforeUnmount */</span></span><br><span class="line">      <span class="title function_">unmounted</span>(<span class="params">el, binding, vnode, prevVnode</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;directives foo hooks unmounted trigger... &#x27;</span>, binding);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params">props, ctx</span>) &#123;</span><br><span class="line">    <span class="comment">/* 定义局部指令  */</span></span><br><span class="line">    <span class="keyword">const</span> gg = &#123;</span><br><span class="line">      <span class="title function_">created</span>(<span class="params">el, binding, vnode, prevVnode</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;withDirectives gg hooks created trigger... &#x27;</span>, binding);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">/* beforeMount, mounted, beforeUpdate, updated, beforeUnmount */</span></span><br><span class="line">      <span class="title function_">unmounted</span>(<span class="params">el, binding, vnode, prevVnode</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;withDirectives gg hooks unmounted trigger... &#x27;</span>, binding);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解析一个已注册的组件，未找到则抛出运行时警告并返回组件名字符串</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">HelloWorld</span> = <span class="title function_">resolveComponent</span>(<span class="string">&#x27;hello-world&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> [</span><br><span class="line">      <span class="title function_">withDirectives</span>(</span><br><span class="line">        <span class="title function_">h</span>(</span><br><span class="line">          <span class="title class_">HelloWorld</span>,</span><br><span class="line">          &#123; <span class="attr">name</span>: <span class="string">&#x27;from createApp&#x27;</span>, <span class="attr">age</span>: -<span class="number">1</span> &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="comment">/* 传递插槽, 使用作用域插槽 */</span></span><br><span class="line">            <span class="attr">default</span>: <span class="function">(<span class="params">slotScope</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;slotScope.message&#125;</span> - <span class="subst">$&#123;slotScope.age&#125;</span> , This from createApp content`</span>,</span><br><span class="line">            <span class="attr">header</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;This from createApp by header slot...&#x27;</span>,</span><br><span class="line">          &#125;</span><br><span class="line">        ),</span><br><span class="line">        [[gg, <span class="number">1000</span>, <span class="string">&#x27;bottom&#x27;</span>, &#123; <span class="attr">animate</span>: <span class="literal">true</span> &#125;]]</span><br><span class="line">      ),</span><br><span class="line">      <span class="title function_">h</span>(<span class="string">&#x27;p&#x27;</span>, <span class="literal">null</span>, &#123;</span><br><span class="line">        <span class="attr">header</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;createApp use h 传递 header slot&#x27;</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="function">() =&gt;</span> <span class="string">&#x27;createApp use h 传递 default slot&#x27;</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="title function_">h</span>(</span><br><span class="line">        <span class="string">&#x27;button&#x27;</span>,</span><br><span class="line">        <span class="comment">/* 添加事件修饰符 */</span></span><br><span class="line">        &#123; <span class="attr">onClick</span>: <span class="title function_">withModifiers</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="title function_">alert</span>(<span class="string">&#x27;createApp withModifiers&#x27;</span>), [<span class="string">&#x27;stop&#x27;</span>, <span class="string">&#x27;prevent&#x27;</span>]) &#125;,</span><br><span class="line">        <span class="string">&#x27;Click Me withModifiers&#x27;</span></span><br><span class="line">      ),</span><br><span class="line">    ];</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">app.<span class="title function_">component</span>(<span class="string">&#x27;hello-world&#x27;</span>, <span class="title class_">HelloWorld</span>);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="自定义指令挂载"><a href="#自定义指令挂载" class="headerlink" title="自定义指令挂载"></a><a href="#directive">自定义指令</a>挂载</h5><p><img data-src="/images/vue3-directives-hooks-1.jpg" alt="vue3-directives-hooks-1"></p>
<h5 id="自定义指令更新"><a href="#自定义指令更新" class="headerlink" title="自定义指令更新"></a><a href="#directive">自定义指令</a>更新</h5><p><img data-src="/images/vue3-directives-hooks-2.jpg" alt="vue3-directives-hooks-2"></p>
<h5 id="自定义指令卸载"><a href="#自定义指令卸载" class="headerlink" title="自定义指令卸载"></a><a href="#directive">自定义指令</a>卸载</h5><p><img data-src="/images/vue3-directives-hooks-3.jpg" alt="vue3-directives-hooks-3"></p>
<h3 id="自定义-Hook"><a href="#自定义-Hook" class="headerlink" title="自定义 Hook"></a>自定义 Hook</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, onMounted, onBeforeUnmount &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">type</span> &#123; <span class="title class_">Ref</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Vue hook for monitoring storage changes for a specific key</span></span><br><span class="line"><span class="comment"> * Supports both localStorage and sessionStorage monitoring</span></span><br><span class="line"><span class="comment"> * Supports automatic JSON parsing and returns the changed value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key storage key to monitor</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> options configuration options</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> reactive value and cleanup function</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useLocalStorageMonitor = &lt;T = <span class="built_in">any</span>&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">key</span>: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="attr">options</span>: &#123;</span></span></span><br><span class="line"><span class="params"><span class="function">    /** Whether to automatically parse <span class="built_in">JSON</span> strings */</span></span></span><br><span class="line"><span class="params"><span class="function">    parseJSON?: <span class="built_in">boolean</span>;</span></span></span><br><span class="line"><span class="params"><span class="function">    /** Default value when key doesn<span class="string">&#x27;t exist or parsing fails */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    defaultValue?: T;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    /** Custom callback for value changes */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    onChange?: (newValue: T | null, oldValue: T | null) =&gt; void;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    /** Storage type to monitor: &#x27;</span><span class="variable language_">localStorage</span><span class="string">&#x27; or &#x27;</span><span class="variable language_">sessionStorage</span><span class="string">&#x27; */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    storageType?: &#x27;</span><span class="variable language_">localStorage</span><span class="string">&#x27; | &#x27;</span><span class="variable language_">sessionStorage</span><span class="string">&#x27;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125; = &#123;&#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">) =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  const &#123; parseJSON = true, defaultValue = null, onChange, storageType = &#x27;</span><span class="variable language_">localStorage</span><span class="string">&#x27; &#125; = options;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  </span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  // Get the storage object based on the storageType</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  const storage = storageType === &#x27;</span><span class="variable language_">sessionStorage</span><span class="string">&#x27; ? sessionStorage : localStorage;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  </span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  // Reactive value that will be updated when storage changes</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  const value: Ref&lt;T | null&gt; = ref(null);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  let currentValue = storage.getItem(key);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  let pollInterval: NodeJS.Timeout | null = null;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  /**</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   * Parse value from storage with error handling</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  const parseValue = (rawValue: string | null): T | null =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    if (rawValue === null) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      return defaultValue ?? null;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    if (!parseJSON) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      return rawValue as T;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    try &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      return JSON.parse(rawValue) as T;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    &#125; catch (error) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      console.warn(`Failed to parse $&#123;storageType&#125; value for key &quot;$&#123;key&#125;&quot;:`, error);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      return defaultValue ?? null;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  /**</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   * Update the reactive value and trigger callbacks</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  const updateValue = (newRawValue: string | null, oldRawValue: string | null) =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    const newParsedValue = parseValue(newRawValue);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    const oldParsedValue = parseValue(oldRawValue);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    </span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    value.value = newParsedValue;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    currentValue = newRawValue;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    </span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    if (onChange) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      onChange(newParsedValue, oldParsedValue);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  /**</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   * Handle storage events from other tabs/windows</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   * Note: sessionStorage events only fire within the same tab, localStorage events fire across tabs</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  const handleStorageEvent = (event: StorageEvent) =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    if (event.key === key &amp;&amp; event.storageArea === storage) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      updateValue(event.newValue, currentValue);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  /**</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   * Manual check for storage changes (polling fallback)</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  const handleStorageChangeManual = () =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    const newValue = storage.getItem(key);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    if (newValue !== currentValue) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      updateValue(newValue, currentValue);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  /**</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   * Override storage methods to detect same-tab changes</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  let originalSetItem: typeof storage.setItem;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  let originalRemoveItem: typeof storage.removeItem;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  const setupStorageOverride = () =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    // Store original methods</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    originalSetItem = storage.setItem;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    originalRemoveItem = storage.removeItem;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    // Override setItem</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    storage.setItem = function (k: string, value: string) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      const oldValue = storage.getItem(k);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      originalSetItem.call(this, k, value);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      if (k === key &amp;&amp; oldValue !== value) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">        updateValue(value, oldValue);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    &#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    // Override removeItem</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    storage.removeItem = function (k: string) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      const oldValue = storage.getItem(k);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      originalRemoveItem.call(this, k);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      if (k === key &amp;&amp; oldValue !== null) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">        updateValue(null, oldValue);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    &#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  /**</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   * Restore original storage methods</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  const restoreStorageOverride = () =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    if (originalSetItem &amp;&amp; originalRemoveItem) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      storage.setItem = originalSetItem;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      storage.removeItem = originalRemoveItem;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  /**</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   * Initialize the hook</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  const initialize = () =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    // Set initial value</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    value.value = parseValue(currentValue);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    // Setup event listeners and overrides</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    window.addEventListener(&#x27;</span>storage<span class="string">&#x27;, handleStorageEvent);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    setupStorageOverride();</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    // Setup polling as fallback (every 1 second)</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    pollInterval = setInterval(handleStorageChangeManual, 1000);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  /**</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   * Cleanup function</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">   */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  const cleanup = () =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    window.removeEventListener(&#x27;</span>storage<span class="string">&#x27;, handleStorageEvent);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    restoreStorageOverride();</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    </span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    if (pollInterval) &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      clearInterval(pollInterval);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">      pollInterval = null;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  // Vue lifecycle hooks</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  onMounted(() =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    initialize();</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125;);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  onBeforeUnmount(() =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    cleanup();</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125;);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  return &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    /** Reactive value that updates when storage changes */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    value: value as Ref&lt;T | null&gt;,</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    /** Manual cleanup function */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">    cleanup</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  &#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">&#125;;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"></span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">/**</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"> * Convenience hook for monitoring sessionStorage changes</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"> * @param key sessionStorage key to monitor</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"> * @param options configuration options (same as useLocalStorageMonitor)</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"> * @returns reactive value and cleanup function</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function"> */</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">export const useSessionStorageMonitor = &lt;T = any&gt;(</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  key: string,</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  options: Omit&lt;Parameters&lt;typeof useLocalStorageMonitor&gt;[1], &#x27;</span>storageType<span class="string">&#x27;&gt; = &#123;&#125;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">) =&gt; &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">  return useLocalStorageMonitor&lt;T&gt;(key, &#123; ...options, storageType: &#x27;</span><span class="variable language_">sessionStorage</span><span class="string">&#x27; &#125;);</span></span></span></span><br><span class="line"><span class="string"><span class="params"><span class="function">&#125;;</span></span></span></span><br></pre></td></tr></table></figure>

<h3 id="服务端渲染"><a href="#服务端渲染" class="headerlink" title="服务端渲染"></a>服务端渲染</h3><h4 id="renderToString"><a href="#renderToString" class="headerlink" title="renderToString()"></a>renderToString()</h4><blockquote>
<p>导出自 <code>vue/server-renderer</code></p>
</blockquote>
<ul>
<li>传入第二个可选的上下文对象用来在渲染过程中记录额外的数据</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createSSRApp &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; renderToString &#125; <span class="keyword">from</span> <span class="string">&#x27;vue/server-renderer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createSSRApp</span>(&#123;</span><br><span class="line">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="string">&#x27;hello world&#x27;</span> &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">template</span>: <span class="string">`&lt;div&gt;&#123;&#123;name&#125;&#125;&lt;/div&gt;`</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ctx = &#123;&#125;;</span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> html = <span class="keyword">await</span> <span class="title function_">renderToString</span>(app, ctx);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(html);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h4 id="renderToNodeStream"><a href="#renderToNodeStream" class="headerlink" title="renderToNodeStream()"></a>renderToNodeStream()</h4><blockquote>
<p>导出自 <code>vue/server-renderer</code></p>
</blockquote>
<p>将输入渲染为一个 <code>Node.js Readable Stream</code> 实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; renderToNodeStream &#125; <span class="keyword">from</span> <span class="string">&#x27;vue/server-renderer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 Node.js http 处理函数中使用</span></span><br><span class="line"><span class="keyword">const</span> stream = <span class="title function_">renderToNodeStream</span>(app);</span><br><span class="line">stream.<span class="title function_">pip</span>(res);</span><br></pre></td></tr></table></figure>

<h4 id="pipeToNodeWritable"><a href="#pipeToNodeWritable" class="headerlink" title="pipeToNodeWritable()"></a>pipeToNodeWritable()</h4><blockquote>
<p>导出自 <code>vue/server-renderer</code></p>
</blockquote>
<p>将输入渲染并 pipe 到一个 <code>Node.js Writable Stream</code> 实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; pipeToNodeWritable &#125; <span class="keyword">from</span> <span class="string">&#x27;vue/server-renderer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 Node.js http 处理函数中使用</span></span><br><span class="line"><span class="title function_">pipeToNodeWritable</span>(app, &#123;&#125;, res);</span><br></pre></td></tr></table></figure>

<h4 id="renderToWebStream"><a href="#renderToWebStream" class="headerlink" title="renderToWebStream()"></a>renderToWebStream()</h4><blockquote>
<p>导出自 <code>vue/server-renderer</code></p>
</blockquote>
<p>将输入渲染为一个 <code>Web ReadableStream</code> 实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; renderToWebStream &#125; <span class="keyword">from</span> <span class="string">&#x27;vue/server-renderer&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">new</span> <span class="title class_">Response</span>(<span class="title function_">renderToWebStream</span>(app));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res); <span class="comment">// Response</span></span><br><span class="line">  <span class="comment">// text() 返回 UTF-8 编码的包含 USVString 对象的 Promise 对象</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> res.<span class="title function_">text</span>());</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h4 id="pipeToWebWritable"><a href="#pipeToWebWritable" class="headerlink" title="pipeToWebWritable()"></a>pipeToWebWritable()</h4><blockquote>
<p>导出自 <code>vue/server-renderer</code></p>
</blockquote>
<p>将输入渲染并 pipe 到一个 <code>Web WritableStream</code> 实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; pipeToWebWritable &#125; <span class="keyword">from</span> <span class="string">&#x27;vue/server-renderer&#x27;</span>;</span><br><span class="line"></span><br><span class="line">(<span class="title function_">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">// 创建一个转换流</span></span><br><span class="line">  <span class="keyword">const</span> tfs = <span class="keyword">new</span> <span class="title class_">TransformStream</span>();</span><br><span class="line">  <span class="comment">// 将内容渲染并 pipe 到转换流的可写流</span></span><br><span class="line">  <span class="title function_">pipeToWebWritable</span>(app, &#123;&#125;, tfs.<span class="property">writable</span>);</span><br><span class="line">  <span class="comment">// 根据转换流的可读流创建响应对象</span></span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">new</span> <span class="title class_">Response</span>(tfs.<span class="property">readable</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pipeToWebWritable &#x27;</span>, res);</span><br><span class="line">  <span class="comment">// text() 返回 UTF-8 编码的包含 USVString 对象的 Promise 对象</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;pipeToWebWritable &#x27;</span>, <span class="keyword">await</span> res.<span class="title function_">text</span>());</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<h4 id="renderToSimpleStream"><a href="#renderToSimpleStream" class="headerlink" title="renderToSimpleStream()"></a>renderToSimpleStream()</h4><blockquote>
<p>导出自 <code>vue/server-renderer</code></p>
</blockquote>
<p>通过一个简单的接口, 将输入以 <code>stream</code> 模式进行渲染</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; renderToSimpleStream &#125; <span class="keyword">from</span> <span class="string">&#x27;vue/server-renderer&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> res = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">renderToSimpleStream</span>(</span><br><span class="line">  app,</span><br><span class="line">  &#123;&#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="title function_">push</span>(<span class="params">chunk</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (chunk == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;renderToSimpleStream render complete: &#x27;</span>, res);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res += chunk;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">destroy</span>(<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="useSSRContext"><a href="#useSSRContext" class="headerlink" title="useSSRContext()"></a>useSSRContext()</h4><p>运行时 API, 用于获取传递给 <code>renderToString</code> 或者其他服务端渲染 API 的上下文对象</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; useSSRContext &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 确保只在服务端渲染时调用</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">if</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">env</span>.<span class="property">SSR</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> ctx = <span class="title function_">useSSRContext</span>();</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 为上下文对象添加属性</span></span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="data-allow-mismatch"><a href="#data-allow-mismatch" class="headerlink" title="data-allow-mismatch"></a>data-allow-mismatch</h4><blockquote>
<p>Vue 3.5 支持</p>
</blockquote>
<p><strong>激活不匹配</strong> 预渲染的 HTML 的 DOM 结构不符合客户端应用的期望, 当 Vue 遇到激活不匹配时, 将尝试自动恢复并调整预渲染的 DOM 结构以匹配客户端的状态, 这将导致一些渲染性能的损失.</p>
<ul>
<li>组件模板中存在不符合规范的 HTML 结构, eg: &lt;p&gt;&lt;div&gt;&lt;/div&gt;&lt;/p&gt;</li>
<li>渲染所用的数据中包含随机生成的值, 由于同一个应用会在服务端和客户端执行两次, 每次执行生成的随机数都不能保证相同</li>
<li>服务端和客户端的时区不一致</li>
</ul>
<p>可以消除激活不匹配警告的特殊的 attribute, 如果没有提供值, 则会允许所有类型的不匹配.<br>允许的值</p>
<ul>
<li>text</li>
<li>children</li>
<li>class</li>
<li>style</li>
<li>attribute</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-allow-mismatch</span>=<span class="string">&quot;text&quot;</span>&gt;</span>&#123;&#123; data.toLocaleString() &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="工具类型"><a href="#工具类型" class="headerlink" title="工具类型"></a>工具类型</h3><h4 id="PropType-lt-T-gt"><a href="#PropType-lt-T-gt" class="headerlink" title="PropType&lt;T&gt;"></a>PropType&lt;T&gt;</h4><p>用于在用运行时 props 声明时给一个 prop 标注更复杂的类型定义</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> type &#123; <span class="title class_">PropType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line">interface <span class="title class_">Book</span>&#123;</span><br><span class="line">  <span class="attr">title</span>: string,</span><br><span class="line">  <span class="attr">author</span>: string,</span><br><span class="line">  <span class="attr">year</span>: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">book</span>: &#123;</span><br><span class="line">      <span class="comment">// 提供一个比 `Object` 更具体的类型</span></span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">Object</span> <span class="keyword">as</span> <span class="title class_">PropType</span>&lt;<span class="title class_">Book</span>&gt;,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ComponentCustomProperties"><a href="#ComponentCustomProperties" class="headerlink" title="ComponentCustomProperties"></a>ComponentCustomProperties</h4><p>用于增强组件实例类型以支持自定义全局属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;vue&#x27;</span>&#123;</span><br><span class="line">  interface <span class="title class_">ComponentCustomProperties</span> &#123;</span><br><span class="line">    <span class="attr">$http</span>: <span class="keyword">typeof</span> axios</span><br><span class="line">    <span class="attr">$translate</span>: <span class="function">(<span class="params">key: string</span>) =&gt;</span> string</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ComponentCustomOptions"><a href="#ComponentCustomOptions" class="headerlink" title="ComponentCustomOptions"></a>ComponentCustomOptions</h4><p>用来扩展组件选项类型以支持自定义选项</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Route</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"></span><br><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;vue&#x27;</span> &#123;</span><br><span class="line">  interface <span class="title class_">ComponentCustomOptions</span> &#123;</span><br><span class="line">    beforeRouteEnter?(<span class="attr">to</span>: any, <span class="attr">from</span>: any, <span class="attr">next</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span>): <span class="keyword">void</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ComponentCustomProps"><a href="#ComponentCustomProps" class="headerlink" title="ComponentCustomProps"></a>ComponentCustomProps</h4><p>用于扩展全局可用的 TSX props, 以便在 TSX 元素上使用没有在组件选项上定义过的 props</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;vue&#x27;</span>&#123;</span><br><span class="line">  interface <span class="title class_">ComponentCustomProps</span> &#123;</span><br><span class="line">    hello?: string</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CSSProperties"><a href="#CSSProperties" class="headerlink" title="CSSProperties"></a>CSSProperties</h4><p>用于扩展在样式属性绑定上允许的值的类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">declare <span class="variable language_">module</span> <span class="string">&#x27;vue&#x27;</span> &#123;</span><br><span class="line">  interface <span class="title class_">CSSProperties</span> &#123;</span><br><span class="line">    [<span class="attr">key</span>: <span class="string">`--<span class="subst">$&#123;string&#125;</span>`</span>]: string</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义渲染"><a href="#自定义渲染" class="headerlink" title="自定义渲染"></a>自定义渲染</h3><h4 id="createRenderer"><a href="#createRenderer" class="headerlink" title="createRenderer()"></a>createRenderer()</h4><p>创建一个自定义渲染器, 可以在非 DOM 环境中使用 Vue 核心运行时的特性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRenderer &#125; <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; render, createApp &#125; = <span class="title function_">createRenderer</span>(&#123;</span><br><span class="line">  patchProp,</span><br><span class="line">  insert,</span><br><span class="line">  remove,</span><br><span class="line">  createElement,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// render 是底层 API</span></span><br><span class="line"><span class="comment">// createApp 返回一个应用实例</span></span><br><span class="line"><span class="keyword">export</span> &#123; render, createApp &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重新导出 Vue 的核心 API</span></span><br><span class="line"><span class="keyword">export</span> * <span class="keyword">from</span> <span class="string">&#x27;@vue/runtime-core&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h2><ul>
<li><p>useLink</p>
</li>
<li><p>useRoute 返回当前的路由地址, 相当于模板中使用 $route</p>
</li>
<li><p>useRouter 返回路由器实例, 相当于模板中使用 $router</p>
</li>
<li><p>路由组件传参, 使用 props 将路由和组件解耦</p>
<ul>
<li>布尔模式: <code>&#123;path: &#39;/users/:id&#39;, component: User, props: true&#125;</code></li>
<li>命名视图: <code>&#123;path: &#39;/users/:id&#39;, components: &#123;default: User, sidebar: SideBar&#125;, props: &#123;default: true, sidebar: true&#125;&#125;</code></li>
<li>对象模式: <code>&#123;path: &#39;/users/profile&#39;, component: User, props: &#123;newsLetterPopup: false&#125;&#125;</code></li>
<li>函数模式: <code>&#123;path: &#39;/search&#39;, component: Search, props: (route) =&gt; (&#123;query: route.query&#125;)&#125;</code></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件 User 和 路由强耦合</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = &#123; <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;User &#123;&#123;$route.params.id&#125;&#125;&lt;/div&gt;&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> routes = [&#123; <span class="attr">path</span>: <span class="string">&#x27;/users/:id&#x27;</span>, <span class="attr">component</span>: <span class="title class_">User</span> &#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 props 设置 true 时, route.params 将被设置为组件的 props</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = &#123; <span class="attr">props</span>: [<span class="string">&#x27;id&#x27;</span>], <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;User &#123;&#123;id&#125;&#125;&lt;/div&gt;&#x27;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> routes = [&#123; <span class="attr">path</span>: <span class="string">&#x27;/users/:id&#x27;</span>, <span class="attr">component</span>: <span class="title class_">User</span>, <span class="attr">props</span>: <span class="literal">true</span> &#125;];</span><br></pre></td></tr></table></figure>

<ul>
<li>beforeEnter 路由独享的守卫, <strong>只在进入路由时触发</strong>, 不会在 params, query, hash 改变时触发</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/users/:id&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="title class_">User</span>,</span><br><span class="line">    <span class="attr">beforeEnter</span>: <span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 从 /users/2 到 /users/3，/users/2#info 到 /users/2#projects 不会触发</span></span><br><span class="line">      <span class="comment">// reject navigation</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<ul>
<li>onBeforeRouteUpdate 组合式 API 中使用组件 update 守卫</li>
<li>onBeforeRouteLeave 组合式 API 中使用组件 leave 守卫</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">import</span> &#123; onBeforeRouteUpdate, onBeforeRouteLeave &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> userData = <span class="title function_">ref</span>();</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onBeforeRouteLeave</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span></span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> answer = <span class="variable language_">window</span>.<span class="title function_">confirm</span>(<span class="string">&#x27;leave?&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 取消导航并停留在同一页面上</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (!answer) <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onBeforeRouteUpdate</span>(<span class="title function_">async</span> (to, <span class="keyword">from</span>) =&gt; &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (to.<span class="property">params</span>.<span class="property">id</span> != <span class="keyword">from</span>.<span class="property">params</span>.<span class="property">id</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      userData.<span class="property">value</span> = <span class="keyword">await</span> <span class="title function_">fetchUser</span>(to.<span class="property">params</span>.<span class="property">id</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="编程式导航"><a href="#编程式导航" class="headerlink" title="编程式导航"></a>编程式导航</h3><ul>
<li>当同时提供了 path, params 参数时, params 会被忽略</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> router = <span class="title function_">useRouter</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// params 不能和 path 同时使用</span></span><br><span class="line">router.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/user&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">username</span>: <span class="string">&#x27;zhangsan&#x27;</span> &#125; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以使用 name 和 params 组合</span></span><br><span class="line">router.<span class="title function_">push</span>(&#123; <span class="attr">name</span>: <span class="string">&#x27;user&#x27;</span>, <span class="attr">params</span>: &#123; <span class="attr">username</span>: <span class="string">&#x27;zhangsan&#x27;</span> &#125; &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>替换当前位置</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">push</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span>, <span class="attr">replace</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line">router.<span class="title function_">replace</span>(&#123; <span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Pinia"><a href="#Pinia" class="headerlink" title="Pinia  "></a>Pinia <em id="store"></em> <!-- markdownlint-disable-line --></h2><p>store 是一个用 <a href="#reactive">reactive</a> 包装的对象, 不需要使用 .value 访问, 使用解构的方式将会丢失响应性</p>
<ul>
<li>defineStore 创建 store, 可使用 Option 对象 或 Setup 函数</li>
<li>storeToRefs() 从 store 中提取属性时保持其响应性, 并且跳过所有的 action 或非响应式(不是 ref 或 reactive)的属性</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia, defineStore, storeToRefs &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="comment">// 创建 pinia 并挂载到 vue 实例</span></span><br><span class="line"><span class="keyword">const</span> pinia = <span class="title function_">createPinia</span>();</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(&#123;&#125;);</span><br><span class="line">app.<span class="title function_">use</span>(pinia);</span><br><span class="line">app.<span class="title function_">mount</span>(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line"><span class="comment">// 定义 store</span></span><br><span class="line"><span class="keyword">const</span> useCounterStore = <span class="title function_">defineStore</span>(<span class="string">&#x27;counter&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> count = <span class="title function_">ref</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> doubleCount = count.<span class="property">value</span> * <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">const</span> increment = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    count.<span class="property">value</span>++;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123; count &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> counter = <span class="title function_">useCounterStore</span>();</span><br><span class="line"><span class="comment">// count, doubleCount 是响应式的 ref</span></span><br><span class="line"><span class="comment">// 同时通过插件添加的属性也会被提取为 ref</span></span><br><span class="line"><span class="comment">// 并且会跳过所有的 action 或非响应式(不是 ref 或 reactive) 的属性</span></span><br><span class="line"><span class="keyword">const</span> &#123; count, doubleCount &#125; = <span class="title function_">storeToRefs</span>(counter);</span><br><span class="line"><span class="comment">// 作为 action 的 increment 可以直接解构</span></span><br><span class="line"><span class="keyword">const</span> &#123; increment &#125; = counter;</span><br></pre></td></tr></table></figure>

<ul>
<li>store.$dispose() 停止 store 的相关作用域, 并从 store 注册表中删除它. 插件可以覆盖此方法来清理已添加的任何副作用函数</li>
<li>store.$reset() 重置 state 为初始值<ul>
<li>使用 选项式 API 创建的 store 调用此方法, 使用 setup 创建的 store 调用此方法报错 <code>Error: ... is built using the setup syntax and does not implement $reset()</code></li>
</ul>
</li>
<li>store.$patch() 批量修改 state, 可接收一个对象或者一个函数, 如果参数为函数, 函数接收一个参数 state 表示当前 store</li>
<li>store.$subscribe() 订阅 state, 侦听 state 及其变化在 patch 后只触发一次,<br>默认情况下, state 订阅器被绑定在使用的组件上, 当组件卸载时, 它们将被自动移除, 如果想在组件卸载时仍保留它们, 传入第二个参数 <code>&#123; detached: true &#125;</code>, 将订阅器从组件中分离</li>
<li>store.$onAction() 订阅 action, 传递给它的回调函数会在 action 本身之前执行,<br>默认情况下, action 订阅器被绑定在使用的组件上, 当组件卸载时, 它们将被自动移除, 如果想在组件卸载时仍保留它们, 传入第二个参数 true, 将订阅器从组件中分离</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">&#x27;./useCounterStore.js&#x27;</span>; <span class="comment">// counter</span></span><br><span class="line"><span class="keyword">const</span> counter = <span class="title function_">useCounterStore</span>();</span><br><span class="line"><span class="keyword">const</span> unsubscribe = counter.$onAction(</span><br><span class="line">  <span class="function">(<span class="params">&#123; name, store, args, after, onError &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/* ... */</span></span><br><span class="line">    <span class="comment">// after 函数将在 action 成功并完全运行后触发, 等待着任何返回的 promise</span></span><br><span class="line">    <span class="title function_">after</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;&#125;);</span><br><span class="line">    <span class="comment">// onError 函数将在 action 抛出或返回一个拒绝的 promise 时触发</span></span><br><span class="line">    <span class="title function_">onError</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;&#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span> <span class="comment">// 组件卸载时订阅器仍会被保留</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">// 取消订阅</span></span><br><span class="line"><span class="title function_">unsubscribe</span>();</span><br></pre></td></tr></table></figure>

<ul>
<li>setMapStoreSuffix() 修改 pinia 为每个 store 的 id 后面加上后缀, 默认 ‘Store’, 修改后会影响调用辅助函数 mapStores 后的 store 的访问方式</li>
<li>mapStores() 将整个 store 映射为组件的计算属性</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapStores &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">&#x27;./useCounterStore.js&#x27;</span>; <span class="comment">// counter</span></span><br><span class="line"><span class="keyword">import</span> &#123; useUserStore &#125; <span class="keyword">from</span> <span class="string">&#x27;./useUserStore.js&#x27;</span>; <span class="comment">// user</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="comment">// 需要使用 id+&#x27;Store&#x27; 的形式访问每个 store</span></span><br><span class="line">    ...<span class="title function_">mapStores</span>(useCounterStore, useUserStore),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">m1</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">counterStore</span>.<span class="property">count</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">counterStore</span>.<span class="title function_">increment</span>();</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>mapState() 辅助函数, 将 state 属性映射为只读的计算属性</li>
<li>mapWritableState() 辅助函数, 将 state 映射为可修改的属性</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">&#x27;./useCounterStore.js&#x27;</span>; <span class="comment">// counter</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  <span class="attr">computed</span>: &#123;</span><br><span class="line">    ...<span class="title function_">mapState</span>(useCounterStore, [<span class="string">&#x27;count&#x27;</span>]),</span><br><span class="line">    ...<span class="title function_">mapState</span>(useCounterStore, &#123;</span><br><span class="line">      <span class="attr">myCount</span>: <span class="string">&#x27;count&#x27;</span>,</span><br><span class="line">      <span class="attr">double</span>: <span class="function">(<span class="params">store</span>) =&gt;</span> store.<span class="property">count</span> * <span class="number">2</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>mapActions() 辅助函数, 将 action 属性映射为组件的方法</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapActions &#125; <span class="keyword">from</span> <span class="string">&#x27;pinia&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useCounterStore &#125; <span class="keyword">from</span> <span class="string">&#x27;./useCounterStore.js&#x27;</span>; <span class="comment">// counter</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;&#125;,</span><br><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="comment">// 将 increment 方法注册为组件的 myIncrement 方法</span></span><br><span class="line">    ...<span class="title function_">mapActions</span>(useCounterStore, &#123;</span><br><span class="line">      <span class="attr">myIncrement</span>: <span class="string">&#x27;increment&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章推荐</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\08\9fc9b29dd769\" rel="bookmark">Vue3-migration</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\03\5f5e09a672cd\" rel="bookmark">ArrayBuffer</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\03\0734d1c7c12c\" rel="bookmark">JS</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2022\02\18f2de6d45f9\" rel="bookmark">JSUtils</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2021\06\0bc450a2cb90\" rel="bookmark">Promise</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>luoleiself
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://luoleiself.github.io/2021/06/c430903d5070/" title="Vue3">https://luoleiself.github.io/2021/06/c430903d5070/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/js/" rel="tag"># js</a>
              <a href="/tags/VueJs/" rel="tag"># VueJs</a>
              <a href="/tags/Vue3/" rel="tag"># Vue3</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/04/818522433104/" rel="prev" title="Git命令">
      <i class="fa fa-chevron-left"></i> Git命令
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/06/0bc450a2cb90/" rel="next" title="Promise">
      Promise <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A8%E5%B1%80-API"><span class="nav-number">1.</span> <span class="nav-text">全局 API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%AE%9E%E4%BE%8B-API"><span class="nav-number">1.1.</span> <span class="nav-text">应用实例 API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#createApp"><span class="nav-number">1.1.1.</span> <span class="nav-text">createApp()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createSSRApp"><span class="nav-number">1.1.2.</span> <span class="nav-text">createSSRApp()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-mount"><span class="nav-number">1.1.3.</span> <span class="nav-text">app.mount()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-unmount"><span class="nav-number">1.1.4.</span> <span class="nav-text">app.unmount()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-onUnmount"><span class="nav-number">1.1.5.</span> <span class="nav-text">app.onUnmount()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-component"><span class="nav-number">1.1.6.</span> <span class="nav-text">app.component()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-directive"><span class="nav-number">1.1.7.</span> <span class="nav-text">app.directive()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-use"><span class="nav-number">1.1.8.</span> <span class="nav-text">app.use()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-mixin"><span class="nav-number">1.1.9.</span> <span class="nav-text">app.mixin()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-provide"><span class="nav-number">1.1.10.</span> <span class="nav-text">app.provide()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-runWithContext"><span class="nav-number">1.1.11.</span> <span class="nav-text">app.runWithContext()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-version"><span class="nav-number">1.1.12.</span> <span class="nav-text">app.version</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#app-config"><span class="nav-number">1.1.13.</span> <span class="nav-text">app.config</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#app-config-errorHandler"><span class="nav-number">1.1.13.1.</span> <span class="nav-text">app.config.errorHandler</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#app-config-warnHandler"><span class="nav-number">1.1.13.2.</span> <span class="nav-text">app.config.warnHandler</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#app-config-performance"><span class="nav-number">1.1.13.3.</span> <span class="nav-text">app.config.performance</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#app-config-compilerOptions"><span class="nav-number">1.1.13.4.</span> <span class="nav-text">app.config.compilerOptions</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#app-config-globalProperties"><span class="nav-number">1.1.13.5.</span> <span class="nav-text">app.config.globalProperties</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#app-config-optionMergeStrategies"><span class="nav-number">1.1.13.6.</span> <span class="nav-text">app.config.optionMergeStrategies</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#app-config-idPrefix"><span class="nav-number">1.1.13.7.</span> <span class="nav-text">app.config.idPrefix</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#app-config-throwUnhandledErrorInProduction"><span class="nav-number">1.1.13.8.</span> <span class="nav-text">app.config.throwUnhandledErrorInProduction</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E7%94%A8"><span class="nav-number">1.2.</span> <span class="nav-text">通用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#version"><span class="nav-number">1.2.1.</span> <span class="nav-text">version</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nextTick"><span class="nav-number">1.2.2.</span> <span class="nav-text">nextTick()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defineComponent"><span class="nav-number">1.2.3.</span> <span class="nav-text">defineComponent()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defineAsyncComponent"><span class="nav-number">1.2.4.</span> <span class="nav-text">defineAsyncComponent()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defineCustomElement"><span class="nav-number">1.2.5.</span> <span class="nav-text">defineCustomElement()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E5%BC%8F-API"><span class="nav-number">2.</span> <span class="nav-text">组合式 API  </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#setup"><span class="nav-number">2.1.</span> <span class="nav-text">setup()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">2.1.1.</span> <span class="nav-text">基本使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE-Props"><span class="nav-number">2.1.2.</span> <span class="nav-text">访问 Props</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">2.1.3.</span> <span class="nav-text">上下文</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-slot-%E6%B8%B2%E6%9F%93"><span class="nav-number">2.1.3.1.</span> <span class="nav-text">使用 slot 渲染</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-slotscope-%E6%B8%B2%E6%9F%93"><span class="nav-number">2.1.3.2.</span> <span class="nav-text">使用 slotscope 渲染</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%94%E5%9B%9E%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0"><span class="nav-number">2.1.4.</span> <span class="nav-text">返回渲染函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F-%E6%A0%B8%E5%BF%83"><span class="nav-number">2.2.</span> <span class="nav-text">响应式: 核心</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ref"><span class="nav-number">2.2.1.</span> <span class="nav-text">ref()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#computed"><span class="nav-number">2.2.2.</span> <span class="nav-text">computed()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#reactive"><span class="nav-number">2.2.3.</span> <span class="nav-text">reactive()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#readonly"><span class="nav-number">2.2.4.</span> <span class="nav-text">readonly()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#watch"><span class="nav-number">2.2.5.</span> <span class="nav-text">watch()  </span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%82%E6%95%B0"><span class="nav-number">2.2.5.1.</span> <span class="nav-text">参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8E-watchEffect-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="nav-number">2.2.5.2.</span> <span class="nav-text">与 watchEffect() 的区别</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#watchEffect"><span class="nav-number">2.2.6.</span> <span class="nav-text">watchEffect()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#watchPostEffect"><span class="nav-number">2.2.7.</span> <span class="nav-text">watchPostEffect()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#watchSyncEffect"><span class="nav-number">2.2.8.</span> <span class="nav-text">watchSyncEffect()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onWatcherCleanup"><span class="nav-number">2.2.9.</span> <span class="nav-text">onWatcherCleanup()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F-%E5%B7%A5%E5%85%B7"><span class="nav-number">2.3.</span> <span class="nav-text">响应式: 工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#isRef"><span class="nav-number">2.3.1.</span> <span class="nav-text">isRef()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#unref"><span class="nav-number">2.3.2.</span> <span class="nav-text">unref()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toRef"><span class="nav-number">2.3.3.</span> <span class="nav-text">toRef()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toValue"><span class="nav-number">2.3.4.</span> <span class="nav-text">toValue()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toRefs"><span class="nav-number">2.3.5.</span> <span class="nav-text">toRefs()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#isProxy"><span class="nav-number">2.3.6.</span> <span class="nav-text">isProxy()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#isReactive"><span class="nav-number">2.3.7.</span> <span class="nav-text">isReactive()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#isReadonly"><span class="nav-number">2.3.8.</span> <span class="nav-text">isReadonly()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F-%E8%BF%9B%E9%98%B6"><span class="nav-number">2.4.</span> <span class="nav-text">响应式: 进阶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#shallowRef"><span class="nav-number">2.4.1.</span> <span class="nav-text">shallowRef()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#triggerRef"><span class="nav-number">2.4.2.</span> <span class="nav-text">triggerRef()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#customRef"><span class="nav-number">2.4.3.</span> <span class="nav-text">customRef()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#shallowReactive"><span class="nav-number">2.4.4.</span> <span class="nav-text">shallowReactive()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#shallowReadonly"><span class="nav-number">2.4.5.</span> <span class="nav-text">shallowReadonly()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#toRaw"><span class="nav-number">2.4.6.</span> <span class="nav-text">toRaw()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#markRaw"><span class="nav-number">2.4.7.</span> <span class="nav-text">markRaw()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#effectScope"><span class="nav-number">2.4.8.</span> <span class="nav-text">effectScope()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getCurrentScope"><span class="nav-number">2.4.9.</span> <span class="nav-text">getCurrentScope()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onScopeDispose"><span class="nav-number">2.4.10.</span> <span class="nav-text">onScopeDispose()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90"><span class="nav-number">2.5.</span> <span class="nav-text">生命周期钩子</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#onBeforeMount"><span class="nav-number">2.5.1.</span> <span class="nav-text">onBeforeMount()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onMounted"><span class="nav-number">2.5.2.</span> <span class="nav-text">onMounted()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onBeforeUpdate"><span class="nav-number">2.5.3.</span> <span class="nav-text">onBeforeUpdate()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onUpdated"><span class="nav-number">2.5.4.</span> <span class="nav-text">onUpdated()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onBeforeUnmount"><span class="nav-number">2.5.5.</span> <span class="nav-text">onBeforeUnmount()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onUnmounted"><span class="nav-number">2.5.6.</span> <span class="nav-text">onUnmounted()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onActivated"><span class="nav-number">2.5.7.</span> <span class="nav-text">onActivated()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onDeactivated"><span class="nav-number">2.5.8.</span> <span class="nav-text">onDeactivated()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onErrorCaptured"><span class="nav-number">2.5.9.</span> <span class="nav-text">onErrorCaptured()  </span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E6%9D%A5%E6%BA%90"><span class="nav-number">2.5.9.1.</span> <span class="nav-text">错误来源</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E4%BC%A0%E9%80%92%E8%A7%84%E5%88%99"><span class="nav-number">2.5.9.2.</span> <span class="nav-text">错误传递规则</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onRenderTracked"><span class="nav-number">2.5.10.</span> <span class="nav-text">onRenderTracked()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onRenderTriggered"><span class="nav-number">2.5.11.</span> <span class="nav-text">onRenderTriggered()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#onServerPrefetch"><span class="nav-number">2.5.12.</span> <span class="nav-text">onServerPrefetch()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#VNode-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E4%BA%8B%E4%BB%B6"><span class="nav-number">2.5.13.</span> <span class="nav-text">VNode 生命周期事件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="nav-number">2.6.</span> <span class="nav-text">依赖注入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#provide"><span class="nav-number">2.6.1.</span> <span class="nav-text">provide()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#inject"><span class="nav-number">2.6.2.</span> <span class="nav-text">inject()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hasInjectionContext"><span class="nav-number">2.6.3.</span> <span class="nav-text">hasInjectionContext()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%89%E9%A1%B9%E5%BC%8F-API"><span class="nav-number">3.</span> <span class="nav-text">选项式 API  </span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%85%E5%8A%A9"><span class="nav-number">3.1.</span> <span class="nav-text">辅助</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#useAttrs"><span class="nav-number">3.1.1.</span> <span class="nav-text">useAttrs()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useSlots"><span class="nav-number">3.1.2.</span> <span class="nav-text">useSlots()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useModel"><span class="nav-number">3.1.3.</span> <span class="nav-text">useModel()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useTemplateRef"><span class="nav-number">3.1.4.</span> <span class="nav-text">useTemplateRef()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useId"><span class="nav-number">3.1.5.</span> <span class="nav-text">useId()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useHost"><span class="nav-number">3.1.6.</span> <span class="nav-text">useHost()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useShadowRoot"><span class="nav-number">3.1.7.</span> <span class="nav-text">useShadowRoot()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E9%80%89%E9%A1%B9"><span class="nav-number">3.2.</span> <span class="nav-text">状态选项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#data"><span class="nav-number">3.2.1.</span> <span class="nav-text">data</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#props"><span class="nav-number">3.2.2.</span> <span class="nav-text">props  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#computed-1"><span class="nav-number">3.2.3.</span> <span class="nav-text">computed</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#methods"><span class="nav-number">3.2.4.</span> <span class="nav-text">methods</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#watch-1"><span class="nav-number">3.2.5.</span> <span class="nav-text">watch</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#emits"><span class="nav-number">3.2.6.</span> <span class="nav-text">emits  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#expose"><span class="nav-number">3.2.7.</span> <span class="nav-text">expose</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E9%80%89%E9%A1%B9"><span class="nav-number">3.3.</span> <span class="nav-text">渲染选项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#template"><span class="nav-number">3.3.1.</span> <span class="nav-text">template</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#render"><span class="nav-number">3.3.2.</span> <span class="nav-text">render</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#compilerOptions"><span class="nav-number">3.3.3.</span> <span class="nav-text">compilerOptions</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%80%89%E9%A1%B9"><span class="nav-number">3.4.</span> <span class="nav-text">生命周期选项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#beforeCreate"><span class="nav-number">3.4.1.</span> <span class="nav-text">beforeCreate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#created"><span class="nav-number">3.4.2.</span> <span class="nav-text">created</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#beforeMount"><span class="nav-number">3.4.3.</span> <span class="nav-text">beforeMount</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mounted"><span class="nav-number">3.4.4.</span> <span class="nav-text">mounted</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#beforeUpdate"><span class="nav-number">3.4.5.</span> <span class="nav-text">beforeUpdate</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#updated"><span class="nav-number">3.4.6.</span> <span class="nav-text">updated</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#beforeUnmount"><span class="nav-number">3.4.7.</span> <span class="nav-text">beforeUnmount</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#unmounted"><span class="nav-number">3.4.8.</span> <span class="nav-text">unmounted</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#activated"><span class="nav-number">3.4.9.</span> <span class="nav-text">activated</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#deactivated"><span class="nav-number">3.4.10.</span> <span class="nav-text">deactivated</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#errorCaptured"><span class="nav-number">3.4.11.</span> <span class="nav-text">errorCaptured</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderTracked"><span class="nav-number">3.4.12.</span> <span class="nav-text">renderTracked</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderTriggered"><span class="nav-number">3.4.13.</span> <span class="nav-text">renderTriggered</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#serverPrefetch"><span class="nav-number">3.4.14.</span> <span class="nav-text">serverPrefetch</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E9%80%89%E9%A1%B9"><span class="nav-number">3.5.</span> <span class="nav-text">组合选项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#provide-1"><span class="nav-number">3.5.1.</span> <span class="nav-text">provide</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#inject-1"><span class="nav-number">3.5.2.</span> <span class="nav-text">inject</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mixins"><span class="nav-number">3.5.3.</span> <span class="nav-text">mixins</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#extends"><span class="nav-number">3.5.4.</span> <span class="nav-text">extends</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%9D%82%E9%A1%B9"><span class="nav-number">3.6.</span> <span class="nav-text">其他杂项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#name"><span class="nav-number">3.6.1.</span> <span class="nav-text">name</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF-1"><span class="nav-number">3.6.1.1.</span> <span class="nav-text">场景 1</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF-2"><span class="nav-number">3.6.1.2.</span> <span class="nav-text">场景 2</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#inheritAttrs"><span class="nav-number">3.6.2.</span> <span class="nav-text">inheritAttrs  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#components"><span class="nav-number">3.6.3.</span> <span class="nav-text">components</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#directives"><span class="nav-number">3.6.4.</span> <span class="nav-text">directives</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E5%AE%9E%E4%BE%8B"><span class="nav-number">3.7.</span> <span class="nav-text">组件实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#data-1"><span class="nav-number">3.7.1.</span> <span class="nav-text">$data</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#props-1"><span class="nav-number">3.7.2.</span> <span class="nav-text">$props</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#el"><span class="nav-number">3.7.3.</span> <span class="nav-text">$el</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#options"><span class="nav-number">3.7.4.</span> <span class="nav-text">$options</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#parent"><span class="nav-number">3.7.5.</span> <span class="nav-text">$parent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#root"><span class="nav-number">3.7.6.</span> <span class="nav-text">$root</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#slots"><span class="nav-number">3.7.7.</span> <span class="nav-text">$slots</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#refs"><span class="nav-number">3.7.8.</span> <span class="nav-text">$refs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#attrs"><span class="nav-number">3.7.9.</span> <span class="nav-text">$attrs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#watch-2"><span class="nav-number">3.7.10.</span> <span class="nav-text">$watch()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#emit"><span class="nav-number">3.7.11.</span> <span class="nav-text">$emit()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#forceUpdate"><span class="nav-number">3.7.12.</span> <span class="nav-text">$forceUpdate()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#nextTick-1"><span class="nav-number">3.7.13.</span> <span class="nav-text">$nextTick()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E5%86%85%E5%AE%B9"><span class="nav-number">4.</span> <span class="nav-text">内置内容</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E6%8C%87%E4%BB%A4"><span class="nav-number">4.1.</span> <span class="nav-text">内置指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#v-text"><span class="nav-number">4.1.1.</span> <span class="nav-text">v-text</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-html"><span class="nav-number">4.1.2.</span> <span class="nav-text">v-html</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-show"><span class="nav-number">4.1.3.</span> <span class="nav-text">v-show</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-if"><span class="nav-number">4.1.4.</span> <span class="nav-text">v-if</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-else"><span class="nav-number">4.1.5.</span> <span class="nav-text">v-else</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-for"><span class="nav-number">4.1.6.</span> <span class="nav-text">v-for</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-on"><span class="nav-number">4.1.7.</span> <span class="nav-text">v-on</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%86%85%E8%81%94%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">4.1.7.1.</span> <span class="nav-text">内联事件处理器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">4.1.7.2.</span> <span class="nav-text">方法事件处理器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-number">4.1.7.3.</span> <span class="nav-text">事件修饰符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8C%89%E9%94%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-number">4.1.7.4.</span> <span class="nav-text">按键修饰符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%8C%89%E9%94%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-number">4.1.7.5.</span> <span class="nav-text">系统按键修饰符</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-bind"><span class="nav-number">4.1.8.</span> <span class="nav-text">v-bind  </span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%91%E5%AE%9A%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-number">4.1.8.1.</span> <span class="nav-text">绑定修饰符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%90%8C%E5%90%8D%E7%BC%A9%E5%86%99"><span class="nav-number">4.1.8.2.</span> <span class="nav-text">同名缩写</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-model"><span class="nav-number">4.1.9.</span> <span class="nav-text">v-model  </span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="nav-number">4.1.9.1.</span> <span class="nav-text">修饰符</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%89%88%E6%9C%AC%E8%BF%AD%E4%BB%A3"><span class="nav-number">4.1.9.2.</span> <span class="nav-text">版本迭代</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#migration"><span class="nav-number">4.1.9.3.</span> <span class="nav-text">migration</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Vue-2-0"><span class="nav-number">4.1.9.4.</span> <span class="nav-text">Vue 2.0</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Vue-2-2"><span class="nav-number">4.1.9.5.</span> <span class="nav-text">Vue 2.2</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Vue-2-3"><span class="nav-number">4.1.9.6.</span> <span class="nav-text">Vue 2.3</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Vue-3-x"><span class="nav-number">4.1.9.7.</span> <span class="nav-text">Vue 3.x</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-slot"><span class="nav-number">4.1.10.</span> <span class="nav-text">v-slot  </span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%99%90%E5%88%B6%E4%BD%BF%E7%94%A8"><span class="nav-number">4.1.10.1.</span> <span class="nav-text">限制使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E5%90%8D%E6%8F%92%E6%A7%BD"><span class="nav-number">4.1.10.2.</span> <span class="nav-text">具名插槽</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%8F%92%E6%A7%BD"><span class="nav-number">4.1.10.3.</span> <span class="nav-text">动态插槽</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%8F%92%E6%A7%BD"><span class="nav-number">4.1.10.4.</span> <span class="nav-text">作用域插槽</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-pre"><span class="nav-number">4.1.11.</span> <span class="nav-text">v-pre</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-once"><span class="nav-number">4.1.12.</span> <span class="nav-text">v-once</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-memo"><span class="nav-number">4.1.13.</span> <span class="nav-text">v-memo</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#v-cloak"><span class="nav-number">4.1.14.</span> <span class="nav-text">v-cloak</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E7%BB%84%E4%BB%B6"><span class="nav-number">4.2.</span> <span class="nav-text">内置组件  </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-Transition-gt"><span class="nav-number">4.2.1.</span> <span class="nav-text">&lt;Transition&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-Transition-gt-props"><span class="nav-number">4.2.1.1.</span> <span class="nav-text">&lt;Transition&gt; props</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-Transition-gt-%E4%BA%8B%E4%BB%B6"><span class="nav-number">4.2.1.2.</span> <span class="nav-text">&lt;Transition&gt; 事件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-TransitionGroup-gt"><span class="nav-number">4.2.2.</span> <span class="nav-text">&lt;TransitionGroup&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-TransitionGroup-gt-props"><span class="nav-number">4.2.2.1.</span> <span class="nav-text">&lt;TransitionGroup&gt; props</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-TransitionGroup-gt-%E4%BA%8B%E4%BB%B6"><span class="nav-number">4.2.2.2.</span> <span class="nav-text">&lt;TransitionGroup&gt; 事件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-KeepAlive-gt"><span class="nav-number">4.2.3.</span> <span class="nav-text">&lt;KeepAlive&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-KeepAlive-gt-props"><span class="nav-number">4.2.3.1.</span> <span class="nav-text">&lt;KeepAlive&gt; props</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-Teleport-gt"><span class="nav-number">4.2.4.</span> <span class="nav-text">&lt;Teleport&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-Teleport-gt-props"><span class="nav-number">4.2.4.1.</span> <span class="nav-text">&lt;Teleport&gt; props</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-Suspense-gt"><span class="nav-number">4.2.5.</span> <span class="nav-text">&lt;Suspense&gt;  </span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-Suspense-gt-props"><span class="nav-number">4.2.5.1.</span> <span class="nav-text">&lt;Suspense&gt; props</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-Suspense-gt-%E4%BA%8B%E4%BB%B6"><span class="nav-number">4.2.5.2.</span> <span class="nav-text">&lt;Suspense&gt; 事件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-Suspense-gt-%E6%8F%92%E6%A7%BD"><span class="nav-number">4.2.5.3.</span> <span class="nav-text">&lt;Suspense&gt; 插槽</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E7%89%B9%E6%AE%8A%E5%85%83%E7%B4%A0"><span class="nav-number">4.3.</span> <span class="nav-text">内置特殊元素</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-component-gt"><span class="nav-number">4.3.1.</span> <span class="nav-text">&lt;component&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-component-gt-props"><span class="nav-number">4.3.1.1.</span> <span class="nav-text">&lt;component&gt; props</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-slot-gt"><span class="nav-number">4.3.2.</span> <span class="nav-text">&lt;slot&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#lt-slot-gt-props"><span class="nav-number">4.3.2.1.</span> <span class="nav-text">&lt;slot&gt; props</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#lt-template-gt"><span class="nav-number">4.3.3.</span> <span class="nav-text">&lt;template&gt;</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E7%89%B9%E6%AE%8A-Attributes"><span class="nav-number">4.4.</span> <span class="nav-text">内置特殊 Attributes</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#key"><span class="nav-number">4.4.1.</span> <span class="nav-text">key</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ref-1"><span class="nav-number">4.4.2.</span> <span class="nav-text">ref</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#is"><span class="nav-number">4.4.3.</span> <span class="nav-text">is</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E6%96%87%E4%BB%B6%E7%BB%84%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text">单文件组件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SFC-%E8%AF%AD%E6%B3%95%E5%AE%9A%E4%B9%89"><span class="nav-number">5.1.</span> <span class="nav-text">SFC 语法定义</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#src-%E5%AF%BC%E5%85%A5"><span class="nav-number">5.1.1.</span> <span class="nav-text">src 导入</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lt-script-setup-gt"><span class="nav-number">5.2.</span> <span class="nav-text">&lt;script setup&gt;</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B6%E5%B1%82%E7%BB%91%E5%AE%9A"><span class="nav-number">5.2.1.</span> <span class="nav-text">顶层绑定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%93%8D%E5%BA%94%E5%BC%8F"><span class="nav-number">5.2.2.</span> <span class="nav-text">响应式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%BB%84%E4%BB%B6"><span class="nav-number">5.2.3.</span> <span class="nav-text">使用组件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6"><span class="nav-number">5.2.3.1.</span> <span class="nav-text">动态组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%80%92%E5%BD%92%E7%BB%84%E4%BB%B6"><span class="nav-number">5.2.3.2.</span> <span class="nav-text">递归组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%BB%84%E4%BB%B6"><span class="nav-number">5.2.3.3.</span> <span class="nav-text">命名空间组件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4"><span class="nav-number">5.2.4.</span> <span class="nav-text">使用自定义指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defineProps-defineEmits"><span class="nav-number">5.2.5.</span> <span class="nav-text">defineProps|defineEmits</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%B1%BB%E5%9E%8B%E5%A3%B0%E6%98%8E%E6%97%B6%E7%9A%84%E9%BB%98%E8%AE%A4-props-%E5%80%BC"><span class="nav-number">5.2.5.1.</span> <span class="nav-text">使用类型声明时的默认 props 值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#props-emit-%E7%B1%BB%E5%9E%8B%E5%A3%B0%E6%98%8E"><span class="nav-number">5.2.5.2.</span> <span class="nav-text">props|emit 类型声明</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defineExpose"><span class="nav-number">5.2.6.</span> <span class="nav-text">defineExpose()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defineOptions"><span class="nav-number">5.2.7.</span> <span class="nav-text">defineOptions()  </span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defineSlots"><span class="nav-number">5.2.8.</span> <span class="nav-text">defineSlots()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#definePropsRefs"><span class="nav-number">5.2.9.</span> <span class="nav-text">definePropsRefs()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defineRender"><span class="nav-number">5.2.10.</span> <span class="nav-text">defineRender()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#defineModel"><span class="nav-number">5.2.11.</span> <span class="nav-text">defineModel()</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E9%A5%B0%E7%AC%A6%E5%92%8C%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="nav-number">5.2.11.1.</span> <span class="nav-text">修饰符和转换器</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useSlots-useAttrs"><span class="nav-number">5.2.12.</span> <span class="nav-text">useSlots()|useAttrs()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E6%99%AE%E9%80%9A-script-%E4%B8%80%E8%B5%B7%E7%94%A8"><span class="nav-number">5.2.13.</span> <span class="nav-text">与普通 script 一起用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A1%B6%E5%B1%82-await"><span class="nav-number">5.2.14.</span> <span class="nav-text">顶层 await</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%99%90%E5%88%B6"><span class="nav-number">5.2.15.</span> <span class="nav-text">限制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSS-%E5%8A%9F%E8%83%BD"><span class="nav-number">5.3.</span> <span class="nav-text">CSS 功能</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">5.3.1.</span> <span class="nav-text">组件作用域</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%B1%E5%BA%A6%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-number">5.3.1.1.</span> <span class="nav-text">深度选择器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8F%92%E6%A7%BD%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-number">5.3.1.2.</span> <span class="nav-text">插槽选择器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-number">5.3.1.3.</span> <span class="nav-text">全局选择器</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#css-Modules"><span class="nav-number">5.3.2.</span> <span class="nav-text">css Modules</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E5%85%A5%E5%90%8D%E7%A7%B0"><span class="nav-number">5.3.2.1.</span> <span class="nav-text">自定义注入名称</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8E%E7%BB%84%E5%90%88%E5%BC%8F-API%E4%B8%80%E8%B5%B7%E4%BD%BF%E7%94%A8"><span class="nav-number">5.3.2.2.</span> <span class="nav-text">与组合式 API一起使用</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CSS-%E4%B8%AD%E7%9A%84-v-bind"><span class="nav-number">5.3.3.</span> <span class="nav-text">CSS 中的 v-bind()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9B%E9%98%B6-API"><span class="nav-number">6.</span> <span class="nav-text">进阶 API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0"><span class="nav-number">6.1.</span> <span class="nav-text">渲染函数  </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#h"><span class="nav-number">6.1.1.</span> <span class="nav-text">h()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mergeProps"><span class="nav-number">6.1.2.</span> <span class="nav-text">mergeProps()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cloneVNode"><span class="nav-number">6.1.3.</span> <span class="nav-text">cloneVNode()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#isVNode"><span class="nav-number">6.1.4.</span> <span class="nav-text">isVNode()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resolveComponent"><span class="nav-number">6.1.5.</span> <span class="nav-text">resolveComponent()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#resolveDirective"><span class="nav-number">6.1.6.</span> <span class="nav-text">resolveDirective()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#withDirectives"><span class="nav-number">6.1.7.</span> <span class="nav-text">withDirectives()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#withModifiers"><span class="nav-number">6.1.8.</span> <span class="nav-text">withModifiers()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%BC%E5%90%88%E4%BD%BF%E7%94%A8"><span class="nav-number">6.1.9.</span> <span class="nav-text">综合使用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E6%8C%82%E8%BD%BD"><span class="nav-number">6.1.9.1.</span> <span class="nav-text">自定义指令挂载</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E6%9B%B4%E6%96%B0"><span class="nav-number">6.1.9.2.</span> <span class="nav-text">自定义指令更新</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4%E5%8D%B8%E8%BD%BD"><span class="nav-number">6.1.9.3.</span> <span class="nav-text">自定义指令卸载</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-Hook"><span class="nav-number">6.2.</span> <span class="nav-text">自定义 Hook</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93"><span class="nav-number">6.3.</span> <span class="nav-text">服务端渲染</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToString"><span class="nav-number">6.3.1.</span> <span class="nav-text">renderToString()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToNodeStream"><span class="nav-number">6.3.2.</span> <span class="nav-text">renderToNodeStream()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pipeToNodeWritable"><span class="nav-number">6.3.3.</span> <span class="nav-text">pipeToNodeWritable()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToWebStream"><span class="nav-number">6.3.4.</span> <span class="nav-text">renderToWebStream()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pipeToWebWritable"><span class="nav-number">6.3.5.</span> <span class="nav-text">pipeToWebWritable()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#renderToSimpleStream"><span class="nav-number">6.3.6.</span> <span class="nav-text">renderToSimpleStream()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#useSSRContext"><span class="nav-number">6.3.7.</span> <span class="nav-text">useSSRContext()</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#data-allow-mismatch"><span class="nav-number">6.3.8.</span> <span class="nav-text">data-allow-mismatch</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%9E%8B"><span class="nav-number">6.4.</span> <span class="nav-text">工具类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PropType-lt-T-gt"><span class="nav-number">6.4.1.</span> <span class="nav-text">PropType&lt;T&gt;</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ComponentCustomProperties"><span class="nav-number">6.4.2.</span> <span class="nav-text">ComponentCustomProperties</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ComponentCustomOptions"><span class="nav-number">6.4.3.</span> <span class="nav-text">ComponentCustomOptions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ComponentCustomProps"><span class="nav-number">6.4.4.</span> <span class="nav-text">ComponentCustomProps</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CSSProperties"><span class="nav-number">6.4.5.</span> <span class="nav-text">CSSProperties</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B8%B2%E6%9F%93"><span class="nav-number">6.5.</span> <span class="nav-text">自定义渲染</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#createRenderer"><span class="nav-number">6.5.1.</span> <span class="nav-text">createRenderer()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Router"><span class="nav-number">7.</span> <span class="nav-text">Router</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E7%A8%8B%E5%BC%8F%E5%AF%BC%E8%88%AA"><span class="nav-number">7.1.</span> <span class="nav-text">编程式导航</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pinia"><span class="nav-number">8.</span> <span class="nav-text">Pinia  </span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="luoleiself"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">luoleiself</p>
  <div class="site-description" itemprop="description">努力的往前飞, 再累也无所谓, 黑夜过后的光芒有多美...</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">57</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/luoleiself" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luoleiself" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:luoleiself@163.com" title="E-Mail → mailto:luoleiself@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://developer.mozilla.org/zh-CN/" title="https:&#x2F;&#x2F;developer.mozilla.org&#x2F;zh-CN&#x2F;" rel="noopener" target="_blank">MDN</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">luoleiself</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">760k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">11:31</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div><!-- canvas-nest -->
<!-- modify source/_data/footer.swig -->
<!-- modify _config.next.yml -> custom_file_path:footer -->
<!--
<script color="0,0,255" opacity="0.7" zIndex="-1" count="200" src="//cdn.jsdelivr.net/npm/canvas-nest.js@1/dist/canvas-nest.js"></script> 
-->
<style>
.highlight-container ::selection {
  color: #fc7237
};
</style>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/lozad.js/1.14.0/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
